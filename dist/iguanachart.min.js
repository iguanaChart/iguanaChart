function formatDate(t,e){var i=new Date,e=i.getTime(),t=new Date(e+864e5*+t);return i.setTime(t.getTime()),iChart.formatDateTime(i,"dd.MM.yyyy")+(e?" 23:59":"")}function _(t,e){if(void 0!==_.data)return _.data[t]||(i18n[t]?(_.data[t]=i18n[t],_.data[t]):e)}function translateGetPluralForm(t,e,i){var a=parseInt(e)==e,r=2;if("ru"==i||"uk"==i)if(a){a=1<(""+e).length&&(""+e).substr(-2,1);if("1"==a)r=3;else switch((""+e).substr(-1)){case"1":r=1;break;case"2":case"3":case"4":r=2;break;default:case"0":case"5":case"6":case"7":case"8":case"9":r=3}}else r=2;else r=1<e?2:1;t=t.split("||");return void 0===t[r-1]?t[0]:t[r-1]}function intervalNames(t){switch(t){case"S30":return _t("2072","30 секундный");case"I1":return _t("2073","минутный");case"I5":return _t("2074","5 минутный");case"I15":return _t("2075","15 минутный");case"H1":return _t("2076","Часовик");case"D1":return _t("2077","Дневной");case"D7":return _t("2078","Недельный");default:return""}}function intervalShortNames(t){switch(t){case"S30":return _t("1176","30c");case"I1":return _t("1370","М");case"I5":return _t("3331","5М");case"I15":return _t("3332","15М");case"H1":return _t("3333","Ч");case"D1":return _t("1368","Д");case"D3":return _t("15824","3Д");case"D7":return _t("1369","Н");case"M1":return _t("1370","М");case"M3":return _t("1371","3М");default:return""}}function getTradeLabelText(t,e){e=parseInt(t.volume)+"@"+e;return 1===t.type_id?"B: "+e:2===t.type_id?"S: "+e:3===t.type_id?"TP: "+e:4===t.type_id?"SL: "+e:void 0}!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(a){var i=[],r=a(document),t=navigator.userAgent.toLowerCase(),s=a(window),h=[],l={ieQuirks:null,msie:/msie/.test(t)&&!/opera/.test(t),opera:/opera/.test(t)};l.ie6=l.msie&&/msie 6./.test(t)&&"object"!=typeof window.XMLHttpRequest,l.ie7=l.msie&&/msie 7.0/.test(t),l.boxModel="CSS1Compat"===document.compatMode,a.modal=function(t,e){return a.modal.impl.init(t,e)},a.modal.close=function(){a.modal.impl.close()},a.modal.focus=function(t){a.modal.impl.focus(t)},a.modal.setContainerDimensions=function(){a.modal.impl.setContainerDimensions()},a.modal.setPosition=function(){a.modal.impl.setPosition()},a.modal.update=function(t,e){a.modal.impl.update(t,e)},a.fn.modal=function(t){return a.modal.impl.init(this,t)},a.modal.defaults={appendTo:"body",focus:!0,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},title:"",titleId:"simplemodal-title",titleCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:!1,autoPosition:!0,zIndex:1e3,close:!0,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"uk-icon-close",escClose:!0,overlayClose:!1,fixed:!0,position:null,persist:!1,draggable:!1,modal:!0,onOpen:null,onShow:null,onClose:null},a.modal.impl={d:{},init:function(t,e){var i=this;if(i.d.data)return i;if(l.ieQuirks=l.msie&&!l.boxModel,i.o=a.extend({},a.modal.defaults,e),i.zIndex=i.o.zIndex,i.occb=!1,"object"==typeof t)t=t instanceof a?t:a(t),i.d.placeholder=!1,0<t.parent().parent().length&&(t.before(a("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"})),i.d.placeholder=!0,i.display=t.css("display"),i.o.persist||(i.d.orig=t.clone(!0)));else{if("string"!=typeof t&&"number"!=typeof t)return alert("SimpleModal Error: Unsupported data type: "+typeof t),i;t=a("<div></div>").html(t)}return i.create(t),t=null,i.open(),a.isFunction(i.o.onShow)&&i.o.onShow.apply(i,[i.d]),i},create:function(t){var e=this;e.getDimensions(),e.o.modal&&l.ie6&&(e.d.iframe=a('<iframe src="javascript:false;"></iframe>').css(a.extend(e.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:h[0],width:h[1],zIndex:e.o.zIndex,top:0,left:0})).appendTo(e.o.appendTo)),e.d.overlay=a("<div></div>").attr("id",e.o.overlayId).addClass("simplemodal-overlay").css(a.extend(e.o.overlayCss,{display:"none",opacity:e.o.opacity/100,height:e.o.modal?i[0]:0,width:e.o.modal?i[1]:0,position:"fixed",left:0,top:0,zIndex:e.o.zIndex+1})).appendTo(e.o.appendTo),e.d.container=a("<div></div>").attr("id",e.o.containerId).addClass("simplemodal-container").css(a.extend({position:e.o.fixed?"fixed":"absolute"},e.o.containerCss,{display:"none",zIndex:e.o.zIndex+2})).append(e.o.close&&e.o.closeHTML?a(e.o.closeHTML).addClass(e.o.closeClass):"").appendTo(e.o.appendTo),e.d.title=a("<div></div>").attr("id",e.o.titleId).addClass("simplemodal-title").css(a.extend({},e.o.titleCss)).append(e.o.title).appendTo(e.d.container),e.d.wrap=a("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").appendTo(e.d.container),e.d.data=t.attr("id",t.attr("id")||e.o.dataId).addClass("simplemodal-data").css(a.extend(e.o.dataCss,{display:"none"})).appendTo("body"),t=null,e.setContainerDimensions(),e.d.data.appendTo(e.d.wrap),e.o.draggable&&"function"==typeof e.d.container.draggable&&e.d.container.draggable({handle:e.d.title,snap:!1}),(l.ie6||l.ieQuirks)&&e.fixIE()},bindEvents:function(){var e=this;a("."+e.o.closeClass).bind("click.simplemodal",function(t){t.preventDefault(),e.close()}),e.o.modal&&e.o.close&&e.o.overlayClose&&e.d.overlay.bind("click.simplemodal",function(t){t.preventDefault(),e.close()}),r.bind("keydown.simplemodal",function(t){e.o.modal&&9===t.keyCode?e.watchTab(t):e.o.close&&e.o.escClose&&27===t.keyCode&&(t.preventDefault(),e.close())}),s.bind("resize.simplemodal orientationchange.simplemodal",function(){e.getDimensions(),e.o.autoResize?e.setContainerDimensions():e.o.autoPosition&&e.setPosition(),l.ie6||l.ieQuirks?e.fixIE():e.o.modal&&(e.d.iframe&&e.d.iframe.css({height:h[0],width:h[1]}),e.d.overlay.css({height:i[0],width:i[1]}))})},unbindEvents:function(){a("."+this.o.closeClass).unbind("click.simplemodal"),r.unbind("keydown.simplemodal"),s.unbind(".simplemodal"),this.d.overlay.unbind("click.simplemodal")},fixIE:function(){var t=this,f=t.o.position;a.each([t.d.iframe||null,t.o.modal?t.d.overlay:null,"fixed"===t.d.container.css("position")?t.d.container:null],function(t,e){var i,a,r,s,n,o,h,l,c,d,p,u,g;e&&(i="document.body.clientHeight",a="document.body.clientWidth",r="document.body.scrollHeight",s="document.body.scrollLeft",n="document.body.scrollTop",o="document.body.scrollWidth",h="document.documentElement.clientHeight",l="document.documentElement.clientWidth",c="document.documentElement.scrollLeft",d="document.documentElement.scrollTop",(p=e[0].style).position="absolute",t<2?(p.removeExpression("height"),p.removeExpression("width"),p.setExpression("height",r+" > "+i+" ? "+r+" : "+i+' + "px"'),p.setExpression("width",o+" > "+a+" ? "+o+" : "+a+' + "px"')):(f&&f.constructor===Array?(g=-1===(g=f[0]?"number"==typeof f[0]?f[0].toString():f[0].replace(/px/,""):e.css("top").replace(/px/,"")).indexOf("%")?g+" + (t = "+d+" ? "+d+" : "+n+') + "px"':parseInt(g.replace(/%/,""))+" * (("+h+" || "+i+") / 100) + (t = "+d+" ? "+d+" : "+n+') + "px"',f[1]&&(u=-1===(u="number"==typeof f[1]?f[1].toString():f[1].replace(/px/,"")).indexOf("%")?u+" + (t = "+c+" ? "+c+" : "+s+') + "px"':parseInt(u.replace(/%/,""))+" * (("+l+" || "+a+") / 100) + (t = "+c+" ? "+c+" : "+s+') + "px"')):(g="("+h+" || "+i+") / 2 - (this.offsetHeight / 2) + (t = "+d+" ? "+d+" : "+n+') + "px"',u="("+l+" || "+a+") / 2 - (this.offsetWidth / 2) + (t = "+c+" ? "+c+" : "+s+') + "px"'),p.removeExpression("top"),p.removeExpression("left"),p.setExpression("top",g),p.setExpression("left",u)))})},focus:function(t){var e=this,t=t&&-1!==a.inArray(t,["first","last"])?t:"first",i=a(":input:enabled:visible:"+t,e.d.wrap);setTimeout(function(){(0<i.length?i:e.d.wrap).focus()},10)},getDimensions:function(){var t=void 0===window.innerHeight?s.height():window.innerHeight;i=[r.height(),r.width()],h=[t,s.width()]},getVal:function(t,e){return t?"number"==typeof t?t:"auto"===t?0:0<t.indexOf("%")?parseInt(t.replace(/%/,""))/100*("h"===e?h[0]:h[1]):parseInt(t.replace(/px/,"")):null},update:function(t,e){var i=this;if(!i.d.data)return!1;i.d.origHeight=i.getVal(t,"h"),i.d.origWidth=i.getVal(e,"w"),i.d.data.hide(),t&&i.d.container.css("height",t),e&&i.d.container.css("width",e),i.setContainerDimensions(),i.d.data.show(),i.o.focus&&i.focus(),i.unbindEvents(),i.bindEvents()},setContainerDimensions:function(){var t=this,e=(l.ie6||l.ie7,""),i="",a=t.d.data.outerHeight(!0)+t.d.container.height(),r=t.d.data.outerWidth(!0)+t.d.container.width();t.d.origHeight=t.d.origHeight||e,t.d.origWidth=t.d.origWidth||i;var s=t.o.maxHeight?t.getVal(t.o.maxHeight,"h"):null,n=t.o.maxWidth?t.getVal(t.o.maxWidth,"w"):null,o=s&&s<h[0]?s:h[0],s=n&&n<h[1]?n:h[1],n=t.o.minHeight?t.getVal(t.o.minHeight,"h"):"auto",e=e?t.o.autoResize&&o<e?o:e<n?n:e:a?o<a?o:t.o.minHeight&&"auto"!==n&&a<n?n:a:n,n=t.o.minWidth?t.getVal(t.o.minWidth,"w"):"auto",i=i?t.o.autoResize&&s<i?s:i<n?n:i:r?s<r?s:t.o.minWidth&&"auto"!==n&&r<n?n:r:n;t.d.container.css({height:e,width:i}),t.d.wrap.css({overflow:e<a||i<r?"auto":"visible"}),t.o.autoPosition&&t.setPosition()},setPosition:function(){var t,e=this,i=h[0]/2-e.d.container.outerHeight(!0)/2,a=h[1]/2-e.d.container.outerWidth(!0)/2,r="fixed"!==e.d.container.css("position")?s.scrollTop():0,a=e.o.position&&"[object Array]"===Object.prototype.toString.call(e.o.position)?(t=parseFloat(r)+parseFloat(e.o.position[0]||i),e.o.position[1]||a):(t=r+i,a);e.d.container.css({left:a,top:t})},watchTab:function(t){var e,i=this;0<a(t.target).parents(".simplemodal-container").length?(i.inputs=a(":input:enabled:visible:first, :input:enabled:visible:last",i.d.data[0]),(!t.shiftKey&&t.target===i.inputs[i.inputs.length-1]||t.shiftKey&&t.target===i.inputs[0]||0===i.inputs.length)&&(t.preventDefault(),e=t.shiftKey?"last":"first",i.focus(e))):(t.preventDefault(),i.focus())},open:function(){var t=this;t.d.iframe&&t.d.iframe.show(),a.isFunction(t.o.onOpen)?t.o.onOpen.apply(t,[t.d]):(t.d.overlay.show(),t.d.container.show(),t.d.data.show()),t.o.focus&&t.focus(),t.bindEvents()},close:function(t){t=void 0===t||!!t;var e=this;if(!e.d.data)return!1;e.unbindEvents(),a.isFunction(e.o.onClose)&&!e.occb&&t?(e.occb=!0,e.o.onClose.apply(e,[e.d])):(e.d.placeholder?(t=a("#simplemodal-placeholder"),e.o.persist?t.replaceWith(e.d.data.removeClass("simplemodal-data").css("display",e.display)):(e.d.data.hide().remove(),t.replaceWith(e.d.orig))):e.d.data.hide().remove(),e.d.container.hide().remove(),e.d.overlay.hide(),e.d.iframe&&e.d.iframe.hide().remove(),e.d.overlay.remove(),e.d={})}}}),function(h){var l={palettes:{basic:["#000000","#7f7f7f","#880015","#ed1c24","#ff7f27","#fff200","#22b14c","#00a2e8","#3f48cc","#a349a4","#ffffff","#c3c3c3","#b97a57","#ffaec9","#ffc90e","#efe4b0","#b5e61d","#99d9ea","#7092be","#c8bfe7"]},defaults:{palette:[],columns:1,size:20,value:"",change:function(){}},init:function(t){var e=h.extend({},l.defaults,t);"string"==typeof t.palette&&l.palettes[t.palette]&&(e.palette=l.palettes[t.palette]),e.element=this;for(var i=Math.ceil(e.palette.length/e.columns),a=h("<table>").css({"border-collapse":"collapse",position:"relative",width:+e.columns*(+e.size+2)+"px",margin:0,padding:0,border:0,outline:0,"text-decoration":"none","font-size":"100%","list-style":"none"}),r=0;r<i;r++){for(var s=h("<tr>"),n=0;n<e.columns;n++){var o=h("<td>",{class:"palette-item"}).attr("data-color",e.palette[r*e.columns+n]).css({width:e.size,height:e.size,"background-color":e.palette[r*e.columns+n]});s.append(o)}a.append(s)}a.on("click","td",function(){e.value=h(this).data("color"),e.change.call(e)}),this.append(a).css({position:"relative","line-height":0,"border-width":0,display:"inline-block"}),this.data("palette",e)}};h.fn.palette=function(i){if(void 0===i||"object"==typeof i)return this.each(function(t){var e=h(this);return l.init.call(e,i,t),e});if("string"!=typeof i)return console.error("Options should be object, string or undefined");var a=Array.prototype.slice.call(arguments,1);if(l[i]&&"function"==typeof l[i]){if(a.length)return this.each(function(t){var e=h(this);return l[i].call(e,a),e});var t=h(this).eq(0);return l[i].call(t,a)}return console.error("Method should be function")}}(jQuery),"undefined"==typeof tzOffsetMoscow&&(tzOffsetMoscow=10800),"undefined"==typeof LANG_NAME&&(LANG_NAME="en"),"undefined"==typeof IGUANACHART_THEME&&(IGUANACHART_THEME="White"),"undefined"==typeof MOBILE_BROWSER_DETECTED&&(MOBILE_BROWSER_DETECTED=!1),Date.parse=function(t){if(!t)return null;if(t instanceof Date)return t.getTime();var e=t.match(/^\s*([0-9]{4})-([0-9]{2})-([0-9]{2})[\s|T]{0,1}(?:\s*(\d\d{0,1}):?(\d\d{0,1})(?::?(\d\d{0,1}))?(?:\.([0-9]{0,3}))?)?\s*$/);if(e){var i=new Date(e[1],e[2]-1,e[3]);return void 0!==e[4]&&void 0!==e[5]&&i.setHours(e[4],e[5],e[6]||0,e[7]||0),i.getTime()}if(e=t.match(new RegExp("^\\s*([0-9]{1,2})(?:.|-|/|\\s)([0-9]{1,2})(?:.|-|/|\\s)([0-9]{4})(?:\\s*([0-9]{1,2}):?([0-9]{1,2})(?::?([0-9]{1,2}))?)?\\s*$"))){i=new Date(e[3],e[2]-1,e[1]);return void 0!==e[4]&&void 0!==e[5]&&i.setHours(e[4],e[5],e[6]||0),i.getTime()}return new Date(t).getTime()},"undefined"==typeof _t&&(_.data={},_t=function(t,e,i){var a="",r=!1,s="object"==typeof i&&void 0!==i.QTY&&-1!=e.indexOf("||");return void 0!==(a=_(t,e))&&a!=e||(a=e,r=!0),s&&(a=translateGetPluralForm(a,i.QTY,r?"ru":LANG_NAME)),"object"==typeof i&&$.each(i,function(t,e){a=a.replace(new RegExp("%"+t+"%","g"),e)})," "+a+" "}),void 0===String.prototype.hashCode&&(String.prototype.hashCode=function(){var t,e,i=0;if(0==this.length)return i;for(t=0,e=this.length;t<e;t++)i=(i<<5)-i+this.charCodeAt(t),i|=0;return i}),"undefined"==typeof getTimeOffsetServer&&(getTimeOffsetServer=function(t){return(t=t||0)+60*(new Date).getTimezoneOffset()}),function(h){"use strict";function a(t,e){return""===e?"":e}var r;function l(t){return t<10?"0"+t:t}"undefined"!=typeof JSON&&""!==JSON.stringify(document.createElement("input").value)&&(r=JSON.stringify,JSON.stringify=function(t,e,i){return r(t,a,i)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){if((e=void 0===e?0:parseInt(e,10))>=this.length)return-1;e<0&&(e=Math.max(0,this.length+e));for(var i=e;i<this.length;++i)if(this[i]===t)return i;return-1}),String.prototype.expandExponential=function(){return this.replace(/^([+-])?(\d+).?(\d*)[eE]([-+]?\d+)$/,function(t,e,i,a,r){var s=+r<0,n=i.length+ +r,t=(s?i:a).length,r=(r=Math.abs(r))>=t?r-t+s:0,r=new Array(r+1).join("0"),a=i+a;return(e||"")+(s?a=r+a:a+=r).substr(0,n+=s?r.length:0)+(n<a.length?"."+a.substr(n):"")})},h.inheritPrototype=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t},void 0===h.iChart&&(h.iChart={}),h.iChart.dayShortNames=[_t("2129","Пн"),_t("2130","Вт"),_t("2131","Ср"),_t("2132","Чт"),_t("2133","Пт"),_t("2134","Сб"),_t("2135","Вс")],h.iChart.monthNames=[_t("3280","Январь"),_t("3281","Февраль"),_t("3282","Март"),_t("3283","Апрель"),_t("3284","Май"),_t("3285","Июнь"),_t("3286","Июль"),_t("3287","Август"),_t("3288","Сентябрь"),_t("3289","Октябрь"),_t("3290","Ноябрь"),_t("3291","Декабрь")],h.iChart.monthRNames=[_t("1889","января"),_t("1890","февраля"),_t("1891","марта"),_t("1892","апреля"),_t("1893","мая"),_t("1894","июня"),_t("1895","июля"),_t("1896","августа"),_t("1897","сентября"),_t("1898","октября"),_t("1899","ноября"),_t("1900","декабря")],h.iChart.monthShortNames=[_t("3502","янв"),_t("3503","фев"),_t("3504","мар"),_t("3505","апр"),_t("4939","май"),_t("3507","июн"),_t("3508","июл"),_t("3509","авг"),_t("3510","сен"),_t("3511","окт"),_t("3512","ноя"),_t("3513","дек")],h.iChart.declineNoun=function(t,e,i,a){return t=Math.abs(t),5<=(t%=100)&&t<=20?a:1==(t%=10)?e:2<=t&&t<=4?i:a},h.iChart.formatDateTime=function(t,e){if(!t)return"";e=e||(0===t.getHours()&&0===t.getMinutes()?"dd.MM.yyyy":0===t.getSeconds()?"dd.MM.yyyy HH:mm":"dd.MM.yyyy HH:mm:ss");for(var i="",a=[],r=0;r<e.length;++r){var s=e.charAt(r);if(0!==i.length){var n=i.charAt(i.length-1);if("d"!==s&&"M"!==s&&"y"!==s&&"H"!==s&&"m"!==s&&"s"!==s){if("d"!==n&&"M"!==n&&"y"!==n&&"H"!==n&&"m"!==n&&"s"!==n){i+=s;continue}}else if(s===n){i+=s;continue}a.push(i),i=s}else i=s}0!==i.length&&a.push(i);for(var o="",r=0;r<a.length;++r)switch(i=a[r]){case"d":o+=t.getDate();break;case"dd":o+=l(t.getDate());break;case"M":o+=t.getMonth()+1;break;case"MM":o+=l(t.getMonth()+1);break;case"MMM":o+=h.iChart.monthShortNames[t.getMonth()];break;case"MMMM":o+=h.iChart.monthRNames[t.getMonth()];break;case"yy":o+=t.getFullYear().toString().substr(2,2);break;case"yyyy":o+=t.getFullYear();break;case"H":o+=t.getHours();break;case"HH":o+=l(t.getHours());break;case"m":o+=t.getMinutes();break;case"mm":o+=l(t.getMinutes());break;case"s":o+=t.getSeconds();break;case"ss":o+=l(t.getSeconds());break;default:o+=i}return o},h.iChart.formatNumber=function(t,e){if(null==t)return"";0!==(e=$.extend({decimalPlaces:null,decimalPrecision:null,decimalSeparator:".",scale:0,thousandsSeparator:" "},e)).scale&&(t/=Math.pow(10,3*e.scale));var i=null!==e.decimalPlaces,t=i?parseFloat(h.iChart.toFixed(t,e.decimalPlaces)):null!==e.decimalPrecision?parseFloat(t.toPrecision(e.decimalPrecision)):t,t=t.toString().expandExponential().split(".");3<t[0].length&&(t[0]=t[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,e.thousandsSeparator)),i&&(t[1]||"").length<e.decimalPlaces&&(t[1]=t[1]||"",t[1]+=new Array(e.decimalPlaces-t[1].length+1).join("0"));var a=t.join(e.decimalSeparator).replace("-","−");switch(e.scale){case 0:break;case 1:a+=_t("3496","тыс.");break;case 2:a+=_t("2137","млн");break;case 3:a+=_t("4708","млрд");break;case 4:a+=_t("2139","трлн");break;default:throw new Error("Number scale '"+e.scale+"' is invalid.")}return a},h.iChart.parseDateTime=function(t,e){if(!t)return null;if(t instanceof Date)return t;var i;if("yyyyMMddHHmm"===e)return(i=t.match(new RegExp("^([0-9]{4})([0-9]{2})([0-9]{2})([0-9]{2})([0-9]{2})$")))?a=new Date(i[1],i[2]-1,i[3],i[4],i[5],0,0):null;if("yyyy-MM-dd HH:mm:ss"===e)return(i=t.match(new RegExp("^([0-9]{4})-([0-9]{2})-([0-9]{2})\\s([0-9]{2}):([0-9]{2}):([0-9]{2})")))?a=new Date(i[1],i[2]-1,i[3],i[4],i[5],i[6],0):null;if(!(i=t.match(new RegExp("^\\s*([0-9]{1,2})(?:.|-|/|\\s)([0-9]{1,2})(?:.|-|/|\\s)([0-9]{4})(?:\\s*([0-9]{1,2}):?([0-9]{1,2})(?::?([0-9]{1,2}))?)?\\s*$"))))return null;var a=new Date(i[3],i[2]-1,i[1]);return void 0!==i[4]&&void 0!==i[5]&&a.setHours(i[4],i[5],i[6]||0),a},h.iChart.parseQueryString=function(t){if("string"!=typeof t)return{};var e=t.indexOf("?");-1!==e&&(t=t.substr(e+1));for(var i=t.split("&"),a={},r=0;r<i.length;++r){var s=i[r].split("=");if(2===s.length){var n=decodeURIComponent(s[0]),o=decodeURIComponent(s[1]);switch(typeof a[n]){case"object":a[n].push(o);break;case"string":a[n]=[a[n],o];break;case"undefined":a[n]=o}}}return a},h.iChart.toFixed=function(t,e){e=Math.pow(10,e);return Math.round(t*e)/e},h.iChart.roundToPrecision=function(t,e){if((e=parseFloat(e))<1){var i=parseFloat(e).toString().length-2;return+(Math.round(t*(1/e))/(1/e)).toFixed(i)}return+(Math.round(t*(1/e))/(1/e)).toFixed(0)},h.iChart.toQueryString=function(t,e){var i,a=[];for(i in t)if(t.hasOwnProperty(i)){var r=t[i];if(null!=r&&""!==r)if($.isArray(r))for(var s=0;s<r.length;++s)a.push(encodeURIComponent(i)+"="+encodeURIComponent(r[s]));else r instanceof Date&&(r=iChart.formatDateTime(r)),a.push(encodeURIComponent(i)+"="+encodeURIComponent(r))}var n="";return e&&0!==a.length&&(n+="?"),n+=a.join("&")},h.iChart.rgbToHex=function(t){var e,i,a;if(/^#[a-fA-F0-9]{3,6}$/.test(t))return t.length<7&&(t=(e=t.split(""))[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),t;for(a=(i=(((t=[].slice.call(arguments).join(",").match(/\d+/g))[0]<<16)+(t[1]<<8)+ +t[2]).toString(16)).length;a++<6;)i="0"+i;return"#"+i},h.iChart.rgbaGetAlfa=function(t){t=t.match(/\((.*),(.*),(.*),(.*)\)/);return t&&t[4]?+t[4]:1},h.iChart.hexToRGB=function(t,e){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?"rgba("+parseInt(t[1],16)+","+parseInt(t[2],16)+","+parseInt(t[3],16)+","+e+")":null},h.iChart.invertColor=function(t){t=[].slice.call(arguments).join(",").replace(/rgb\(|\)|rgba\(|\)|\s/gi,"").split(",");for(var e=0;e<t.length;e++)t[e]=(3===e?1:255)-t[e];return t.join(", ")},h.iChart.getIntersection=function(t,e,i,a){if((t.y-e.y)*(a.x-i.x)-(i.y-a.y)*(e.x-t.x)==0||a.x-i.x==0)return!1;t=-((t.x*e.y-e.x*t.y)*(a.x-i.x)-(i.x*a.y-a.x*i.y)*(e.x-t.x))/((t.y-e.y)*(a.x-i.x)-(i.y-a.y)*(e.x-t.x));return{x:t,y:((i.y-a.y)*-t-(i.x*a.y-a.x*i.y))/(a.x-i.x)}},h.iChart.getThirdPoint=function(t,e,i){t=(parseFloat(i)-parseFloat(t.x))*(parseFloat(e.y)-parseFloat(t.y))/(parseFloat(e.x)-parseFloat(t.x))+parseFloat(t.y);return{x:parseFloat(i),y:t}},h.iChart.getLineEquation=function(t,e,i){e=(+e.y-+t.y)/(+e.x-+t.x),t=+t.y-e*t.x;return{x:+i,y:e*+i+t,k:e,b:t}},h.iChart.getChartTimeframe=function(t){switch(t){case"I1":return 1;case"I5":return 5;case"I15":return 15;case"H1":return 60;case"D1":return 1440;case"D7":return 10080;default:return 1440}},h.iChart.getContext=function(t){var e=t.getContext("2d");return e.scaled||(t=Math.max(window.devicePixelRatio||1,1),e.scale(t,t),e.scaled=1),e},h.iChart.animateId=null,h.iChart.animate=function(a){var r=performance.now();h.iChart.animateId=requestAnimationFrame(function t(e){var i=(e-r)/a.duration;1<i&&(i=1);e=a.timing(i);a.draw(e),i<1?h.iChart.animateId=requestAnimationFrame(t):(cancelAnimationFrame(h.iChart.animateId),"function"==typeof a.complete&&a.complete())})}}(window),iChart.indicators={AD:{type:"TA_LIB",output:1,name:_t("428","AD (Распределение накопления)"),value:"AD",outputRegion:"self",description:_t("4789","Формула распределения накопления использует отношение между объемом и ценами, чтобы оценить интенсивность изменения цен; если объем увеличивается, весьма вероятно, что цены поднимутся.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5400">'+_t("15840","Подробнее.")+"</a>",parameters:[]},ADOSC:{type:"TA_LIB",output:1,name:_t("429","ADOSC (Осциллятор Чайкина)"),value:"ADOSC",outputRegion:"self",description:_t("4790","Индикатор осциллятора Чайкина – это разница между трехдневным экспоненциальным скользящим средним и десятидневным экспоненциальным скользящим средним, примененная к распределению накопления.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5425">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"FastPeriod",Name:_t("4791","Краткосрочный интервал"),Value:3},{Code:"SlowPeriod",Name:_t("4792","Долгосрочный интервал"),Value:10}]},ADX:{type:"TA_LIB",output:1,name:_t("430","ADX (Индекс направленного движения)"),value:"ADX",outputRegion:"self",description:_t("4793","Индикатор среднего направленного движения служит для определения вероятного направления основного тренда."),parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:14}]},ADXDI:{type:"TA_LIB",output:3,outputNames:["ADX","PLUS_DI","MINUS_DI"],name:_t("431","ADXDI (Индекс направленного движения (с индикаторами направления))"),value:"ADXDI",outputRegion:"self",description:_t("4793","Индикатор среднего направленного движения служит для определения вероятного направления основного тренда.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5421">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:14}]},AROON:{type:"TA_LIB",output:2,outputNames:["AroonDown","AroonUp"],name:_t("432","AROON (Арун)"),value:"AROON",outputRegion:"self",description:_t("4797","Индикатор Арун применяется для изучения силы и направления трендов."),parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:25}]},ATR:{type:"TA_LIB",output:1,name:_t("433","ATR (Средний истинный диапазон)"),value:"ATR",outputRegion:"self",description:_t("4799","Индикатор среднего истинного диапазона измеряет фиксацию и сравнивает диапазоны между высокими и низкими ценами и ценами закрытия."),parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:14}]},BBANDS:{type:"TA_LIB",output:3,outputNames:["UpperBand","MiddleBand","LowerBand"],name:_t("434","BBANDS (Уровни Боллинджера)"),value:"BBANDS",outputRegion:"price",description:_t("4801","Индикаторы с линиями Боллинджера наносятся на график как уровни стандартного отклонения выше и ниже скользящего среднего.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5397">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("5421","Интервал"),Value:7},{Code:"DeviationsUp",Name:_t("4803","Верхнее число станд. отклонения"),Value:2},{Code:"DeviationsDown",Name:_t("4804","Нижнее число станд. отклонения"),Value:2}]},CCI:{type:"TA_LIB",output:1,name:_t("435","CCI (Индекс товарного канала)"),value:"CCI",outputRegion:"self",description:_t("4805","Индикатор ценовых моментов сравнивает цены с их скользящими средними.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5424">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},CHV:{type:"TA_LIB",output:1,name:_t("436","CHV (Волатильность Чайкина)"),value:"CHV",outputRegion:"self",description:_t("4807","Индикатор волатильности Чайкина показывает разницу между максимальными и минимальными ценами и используется для обозначения верхних и нижних частей рынка."),parameters:[{Code:"TimePeriod",Name:_t("4808","Период EMA"),Value:10},{Code:"PeriodROC",Name:_t("4809","Период ROC"),Value:10}]},DPO:{type:"TA_LIB",output:1,name:_t("437","DPO (Осциллятор цен с исключенным трендом)"),value:"DPO",outputRegion:"self",description:_t("4810","Осциллятор цен с исключенным трендом пытается исключить из цен тренды.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5432">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:20}]},ELDR:{type:"TA_LIB",output:4,outputNames:["Bull","Bear","Rays"],name:_t("17699","ELDR (Лучи Элдера)"),value:"ELDR",outputRegion:"self",description:_t("17700","Индикатор Лучи Элдера поможет вам оценить, в какой момент времени «быки» и «медведи» становятся слабее или сильнее.")+" "+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:13}]},EMA:{type:"TA_LIB",output:1,name:_t("438","EMA (Экспоненциальное скользящее среднее)"),value:"EMA",outputRegion:"price",description:_t("4812","Экспоненциальное скользящее среднее – это среднее значение данных, рассчитанное за некий период времени, причем последние дни имеют в вычислении больший вес.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5396">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:12}]},ENV:{type:"TA_LIB",output:2,outputNames:["Upper","Lower"],name:_t("439","ENV (Конверты)"),value:"ENV",outputRegion:"price",description:_t("4815","Конверты наносятся над и под скользящим средним; смещение определяется указанным процентом.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5431">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:20},{Code:"shift",Name:_t("4817","Сдвиг, %"),Value:1}]},MACD:{type:"TA_LIB",output:3,outputNames:["MACD","MACDSignal","MACDHist"],name:_t("441","MACD (Конвергенция и дивергенция скользящих средних)"),value:"MACD",outputRegion:"self",description:_t("4818","Индикатор конвергенции и дивергенции скользящих средних сравнивает два скользящих средних цен и используется вместе с девятидневным экспоненциальным скользящим средним в качестве сигнала для моментов покупки и продажи.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5428">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"FastPeriod",Name:_t("4819","Краткосрочный период"),Value:12},{Code:"SlowPeriod",Name:_t("4820","Долгосрочный период"),Value:26},{Code:"SignalPeriod",Name:_t("4821","Период сигнальной линии"),Value:9}]},MEDPRICE:{type:"TA_LIB",output:1,name:_t("443","MEDPRICE (Медианная цена)"),value:"MEDPRICE",outputRegion:"price",description:_t("4822","Медианные цены – это средние значения цен за день, которые могут использоваться как фильтр для индикаторов трендов."),parameters:[]},MFI:{type:"TA_LIB",output:1,name:_t("444","MFI (Денежный поток)"),value:"MFI",outputRegion:"self",description:_t("4823","Индикатор денежных потоков сравнивает восходящие и нисходящие изменения типичных цен, приведенных к объему."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:14}]},OBV:{type:"TA_LIB",output:1,name:_t("445","OBV (Балансовый объём)"),value:"OBV",outputRegion:"self",description:_t("4828","Индикатор балансового объема измеряет положительный и отрицательный поток объема.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5434">'+_t("15840","Подробнее.")+"</a>",parameters:[]},PCH:{type:"TA_LIB",output:3,name:_t("17701","PCH (Price chanel)"),value:"PCH",outputRegion:"price",description:_t("17702","price channel это уровни потдержки и сопротивления, которые меняются вместе с ценой."),parameters:[{Code:"TimePeriodLower",Name:_t("17703","Период Lower"),Value:20},{Code:"TimePeriodUpper",Name:_t("17704","Период Upper"),Value:20}]},PSAR:{type:"TA_LIB",output:1,name:_t("447","PSAR (Параболик)"),value:"PSAR",outputRegion:"price",description:_t("4833","Индикатор Параболик помогает определять точки разворота тренда.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5399">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"Acceleration",Name:_t("860","Шаг"),Value:.02},{Code:"Maximum",Name:_t("4835","Максимальный шаг"),Value:.2}]},ROC:{type:"TA_LIB",output:1,name:_t("449","ROC (Темп изменения)"),value:"ROC",outputRegion:"self",description:_t("4840","Индикатор темпов изменений сравнивает указанную цену закрытия с текущей ценой.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5430">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},RSI:{type:"TA_LIB",output:1,name:_t("450","RSI (Индекс относительной силы)"),value:"RSI",outputRegion:"self",description:_t("4842","Индекс относительной силы – это осциллятор момента, сравнивающий восходящие изменения цены закрытия с нисходящими изменениями и выдающий значения в диапазоне от 0 до 100.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5411">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},SMA:{type:"TA_LIB",output:1,name:_t("451","SMA (Простое скользящее среднее)"),value:"SMA",outputRegion:"price",description:_t("4844","Простое скользящее среднее – это среднее значение данных, рассчитанное за некий период времени. Скользящее среднее – самый распространенный индикатор цен в техническом анализе, который можно использовать с любой ценой, например высокой, низкой, ценами открытия и закрытия, а также применять к другим индикаторам."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},STDDEV:{type:"TA_LIB",output:1,name:_t("452","STDDEV (Стандартное отклонение)"),value:"STDDEV",outputRegion:"self",description:_t("4846","Стандартное отклонение используется для обозначения волатильности и показывает, например, разницу между значениями цены закрытия и ее скользящего среднего."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:10}]},STOCH:{type:"TA_LIB",output:2,name:_t("453","STOCH (Вероятностный индикатор)"),value:"STOCH",description:_t("4848","Вероятностный индикатор помогает находить изменения трендов, обнаруживая моменты, когда цены закрытия приближаются к низким ценам на рынке, имеющем восходящий тренд, и когда цены закрытия близки к высоким ценам на рынке, имеющем нисходящий тренд."),parameters:[{Code:"PeriodFastK",Name:_t("4849","Краткосрочный период %K"),Value:5},{Code:"PeriodSlowK",Name:_t("4850","Долгосрочный период %K"),Value:3},{Code:"PeriodSlowD",Name:_t("4851","Период %D"),Value:3}]},TEMA:{type:"TA_LIB",output:1,name:_t("454","TEMA (Тройное экспоненциальное скользящее среднее)"),value:"TEMA",outputRegion:"price",description:_t("4852","Тройное экспоненциальное скользящее среднее основано на тройном скользящем среднем цены закрытия. Его назначение – исключить короткие циклы. Этот индикатор сохраняет цену закрытия в трендах, которые короче указанного периода."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:12}]},TRIMA:{type:"TA_LIB",output:1,name:_t("455","TRIMA (Треугольное скользящее среднее)"),value:"TRIMA",outputRegion:"price",description:_t("4854","Треугольное скользящее среднее – это среднее значение данных, рассчитанное за некий период времени, причем средняя часть данных имеет в вычислении больший вес."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:20}]},TYPPRICE:{type:"TA_LIB",output:1,name:_t("456","TYPPRICE (Типичная цена)"),value:"TYPPRICE",outputRegion:"price",description:_t("4856","Типичная цена – это среднее значение цен за день, которое может использоваться как фильтр для индикаторов трендов."),parameters:[]},VPT:{type:"TA_LIB",output:1,name:_t("457","VPT (Тренд объёма цен)"),value:"VPT",outputRegion:"self",description:_t("4857","Тренд объема цен – это совокупное значение объема, рассчитываемое на основе относительных изменений цены закрытия; его следует использовать с другими индикаторами."),parameters:[]},WCLPRICE:{type:"TA_LIB",output:1,name:_t("458","WCLPRICE (Взвешенная цена закрытия)"),value:"WCLPRICE",outputRegion:"price",description:_t("4858","Формула взвешенной цены закрытия вычисляет среднее значение цен за день. Единственное отличие взвешенной цены закрытия и типичной цены в том, что у цены закрытия больший вес и она считается самой важной ценой.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5433">'+_t("15840","Подробнее.")+"</a>",parameters:[]},WILLR:{type:"TA_LIB",output:1,name:_t("459","WILLR (Процентный диапазон Уильямса)"),value:"WILLR",outputRegion:"self",description:_t("4859","Процентный диапазон Уильямса – это индикатор момента, который показывает уровни перекупленности и перепроданности.")+' <a target="_blank" href="http://www.nettrader.ru/education/book/5410">'+_t("15840","Подробнее.")+"</a>",parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:14}]},WMA:{type:"TA_LIB",output:1,name:_t("460","WMA (Взвешенное скользящее среднее)"),value:"WMA",outputRegion:"price",description:_t("4861","Взвешенное скользящее среднее – это среднее значение данных, рассчитанное за некий период времени, причем последние данные имеют в вычислении больший вес."),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:9}]},ZLEMA:{type:"TA_LIB",output:1,name:_t("17705","ZLEMA (Zero-Lag Moving Average Indicator)"),value:"ZLEMA",outputRegion:"price",description:_t("13667",""),parameters:[{Code:"TimePeriod",Name:_t("1296","Период"),Value:12}]},TRPLN:{type:"TA_LIB",output:0,name:_t("13838","TRPLN (Тенденциальная планиметрия)"),value:"TRPLN",outputRegion:"price",description:_t("13843","Тенденциальная планиметрия"),parameters:[]}},function(){"use strict";"undefined"==typeof iChart&&(iChart={}),iChart.Charting={},iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo=function(t,e){var i,a=0,r=t.length-1;if(-1===r)return-1;if(t[a]>=e)return a;if(t[r]<e)return-1;for(;a<=r;){if(a===r)return a;if(a===r-1)return t[a]<e?r:a;t[i=Math.floor((a+r)/2)]<e?a=i+1:r=i}return i},iChart.Charting.indexOfLastElementLessThanOrEqualTo=function(t,e){var i,a=0,r=t.length-1;if(-1===r)return-1;if(t[a]>e)return-1;if(t[r]<=e)return r;for(;a<=r;){if(a===r)return a;if(a===r-1)return t[r]<=e?r:a;t[i=Math.floor((a+r)/2)]>e?r=i-1:a=i}return i},iChart.Charting.getNearestNotNullIndex=function(t,e){for(var i,a=i=e;;){if($.isArray(t[a])){if(null!=t[a][0])return a}else if(null!=t[a])return a;if($.isArray(t[i])){if(null!=t[i][0])return i}else if(null!=t[i])return i;if(0<a&&a--,i<t.length-1&&i++,a<0&&i>t.length-1)return!1}},iChart.Charting.initCanvas=function(t,e,i,a){if(t){var r=Math.max(window.devicePixelRatio||1,1);if(i*=r,a*=r,e){if(e.width===i&&e.height===a)return e;if("undefined"==typeof FlashCanvas)return e.width=i,e.height=a,e.getContext("2d").scaled=0,e;$(e).remove()}e=document.createElement("canvas");if(e.style.left=0,e.style.position="absolute",e.style.top=0,$(e).unbind("selectstart"),$(e).attr("unselectable","on").css("user-select","none").on("selectstart",!1),t.appendChild(e),void 0===e.getContext){if("undefined"==typeof FlashCanvas)return alert("Ваш браузер не поддерживается."),null;FlashCanvas.initElement(e)}return e.width=i,e.height=a,e}console.log("No chart container. Abort")},iChart.Charting.pointToPointDistanceSquared=function(t,e){var i=t.x-e.x,e=t.y-e.y;return i*i+e*e},iChart.Charting.pointToSegmentDistanceSquared=function(t,e,i){var a=(e.x-t[0].x)*(t[1].x-t[0].x)+(e.y-t[0].y)*(t[1].y-t[0].y);if(a<0)return i?1/0:iChart.Charting.pointToPointDistanceSquared(e,t[0]);var r=iChart.Charting.pointToPointDistanceSquared(t[1],t[0]);if(r<a||r<1e-5)return i?1/0:iChart.Charting.pointToPointDistanceSquared(e,t[1]);r=a/r,t={x:t[0].x+r*(t[1].x-t[0].x),y:t[0].y+r*(t[1].y-t[0].y)};return iChart.Charting.pointToPointDistanceSquared(e,t)}}(),function(){"use strict";iChart.Charting.ChartWidgetLayer=function(t,e){if(this.canvas=null,this.chart=t,this.widget={widgetCurPrice:{enable:!1,width:200,height:44,valign:"top",halign:"left",vspace:0,hspace:50}},this.prevX=null,this.prevY=null,this.prevValueX=null,this.prevValueY=null,this.xIndex=null,this.xPoint=null,this.yPoint=null,void 0!==e)for(var i in e)this.widget[i]=$.extend(this.widget[i],e[i]);$(t.container).off("mousedown.WidgetLayer").off("mouseup.WidgetLayer").off("mousemove.WidgetLayer").off("mouseout.WidgetLayer"),$(t.container).on("mousedown.WidgetLayer",$.proxy(this.onMouseDown,this)).on("mouseup.WidgetLayer",$.proxy(this.onMouseUp,this)).on("mousemove.WidgetLayer",$.proxy(this.onMouseMove,this)).on("mouseout.WidgetLayer",$.proxy(this.onMmouseOut,this))},iChart.Charting.ChartWidgetLayer.prototype.clear=function(){if(!this.context)return console.log("ERROR: No context for render"),0;var t=this.context;this.context.clearRect(0,0,t.canvas.width,t.canvas.height),this.drawWidgets(t)},iChart.Charting.ChartWidgetLayer.prototype.render=function(t){if(!t){if(!this.context)return console.log("ERROR: No context for render"),0;(t=this.context).clearRect(0,0,t.canvas.width,t.canvas.height)}t.save(),this.drawWidgets(t),this.drawCrosshair(t,{}),t.restore(),"undefined"!=typeof FlashCanvas&&t.e()},iChart.Charting.ChartWidgetLayer.prototype.update=function(){var t;this.chart.areas&&(this.area=this.chart.areas[0],t=$(this.chart.container),this._initCanvas(t.width(),t.height()),this.render())},iChart.Charting.ChartWidgetLayer.prototype._initCanvas=function(t,e){this.canvas=iChart.Charting.initCanvas(this.chart.container,this.canvas,t,e),this.canvas&&(this.context=iChart.getContext(this.canvas),this.offset=this.chart._containerSize.offset)},iChart.Charting.ChartWidgetLayer.prototype.drawWidgets=function(t){for(var e in this.widget)this.widget[e].enable&&this[e](t,this.widget[e])},iChart.Charting.ChartWidgetLayer.prototype.onMouseDown=function(t){},iChart.Charting.ChartWidgetLayer.prototype.onMouseUp=function(t){},iChart.Charting.ChartWidgetLayer.prototype.onMmouseOut=function(t){this.clear()},iChart.Charting.ChartWidgetLayer.prototype.onMouseMove=function(t){var e,i;void 0!==this.offset&&(e=t.pageX,i=t.pageY,e===this.pageX&&i===this.pageY||(this.pageX=e,this.pageY=i,i=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),t=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top),i===this.prevX&&t===this.prevY||(this.prevX=i,this.prevY=t,i=1e3*this.area.getXValue(i),t=this.area.getYValue(t),this.prevValueX=i,this.prevValueY=t,this.render())))},iChart.Charting.ChartWidgetLayer.prototype.widgetCurPrice=function(t,e){var i=e.width,a=e.height;r="top"==e.valign?this.area.innerOffset.top+e.vspace:this.area.innerHeight+this.area.innerOffset.top-a-e.vspace,e="left"==e.halign?this.area.innerOffset.left+e.hspace:this.area.innerWidth+this.area.innerOffset.left-i-e.hspace,t.save(),t.translate(e,r),t.beginPath(),t.moveTo(0,a),t.lineTo(i,a),t.lineTo(i,0),t.lineTo(0,0),t.closePath(),t.clip(),t.fillStyle="rgba(214,218,225,0.75)",t.strokeStyle="rgba(171,177,192,1)",t.fillRect(0,0,i,a),t.rect(0,0,i,a),t.stroke();var r;this.chart.env.userSettings.currentSecurity.q;t.fillStyle="#20232a",t.font="normal 26px Arial,Helvetica,sans-serif",t.textBaseline="middle",this.chart.areas[0].ySeries[0]&&(r=this.chart.areas[0].ySeries[0].points.length-this.chart.chartOptions.futureAmount-1,i=this.chart.areas[0].xSeries[r],a=this.chart.areas[0].ySeries[0].points[r][3],r=1<1/this.chart.env.userSettings.currentSecurity.min_step?Math.round(1/this.chart.env.userSettings.currentSecurity.min_step).toString().length-1:0,a=a.toFormat(r,"."," "),t.fillText(a,10,30),t.textBaseline="top",i=iChart.formatDateTime(new Date(1e3*i),"dd MMMM HH:mm"),t.font="normal 11px Arial,Helvetica,sans-serif",t.fillText(i,10,5),t.restore())},iChart.Charting.ChartWidgetLayer.prototype.widgetCurPrice2=function(t,e){var i,a,r,s=e.width,n=e.height;void 0!==this.chart.env.userSettings.currentSecurity.q&&(r="top"==e.valign?this.area.innerOffset.top+e.vspace:this.area.innerHeight+this.area.innerOffset.top-n-e.vspace,e="left"==e.halign?this.area.innerOffset.left+e.hspace:this.area.innerWidth+this.area.innerOffset.left-s-e.hspace,t.save(),t.translate(e,r),t.beginPath(),t.moveTo(0,n),t.lineTo(s,n),t.lineTo(s,0),t.lineTo(0,0),t.closePath(),t.clip(),t.fillStyle="rgba(214,218,225,0.75)",t.strokeStyle="rgba(171,177,192,1)",t.fillRect(0,0,s,n),t.rect(0,0,s,n),t.stroke(),r=this.chart.env.userSettings.currentSecurity.q,t.fillStyle="#20232a",t.font="normal 26px Arial,Helvetica,sans-serif",t.textBaseline="middle",s=parseFloat(r.ltp),n=1<1/this.chart.env.userSettings.currentSecurity.min_step?Math.round(1/this.chart.env.userSettings.currentSecurity.min_step).toString().length-1:0,s=s.toFormat(n,"."," "),t.fillText(s,10,30),t.textBaseline="top","Invalid Date"!=new Date(r.ltt).toString()&&(i=(i=r.ltt).replace(/^[\d-]{10}T?/,""),a=iChart.formatDateTime(new Date(r.ltt),"dd MMMM")+" "+i,t.font="normal 11px Arial,Helvetica,sans-serif",t.fillText(a,10,5)),0<=r.chg?t.fillStyle="#228B22":t.fillStyle="#b7333b",a=0<(i=parseFloat(r.chg))?"▲+":"▼",i="0"==r.chg?"0.00":a+i.toFormat(Math.max(i.getDegree(),2),"."," "),t.fillText(i,140,13),r.pcp&&(0<=r.pcp?t.fillStyle="#228B22":t.fillStyle="#b7333b",r=(a=0<parseFloat(r.pcp)?"▲+":"▼")+r.pcp+"%",t.fillText(r,140,28))),t.restore()},iChart.Charting.ChartWidgetLayer.prototype.drawCrosshair=function(t,e){var i={};i.left=Math.round(this.pageX-this.offset.left),i.top=Math.round(this.pageY-this.offset.top);for(var a,r,s={x:!1,y:!1},n=0;n<this.chart.areas.length;++n)!1===(a=this.chart.areas[n]).enabled||a.isLayer||a.isScroller||("top"==a.chart.chartOptions.tooltipPosition?a.innerOffset.top:"bottom"==a.chart.chartOptions.tooltipPosition&&(a.innerOffset.top,a.innerHeight),s[n]={},s.x=(s[n].x=i.left>=a.innerOffset.left&&i.left<=a.innerOffset.left+a.innerWidth)||s.x,s.y=(s[n].y=i.top>=a.innerOffset.top&&i.top<=a.innerOffset.top+a.innerHeight)||s.y);s.x&&s.y&&0!==(a=this.chart.areas[0]).xSeries.length&&((r=a.getXIndex(i.left-a.innerOffset.left))<a.viewport.x.bounded.min||r>a.viewport.x.bounded.max||(this.xIndex=Math.max(a.viewport.x.bounded.min,Math.min(a.viewport.x.bounded.max,Math.round(r))),this.xPoint=Math.round(this.area.getXPositionByIndex(this.xIndex)),this.yPoint=this.prevY,t.save(),t.translate(.5,.5),this.drawCrossLines(t),t.restore()))},iChart.Charting.ChartWidgetLayer.prototype.drawCrossLines=function(t,e,i){for(var a=this.chart.areas,r=this.chart.chartOptions.legendAlign,s=0;s<a.length;++s){var n,o=a[s];if(!1!==o.enabled&&!o.isScroller&&"VolumeByPriceArea"!=o.name){o.isLayer?(d=$.grep(a,function(t){return t.name===o.parentName})[0],o.textOffset=d.textOffset,n="top"===r?d.offset.top+2:o.offset.top):(n=o.offset.top+("top"===r?2:0),o.textOffset=0),o.isLayer||(t.save(),t.setLineDash&&t.setLineDash([4,3]),t.strokeStyle="#999999",t.beginPath(),t.moveTo(this.xPoint,o.offset.top),t.lineTo(this.xPoint,o.offset.top+o.innerHeight),this.yPoint>=o.innerOffset.top&&this.yPoint<=o.innerOffset.top+o.innerHeight&&(t.setLineDash&&t.setLineDash([4,3]),t.moveTo(o.offset.left,this.yPoint),t.lineTo(o.offset.left+o.innerWidth,this.yPoint)),t.stroke(),t.closePath(),t.restore(),this.yPoint>=o.innerOffset.top&&this.yPoint<=o.innerOffset.top+o.innerHeight&&(u=(u=o.getYValue(this.yPoint-o.offset.top))<100?iChart.formatNumber(u,{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(u,{decimalPlaces:2,decimalPrecision:null,scale:0}),h=o.offset.left+o.innerWidth,l=this.yPoint,t.fillStyle=this.chart.chartOptions.labelColor,t.fillRect(h+8,l-8,t.measureText(u).width+10,15),t.beginPath(),t.moveTo(h+9,l-9),t.lineTo(h+9,l+8),t.lineTo(h,l),t.lineTo(h+9,l-9),t.lineTo(h+9,l+8),t.closePath(),t.fill(),t.font="normal 10px Verdana,Tahoma,Geneva,Arial,Sans-serif",t.textAlign="left",t.textBaseline="top",t.fillStyle=this.chart.chartOptions.backgroundColor,t.fillText(u,h+8,l-6))),t.save();var h,l,c,d=new Date(1e3*o.xSeries[this.xIndex]);0!=s||o.isLayer||(h=iChart.formatDateTime(d,this.chart.dateFormat).split("\n"),l=t.measureText(h[0]+" "+h[1]).width,t.fillStyle=this.chart.chartOptions.labelColor,t.fillRect(this.xPoint-Math.round(l/2)-4,o.offset.top+o.innerHeight+2,l+4,12),t.fillStyle=this.chart.chartOptions.backgroundColor,t.font="normal 8px Verdana,Tahoma,Geneva,Arial,Sans-serif",t.textAlign="left",t.textBaseline="top",t.fillText(h[0]+" "+h[1],this.xPoint-Math.round(l/2),o.offset.top+o.innerHeight+3)),o.isLayer||(t.fillStyle=this.chart.chartOptions.backgroundColor,"top"===r?t.fillRect(o.offset.left,n,100,15):t.fillRect(o.offset.left,n+o.innerHeight-15,100,15),t.font="normal 10px Verdana,Tahoma,Geneva,Arial,Sans-serif",t.textAlign="left",t.textBaseline="top",c=iChart.formatDateTime(d,"dd.MM.yyyy"+(this.chart.showTime()?" HH:mm":"")),o.textOffset+=t.measureText(c).width+20,t.fillStyle=this.chart.chartOptions.labelColor,"top"===r?t.fillText(c,o.offset.left,n):t.fillText(c,o.offset.left,n+o.innerHeight-12));for(var p=0;p<o.ySeries.length;p++){var u,g=o.ySeries[p];!g.points[this.xIndex]||4==g.points[this.xIndex].length&&null==g.points[this.xIndex][0]||((u=1<g.valuesPerPoint?g.points[this.xIndex]?g.points[this.xIndex][g.dotIndex]:null:g.points[this.xIndex]?g.points[this.xIndex][0]:null)&&(t.beginPath(),t.fillStyle=g.color,t.arc(this.xPoint,o.offset.top+Math.round(o.getYPosition(u)),4,0,2*Math.PI,!0),t.closePath(),t.fill()),t.fillStyle=this.chart.chartOptions.backgroundColor,"top"===r?t.fillRect(o.offset.left+o.textOffset,n,15,15):t.fillRect(o.offset.left+o.textOffset,n+o.innerHeight-15,15,15),t.beginPath(),t.fillStyle=g.color,t.strokeStyle=g.color,"top"===r?t.arc(o.offset.left+o.textOffset,n+5,6,0,2*Math.PI,!0):t.arc(o.offset.left+o.textOffset,n+o.innerHeight-6,6,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.fill(),o.textOffset+=15,c=(g.labels[0]&&g.labels[0][2]?g.labels[0][2]:g.name)+" ",g.points[this.xIndex]&&(4===g.valuesPerPoint?this.chart.isComparison?c+=g.points[this.xIndex][3]:c+=" H: "+g.points[this.xIndex][0]+" L: "+g.points[this.xIndex][1]+" O: "+g.points[this.xIndex][2]+" C: "+g.points[this.xIndex][3]:2==g.valuesPerPoint?c+=" "+_t("2589","Мин:")+" "+g.points[this.xIndex][0]+" "+_t("2590","Макс:")+" "+g.points[this.xIndex][0]:c+=g=(g=g.points[this.xIndex][0])<100?iChart.formatNumber(g,{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(g,{decimalPlaces:2,decimalPrecision:null,scale:0}),t.fillStyle=this.chart.chartOptions.backgroundColor,"top"===r?t.fillRect(o.offset.left+o.textOffset,n,t.measureText(c).width+20,15):t.fillRect(o.offset.left+o.textOffset,n+o.innerHeight-15,t.measureText(c).width+20,15),t.fillStyle=this.chart.chartOptions.labelColor,t.font="normal 10px Verdana,Tahoma,Geneva,Arial,Sans-serif",t.textAlign="left",(t.textBaseline="top")===r?t.fillText(c,o.offset.left+o.textOffset,n):t.fillText(c,o.offset.left+o.textOffset,n+o.innerHeight-12),o.textOffset+=t.measureText(c).width+20))}t.restore()}}this.chart.chartOptions.floatingLegend&&this.drawTooltip(t)},iChart.Charting.ChartWidgetLayer.prototype.drawPoints=function(t){},iChart.Charting.ChartWidgetLayer.prototype.drawTooltip=function(t){t.save();for(var e=this.chart.areas,i=0;i<e.length;++i){var a,r,s,n,o,h,l,c,d,p,u,g,f=e[i];!1===f.enabled||f.isScroller||"VolumeByPriceArea"==f.name||f.isLayer||this.yPoint>=f.innerOffset.top&&this.yPoint<=f.innerOffset.top+f.innerHeight&&(a=f.ySeries[0],u=!0,s=(r=this.chart.chartOptions.floatingLegendFontSize)/2,t.font="normal "+r+"px Verdana,Tahoma,Geneva,Arial,Sans-serif",t.textAlign="left",t.textBaseline="top",n=f.ySeries[0].points[this.xIndex],h="HLOC"==a.kind?(l=t.measureText(_t("21962","open:")+n[2]).width,c=t.measureText(_t("21963","close:")+n[3]).width,d=t.measureText(_t("21964","low:")+n[1]).width,p=t.measureText(_t("21965","high:")+n[0]).width,o=Math.max(l,c,d,p)+10,4*(r+2)+s):(o=t.measureText(a.name+": "+iChart.formatNumber(n[a.closeValueIndex],a.formatProvider)).width+10,r+2+s),c=(l=f.getYPosition(n[a.closeValueIndex])+f.innerOffset.top)-20,this.xPoint>(f.offset.left+f.innerWidth)/2&&(u=!1),d=9*(u?1:-1),p=u?this.xPoint+d:this.xPoint-o+d,u=0,c+h>f.innerOffset.top+f.innerHeight&&(u=c+h-(f.innerOffset.top+f.innerHeight)),t.fillStyle=this.chart.chartOptions.floatingLegendBorderColor,t.beginPath(),t.moveTo(this.xPoint+d,l-9),t.lineTo(this.xPoint+d,l+8),t.lineTo(this.xPoint,l),t.lineTo(this.xPoint+d,l-9),t.lineTo(this.xPoint+d,l+8),t.closePath(),t.fill(),t.lineWidth=1,t.strokeStyle=this.chart.chartOptions.floatingLegendBorderColor,t.beginPath(),t.moveTo(p+5,c-u),t.lineTo(p+o-5,c-u),t.quadraticCurveTo(p+o,c-u,p+o,c-u+5),t.lineTo(p+o,c-u+h-5),t.quadraticCurveTo(p+o,c-u+h,p+o-5,c-u+h),t.lineTo(p+5,c-u+h),t.quadraticCurveTo(p,c-u+h,p,c-u+h-5),t.lineTo(p,c-u+5),t.quadraticCurveTo(p,c-u,p+5,c-u),t.closePath(),t.stroke(),t.fillStyle=this.chart.chartOptions.floatingLegendBackground,t.fill(),t.fillStyle=this.chart.chartOptions.floatingLegendTextColor,"HLOC"==a.kind?(g=c-u+s,t.fillText(_t("21962","open:")+n[2],p,g),t.fillText(_t("21963","close:")+n[3],p,g+r+2),t.fillText(_t("21964","low:")+n[1],p,g+2*r+2),t.fillText(_t("21965","high:")+n[0],p,g+3*r+2)):(g=c-u+s,t.fillText(a.name+": "+iChart.formatNumber(n[a.closeValueIndex],a.formatProvider),p,g)))}t.restore()}}(),function(){"use strict";iChart.Charting.ChartAreaLayer=function(t){this.$deleteButton=$("<span/>",{class:"m-chart-instrument-delete",text:"✕",title:"Удалить инструмент"}).hide().appendTo(t.container),this.$settingsButton=$("<span class ='m-chart-instrument-settings' href = '#' text = '' title = 'Свойства'><span class='elementSettingsHolder' style='position: relative'></span></span>").hide().appendTo(t.container),this.canvas=null,this.chart=t,this.defaultCursor="default",this.drag=null,this.history=[],this.hover=null,this.controlsHover=null,this.prevX=null,this.prevY=null,this.selected=null,this.unfinished=null},iChart.Charting.ChartAreaLayer.prototype.clear=function(t){if(t=!!t,this.history.length)if(t)this.$deleteButton.hide().removeClass("on"),this.$settingsButton.hide(),this.history=[],this.render(),this.syncHash();else{for(var e=this.history,i=0;i<e.length;i++)"manually"==e[i].drawType&&(e.splice(i,1),i--);this.render(),this.syncHash()}},iChart.Charting.ChartAreaLayer.prototype.createElement=function(t){switch(t){case"Channel":return new iChart.Charting.ChartChannel(this);case"Ellipse":return new iChart.Charting.ChartEllipse(this);case"FibonacciArc":return new iChart.Charting.ChartFibonacciArc(this);case"FibonacciCorrection":return new iChart.Charting.ChartFibonacciCorrection(this);case"FibonacciFan":return new iChart.Charting.ChartFibonacciFan(this);case"HorizontalLine":return new iChart.Charting.ChartHorizontalLine(this);case"Line":return new iChart.Charting.ChartLine(this);case"Rectangle":return new iChart.Charting.ChartRectangle(this);case"Trend":return new iChart.Charting.ChartTrend(this);case"Triangle":return new iChart.Charting.ChartTriangle(this);case"VerticalLine":return new iChart.Charting.ChartVerticalLine(this);case"Mark":return new iChart.Charting.ChartMark(this);case"Label":return new iChart.Charting.ChartLabel(this);case"Arrow":return new iChart.Charting.ChartArrow(this);case"Polygon":return new iChart.Charting.ChartPolygon(this);case"Trade":return new iChart.Charting.ChartTrade(this);case"Bubble":return new iChart.Charting.ChartBubble(this);case"Text":return new iChart.Charting.ChartText(this);case"Order":return new iChart.Charting.ChartOrder(this);case"Trendorder":return new iChart.Charting.ChartTrendorder(this);case"Position":return new iChart.Charting.ChartPosition(this);case"Visualtrade":return new iChart.Charting.ChartVisualtrade(this);case"TradePanel":return new iChart.Charting.ChartTradePanel(this);case"Button":return new iChart.Charting.ChartButton(this);case"Event":return new iChart.Charting.ChartEvent(this);case"Level":return new iChart.Charting.ChartLevel(this);case"Range":return new iChart.Charting.ChartRange(this);case"HorizontalRange":return new iChart.Charting.ChartHorizontalRange(this);default:return}},iChart.Charting.ChartAreaLayer.prototype.deserialize=function(t){this.$deleteButton.unbind("mousedown").hide().removeClass("on"),this.$settingsButton.unbind("mousedown").hide(),this.history=[];var e=parseInt(t.L,10);if(!isNaN(e))t:for(var i=0;i<e;++i){var a=t["L"+i+"_T"],r=this.createElement(a);if(void 0!==r){r.points=[];for(var s=0;s<r.maxPointCount;++s){var n={x:parseFloat(t["L"+i+"_X"+s]),y:parseFloat(t["L"+i+"_Y"+s])};if(isNaN(n.x)||isNaN(n.y))continue t;r.points.push(n)}t["L"+i+"_S"]&&(r.settings=JSON.parse(decodeURIComponent(window.atob(t["L"+i+"_S"].replace(/@/g,"="))))),this.history.push(r)}}},iChart.Charting.ChartAreaLayer.prototype.elementAt=function(t,e){},iChart.Charting.ChartAreaLayer.prototype.finalizePoint=function(t,e){this.render()},iChart.Charting.ChartAreaLayer.prototype.getMarkers=function(t,e){for(var i=[],a=!1,r=0;r<this.drag.element.points.length;++r){var s=this.drag.element.points[r],n={};if(0===this.drag.mode||this.drag.mode===r+1){if((n=$.extend({},s)).x=1e3*this.area.getXValue(this.area.getXPositionByValue(s.x/1e3)+t),n.y=this.area.getYValue(this.area.getYPosition(s.y)+e),isNaN(n.x)||isNaN(n.y)){a=!0;break}}else n=$.extend({},s);i.push(n)}return{markers:i,outside:a}},iChart.Charting.ChartAreaLayer.prototype.getPixelPosition=function(t,e){var i=t.length;if(!(i<2||t[0][0]>=e))for(var a=1;a<i;++a){var r=t[a];if(r[0]>=e)return r[1]}},iChart.Charting.ChartAreaLayer.prototype.onMouseDown=function(t){},iChart.Charting.ChartAreaLayer.prototype.onMouseMove=function(t){},iChart.Charting.ChartAreaLayer.prototype.onMouseUp=function(t){},iChart.Charting.ChartAreaLayer.prototype.remove=function(t){t=this.history.indexOf(t);-1!==t&&(this.$deleteButton.unbind("mousedown").hide().removeClass("on"),this.$settingsButton.unbind("mousedown").hide(),this.history.splice(t,1),this.render(),this.syncHash())},iChart.Charting.ChartAreaLayer.prototype.removeSelected=function(t){null===this.selected||t?this.remove(t):this.remove(this.selected)},iChart.Charting.ChartAreaLayer.prototype.render=function(t){if(!t){if(!this.context)return console.log("ERROR: No context for render"),0;(t=this.context).clearRect(0,0,t.canvas.width,t.canvas.height)}t.save(),t.translate(this.area.innerOffset.left+.5,this.area.innerOffset.top+.5),t.beginPath(),t.moveTo(0,this.area.innerHeight),t.lineTo(this.area.innerWidth,this.area.innerHeight),t.lineTo(this.area.innerWidth,0),t.lineTo(0,0),t.closePath(),t.clip(),void 0!==t.busyPoints&&(t.busyPoints={}),this.history.sort(function(t,e){return t.selected?1:t.inHover&&e.selected?-1:!t.inHover||e.inHover||e.selected?void 0:1});for(var e=0;e<this.history.length;++e)this.history[e].draw(t,-1);t.restore(),t.save(),t.translate(this.area.innerOffset.left,this.area.innerOffset.top),t.beginPath(),t.moveTo(0,this.area.innerHeight),t.lineTo(this.area.outerWidth,this.area.innerHeight),t.lineTo(this.area.outerWidth,0),t.lineTo(0,0),t.closePath(),t.clip();for(e=0;e<this.history.length;++e)this.history[e].drawExtended(t,-1);t.restore(),"undefined"!=typeof FlashCanvas&&t.e()},iChart.Charting.ChartAreaLayer.prototype.serialize=function(){for(var t={},e=0,i=t.L=0;i<this.history.length;++i){var a=this.history[i];if(a.isComplete()&&a.controlEnable&&a.storageEnable){t["L"+e+"_T"]=a.elementType;for(var r=0;r<a.points.length;++r)t["L"+e+"_X"+r]=a.points[r].x,t["L"+e+"_Y"+r]=a.points[r].y;a.hasSettings&&(t["L"+e+"_S"]=window.btoa(encodeURIComponent(JSON.stringify(a.settings))).replace(/=/g,"@")),e++,t.L=t.L+1}}return t},iChart.Charting.ChartAreaLayer.prototype.setControlsHover=function(t){var e;this.controlsHover?t?this.controlsHover.value.id==t.value.id&&this.controlsHover.mode==t.mode||(this.controlsHover.toString().match(new RegExp("^c_","i"))||this.controlsHover.mode.toString().match(new RegExp("^a_","i"))||this.controlsHover.mode.toString().match(new RegExp("^m_","i"))&&(e=this.controlsHover.mode.toString().match(new RegExp(/^m_(\d)/i)),void 0!==this.controlsHover.value.maps&&"function"==typeof this.controlsHover.value.maps[e[1]].hoverOut&&(this.controlsHover.value.maps[e[1]].hoverOut(),this.controlsHover=null)),t.mode.toString().match(new RegExp("^c_","i"))||t.mode.toString().match(new RegExp("^a_","i"))||t.mode.toString().match(new RegExp("^m_","i"))&&(e=t.mode.toString().match(new RegExp(/^m_(\d)/i)),void 0!==t.value.maps&&"function"==typeof t.value.maps[e[1]].hoverIn&&(this.controlsHover=t).value.maps[e[1]].hoverIn())):this.controlsHover.toString().match(new RegExp("^c_","i"))||this.controlsHover.mode.toString().match(new RegExp("^a_","i"))||this.controlsHover.mode.toString().match(new RegExp("^m_","i"))&&(e=this.controlsHover.mode.toString().match(new RegExp(/^m_(\d)/i)),void 0!==this.controlsHover.value.maps&&"function"==typeof this.controlsHover.value.maps[e[1]].hoverOut&&(this.controlsHover.value.maps[e[1]].hoverOut(),this.controlsHover=null)):t&&(t.mode.toString().match(new RegExp("^c_","i"))||t.mode.toString().match(new RegExp("^a_","i"))||t.mode.toString().match(new RegExp("^m_","i"))&&(e=t.mode.toString().match(new RegExp(/^m_(\d)/i)),void 0!==t.value.maps&&"function"==typeof t.value.maps[e[1]].hoverIn&&(this.controlsHover=t).value.maps[e[1]].hoverIn()))},iChart.Charting.ChartAreaLayer.prototype.setHover=function(t,e,i){null===this.hover||null!=t&&this.hover===t||(this.hover.inHover=!1,this.hover.onOut()),null!==t&&(t.inHover=!0),this.hover!==t&&(null!==(this.hover=t)&&"function"==typeof t.onHover&&t.onHover(e,i),this.render())},iChart.Charting.ChartAreaLayer.prototype.setSelected=function(t){$("#elementSettings").remove(),this.selected!==t&&(null!=this.selected&&(this.selected.onOut(),this.selected.selected=!1,this.selected.onBlur(this.context)),null===(this.selected=t)?(this.$deleteButton.hide().removeClass("on"),this.$settingsButton.hide()):(this.$deleteButton.removeClass("on"),this.selected.selected=!0,this.selected.onSelect.call(this.selected,this.context)),this.render())},iChart.Charting.ChartAreaLayer.prototype.start=function(t){return this.unfinished=this.createElement(t),this.selected=this.unfinished,void 0!==this.unfinished&&this.history.push(this.unfinished),this.unfinished},iChart.Charting.ChartAreaLayer.prototype.syncHash=function(){},iChart.Charting.ChartAreaLayer.prototype.update=function(t){if(t){this.area=t;for(var e=0;e<this.history.length;++e)delete this.history[e].testContext;t=$("canvas#"+t.name);t.length?(this.canvas=t.get(0),this.context=iChart.getContext(this.canvas),this.offset=this.chart._containerSize.offset):(t=$(this.chart.container),this._initCanvas(t.width(),t.height()),this.canvas&&$(this.canvas).attr("id",this.area.name)),this.render()}},iChart.Charting.ChartAreaLayer.prototype._initCanvas=function(t,e){this.canvas=iChart.Charting.initCanvas(this.chart.container,this.canvas,t,e),this.canvas&&(this.context=iChart.getContext(this.canvas),this.offset=this.chart._containerSize.offset)}}(),function(){"use strict";iChart.Charting.ChartDrawingLayer=function(t){this.$deleteButton=$("<span/>",{class:"m-chart-instrument-delete",text:"✕",title:"Удалить инструмент"}).hide().appendTo(t.container),this.$settingsButton=$("<span class ='m-chart-instrument-settings' href = '#' text = '' title = 'Свойства'><span class='elementSettingsHolder' style='position: relative'></span></span>").hide().appendTo(t.container),this.canvas=null,this.chart=t,this.defaultCursor="default",this.drag=null,this.history=[],this.hover=null,this.controlsHover=null,this.prevX=null,this.prevY=null,this.selected=null,this.unfinished=null,$(t.container).off("mousedown.overlay").unbind("mouseup.overlay").unbind("mousemove.overlay"),$(t.container).on("mousedown.overlay",$.proxy(this.onMouseDown,this)).on("mouseup.overlay",$.proxy(this.onMouseUp,this)).on("mousemove.overlay",$.proxy(this.onMouseMove,this)),t=(0==this.chart.env.dataSource.dataSettings.useHash?this.chart.env.dataSource.dataSettings:document.location).hash,this.deserialize(iChart.parseQueryString((t||"#").substr(1)))},iChart.Charting.ChartDrawingLayer.prototype.clear=function(t){if(t=!!t,this.history.length)if(t)this.$deleteButton.hide().removeClass("on"),this.$settingsButton.hide(),this.history=[],this.render(),this.syncHash();else{for(var e=this.history,i=0;i<e.length;i++)"manually"==e[i].drawType&&(e.splice(i,1),i--);this.render(),this.syncHash()}},iChart.Charting.ChartDrawingLayer.prototype.createElement=function(t){switch(t){case"Channel":return new iChart.Charting.ChartChannel(this);case"Ellipse":return new iChart.Charting.ChartEllipse(this);case"FibonacciArc":return new iChart.Charting.ChartFibonacciArc(this);case"FibonacciCorrection":return new iChart.Charting.ChartFibonacciCorrection(this);case"FibonacciFan":return new iChart.Charting.ChartFibonacciFan(this);case"HorizontalLine":return new iChart.Charting.ChartHorizontalLine(this);case"Line":return new iChart.Charting.ChartLine(this);case"Rectangle":return new iChart.Charting.ChartRectangle(this);case"Trend":return new iChart.Charting.ChartTrend(this);case"Triangle":return new iChart.Charting.ChartTriangle(this);case"VerticalLine":return new iChart.Charting.ChartVerticalLine(this);case"Mark":return new iChart.Charting.ChartMark(this);case"Label":return new iChart.Charting.ChartLabel(this);case"Arrow":return new iChart.Charting.ChartArrow(this);case"Polygon":return new iChart.Charting.ChartPolygon(this);case"Trade":return new iChart.Charting.ChartTrade(this);case"Bubble":return new iChart.Charting.ChartBubble(this);case"Text":return new iChart.Charting.ChartText(this);case"Order":return new iChart.Charting.ChartOrder(this);case"Trendorder":return new iChart.Charting.ChartTrendorder(this);case"Position":return new iChart.Charting.ChartPosition(this);case"Visualtrade":return new iChart.Charting.ChartVisualtrade(this);case"TradePanel":return new iChart.Charting.ChartTradePanel(this);case"Button":return new iChart.Charting.ChartButton(this);case"Event":return new iChart.Charting.ChartEvent(this);case"Level":return new iChart.Charting.ChartLevel(this);case"Range":return new iChart.Charting.ChartRange(this);case"HorizontalRange":return new iChart.Charting.ChartHorizontalRange(this);default:return}},iChart.Charting.ChartDrawingLayer.prototype.deserialize=function(t){this.$deleteButton.unbind("mousedown").hide().removeClass("on"),this.$settingsButton.unbind("mousedown").hide(),this.history=[];var e=parseInt(t.L,10);if(!isNaN(e))t:for(var i=0;i<e;++i){var a=t["L"+i+"_T"],r=this.createElement(a);if(void 0!==r){r.points=[];for(var s=0;s<r.maxPointCount;++s){var n={x:parseFloat(t["L"+i+"_X"+s]),y:parseFloat(t["L"+i+"_Y"+s])};if(isNaN(n.x)||isNaN(n.y))continue t;r.points.push(n)}t["L"+i+"_S"]&&(r.settings=JSON.parse(decodeURIComponent(window.atob(t["L"+i+"_S"].replace(/@/g,"="))))),this.history.push(r)}}},iChart.Charting.ChartDrawingLayer.prototype.elementAt=function(t,e){this.history.sort(function(t,e){return t&&t.selected||t&&"TradePanel"==t.elementType?-1:1});for(var i=0;i<this.history.length;++i){var a=this.history[i],r=a.isMouseOver.call(a,t,e);if(-1!==r)return{mode:r,value:a}}},iChart.Charting.ChartDrawingLayer.prototype.finalizePoint=function(t,e){this.unfinished.points[this.unfinished.points.length-1].x=t,this.unfinished.points[this.unfinished.points.length-1].y=e,this.unfinished.isComplete()?(this.chart.env.wrapper.trigger("iguanaChartEvents",["drawComplete",this.unfinished]),this.unfinished=null,this.syncHash(),this.chart.container.style.cursor=this.defaultCursor):(this.unfinished.points.push({}),this.chart.container.style.cursor="crosshair"),this.render()},iChart.Charting.ChartDrawingLayer.prototype.getMarkers=function(t,e){for(var i=[],a=!1,r=0;r<this.drag.element.points.length;++r){var s=this.drag.element.points[r],n={};if(0===this.drag.mode||this.drag.mode===r+1){if((n=$.extend({},s)).x=1e3*this.area.getXValue(this.area.getXPositionByValue(s.x/1e3)+t),n.y=this.area.getYValue(this.area.getYPosition(s.y)+e),isNaN(n.x)||isNaN(n.y)){a=!0;break}}else n=$.extend({},s);i.push(n)}return{markers:i,outside:a}},iChart.Charting.ChartDrawingLayer.prototype.getPixelPosition=function(t,e){var i=t.length;if(!(i<2||t[0][0]>=e))for(var a=1;a<i;++a){var r=t[a];if(r[0]>=e)return r[1]}},iChart.Charting.ChartDrawingLayer.prototype.onMouseDown=function(t){if(void 0!==this.offset){var e,i=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),a=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top),r=1e3*this.area.getXValue(i),s=this.area.getYValue(a);if($(window).data("mouseValueX",r),$(window).data("mouseValueY",s),this.chart.isComparison&&!isNaN(s)&&(e=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,this.chart.areas[0].viewport.x.bounded.min),s=(e=this.chart.areas[0].ySeries[0].points[e][3])+e/100*s),!isNaN(r)&&!isNaN(s)){if(null!==this.unfinished)return this.finalizePoint(r,s),void this.selected.onInsert();if(0!==this.history.length&&null===this.drag){s=this.elementAt(i,a);if(s&&s.value&&"function"==typeof s.value.onMouseDown&&s.value.onMouseDown(t,i,a),void 0!==s){if(s.value.controlEnable){if(s.mode.toString().match(new RegExp("^m_","i"))){var n=s.mode.toString().match(new RegExp(/^m_(\d)/i));s.value.maps[n[1]].click()}else{if(s.mode.toString().match(new RegExp("^c_","i"))){n=s.mode.toString().match(new RegExp(/^c_(\d)/i));return void s.value.controls[n[1]].click()}s.mode.toString().match(new RegExp("^a_","i"))}this.setSelected(s.value),s.hasSettings,this.drag={},this.drag.element=this.selected,this.drag.mode=s.mode,this.drag.x=i,this.drag.y=a,this.chart.selection&&this.chart.selection.disable()}}else this.setSelected(null)}}}},iChart.Charting.ChartDrawingLayer.prototype.onMouseMove=function(t){if(void 0!==this.offset){var e=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),i=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top);if(e!==this.prevX||i!==this.prevY){this.prevX=e,this.prevY=i;var a=1e3*this.area.getXValue(e),r=this.area.getYValue(i);if(this.prevValueX=a,this.prevValueY=r,this.chart.isComparison&&!isNaN(r)&&(t=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,this.chart.areas[0].viewport.x.bounded.min),r=(t=this.chart.areas[0].ySeries[0].points[t][3])+t/100*r),isNaN(a)||isNaN(r))return this.setHover(null),void(this.chart.container.style.cursor=this.defaultCursor);if(null!==this.unfinished)return this.hover=null,this.unfinished.points[this.unfinished.points.length-1].x=a,this.unfinished.points[this.unfinished.points.length-1].y=r,this.render(),void(this.chart.container.style.cursor="crosshair");if(null!==this.drag){isNaN(parseInt(this.drag.mode))||(void 0!==this.drag.element.moveCursor?this.chart.container.style.cursor=this.drag.element.moveCursor:this.chart.container.style.cursor="move");var r=e-this.drag.x,s=i-this.drag.y;if(0==r&&0==s)return;s=this.getMarkers(r,s);return this.drag.element.onDrag(s.markers),void(s.outside?void 0!==this.drag.element.markers&&(delete this.drag.element.markers,this.render()):(this.drag.element.markers=s.markers,this.render()))}s=this.elementAt(e,i);void 0===s?(this.setHover(null),this.setControlsHover(null),this.chart.container.style.cursor=this.defaultCursor):s.mode.toString().match(new RegExp("^c_","i"))?(this.chart.container.style.cursor="pointer",this.setControlsHover(s)):s.mode.toString().match(new RegExp("^a_","i"))?(this.setHover(null),this.setControlsHover(s),this.chart.container.style.cursor=this.defaultCursor):s.mode.toString().match(new RegExp("^m_","i"))?(s.mode.toString().match(new RegExp(/^m_(\d)/i)),this.setControlsHover(s),this.chart.container.style.cursor="pointer"):(this.setHover(s.value,e,i),this.setControlsHover(s),void 0!==s.value.hoverCursor||void 0!==s.value.hoverPointCursor?0<s.mode&&void 0!==s.value.hoverPointCursor?this.chart.container.style.cursor=s.value.hoverPointCursor:0==s.mode&&void 0!==s.value.hoverCursor?this.chart.container.style.cursor=s.value.hoverCursor:this.chart.container.style.cursor="pointer":this.chart.container.style.cursor="pointer")}}},iChart.Charting.ChartDrawingLayer.prototype.onMouseUp=function(t){var e,i=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),a=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top),r=this.elementAt(i,a);if(void 0!==r){if(!r.value.controlEnable)return;r.mode.toString().match(new RegExp("^c_","i"))||r.mode.toString().match(new RegExp("^a_","i"))}void 0!==this.offset&&null!==this.drag&&(i=Math.round(t.pageX-this.offset.left-this.area.innerOffset.left),a=Math.round(t.pageY-this.offset.top-this.area.innerOffset.top),e=1e3*this.area.getXValue(i),r=this.area.getYValue(a),this.chart.isComparison&&!isNaN(r)&&(r=(t=this.chart.areas[0].ySeries[0].points[this.chart.areas[0].viewport.x.bounded.min][3])+t/100*r),isNaN(e)||isNaN(r)||(i=i-this.drag.x,a=a-this.drag.y,0==i&&0==a||(a=this.getMarkers(i,a),this.drag.element.onDrag(a.markers),a.outside||(this.drag.element.points=a.markers,delete this.drag.element.testContext,this.syncHash(),this.drag.element.onDrop(this.drag.mode))),delete this.drag.element.markers,this.drag=null,this.render(),this.chart.selection&&this.chart.selection.enable()))},iChart.Charting.ChartDrawingLayer.prototype.remove=function(t){t=this.history.indexOf(t);-1!==t&&(this.$deleteButton.unbind("mousedown").hide().removeClass("on"),this.$settingsButton.unbind("mousedown").hide(),this.history.splice(t,1),this.render(),this.syncHash())},iChart.Charting.ChartDrawingLayer.prototype.removeSelected=function(t){null===this.selected||t?this.remove(t):this.remove(this.selected)},iChart.Charting.ChartDrawingLayer.prototype.render=function(t){if(!t){if(!this.context)return console.log("ERROR: No context for render"),0;(t=this.context).clearRect(0,0,t.canvas.width,t.canvas.height)}t.save(),t.translate(this.area.innerOffset.left,this.area.innerOffset.top),t.beginPath(),t.moveTo(0,this.area.innerHeight),t.lineTo(this.area.outerWidth,this.area.innerHeight),t.lineTo(this.area.outerWidth,0),t.lineTo(0,0),t.closePath(),t.clip();for(var e=0;e<this.history.length;++e)this.history[e].drawExtended(t,-1);t.restore(),t.save(),t.translate(this.area.innerOffset.left+.5,this.area.innerOffset.top+.5),t.beginPath(),t.moveTo(0,this.area.innerHeight),t.lineTo(this.area.innerWidth,this.area.innerHeight),t.lineTo(this.area.innerWidth,0),t.lineTo(0,0),t.closePath(),t.clip(),void 0!==t.busyPoints&&(t.busyPoints={}),this.history.sort(function(t,e){return t.selected?1:t.inHover&&e.selected?-1:!t.inHover||e.inHover||e.selected?void 0:1});for(e=0;e<this.history.length;++e)this.history[e].draw(t,-1);t.restore(),"undefined"!=typeof FlashCanvas&&t.e()},iChart.Charting.ChartDrawingLayer.prototype.serialize=function(){for(var t={},e=0,i=t.L=0;i<this.history.length;++i){var a=this.history[i];if(a.isComplete()&&a.controlEnable&&a.storageEnable){t["L"+e+"_T"]=a.elementType;for(var r=0;r<a.points.length;++r)t["L"+e+"_X"+r]=a.points[r].x,t["L"+e+"_Y"+r]=a.points[r].y;a.hasSettings&&(t["L"+e+"_S"]=window.btoa(encodeURIComponent(JSON.stringify(a.settings))).replace(/=/g,"@")),e++,t.L=t.L+1}}return t},iChart.Charting.ChartDrawingLayer.prototype.setControlsHover=function(t){var e;this.controlsHover?t?this.controlsHover.value.id==t.value.id&&this.controlsHover.mode==t.mode||(this.controlsHover.toString().match(new RegExp("^c_","i"))||this.controlsHover.mode.toString().match(new RegExp("^a_","i"))||this.controlsHover.mode.toString().match(new RegExp("^m_","i"))&&(e=this.controlsHover.mode.toString().match(new RegExp(/^m_(\d)/i)),void 0!==this.controlsHover.value.maps&&"function"==typeof this.controlsHover.value.maps[e[1]].hoverOut&&(this.controlsHover.value.maps[e[1]].hoverOut(),this.controlsHover=null)),t.mode.toString().match(new RegExp("^c_","i"))||t.mode.toString().match(new RegExp("^a_","i"))||t.mode.toString().match(new RegExp("^m_","i"))&&(e=t.mode.toString().match(new RegExp(/^m_(\d)/i)),void 0!==t.value.maps&&"function"==typeof t.value.maps[e[1]].hoverIn&&(this.controlsHover=t).value.maps[e[1]].hoverIn())):this.controlsHover.toString().match(new RegExp("^c_","i"))||this.controlsHover.mode.toString().match(new RegExp("^a_","i"))||this.controlsHover.mode.toString().match(new RegExp("^m_","i"))&&(e=this.controlsHover.mode.toString().match(new RegExp(/^m_(\d)/i)),void 0!==this.controlsHover.value.maps&&"function"==typeof this.controlsHover.value.maps[e[1]].hoverOut&&(this.controlsHover.value.maps[e[1]].hoverOut(),this.controlsHover=null)):t&&(t.mode.toString().match(new RegExp("^c_","i"))||t.mode.toString().match(new RegExp("^a_","i"))||t.mode.toString().match(new RegExp("^m_","i"))&&(e=t.mode.toString().match(new RegExp(/^m_(\d)/i)),void 0!==t.value.maps&&"function"==typeof t.value.maps[e[1]].hoverIn&&(this.controlsHover=t).value.maps[e[1]].hoverIn()))},iChart.Charting.ChartDrawingLayer.prototype.setHover=function(t,e,i){null===this.hover||null!=t&&this.hover===t||(this.hover.inHover=!1,this.hover.onOut()),null!==t&&(t.inHover=!0),this.hover!==t&&(null!==(this.hover=t)&&"function"==typeof t.onHover&&t.onHover(e,i),this.render())},iChart.Charting.ChartDrawingLayer.prototype.setSelected=function(t){$("#elementSettings").remove(),this.selected!==t&&(null!=this.selected&&(this.selected.onOut(),this.selected.selected=!1,this.selected.onBlur(this.context)),null===(this.selected=t)?(this.$deleteButton.hide().removeClass("on"),this.$settingsButton.hide()):(this.$deleteButton.removeClass("on"),this.selected.selected=!0,this.selected.onSelect.call(this.selected,this.context)),this.render())},iChart.Charting.ChartDrawingLayer.prototype.start=function(t){return this.unfinished=this.createElement(t),this.selected=this.unfinished,void 0!==this.unfinished&&this.history.push(this.unfinished),this.unfinished},iChart.Charting.ChartDrawingLayer.prototype.syncHash=function(){this.chart.env.setHashValues(this.serialize())},iChart.Charting.ChartDrawingLayer.prototype.update=function(){if(this.chart.areas){this.area=this.chart.areas[0];for(var t=0;t<this.history.length;++t)delete this.history[t].testContext;var e=$(this.chart.container);this._initCanvas(e.width(),e.height()),this.render()}},iChart.Charting.ChartDrawingLayer.prototype._initCanvas=function(t,e){this.canvas=iChart.Charting.initCanvas(this.chart.container,this.canvas,t,e),this.canvas&&(this.context=iChart.getContext(this.canvas),this.offset=this.chart._containerSize.offset)}}(),function(){"use strict";iChart.Charting.ChartElement=function(t){this.layer=t,this.selected=!1,this.maxPointCount=2,this.points=[{}],this.testContext=void 0,this.id=t.history.length+"_"+(new Date).getTime(),this.controlEnable=!0,this.storageEnable=!0,this.hasSettings=!1,this.settings={},this.hasPopupSettings=!1,this.drawSingle=!1,this.positionAbsolute=!1,this.inHover=!1,t.setSelected(null)},iChart.Charting.ChartElement.prototype.draw=function(t){var e,i;this===this.layer.hover?(t.fillStyle="rgba(255,255,153,.2)",t.strokeStyle="#52afc9",t.inHover=!0):(t.inHover=!1,t.hasSettings?(e=t.settings,t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,t.lineWidth=e.lineWidth):(t.fillStyle="rgba(0,0,0,.0)",t.strokeStyle="#000")),this.drawSingle?(i=void 0!==this.markers?(t.fillStyle="rgba(82,175,201,.2)",t.strokeStyle="#52afc9",this.getCoordinates(t,this.markers)):this.getCoordinates(t,this.points),this.drawInternal(t,i),this.drawPoints(t,i)):(i=this.getCoordinates(t,this.points),this.drawInternal(t,i),this.drawPoints(t,i),void 0!==this.markers&&(t.fillStyle="rgba(82,175,201,.2)",t.strokeStyle="#52afc9",i=this.getCoordinates(t,this.markers),this.drawInternal(t,i),this.drawPoints(t,i)))},iChart.Charting.ChartElement.prototype.drawInternal=function(t,e){},iChart.Charting.ChartElement.prototype.drawExtended=function(t){},iChart.Charting.ChartElement.prototype.onHover=function(t){},iChart.Charting.ChartElement.prototype.onOut=function(t){},iChart.Charting.ChartElement.prototype.onSelect=function(t){this.layer.chart.env.wrapper.trigger("iguanaChartEvents",["selectInstrument",this])},iChart.Charting.ChartElement.prototype.onBlur=function(t){},iChart.Charting.ChartElement.prototype.onRemove=function(){},iChart.Charting.ChartElement.prototype.onDrop=function(){},iChart.Charting.ChartElement.prototype.onDrag=function(t){},iChart.Charting.ChartElement.prototype.drawPopupSettings=function(t,e){},iChart.Charting.ChartElement.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t),void 0!==this.layer&&this.layer.context&&(this.layer.render(),this.layer.syncHash())},iChart.Charting.ChartElement.prototype.initDrawSettings=function(t,e){null!=e&&(void 0!==(e=e).lineDash&&(void 0!==t.setLineDash&&t.setLineDash(e.lineDash),void 0!==t.mozDash&&(t.mozDash=e.lineDash)),t.inHover?(t.fillStyle=iChart.invertColor(e.fillStyle),t.strokeStyle=iChart.invertColor(e.strokeStyle)):(t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle),t.lineWidth=e.lineWidth)},iChart.Charting.ChartElement.prototype.onInsert=function(){this.selected=!0},iChart.Charting.ChartElement.prototype.getCoordinates=function(t,e){for(var i=[],a=0;a<e.length;++a){var r,s,n={};if(n.x=Math.round(this.layer.area.getXPositionByValue(e[a].x/1e3)),isNaN(n.x))break;if(this.layer.chart.isComparison?(r=100*(e[a].y/this.layer.area.ySeries[0].points[this.layer.area.viewport.x.bounded.min][3]-1),n.y=Math.round(this.layer.area.getYPosition(r))):n.y=Math.round(this.layer.area.getYPosition(e[a].y)),isNaN(n.y))break;this===this.layer.selected&&this.controlEnable&&this.storageEnable&&0===a&&((s=this).layer.$deleteButton.unbind("mousedown").mousedown(function(){return $(this).hasClass("on")?s.remove():$(this).addClass("on"),!1}).show().css({left:this.layer.area.innerOffset.left+n.x+2,top:this.layer.area.innerOffset.top+n.y+2}),this.hasSettings&&this.hasPopupSettings&&this.layer.$settingsButton.unbind("mousedown").mousedown(function(){return s.drawPopupSettings(t,n),!1}).show().css({left:this.layer.area.innerOffset.left+n.x-10,top:this.layer.area.innerOffset.top+n.y+2})),i.push(n)}return i},iChart.Charting.ChartElement.prototype.drawPoints=function(t,e){if(this===this.layer.selected&&this.controlEnable)for(var i=0;i<e.length;++i){var a=e[i];t.save(),t.beginPath(),t.arc(a.x,a.y,6,0,2*Math.PI,!0),t.fillStyle="#fff",t.globalAlpha=1,t.lineWidth=2,t.stokeStyle="#eee",t.fill(),t.stroke(),t.restore()}},iChart.Charting.ChartElement.prototype.getTestContext=function(t){var i;return t=!!t,void 0!==this.testContext&&!t||(this.testContext={},(i=this).testContext.points=$.map(this.points,function(t,e){return{x:Math.round(i.layer.area.getXPositionByValue(t.x/1e3)),y:Math.round(i.layer.area.getYPosition(t.y))}}),this.setTestSegments()),this.testContext},iChart.Charting.ChartElement.prototype.isComplete=function(){return this.points.length===this.maxPointCount},iChart.Charting.ChartElement.prototype.isMouseOver=function(t,e){if(!this.isComplete())return-1;var i=this.getTestContext();if(void 0!==i.maps)for(var a in i.maps)if(t>=(s=i.maps[a])[0].x&&t<=s[1].x&&e>=s[0].y&&e<=s[1].y)return"m_"+a;for(a=0;a<i.points.length;++a){var r=i.points[a];if(iChart.Charting.pointToPointDistanceSquared(r,{x:t,y:e})<=64)return a+1}for(var s,a=0;a<i.segments.length;++a){var n=i.segments[a];if(iChart.Charting.pointToSegmentDistanceSquared(n,{x:t,y:e},!0)<=64)return 0}if(this.selected&&void 0!==i.controls)for(var a in i.controls)if(t>=(s=i.controls[a])[0].x&&t<=s[1].x&&e>=s[0].y&&e<=s[1].y)return"c_"+a;if(void 0!==i.elementArea){var o=i.elementArea;if(t>=o[0].x&&t<=o[1].x&&e>=o[0].y&&e<=o[1].y)return"a_0"}return-1},iChart.Charting.ChartElement.prototype.remove=function(){this.onRemove(),this.layer.remove(this),delete this.layer,delete this.testContext},iChart.Charting.ChartElement.prototype.setTestSegments=function(){this.testContext.segments=[this.testContext.points],this.testContext.controls=[]}}(),function(){"use strict";iChart.Charting.ChartChannel=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Channel",this.drawType="manually",this.maxPointCount=3,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartChannel,iChart.Charting.ChartElement),iChart.Charting.ChartChannel.prototype.drawInternal=function(t,e){e.length<2||(this.initDrawSettings(t,this.settings),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),e.length<3||(t.beginPath(),t.moveTo(e[2].x,e[2].y),t.lineTo(e[1].x+(e[2].x-e[0].x),e[1].y+(e[2].y-e[0].y)),t.stroke(),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[1].x+(e[2].x-e[0].x),e[1].y+(e[2].y-e[0].y)),t.lineTo(e[2].x,e[2].y),t.fill()))},iChart.Charting.ChartChannel.prototype.setTestSegments=function(){this.testContext.segments=[this.testContext.points,[this.testContext.points[2],{x:this.testContext.points[1].x+(this.testContext.points[2].x-this.testContext.points[0].x),y:this.testContext.points[1].y+(this.testContext.points[2].y-this.testContext.points[0].y)}]]}}(),function(){"use strict";iChart.Charting.ChartEllipse=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Ellipse",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartEllipse,iChart.Charting.ChartElement),iChart.Charting.ChartEllipse.prototype.drawInternal=function(t,e){var i,a,r;e.length<2||(i=Math.abs(e[1].y-e[0].y),r=Math.abs(e[1].x-e[0].x),i<=4||r<=4||(a=(e[0].x+e[1].x)/2,e=(e[0].y+e[1].y)/2,r=2*r/3,this.initDrawSettings(t,this.settings),t.beginPath(),t.moveTo(a,e-i/2),t.bezierCurveTo(a-r,e-i/2,a-r,e+i/2,a,e+i/2),t.bezierCurveTo(a+r,e+i/2,a+r,e-i/2,a,e-i/2),t.fill(),t.stroke()))},iChart.Charting.ChartEllipse.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[1].y}],[{x:this.testContext.points[0].x,y:this.testContext.points[1].y},this.testContext.points[1]],[this.testContext.points[1],{x:this.testContext.points[1].x,y:this.testContext.points[0].y}],[{x:this.testContext.points[1].x,y:this.testContext.points[0].y},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartFibonacciArc=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="FibonacciArc",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartFibonacciArc,iChart.Charting.ChartElement),iChart.Charting.ChartFibonacciArc.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke();var i=Math.sqrt(iChart.Charting.pointToPointDistanceSquared(e[0],e[1]));if(!(i<=4))for(var a=[.382,.5,.618],r=0;r<a.length;++r)t.beginPath(),t.arc(e[0].x,e[0].y,i*a[r],0,Math.PI,e[0].y>e[1].y),t.stroke()}}}(),function(){"use strict";iChart.Charting.ChartFibonacciCorrection=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="FibonacciCorrection",this.drawType="manually",this.percentages=[0,.382,.5,.618,.786,1,1.272,1.618],this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartFibonacciCorrection,iChart.Charting.ChartElement),iChart.Charting.ChartFibonacciCorrection.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke();var i=e[1].y-e[0].y;if(Math.abs(i)<=4)t.restore();else{for(var a=0;a<this.percentages.length;++a){var r,s=Math.round(e[0].y+i*this.percentages[a]);t.beginPath(),t.moveTo(e[0].x,s),t.lineTo(t.canvas.width,s),t.stroke(),0!=this.percentages[a]&&(t.font="12px Arial",r=t.measureText(this.percentages[a]),t.fillText(this.percentages[a],e[0].x-r.width-5,s+5))}t.restore()}}}}(),function(){"use strict";iChart.Charting.ChartFibonacciFan=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="FibonacciFan",this.drawType="manually",this.percentages=[.382,.5,.618],this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartFibonacciFan,iChart.Charting.ChartElement),iChart.Charting.ChartFibonacciFan.prototype.drawInternal=function(t,e){if(!(e.length<2)){t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke();var i=e[1].y-e[0].y;if(!(Math.abs(i)<=4)){i/=e[1].x-e[0].x;for(var a=0;a<this.percentages.length;++a)t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(t.canvas.width,e[0].y+this.percentages[a]*i*(t.canvas.width-e[0].x)),t.stroke()}}}}(),function(){"use strict";iChart.Charting.ChartHorizontalLine=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="HorizontalLine",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.settings=$.extend({drawLabel:!0},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartHorizontalLine,iChart.Charting.ChartElement),iChart.Charting.ChartHorizontalLine.prototype.drawInternal=function(t,e){var i;e.length<1||(i=this.layer.area.getXValue(t.canvas.width-200),this.points[0].x=1e3*i,e[0].x=t.canvas.width-200,t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore())},iChart.Charting.ChartHorizontalLine.prototype.drawExtended=function(t){var e,i,a;this.settings.drawLabel&&((e=this.getCoordinates(t,this.points)).length<1||(i=this.settings,a=this.layer.chart.renderer.formatNumber(this.layer.area.getYValue(e[0].y),{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),this.layer.chart.renderer.drawLable(t,i.strokeStyle,0,this.layer.area.innerWidth,e[0].y,a)))},iChart.Charting.ChartHorizontalLine.prototype.setTestSegments=function(){this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartLine=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Line",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartLine,iChart.Charting.ChartElement),iChart.Charting.ChartLine.prototype.drawInternal=function(t,e){e.length<2||(t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.restore())}}(),function(){"use strict";iChart.Charting.ChartRectangle=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Rectangle",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartRectangle,iChart.Charting.ChartElement),iChart.Charting.ChartRectangle.prototype.drawInternal=function(t,e){var i,a;e.length<2||(t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),i=e[1].x-e[0].x,a=e[1].y-e[0].y,t.moveTo(e[0].x,e[0].y),t.lineTo(e[0].x,e[1].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[1].x,e[0].y),t.lineTo(e[0].x,e[0].y),t.lineTo(e[0].x,e[1].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.fillRect(e[0].x,e[0].y,i,a),t.restore())},iChart.Charting.ChartRectangle.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[1].y}],[{x:this.testContext.points[0].x,y:this.testContext.points[1].y},this.testContext.points[1]],[this.testContext.points[1],{x:this.testContext.points[1].x,y:this.testContext.points[0].y}],[{x:this.testContext.points[1].x,y:this.testContext.points[0].y},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartTrend=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Trend",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartTrend,iChart.Charting.ChartElement),iChart.Charting.ChartTrend.prototype.drawInternal=function(t,e){var i,a,r;e.length<2||(t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),(i=Math.sqrt(iChart.Charting.pointToPointDistanceSquared(e[0],e[1])))<=4||(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[0].x+i,e[0].y),t.stroke(),a=Math.acos((e[1].x-e[0].x)/i),r=e[0].y>=e[1].y,this===this.layer.selected&&(t.beginPath(),t.arc(e[0].x,e[0].y,i/4,0,r?2*Math.PI-a:a,r),t.stroke()),"function"==typeof t.strokeText&&(t.font="normal 15px Tahoma",t.fillStyle=t.strokeStyle,t.translate(-.5,-.5),r?(t.textBaseline="top",t.fillText(Math.round(180*a/Math.PI)+"°",e[0].x+18,e[0].y+3)):(t.textBaseline="bottom",t.fillText("-"+Math.round(180*a/Math.PI)+"°",e[0].x+18,e[0].y-3)),t.translate(.5,.5))))},iChart.Charting.ChartTrend.prototype.setTestSegments=function(){var t=Math.sqrt(iChart.Charting.pointToPointDistanceSquared(this.testContext.points[0],this.testContext.points[1]));this.testContext.segments=[this.testContext.points,[this.testContext.points[0],{x:this.testContext.points[0].x+t,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartTriangle=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Triangle",this.drawType="manually",this.maxPointCount=3,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartTriangle,iChart.Charting.ChartElement),iChart.Charting.ChartTriangle.prototype.drawInternal=function(t,e){e.length<2||(t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),e.length<3||(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.fill(),t.stroke()))},iChart.Charting.ChartTriangle.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],this.testContext.points[1]],[this.testContext.points[1],this.testContext.points[2]],[this.testContext.points[2],this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartVerticalLine=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="VerticalLine",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartVerticalLine,iChart.Charting.ChartElement),iChart.Charting.ChartVerticalLine.prototype.drawInternal=function(t,e){e.length<1||(t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,0),t.lineTo(e[0].x,t.canvas.height),t.stroke(),t.restore())},iChart.Charting.ChartVerticalLine.prototype.setTestSegments=function(){this.testContext.segments=[[{x:this.testContext.points[0].x,y:this.layer.area.innerOffset.top},{x:this.testContext.points[0].x,y:this.layer.area.innerOffset.top+this.layer.area.innerHeight}]]}}(),function(){"use strict";iChart.Charting.ChartMark=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Mark",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.hasPopupSettings=!0,this.settings={mark:"smileUp"},this.img={},this.img.up=new Image,this.img.up.src=this.layer.chart.env.lib_path+"/images/icon-up.png",this.img.left=new Image,this.img.left.src=this.layer.chart.env.lib_path+"/images/icon-left.png",this.img.leftUp=new Image,this.img.leftUp.src=this.layer.chart.env.lib_path+"/images/icon-leftUp.png",this.img.rightUp=new Image,this.img.rightUp.src=this.layer.chart.env.lib_path+"/images/icon-rightUp.png",this.img.smileUp=new Image,this.img.smileUp.src=this.layer.chart.env.lib_path+"/images/icon-smileUp.png",this.img.exclamation=new Image,this.img.exclamation.src=this.layer.chart.env.lib_path+"/images/icon-exclamation.png",this.img.buy=new Image,this.img.buy.src=this.layer.chart.env.lib_path+"/images/icon-buy.png",this.img.down=new Image,this.img.down.src=this.layer.chart.env.lib_path+"/images/icon-down.png",this.img.right=new Image,this.img.right.src=this.layer.chart.env.lib_path+"/images/icon-right.png",this.img.leftDown=new Image,this.img.leftDown.src=this.layer.chart.env.lib_path+"/images/icon-leftDown.png",this.img.rightDown=new Image,this.img.rightDown.src=this.layer.chart.env.lib_path+"/images/icon-rightDown.png",this.img.smileDown=new Image,this.img.smileDown.src=this.layer.chart.env.lib_path+"/images/icon-smileDown.png",this.img.question=new Image,this.img.question.src=this.layer.chart.env.lib_path+"/images/icon-question.png",this.img.sell=new Image,this.img.sell.src=this.layer.chart.env.lib_path+"/images/icon-sell.png",$("#elementSettings").remove()},inheritPrototype(iChart.Charting.ChartMark,iChart.Charting.ChartElement),iChart.Charting.ChartMark.prototype.drawInternal=function(t,e){var i;e.length<1||null!=this.settings&&(i=this.settings,i=this.img[i.mark],t.save(),t.translate(-.5,-.5),t.drawImage(i,e[0].x-i.width/2,e[0].y-i.height/2,i.width,i.height),t.restore(),$(".Mark-select").hide())},iChart.Charting.ChartMark.prototype.drawPopupSettings=function(t,e){$("#elementSettings").remove(),$('<div id="elementSettings" class="mark chartInstrument"><div class="uk-flex uk-flex-left"><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"up"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-up"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"left"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-left"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"leftUp"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-upLeft"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"rightUp"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-upRight"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"smileUp"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-smileUp"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"exclamation"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-exclamation"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"buy"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-buy"></i></div></div><div class="uk-flex uk-flex-left"><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"down"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-down"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"right"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-right"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"leftDown"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-downLeft"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"rightDown"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-downRight"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"smileDown"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-smileDown"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"question"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-question"></i></div><div class="chartTool uk-flex uk-flex-center uk-flex-middle" data-settings=\'{"mark":"sell"}\' name="SelectInstrument" data-instrument="Mark"><i class="sprite sprite-icon-sell"></i></div></div></div>').appendTo($(this.layer.chart.container));var i=e.x-$("#elementSettings.mark").width()+8;$("#elementSettings").css({left:this.layer.area.innerOffset.left+i,top:this.layer.area.innerOffset.top+e.y+15});var a=this;return $("#elementSettings .chartTool").off("mousedown").on("mousedown",function(t){t.stopPropagation(),t=$(this).data("settings"),a.setSettings(t),a.layer.render(),$("#elementSettings").remove()}),!1},iChart.Charting.ChartMark.prototype.drawPoints=function(t,e){},iChart.Charting.ChartMark.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartLabel=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Label",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.hasPopupSettings=!0,this.settings=0,this.settings={text:"",size:12},this.sizes=[12,15,19],$("#elementSettings").remove()},inheritPrototype(iChart.Charting.ChartLabel,iChart.Charting.ChartElement),iChart.Charting.ChartLabel.prototype.drawString=function(t,e,i,a,r,s,n,o){var h=e.split("\n");n=n||0,o=o||"Arial,Helvetica,sans-serif",r=r||this.sizes[0],s=s||"#000000",t.save(),t.font=r+"px "+o,t.fillStyle=s,t.translate(i,a),t.rotate(n*Math.PI/180);for(var l=0;l<h.length;l++)t.fillText(h[l],0,l*r);t.restore()},iChart.Charting.ChartLabel.prototype.drawInternal=function(t,e){var i;e.length<1||(i=this.settings,this.drawString(t,i.text,e[0].x,e[0].y,i.size))},iChart.Charting.ChartLabel.prototype.setSettings=function(t){this.settings=t,this.layer.context&&(this.layer.render(),this.layer.syncHash())},iChart.Charting.ChartLabel.prototype.drawPopupSettings=function(t,e){var i=this.settings,a=i.size==this.sizes[0]?"selected":"",r=i.size==this.sizes[1]?"selected":"",s=i.size==this.sizes[2]?"selected":"";$("#elementSettings").remove(),$('<div id="elementSettings" class="label"><textarea rows="3" style="width: 99%;">'+i.text+'</textarea><br/>Размер шрифта:<br/><select id="elementSize"><option '+a+' value="'+this.sizes[0]+'">Маленький</option><option '+r+' value="'+this.sizes[1]+'">Средний</option><option '+s+' value="'+this.sizes[2]+'">Большой</option></select><img class="save" style="margin-left: 15px; margin-top: 3px;" src="/i/admin/btn/save.gif"/><div class="close">[X]</div></div>').prependTo($(this.layer.chart.container).parent()),$("#elementSettings.label").css({"margin-left":e.x+2,"margin-top":e.y+2});function n(){o.remove()}var o=this;return $("#elementSettings .save").unbind("mousedown").mousedown(function(t){t.stopPropagation();t={text:$("#elementSettings.label textarea").val(),size:$("#elementSettings.label #elementSize").val()};$("#elementSettings.label textarea").val().length?(t=t,o.setSettings(t)):n(),$("#elementSettings.label").remove()}),$("#elementSettings.label .close").unbind("mousedown").mousedown(function(t){t.stopPropagation(),o.settings.text.length||n(),$("#elementSettings.label").remove()}),!1},iChart.Charting.ChartLabel.prototype.setTestSegments=function(){var t=this.layer.context,e=this.settings,i=e.size;t.font=i+"px Arial,Helvetica,sans-serif",t.fillStyle="#000000";for(var a=0,r=0,s=e.text.split("\n"),n=0;n<s.length;n++)t.measureText(s[n]).width>a&&(a=t.measureText(s[n]).width,r+=i);this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x+a,y:this.testContext.points[0].y}],[{x:this.testContext.points[0].x+a,y:this.testContext.points[0].y},{x:this.testContext.points[0].x+a,y:this.testContext.points[0].y+r}],[{x:this.testContext.points[0].x+a,y:this.testContext.points[0].y+r},{x:this.testContext.points[0].x,y:this.testContext.points[0].y+r}],[{x:this.testContext.points[0].x,y:this.testContext.points[0].y+r},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartArrow=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Arrow",this.drawType="manually",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartArrow,iChart.Charting.ChartElement),iChart.Charting.ChartArrow.prototype.drawInternal=function(t,e){var i,a,r,s,n;e.length<2||(t.save(),this.initDrawSettings(t,this.settings),i=e[0].x,a=e[0].y,r=e[1].y,s=e[1].x,n=2*(5+t.lineWidth),t.lineWidth,e=Math.atan2(r-a,s-i),t.beginPath(),t.moveTo(s,r),t.lineTo(s-n*Math.cos(e-Math.PI/6),r-n*Math.sin(e-Math.PI/6)),t.lineTo(s-n*Math.cos(e+Math.PI/6),r-n*Math.sin(e+Math.PI/6)),t.lineTo(s,r),t.lineTo(s-n*Math.cos(e-Math.PI/6),r-n*Math.sin(e-Math.PI/6)),t.fillStyle=t.strokeStyle,t.fill(),t.stroke(),t.beginPath(),t.moveTo(i,a),t.lineTo((s-n*Math.cos(e-Math.PI/6)+s-n*Math.cos(e+Math.PI/6))/2,(r-n*Math.sin(e-Math.PI/6)+r-n*Math.sin(e+Math.PI/6))/2),t.stroke(),t.restore())}}(),function(){"use strict";iChart.Charting.ChartPolygon=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Polygon",this.drawType="manually",this.maxPointCount=4,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartPolygon,iChart.Charting.ChartElement),iChart.Charting.ChartPolygon.prototype.drawInternal=function(t,e){var i;e.length<2||(t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),e.length<3||(t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),e.length<4||(i=this.settings,t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.beginPath(),t.strokeStyle=i.strokeStyle2,t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y),t.stroke(),t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(e[3].x,e[3].y)),t.fill()))},iChart.Charting.ChartPolygon.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],this.testContext.points[1]],[this.testContext.points[2],this.testContext.points[3]]]}}(),function(){"use strict";iChart.Charting.ChartTrade=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Trade",this.drawType="manually",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.id=0},inheritPrototype(iChart.Charting.ChartTrade,iChart.Charting.ChartElement),iChart.Charting.ChartTrade.prototype.drawInternal=function(t,e){e.length<1||(t.save(),t.beginPath(),t.arc(e[0].x,e[0].y,5,0,2*Math.PI,!0),1==this.settings.type_id||3==this.settings.type_id?t.fillStyle="#00ff00":t.fillStyle="#ff0000",t.inHover&&(t.fillStyle="#0000ff",t.stokeStyle="#000"),t.fill(),t.closePath(),""!==this.settings.qb&&(t.beginPath(),t.strokeStyle=t.fillStyle,t.moveTo(e[0].x+5,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.closePath(),t.stroke()),2==this.settings.mode&&this.drawTradeLable(t,e[0].x,e[0].y,this.settings),t.globalAlpha=.3,t.lineWidth=1,t.stokeStyle="#eee",t.restore())},iChart.Charting.ChartTrade.prototype.drawTradeLable=function(t,e,i,a){var r=parseFloat(a.price),s=getTradeLabelText(a,r=r<100?iChart.formatNumber(r,{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(r,{decimalPlaces:2,decimalPrecision:null,scale:0}));t.save(),t.font="normal 11px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.busyPoints=t.busyPoints||{},t.setLineDash&&t.setLineDash([5]);for(var n=e+20,o=70,r=t.measureText(s).width+10,h=n+r,l=0,o=70;o<=this.layer.area.innerHeight;o+=30){l=1;for(var c=$.map(t.busyPoints,function(t,e){return t.y==o?t:null}),d=0;d<c.length&&l;d++)(e<=c[d].maxX&&e>=c[d].minX||h<=c[d].maxX&&h>=c[d].minX||e<=c[d].minX&&h>=c[d].maxX)&&(l=0);if(l)break}t.beginPath(),t.strokeStyle="#C5C5C5",t.fillStyle="rgba(238,238,238,0.5)",t.rect(n,o-10,r,20),t.fill(),t.moveTo(e,i+(i<o?5:-5)),t.lineTo(e,o),t.lineTo(n,o),t.moveTo(e,i+(i<o?5:-5)),t.stroke(),t.fillStyle="#000",t.fillText(s,e+24,o),t.busyPoints[a.id]={minX:e,maxX:n+r,y:o},t.restore()},iChart.Charting.ChartTrade.prototype.onHover=function(t){var e=this.getCoordinates(t,this.points),t=e[0].y,e=e[0].x;this.drawTooltip(this.settings,t,e)},iChart.Charting.ChartTrade.prototype.onOut=function(t){$("[chart-element-tooltip]").hide()},iChart.Charting.ChartTrade.prototype.drawTooltip=function(t,e,i){0==this.layer.chart.env.wrapper.find("[chart-element-tooltip]").length&&$(this.layer.chart.container).append('<div chart-element-tooltip class="qtip qtip-default qtip-tipsy qtip-pos-rc" tracking="false" role="alert" aria-live="polite" aria-atomic="false" style="z-index: 15002;"><div class="qtip-tip" style="background-color: transparent ! important; border: 0px none ! important; height: 6px; width: 6px; line-height: 6px; top: 50%; margin-top: -3px; right: -6px;"><canvas style="background-color: transparent ! important; border: 0px none ! important;" height="6" width="6"></canvas></div><div class="qtip-content" id="qtip-34-content" aria-atomic="true"></div></div></div>');t=$("<div>"+(1==t.type_id?"Покупка":"Продажа")+"<br/>Дата: "+(1440<=this.layer.chart._dataSettings.timeframe?t.date_time.substr(0,10):t.date_time)+"<br/>Сделок: "+t.count+"<br/>Количество: "+iChart.formatNumber(parseFloat(t.volume),{decimalPlaces:0,decimalPrecision:null,scale:0})+"<br/>Сумма: "+(t.summ<100?iChart.formatNumber(parseFloat(t.summ),{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(parseFloat(t.summ),{decimalPlaces:2,decimalPrecision:null,scale:0}))+"<br/>Цена: "+(t.price<100?iChart.formatNumber(parseFloat(t.price),{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(parseFloat(t.price),{decimalPlaces:2,decimalPrecision:null,scale:0}))+"<br/>"+(0==parseFloat(t.profit)?"":0<parseFloat(t.profit)?"Прибыль: ":"Убыток: ")+(0!=parseFloat(t.profit)?iChart.formatNumber(parseFloat(t.profit),{decimalPlaces:2,decimalPrecision:2,scale:0})+"<br/>":"")+"</div>");$("[chart-element-tooltip] .qtip-content").html(t),$("[chart-element-tooltip]").css({top:Math.max(e-$("[chart-element-tooltip]").height()-12,0)+"px",left:i+12+"px"}).show()},iChart.Charting.ChartTrade.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartBubble=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Bubble",this.drawType="manually",this.maxPointCount=3,this.hasSettings=!0,this.hasPopupSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings,{text:""})},inheritPrototype(iChart.Charting.ChartBubble,iChart.Charting.ChartElement),iChart.Charting.ChartBubble.prototype.onInsert=function(){this.selected=!0;var t=this.getCoordinates(null,this.points);t.length<2||(this.settings.width=t[1].x-t[0].x,this.settings.height=t[1].y-t[0].y)},iChart.Charting.ChartBubble.prototype.drawInternal=function(t,e){e.length<2||(void 0!==this.markers?(e[1].x,e[0].x,e[1].y,e[0].y,this.settings.width=e[1].x-e[0].x,this.settings.height=e[1].y-e[0].y):this.settings.width&&this.settings.height&&(this.points[1].x=1e3*this.layer.area.getXValue(e[0].x+this.settings.width),this.points[1].y=this.layer.area.getYValue(e[0].y+this.settings.height),e[1].x=this.layer.area.getXPositionByValue(this.points[1].x/1e3),e[1].y=this.layer.area.getYPosition(this.points[1].y)),this.initDrawSettings(t,this.settings),this.drawBubble(t,e))},iChart.Charting.ChartBubble.prototype.drawBubble=function(t,e){var i,a,r,s=Math.abs(e[0].x-e[1].x),n=Math.abs(e[0].y-e[1].y),o=e[0].x<e[1].x,h=e[0].y<e[1].y,l=[{},{},{}],c=80,d=!1,p=!1,u=Math.min(parseInt(s/3),parseInt(n/3),25);t.save(),t.lineJoin="miter",t.beginPath(),void 0!==e[2]&&Math.abs(e[0].x-e[1].x)>2*u&&Math.abs(e[0].y-e[1].y)>2*u&&(e[2].x<Math.max(e[0].x,e[1].x)&&e[2].x>Math.min(e[0].x,e[1].x)&&e[2].y<Math.max(e[0].y,e[1].y)&&e[2].y>Math.min(e[0].y,e[1].y)||(Math.abs(e[0].x-e[2].x)<Math.abs(e[1].x-e[2].x)?l[0].x=e[0].x:l[0].x=e[1].x,Math.abs(e[0].y-e[2].y)<Math.abs(e[1].y-e[2].y)?l[0].y=e[0].y:l[0].y=e[1].y,!(e[2].x>Math.min(e[0].x,e[1].x)&&e[2].x<Math.max(e[0].x,e[1].x))&&(e[2].y>Math.min(e[0].y,e[1].y)&&e[2].y<Math.max(e[0].y,e[1].y)||Math.abs((l[0].x-e[2].x)*(o?1:-1))>Math.abs((l[0].y-e[2].y)*(h?1:-1)))?p=!0:d=!0,d?(a=Math.abs(l[0].y-e[2].y)*Math.sin(Math.PI/12),c=parseInt(s/6),r=parseInt(s-2*u),i=a<c&&a<r?a:Math.min(c,r),s=o?Math.min(e[1].x-u,Math.max(e[0].x+u,e[2].x)):Math.min(e[0].x-u,Math.max(e[1].x+u,e[2].x)),l[1].x=s-i/2,l[2].x=s+i/2,l[1].y=l[2].y=l[0].y,o&&Math.min(l[1].x,l[2].x)<e[0].x+u||!o&&Math.min(l[1].x,l[2].x)<e[1].x+u?(l[1].x=l[0].x+u,l[2].x=l[1].x+i):(o&&Math.max(l[1].x,l[2].x)>e[1].x-u||!o&&Math.max(l[1].x,l[2].x)>e[0].x-u)&&(l[1].x=l[0].x-u,l[2].x=l[1].x-i)):p&&(a=Math.abs(l[0].x-e[2].x)*Math.sin(Math.PI/12),c=parseInt(n/6),r=parseInt(n-2*u),i=a<c&&a<r?a:Math.min(c,r),r=h?Math.min(e[1].y-u,Math.max(e[0].y+u,e[2].y)):Math.min(e[0].y-u,Math.max(e[1].y+u,e[2].y)),l[1].y=r-i/2,l[2].y=r+i/2,l[1].x=l[2].x=l[0].x,h&&Math.min(l[1].y,l[2].y)<e[0].y+u||!h&&Math.min(l[1].y,l[2].y)<e[1].y+u?(l[1].y=l[0].y+u,l[2].y=l[1].y+i):(h&&Math.max(l[1].y,l[2].y)>e[1].y-u||!h&&Math.max(l[1].y,l[2].y)>e[0].y-u)&&(l[1].y=l[0].y-u,l[2].y=l[1].y-i)))),t.moveTo(e[0].x+(o?u:-u),e[0].y),d&&l[0].y==e[0].y&&(t.lineTo(o?Math.min(l[1].x,l[2].x):Math.max(l[1].x,l[2].x),l[1].y),t.lineTo(e[2].x,e[2].y),t.lineTo(o?Math.max(l[1].x,l[2].x):Math.min(l[1].x,l[2].x),l[2].y)),t.lineTo(e[1].x-(o?u:-u),e[0].y),t.quadraticCurveTo(e[1].x,e[0].y,e[1].x,e[0].y+(h?u:-u)),p&&l[0].x==e[1].x&&(t.lineTo(l[1].x,h?Math.min(l[1].y,l[2].y):Math.max(l[1].y,l[2].y)),t.lineTo(e[2].x,e[2].y),t.lineTo(l[1].x,h?Math.max(l[1].y,l[2].y):Math.min(l[1].y,l[2].y))),t.lineTo(e[1].x,e[1].y-(h?u:-u)),t.quadraticCurveTo(e[1].x,e[1].y,e[1].x-(o?u:-u),e[1].y),d&&l[0].y==e[1].y&&(t.lineTo(o?Math.max(l[1].x,l[2].x):Math.min(l[1].x,l[2].x),l[2].y),t.lineTo(e[2].x,e[2].y),t.lineTo(o?Math.min(l[1].x,l[2].x):Math.max(l[1].x,l[2].x),l[1].y)),t.lineTo(e[0].x+(o?u:-u),e[1].y),t.quadraticCurveTo(e[0].x,e[1].y,e[0].x,e[1].y-(h?u:-u)),p&&l[0].x==e[0].x&&(t.lineTo(l[1].x,h?Math.max(l[1].y,l[2].y):Math.min(l[1].y,l[2].y)),t.lineTo(e[2].x,e[2].y),t.lineTo(l[1].x,h?Math.min(l[1].y,l[2].y):Math.max(l[1].y,l[2].y))),t.lineTo(e[0].x,e[0].y+(h?u:-u)),t.quadraticCurveTo(e[0].x,e[0].y,e[0].x+(o?u:-u),e[0].y),t.closePath(),t.fill(),t.stroke(),this.drawText(t,e,u,""),t.restore()},iChart.Charting.ChartBubble.prototype.drawText=function(t,e,i,a){var r=Math.abs(e[0].x-e[1].x)-parseInt(2*i/3)-10,s=Math.abs(e[0].y-e[1].y)-parseInt(2*i/3)-10,n=Math.min(e[0].x,e[1].x)+parseInt(i/3)+5,o=Math.min(e[0].y,e[1].y)+parseInt(i/3)+5,h=this.settings;if(this.selected){e=o,i=n+this.layer.area.innerOffset.left;$("#chart-bubble-text").is(":visible")?this.settings.text=$("#chart-bubble-text").val():(0==$("#chart-element-bubble").length&&$(this.layer.chart.container).append('<div id="chart-element-bubble" style="z-index: 15002; position: absolute; "><textarea id="chart-bubble-text"></textarea></div>'),$("#chart-bubble-text").val("").focus().val(this.settings.text)),$("#chart-bubble-text").css({font:"normal "+this.settings.fontSize+"px/"+(parseInt(this.settings.fontSize)+Math.round(parseInt(this.settings.fontSize)/5))+"px "+this.settings.fontFamaly,background:"rgba(230,230,230,.0)",color:this.settings.fontColor,overflow:"hidden",border:"0px solid red",width:r+"px",height:s+"px"}),$("#chart-element-bubble").css({top:e+"px",left:i-2+"px"}).show(),$("#chart-bubble-text").width(r-2).height(s-2),$("#chart-element-bubble").off("click mousedown drag dragstart").on("click mousedown drag dragstart",function(t){t.stopPropagation()})}else{a=h.text,t.save(),t.beginPath(),t.fillStyle=this.settings.fontColor,t.font="normal "+this.settings.fontSize+"px "+this.settings.fontFamaly,t.textAlign="left",t.textBaseline="top",t.rect(n,o,r,s),t.clip(),t.translate(n,o);for(var l=(a=a.replace(/\n/g," [%br%] ")).split(/\s/),c=l.length,d="",p=0+Math.round(parseInt(this.settings.fontSize)/10),u=parseInt(this.settings.fontSize)+Math.round(parseInt(this.settings.fontSize)/5),g=0;g<c;g++){var f=d+l[g]+" ",m=t.measureText(f).width;"[%br%]"==l[g]?(t.fillText(d,0,p),d="",p+=u):r<m?(t.fillText(d,0,p),d=l[g]+" ",p+=u):d=f}t.fillText(d,0,p),t.closePath(),t.restore()}},iChart.Charting.ChartBubble.prototype.drawPopupSettings=function(t,e){function i(t,e){var i=$(this).val(),a=i,r=$(this).attr("data-option");i.match(/^rgb.*/)||(a=iChart.hexToRGB(i,e)),s.find('.js-colorSelector[data-option="'+r+'"]').css("background-color",a),s.find('input[data-option="'+r+'"]').val(a),$(this).minicolors("value",a)}function a(){var t=this.value,e=this.element.attr("data-option"),i=t;t.match(/^rgb.*/)||(i=iChart.hexToRGB(t,1)),s.find('.js-colorSelector[data-option="'+e+'"]').css("background-color",i),s.find('input[data-option="'+e+'"]').val(i),this.element.parent().find(".js-colorPicker").minicolors("value",i)}var r={options:{sizes:[{name:8,value:8},{name:9,value:9},{name:10,value:10},{name:11,value:11},{name:12,value:12},{name:14,value:14},{name:16,value:16},{name:20,value:20},{name:24,value:24},{name:28,value:28},{name:32,value:32},{name:40,value:40}],fonts:[{name:"Verdana",value:"Verdana,Tahoma,Geneva,Arial,Sans-serif"},{name:"Courier New",value:"Courier New,Monospace"},{name:"Times New Roman",value:"TimesNewRoman,Times,Baskerville,Georgia,serif"},{name:"Arial",value:"Arial,Helvetica,sans-serif"}]},values:{fontSize:this.settings.fontSize,fontColor:this.settings.fontColor,fontFamaly:this.settings.fontFamaly,text:this.settings.text}},s=$($.render.iChart_textPopupSettingsTmpl(r)),n=this;s.find(".js-colorSelector").each(function(){var t=$(this),e=t.find(".menuHolder").html();t.qtip({style:{classes:"qtip-light"},position:{at:"center right",my:"left center",effect:!1,viewport:$("html"),adjust:{method:"shift none"}},content:{text:e},hide:{fixed:!0,delay:300},show:{solo:!0},events:{show:function(t,e){$(t.currentTarget).find(".js-colorPicker").each(function(){n.layer.chart.env.ui.addMinicolors(this,t.currentTarget,i,a)})}}})}),s.on("click",".js-textPopupSettings",{popupWindow:s,element:n},function(t){"ok"==$(this).data("value")&&(t.data.element.settings.fontSize=t.data.popupWindow.find("[name='fontSize']").val(),t.data.element.settings.fontFamaly=t.data.popupWindow.find("[name='fontFamaly']").val(),t.data.element.settings.text=t.data.popupWindow.find("[name='text']").val(),$("#chart-bubble-text").val(t.data.element.settings.text),t.data.element.settings.fontColor=t.data.popupWindow.find("input[data-option='fontColor']").val(),t.data.element.layer.render()),$.modal.impl.d.data&&$.modal.impl.close()}),this.layer.chart.env.wrapper.append(s),s.modal({modal:!1,minWidth:500,zIndex:1500,position:[e.y+"px",e.x+"px"],title:_t("17599","Настройки текста")})},iChart.Charting.ChartBubble.prototype.onSelect=function(t){iChart.Charting.ChartElement.prototype.onSelect.call(this,t),0==$("#chart-element-bubble").length&&($(this.layer.chart.container).append('<div id="chart-element-bubble" style="z-index: 15002; position: absolute; "><textarea id="chart-bubble-text"></textarea></div>'),$("#chart-bubble-text").css({font:"normal "+this.settings.fontSize+"px/"+(parseInt(this.settings.fontSize)+Math.round(parseInt(this.settings.fontSize)/5))+"px "+this.settings.fontFamaly,background:"rgba(230,230,230,.0)",color:this.settings.fontColor,overflow:"hidden",border:"0px solid red"})),$("#chart-bubble-text").val("").focus().val(this.settings.text)},iChart.Charting.ChartBubble.prototype.onBlur=function(t){var e=this.settings;e.text=$("#chart-bubble-text").val(),this.setSettings(e),$("#chart-element-bubble").css({top:"-12000px",left:"-12000px"}).remove()},iChart.Charting.ChartBubble.prototype.onHover=function(t){this.selected&&(this.settings.text=$("#chart-bubble-text").val())},iChart.Charting.ChartBubble.prototype.onOut=function(t){this.selected&&(this.settings.text=$("#chart-bubble-text").val())},iChart.Charting.ChartBubble.prototype.onRemove=function(){$("#chart-element-bubble").css({top:"-12000px",left:"-12000px"}).hide()},iChart.Charting.ChartBubble.prototype.drawCheckPoint=function(t,e,i,a){t.strokeText(a,e,i),t.beginPath(),t.save(),t.strokeStyle="rgba(50,50,50,.4)",t.arc(e,i,40,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.lineWidth="3",t.arc(e,i,1,0,2*Math.PI,!0),t.stroke(),t.restore()},iChart.Charting.ChartBubble.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[1].y}],[{x:this.testContext.points[0].x,y:this.testContext.points[1].y},this.testContext.points[1]],[this.testContext.points[1],{x:this.testContext.points[1].x,y:this.testContext.points[0].y}],[{x:this.testContext.points[1].x,y:this.testContext.points[0].y},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartText=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Text",this.drawType="manually",this.maxPointCount=2,this.hasSettings=!0,this.hasPopupSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings,{text:""})},inheritPrototype(iChart.Charting.ChartText,iChart.Charting.ChartElement),iChart.Charting.ChartText.prototype.onInsert=function(){this.selected=!0;var t=this.getCoordinates(null,this.points);t.length<2||(this.settings.width=t[1].x-t[0].x,this.settings.height=t[1].y-t[0].y)},iChart.Charting.ChartText.prototype.drawInternal=function(t,e){e.length<2||(void 0!==this.markers?(e[1].x,e[0].x,e[1].y,e[0].y,this.settings.width=e[1].x-e[0].x,this.settings.height=e[1].y-e[0].y):this.settings.width&&this.settings.height&&(this.points[1].x=1e3*this.layer.area.getXValue(e[0].x+this.settings.width),this.points[1].y=this.layer.area.getYValue(e[0].y+this.settings.height),e[1].x=this.layer.area.getXPositionByValue(this.points[1].x/1e3),e[1].y=this.layer.area.getYPosition(this.points[1].y)),this.initDrawSettings(t,this.settings),this.drawLabel(t,e))},iChart.Charting.ChartText.prototype.drawLabel=function(t,e){var i=Math.abs(e[0].x-e[1].x),a=Math.abs(e[0].y-e[1].y),r=e[0].x<e[1].x,s=e[0].y<e[1].y,n=Math.min(parseInt(i/3),parseInt(a/3),5);t.save(),t.beginPath(),t.moveTo(e[0].x+(r?n:-n),e[0].y),t.lineTo(e[1].x-(r?n:-n),e[0].y),t.quadraticCurveTo(e[1].x,e[0].y,e[1].x,e[0].y+(s?n:-n)),t.lineTo(e[1].x,e[1].y-(s?n:-n)),t.quadraticCurveTo(e[1].x,e[1].y,e[1].x-(r?n:-n),e[1].y),t.lineTo(e[0].x+(r?n:-n),e[1].y),t.quadraticCurveTo(e[0].x,e[1].y,e[0].x,e[1].y-(s?n:-n)),t.lineTo(e[0].x,e[0].y+(s?n:-n)),t.quadraticCurveTo(e[0].x,e[0].y,e[0].x+(r?n:-n),e[0].y),t.closePath(),t.fill(),t.stroke(),this.drawText(t,e,n,""),t.restore()},iChart.Charting.ChartText.prototype.drawText=function(t,e,i,a){var r=Math.abs(e[0].x-e[1].x)-parseInt(2*i/3)-10,s=Math.abs(e[0].y-e[1].y)-parseInt(2*i/3)-10,n=Math.min(e[0].x,e[1].x)+parseInt(i/3)+5,o=Math.min(e[0].y,e[1].y)+parseInt(i/3)+5,h=this.settings;if(this.selected){e=o,i=n+this.layer.area.innerOffset.left;$("#chart-bubble-text").is(":visible")?this.settings.text=$("#chart-bubble-text").val():(0==$("#chart-element-bubble").length&&$(this.layer.chart.container).append('<div id="chart-element-bubble" style="z-index: 15002; position: absolute; "><textarea id="chart-bubble-text"></textarea></div>'),$("#chart-bubble-text").val("").focus().val(this.settings.text)),$("#chart-bubble-text").css({font:"normal "+this.settings.fontSize+"px/"+(parseInt(this.settings.fontSize)+Math.round(parseInt(this.settings.fontSize)/5))+"px "+this.settings.fontFamaly,background:"rgba(230,230,230,.0)",color:this.settings.fontColor,overflow:"hidden",border:"0px solid red",width:r+"px",height:s+"px"}),$("#chart-element-bubble").css({top:+e+"px",left:i-1+"px"}).show(),$("#chart-bubble-text").width(r-2).height(s-2),$("#chart-element-bubble").off("click mousedown drag dragstart").on("click mousedown drag dragstart",function(t){t.stopPropagation()})}else{a=h.text,t.save(),t.beginPath(),t.fillStyle=this.settings.fontColor,t.font="normal "+this.settings.fontSize+"px "+this.settings.fontFamaly,t.textAlign="left",t.textBaseline="top",t.rect(n,o,r,s),t.clip(),t.translate(n,o);for(var l=(a=a.replace(/\n/g," [%br%] ")).split(/\s/),c=l.length,d="",p=0+Math.round(parseInt(this.settings.fontSize)/10),u=parseInt(this.settings.fontSize)+Math.round(parseInt(this.settings.fontSize)/5),g=0;g<c;g++){var f=d+l[g]+" ",m=t.measureText(f).width;"[%br%]"==l[g]?(t.fillText(d,0,p),d="",p+=u):r<m?(t.fillText(d,0,p),d=l[g]+" ",p+=u):d=f}t.fillText(d,0,p),t.closePath(),t.restore()}},iChart.Charting.ChartText.prototype.drawPopupSettings=function(t,e){function i(t,e){var i=$(this).val(),a=i,r=$(this).attr("data-option");i.match(/^rgb.*/)||(a=iChart.hexToRGB(i,e)),s.find('.js-colorSelector[data-option="'+r+'"]').css("background-color",a),s.find('input[data-option="'+r+'"]').val(a),$(this).minicolors("value",a)}function a(){var t=this.value,e=this.element.attr("data-option"),i=t;t.match(/^rgb.*/)||(i=iChart.hexToRGB(t,1)),s.find('.js-colorSelector[data-option="'+e+'"]').css("background-color",i),s.find('input[data-option="'+e+'"]').val(i),this.element.parent().find(".js-colorPicker").minicolors("value",i)}var r={options:{sizes:[{name:8,value:8},{name:9,value:9},{name:10,value:10},{name:11,value:11},{name:12,value:12},{name:14,value:14},{name:16,value:16},{name:20,value:20},{name:24,value:24},{name:28,value:28},{name:32,value:32},{name:40,value:40}],fonts:[{name:"Verdana",value:"Verdana,Tahoma,Geneva,Arial,Sans-serif"},{name:"Courier New",value:"Courier New,Monospace"},{name:"Times New Roman",value:"TimesNewRoman,Times,Baskerville,Georgia,serif"},{name:"Arial",value:"Arial,Helvetica,sans-serif"}]},values:{fontSize:this.settings.fontSize,fontColor:this.settings.fontColor,fontFamaly:this.settings.fontFamaly,text:this.settings.text}},s=$($.render.iChart_textPopupSettingsTmpl(r)),n=this;s.find(".js-colorSelector").each(function(){var t=$(this),e=t.find(".menuHolder").html();t.qtip({style:{classes:"qtip-light"},position:{at:"center right",my:"left center",effect:!1,viewport:$("html"),adjust:{method:"shift none"}},content:{text:e},hide:{fixed:!0,delay:300},show:{solo:!0},events:{show:function(t,e){$(t.currentTarget).find(".js-colorPicker").each(function(){n.layer.chart.env.ui.addMinicolors(this,t.currentTarget,i,a)})}}})}),s.on("click",".js-textPopupSettings",{popupWindow:s,element:n},function(t){"ok"==$(this).data("value")&&(t.data.element.settings.fontSize=t.data.popupWindow.find("[name='fontSize']").val(),t.data.element.settings.fontFamaly=t.data.popupWindow.find("[name='fontFamaly']").val(),t.data.element.settings.text=t.data.popupWindow.find("[name='text']").val(),$("#chart-bubble-text").val(t.data.element.settings.text),t.data.element.settings.fontColor=t.data.popupWindow.find("input[data-option='fontColor']").val(),t.data.element.layer.render()),$.modal.impl.d.data&&$.modal.impl.close()}),this.layer.chart.env.wrapper.append(s),s.modal({modal:!1,minWidth:500,zIndex:1500,position:[e.y+"px",e.x+"px"],title:_t("17599","Настройки текста")})},iChart.Charting.ChartText.prototype.onSelect=function(t){iChart.Charting.ChartElement.prototype.onSelect.call(this,t),0==$("#chart-element-bubble").length&&($(this.layer.chart.container).append('<div id="chart-element-bubble" style="z-index: 15002; position: absolute; "><textarea id="chart-bubble-text"></textarea></div>'),$("#chart-bubble-text").css({font:"normal "+this.settings.fontSize+"px/"+(parseInt(this.settings.fontSize)+Math.round(parseInt(this.settings.fontSize)/5))+"px "+this.settings.fontFamaly,background:"rgba(230,230,230,.0)",color:this.settings.fontColor,overflow:"hidden",border:"0px solid red"})),$("#chart-bubble-text").val("").focus().val(this.settings.text)},iChart.Charting.ChartText.prototype.onBlur=function(t){var e=this.settings;e.text=$("#chart-bubble-text").val(),this.setSettings(e),$("#chart-element-bubble").css({top:"-12000px",left:"-12000px"}).remove()},iChart.Charting.ChartText.prototype.onHover=function(t){this.selected&&(this.settings.text=$("#chart-bubble-text").val())},iChart.Charting.ChartText.prototype.onOut=function(t){this.selected&&(this.settings.text=$("#chart-bubble-text").val())},iChart.Charting.ChartText.prototype.onRemove=function(){$("#chart-element-bubble").css({top:"-12000px",left:"-12000px"}).hide()},iChart.Charting.ChartText.prototype.drawCheckPoint=function(t,e,i,a){t.strokeText(a,e,i),t.beginPath(),t.save(),t.strokeStyle="rgba(50,50,50,.4)",t.arc(e,i,40,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.lineWidth="3",t.arc(e,i,1,0,2*Math.PI,!0),t.stroke(),t.restore()},iChart.Charting.ChartText.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[1].y}],[{x:this.testContext.points[0].x,y:this.testContext.points[1].y},this.testContext.points[1]],[this.testContext.points[1],{x:this.testContext.points[1].x,y:this.testContext.points[0].y}],[{x:this.testContext.points[1].x,y:this.testContext.points[0].y},this.testContext.points[0]]]}}(),function(){"use strict";iChart.Charting.ChartOrder=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Order",this.drawType="auto",this.hoverCursor="row-resize",this.moveCursor="row-resize",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.storageEnable=!1,this.settings={},this.positionAbsolute=!0},inheritPrototype(iChart.Charting.ChartOrder,iChart.Charting.ChartElement),iChart.Charting.ChartOrder.prototype.drawInternal=function(t,e){if(!(e.length<1)){this.settings.fillStyle=this.settings.fillStyle||"#3AAE3E";var i=this.layer.chart.areas[0].xSeries[this.layer.chart.areas[0].xSeries.length-this.layer.chart.chartOptions.futureAmount-1];this.points[0].x=1e3*i,e[0].x=this.layer.area.getXPositionByValue(i);i=this.settings.fillStyle;if(this.selected||t.inHover)t.save(),t.beginPath(),t.strokeStyle=i,t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore(),this.drawLable(t,i,this.settings.textColor,e[0].x,e[0].y,this.settings.text);else{t.save(),t.strokeStyle=i,t.lineWidth=1,t.beginPath();for(var a=0;a<=t.canvas.width;a+=20)t.moveTo(a,e[0].y),t.lineTo(a+12,e[0].y);t.stroke(),t.restore()}}},iChart.Charting.ChartOrder.prototype.drawExtended=function(t){var e,i,a;this.selected&&((e=this.getCoordinates(t,this.points)).length<1||(i=iChart.formatNumber(this.points[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),this.layer.chart.renderer.drawLable(t,this.settings.fillStyle,0,this.layer.area.innerWidth,e[0].y,i),void 0!==this.markers&&(e=this.getCoordinates(t,this.markers),i=iChart.formatNumber(this.markers[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),a=t.inHover?void 0!==this.settings.fillStyleHover?this.settings.fillStyleHover:iChart.Charting.ChartOrder.lightColor(this.settings.fillStyle):this.settings.fillStyle,this.layer.chart.renderer.drawLable(t,a,0,this.layer.area.innerWidth,e[0].y,i))))},iChart.Charting.ChartOrder.prototype.drawLable=function(t,e,i,a,r,s){e=e||"#333333",i=i||"#FFFFFF",t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=e,t.lineWidth="2";var n=t.measureText(s).width,a=t.canvas.width-120;t.beginPath(),t.moveTo(a-n-5,r+5),t.lineTo(a-n-5,r-5),t.quadraticCurveTo(a-n-5,r-10,a-n,r-10),t.lineTo(a,r-10),t.quadraticCurveTo(5+a,r-10,5+a,r-5),t.lineTo(5+a,r+5),t.quadraticCurveTo(5+a,r+10,a,r+10),t.lineTo(a-n,r+10),t.quadraticCurveTo(a-n-5,r+10,a-n-5,r+5),t.closePath(),t.save();e=this.layer.chart.chartOptions.shadowColor;this.selected?(t.shadowColor=e,t.shadowBlur=20,t.shadowOffsetX=15,t.shadowOffsetY=15):t.inHover&&(t.shadowColor=e,t.shadowBlur=10,t.shadowOffsetX=5,t.shadowOffsetY=5),t.fill(),t.restore(),this.drawCancelButton(t,a,r-10),t.fillStyle=i,t.fillText(s,a-n,r),t.restore()},iChart.Charting.ChartOrder.prototype.drawCancelButton=function(t,e,i){t.beginPath(),t.moveTo(e,i),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.lineTo(e,i+20),t.stroke(),t.lineTo(e+15,i+20),t.quadraticCurveTo(e+20,i+20,e+20,i+15),t.lineTo(e+20,i+5),t.quadraticCurveTo(e+20,i,e+15,i),t.closePath(),t.fillStyle="#e53935",t.fill(),t.beginPath(),t.moveTo(e+5,i+5),t.lineTo(e+15,i+15),t.moveTo(e+5,i+15),t.lineTo(e+15,i+5),t.stroke(),t.closePath()},iChart.Charting.ChartOrder.prototype.drawTestSegments=function(t){if(void 0!==this.testContext){for(var e in t.save(),t.beginPath(),t.fillStyle="rgba(0,0,0,0.75)",this.testContext.segments){var i=this.testContext.segments[e];t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.stroke()}t.closePath(),t.restore()}},iChart.Charting.ChartOrder.prototype.setTestSegments=function(){var t,e;this.selected?((e=this.layer.context).font="normal 13px Arial,Helvetica,sans-serif",e.textAlign="left",e.textBaseline="middle",t=e.measureText(this.settings.text).width,e=e.canvas.width-120,this.testContext.segments=[[{x:e-t,y:this.testContext.points[0].y-4},{x:e,y:this.testContext.points[0].y-4}],[{x:e,y:this.testContext.points[0].y-4},{x:e,y:this.testContext.points[0].y+4}],[{x:e,y:this.testContext.points[0].y+4},{x:e-t,y:this.testContext.points[0].y+4}],[{x:e-t,y:this.testContext.points[0].y+4},{x:e-t,y:this.testContext.points[0].y-4}],[{x:e-t,y:this.testContext.points[0].y},{x:e,y:this.testContext.points[0].y}],[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]):this.testContext&&(this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]])},iChart.Charting.ChartOrder.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartOrder.prototype.onSelect=function(t){iChart.Charting.ChartElement.prototype.onSelect.call(this,t),this.setTestSegments()},iChart.Charting.ChartOrder.prototype.onBlur=function(){this.setTestSegments()},iChart.Charting.ChartOrder.prototype.onDrop=function(){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this)},iChart.Charting.ChartOrder.prototype.onHover=function(){clearTimeout(this.layer.chart.env.timers.orderClose),this.cancelControl(1)},iChart.Charting.ChartOrder.prototype.onOut=function(){clearTimeout(this.layer.chart.env.timers.orderClose);var t=this;this.layer.chart.env.timers.orderClose=setTimeout(function(){t.cancelControl(0)},300)},iChart.Charting.ChartOrder.prototype.cancelControl=function(t){var e,i;"function"==typeof this.settings.onCancel&&(t?($("#ichartOrderCancelCtrl").hide(),t=(i=this.layer.context).canvas.width-120,i=this.getCoordinates(i,this.points),$("#ichartOrderCancelCtrl").length||$("<span/>",{id:"ichartOrderCancelCtrl",style:"color:transparent",class:"m-chart-instrument-delete",text:"✕",title:_t("2958","Снять")}).hide().appendTo(this.layer.chart.container),e=this,$("#ichartOrderCancelCtrl").unbind("click").bind("click",function(t){"function"==typeof e.settings.onCancel&&e.settings.onCancel.call(e),$("#ichartOrderCancelCtrl").hide()}).bind("mouseover",function(){clearTimeout(e.layer.chart.env.timers.orderClose)}).bind("mouseleave",function(){clearTimeout(e.layer.chart.env.timers.orderClose),e.layer.chart.env.timers.orderClose=setTimeout(function(){e.cancelControl(0)},1e3)}),i=i[0].y-8,t=2+t,$("#ichartOrderCancelCtrl").css({top:i,left:t}).show()):$("#ichartOrderCancelCtrl").hide())},iChart.Charting.ChartOrder.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"},iChart.Charting.ChartOrder.prototype.onMouseDown=function(t){"function"==typeof this.settings.onSelect&&this.settings.onSelect.call(this,t)}}(),function(){"use strict";iChart.Charting.ChartVisualtrade=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Visualtrade",this.drawType="auto",this.hoverCursor=MOBILE_BROWSER_DETECTED?"move":"url('"+this.layer.chart.env.lib_path+"/styles/cursors/red_vertical_cursor.cur'), move",this.moveCursor=MOBILE_BROWSER_DETECTED?"move":"url('"+this.layer.chart.env.lib_path+"/styles/cursors/red_vertical_cursor.cur'), move",this.maxPointCount=5,this.hasSettings=!0,this.controlEnable=!0,this.storageEnable=!1,this.settings={redColor:"#bc353d",greenColor:"#7fcc1a",blueColor:"#4684c6",greyColor:"#999999",offset:40},this.drawSingle=!0},inheritPrototype(iChart.Charting.ChartVisualtrade,iChart.Charting.ChartElement),iChart.Charting.ChartVisualtrade.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t),this.settings.onDrop=function(t){var e;isNaN(parseInt(t))||(0==(t=parseInt(t)-1)?$(jNTChartTrading).trigger("priceExternalUpdate",["price",iChart.roundToPrecision(this.points[0].y,this.layer.chart.env.userSettings.currentSecurity.min_step)]):1==t?"sell_at"==(e=this.getControlValue("order_type"))||"sell"==e?$(jNTChartTrading).trigger("priceExternalUpdate",["tp",iChart.roundToPrecision(this.points[1].y,this.layer.chart.env.userSettings.currentSecurity.min_step)]):$(jNTChartTrading).trigger("priceExternalUpdate",["sl",iChart.roundToPrecision(this.points[1].y,this.layer.chart.env.userSettings.currentSecurity.min_step)]):2==t&&("sell_at"==(e=this.getControlValue("order_type"))||"sell"==e?$(jNTChartTrading).trigger("priceExternalUpdate",["sl",iChart.roundToPrecision(this.points[2].y,this.layer.chart.env.userSettings.currentSecurity.min_step)]):$(jNTChartTrading).trigger("priceExternalUpdate",["tp",iChart.roundToPrecision(this.points[2].y,this.layer.chart.env.userSettings.currentSecurity.min_step)])))},this.priceControl={width:180,height:30},this.elementArea={top:70,bottom:47,left:10,right:10},this.points[0].fActive=1,this.points[1].fActive=0,this.points[2].fActive=0,this.points[0].enable=1,this.points[1].enable=!!this.settings.stoplossEnable,this.points[2].enable=!!this.settings.takeprofitEnable,this.points[1].fHover=0,this.points[2].fHover=0,this.controls={1:{enabled:!1,element:this,x:10,y:10,w:100,h:17,click:function(){this.element.switchControl(this)},type:"order_type",label:_t("4018","Продать"),value:"sell_at",active:!1},2:{enabled:!1,element:this,x:10,y:33,w:100,h:17,click:function(){this.element.switchControl(this)},type:"order_type",label:_t("4875","Продать по рынку"),value:"sell",active:!1},3:{enabled:!1,element:this,x:120,y:10,w:100,h:17,click:function(){this.element.switchControl(this)},type:"order_type",label:_t("4019","Купить"),value:"buy_at",active:!1},4:{enabled:!1,element:this,x:120,y:33,w:100,h:17,click:function(){this.element.switchControl(this)},type:"order_type",label:_t("5452","Купить по рынку"),value:"buy",active:!1},5:{enabled:!1,element:this,x:120,y:-27,w:100,h:17,click:function(){var t=this.element.getControlValue("order_type"),e=iChart.roundToPrecision(this.element.points[0].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step);"buy_at"!=t&&"buy"!=t&&"sell_at"!=t&&"sell"!=t||(Math.min(iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step),iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)),Math.max(iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step),iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)))},type:"action",label:_t("614","Ok"),value:"ok",active:!1},6:{enabled:!1,element:this,x:10,y:-27,w:100,h:17,click:function(){this.element.remove()},type:"action",label:_t("1403","Отмена"),value:"cancel",active:!1},7:{enabled:!0,element:this,click:function(){jNTChartTrading.close(),this.element.layer.chart.env.removeVisualTrade()},type:"close",value:"stoploss"},8:{enabled:!0,element:this,click:function(){jNTChartTrading.close(),this.element.layer.chart.env.removeVisualTrade()},type:"close",value:"takeprofit"},9:{enabled:!0,element:this,active:!0,click:function(){this.element.points[0].fActive=0,jNTChartTrading.close(),this.element.layer.chart.env.removeVisualTrade()},type:"close",value:"price"}};for(var e=0;e<this.settings.controls.length;e++)for(var i in this.controls)this.settings.controls[e].type==this.controls[i].type&&this.settings.controls[e].value==this.controls[i].value&&(this.controls[i].active=!0);this.maps={0:{element:this,click:function(){this.element.points[0].fActive=1,this.element.points[1].fActive=0,this.element.points[2].fActive=0,this.element.setTestSegments(),$(jNTChartTrading).trigger("priceExternalUpdate",["price",iChart.roundToPrecision(this.element.points[0].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)])},hoverIn:function(){this.element.points[0].fHover=1,this.element.layer.render()},hoverOut:function(){this.element.points[0].fHover=0,this.element.layer.render()},type:"sltp",value:"price"},1:{element:this,click:function(){this.element.points[1].fActive=1,this.element.points[0].fActive=0,this.element.points[2].fActive=0,this.element.setTestSegments();var t=this.element.getControlValue("order_type");"sell_at"==t||"sell"==t?$(jNTChartTrading).trigger("priceExternalUpdate",["tp",iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)]):$(jNTChartTrading).trigger("priceExternalUpdate",["sl",iChart.roundToPrecision(this.element.points[1].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)])},hoverIn:function(){this.element.points[1].fHover=1,this.element.layer.render()},hoverOut:function(){this.element.points[1].fHover=0,this.element.layer.render()},type:"sltp",value:"stoploss"},2:{element:this,click:function(){this.element.points[2].fActive=1,this.element.points[0].fActive=0,this.element.points[1].fActive=0,this.element.setTestSegments();var t=this.element.getControlValue("order_type");"sell_at"==t||"sell"==t?$(jNTChartTrading).trigger("priceExternalUpdate",["sl",iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)]):$(jNTChartTrading).trigger("priceExternalUpdate",["tp",iChart.roundToPrecision(this.element.points[2].y,this.element.layer.chart.env.userSettings.currentSecurity.min_step)])},hoverIn:function(){this.element.points[2].fHover=1,this.element.layer.render()},hoverOut:function(){this.element.points[2].fHover=0,this.element.layer.render()},type:"sltp",value:"takeprofit"}}},iChart.Charting.ChartVisualtrade.prototype.drawInternal=function(t,e){if(!(e.length<3)){var i=this.layer.chart.env.viewData.chart.areas[0].getXPositionByIndex(this.layer.chart.env.viewData.chart.areas[0].xSeries.length-1-this.layer.chart.env.viewData.chart.chartOptions.futureAmount)+this.settings.offset,i=Math.min(i,this.layer.chart.env.viewData.chart.areas[0].getXPositionByIndex(this.layer.chart.env.viewData.chart.areas[0].xSeries.length-1)),i=this.layer.chart.env.viewData.chart.areas[0].getXValue(i);this.points[0].x=1e3*i,this.points[1].x=this.points[2].x=this.points[0].x,e[0].x=this.layer.area.getXPositionByValue(i),e[1].x=e[2].x=e[0].x,this.selected&&this.drawArea(t,e),t.fillStyle="rgba(255,255,255,1)";for(var a=e.length-1;0<=a;a--)3<=a||(this.drawPriceBox(t,e,a),this.drawLabel(t,e,a));i=this.getElementAreaPos(e);this.points[3].y=this.layer.area.getYValue(i[0].y).toFixed(2),this.points[4].y=this.layer.area.getYValue(i[1].y).toFixed(2)}},iChart.Charting.ChartVisualtrade.prototype.drawPoints=function(t,e){},iChart.Charting.ChartVisualtrade.prototype.drawTestSegments=function(t){if(void 0!==this.testContext){for(var e in t.save(),t.fillStyle="#000000",this.testContext.controls){var i=this.testContext.controls[e];t.rect(i[0].x,i[0].y,i[1].x-i[0].x,i[1].y-i[0].y),t.stroke()}t.restore()}},iChart.Charting.ChartVisualtrade.prototype.getColorForPoint=function(t){var e="#999999";switch(t){case 0:e=this.settings.blueColor;break;case 1:this.points[t].fActive&&(e="sell"==this.getControlValue("order_type")||"sell_at"==this.getControlValue("order_type")?this.settings.greenColor:this.settings.redColor);break;case 2:this.points[t].fActive&&(e="sell"==this.getControlValue("order_type")||"sell_at"==this.getControlValue("order_type")?this.settings.redColor:this.settings.greenColor);break;default:e="#5a6378"}return e},iChart.Charting.ChartVisualtrade.prototype.drawExtended=function(t){var e,i;if(i=void 0!==this.markers?(e=this.getCoordinates(t,this.markers),this.markers):(e=this.getCoordinates(t,this.points),this.points),!(e.length<1))for(var a,r=0;r<e.length&&r<3;r++)i[r].fActive&&(a=iChart.roundToPrecision(i[r].y,this.layer.chart.env.userSettings.currentSecurity.min_step),this.layer.chart.renderer.drawLable(t,this.getColorForPoint(r),0,this.layer.area.innerWidth,e[r].y,a))},iChart.Charting.ChartVisualtrade.prototype.drawArea=function(t,e){this.getElementAreaPos(e);if(this.selected)for(var i in this.controls){var a=this.controls[i];a.enabled&&this.drawControl(t,e,a)}},iChart.Charting.ChartVisualtrade.prototype.drawControl=function(t,e,i){t.save();var a,r=this.getElementAreaPos(e);"order_type"==i.type||"action"==i.type?(i.active?t.fillStyle="rgba(57,63,79,1)":t.fillStyle="#ffffff",0<=i.y?t.fillRect(r[0].x+i.x,r[0].y+i.y,i.w,i.h):t.fillRect(r[0].x+i.x,r[1].y+i.y,i.w,i.h),i.active?t.fillStyle="#ffffff":t.fillStyle="#428bca",t.font="normal 11px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="top",0<=i.y?t.fillText(i.label,r[0].x+i.x+2,r[0].y+i.y+4):t.fillText(i.label,r[0].x+i.x+2,r[1].y+i.y+4)):"close"==i.type&&("stoploss"==i.value||"takeprofit"==i.value?"sell"==this.getControlValue("order_type")||"sell_at"==this.getControlValue("order_type")?"stoploss"==i.value&&this.points[2].fActive?a=e[2]:"takeprofit"==i.value&&this.points[1].fActive&&(a=e[1]):"buy"!=this.getControlValue("order_type")&&"buy_at"!=this.getControlValue("order_type")||("stoploss"==i.value&&this.points[1].fActive?a=e[1]:"takeprofit"==i.value&&this.points[2].fActive&&(a=e[2])):this.points[0].fActive&&(a=e[0]),a&&(t.fillStyle="#ff9999",t.strokeStyle="#777777",t.beginPath(),t.lineWidth=2,t.moveTo(a.x+this.priceControl.width+10-4,a.y-15-4),t.lineTo(a.x+this.priceControl.width+10+4,a.y-15+4),t.moveTo(a.x+this.priceControl.width+10+4,a.y-15-4),t.lineTo(a.x+this.priceControl.width+10-4,a.y-15+4),t.closePath(),t.stroke())),t.restore()},iChart.Charting.ChartVisualtrade.prototype.drawPriceBox=function(t,e,i){var a="";switch(i){case 0:a=this.settings.blueColor;break;case 1:if(this.points[i].fActive)switch(this.getControlValue("order_type")){case"sell":case"sell_at":a=this.settings.greenColor;break;case"buy":case"buy_at":a=this.settings.redColor}else a=this.settings.greyColor;break;case 2:if(this.points[i].fActive)switch(this.getControlValue("order_type")){case"sell":case"sell_at":a=this.settings.redColor;break;case"buy":case"buy_at":a=this.settings.greenColor}else a=this.settings.greyColor;break;default:a="ffffff"}this.points[i].fActive?(t.save(),t.fillStyle=a,t.beginPath(),t.moveTo(e[i].x-10,e[i].y-10),t.lineTo(e[i].x+this.priceControl.width,e[i].y-10),t.lineTo(e[i].x+this.priceControl.width+8,e[i].y),t.lineTo(e[i].x+this.priceControl.width,e[i].y+10),t.lineTo(e[i].x-10,e[i].y+10),t.lineTo(e[i].x-10,e[i].y-10),t.moveTo(e[i].x+10,e[i].y-10),t.lineTo(e[i].x+10,e[i].y+10),t.closePath(),t.fill(),t.restore(),t.save(),t.strokeStyle="#ffffff",t.beginPath(),t.moveTo(e[i].x-5,e[i].y-3),t.lineTo(e[i].x+5,e[i].y-3),t.moveTo(e[i].x-5,e[i].y),t.lineTo(e[i].x+5,e[i].y),t.moveTo(e[i].x-5,e[i].y+3),t.lineTo(e[i].x+5,e[i].y+3),t.closePath(),t.stroke(),t.strokeStyle=a,t.beginPath(),t.moveTo(e[i].x+this.priceControl.width+8,e[i].y),t.lineTo(t.canvas.width,e[i].y),t.moveTo(0,e[i].y),t.lineTo(e[i].x-10,e[i].y),t.closePath(),t.stroke(),t.restore()):this.points[i].enable&&(t.save(),this.points[i].fHover?t.strokeStyle=this.settings.blueColor:t.strokeStyle="#AAAAAA",t.beginPath(),t.moveTo(e[i].x-10,e[i].y-10),t.lineTo(e[i].x+this.priceControl.width,e[i].y-10),t.lineTo(e[i].x+this.priceControl.width+8,e[i].y),t.lineTo(e[i].x+this.priceControl.width,e[i].y+10),t.lineTo(e[i].x-10,e[i].y+10),t.lineTo(e[i].x-10,e[i].y-10),t.closePath(),t.stroke(),t.restore())},iChart.Charting.ChartVisualtrade.prototype.drawLabel=function(t,e,i){var a="";switch(i){case 0:var r=this.points[0].y;switch(void 0!==this.markers&&(r=this.markers[0].y),this.getControlValue("order_type")){case"sell":a=_t("4875","Продать по рынку");break;case"sell_at":a=_t("4876","Продать по")+iChart.roundToPrecision(r,this.layer.chart.env.userSettings.currentSecurity.min_step);break;case"buy":a=_t("5452","Купить по рынку");break;case"buy_at":a=_t("5458","Купить по")+iChart.roundToPrecision(r,this.layer.chart.env.userSettings.currentSecurity.min_step)}break;case 1:r=this.points[1].y;switch(void 0!==this.markers&&(r=this.markers[1].y),this.getControlValue("order_type")){case"sell":case"sell_at":a=_t("3917","TakeProfit")+" ";var s=100*(this.points[0].y/r-1);break;case"buy":case"buy_at":a=_t("3916","StopLoss")+" ";s=100*(1-this.points[0].y/r)}a+=s.toFixed(2)+"%";break;case 2:r=this.points[2].y;switch(void 0!==this.markers&&(r=this.markers[2].y),this.getControlValue("order_type")){case"sell":case"sell_at":a=_t("3916","StopLoss")+" ";s=100*(1-r/this.points[0].y);break;case"buy":case"buy_at":a=_t("3917","TakeProfit")+" ";s=100*(r/this.points[0].y-1)}a+=s.toFixed(2)+"%"}t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle="#ffffff",this.points[i].fActive?t.fillText(a,e[i].x+15,e[i].y):(this.points[i].fHover?t.fillStyle=this.settings.blueColor:t.fillStyle="#AAAAAA",this.points[i].enable&&t.fillText(a,e[i].x+15,e[i].y)),t.restore()},iChart.Charting.ChartVisualtrade.prototype.setTestSegments=function(){this.testContext.segments=[];var t,e,i,a=this.getElementAreaPos(this.testContext.points);for(t in this.testContext.elementArea=a,this.testContext.controls={},this.controls)this.controls[t].enabled&&("order_type"==this.controls[t].type||"action"==this.controls[t].type?0<=this.controls[t].y?this.testContext.controls[t]=[{x:a[0].x+this.controls[t].x,y:a[0].y+this.controls[t].y},{x:a[0].x+this.controls[t].x+this.controls[t].w,y:a[0].y+this.controls[t].y+this.controls[t].h}]:this.testContext.controls[t]=[{x:a[0].x+this.controls[t].x,y:a[1].y+this.controls[t].y},{x:a[0].x+this.controls[t].x+this.controls[t].w,y:a[1].y+this.controls[t].y+this.controls[t].h}]:"close"==this.controls[t].type&&("stoploss"==(e=this.controls[t]).value||"takeprofit"==e.value?"sell"==this.getControlValue("order_type")||"sell_at"==this.getControlValue("order_type")?"stoploss"==e.value&&this.points[2].fActive?i=this.testContext.points[2]:"takeprofit"==e.value&&this.points[1].fActive&&(i=this.testContext.points[1]):"stoploss"==e.value&&this.points[1].fActive?i=this.testContext.points[1]:"takeprofit"==e.value&&this.points[2].fActive&&(i=this.testContext.points[2]):this.points[0].fActive&&(i=this.testContext.points[0]),i&&(this.testContext.controls[t]=[{x:i.x+this.priceControl.width+2,y:i.y-23},{x:i.x+this.priceControl.width+2+16,y:i.y-23+16}])));this.testContext.maps={},this.points[0].fActive||(this.testContext.maps[0]=[{x:this.testContext.points[0].x+10,y:this.testContext.points[0].y-10},{x:this.testContext.points[0].x+this.priceControl.width+10,y:this.testContext.points[0].y+10}]),!this.points[1].fActive&&this.points[1].enable&&(this.testContext.maps[1]=[{x:this.testContext.points[1].x+10,y:this.testContext.points[1].y-10},{x:this.testContext.points[1].x+this.priceControl.width+10,y:this.testContext.points[1].y+10}]),!this.points[2].fActive&&this.points[2].enable&&(this.testContext.maps[2]=[{x:this.testContext.points[2].x+10,y:this.testContext.points[2].y-10},{x:this.testContext.points[2].x+this.priceControl.width+10,y:this.testContext.points[2].y+10}])},iChart.Charting.ChartVisualtrade.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartVisualtrade.prototype.onDrop=function(t){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this,t)},iChart.Charting.ChartVisualtrade.prototype.getElementAreaPos=function(t){var i=Math.max.apply(Math,t.map(function(t,e){return e<3?t.y:null})),e=Math.min.apply(Math,t.map(function(t,e){return e<3?t.y:i}));return this.selected?[{x:t[0].x-this.elementArea.left,y:e-this.elementArea.top},{x:t[0].x+this.priceControl.width+this.elementArea.right,y:i+this.elementArea.bottom}]:[{x:t[0].x-this.elementArea.left,y:e-this.elementArea.top+30},{x:t[0].x+this.priceControl.width+this.elementArea.right,y:i+this.elementArea.bottom}]},iChart.Charting.ChartVisualtrade.prototype.switchControl=function(t){for(var e in this.controls)t.type==this.controls[e].type&&(this.controls[e].active=!1);t.active=!0,this.layer.render()},iChart.Charting.ChartVisualtrade.prototype.getControl=function(t,e){for(var i in this.controls)if(this.controls[i].type==t&&this.controls[i].value==e)return this.controls[i]},iChart.Charting.ChartVisualtrade.prototype.getControlValue=function(t){for(var e in this.controls)if(this.controls[e].type==t&&this.controls[e].active)return this.controls[e].value},iChart.Charting.ChartVisualtrade.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"}}(),function(){"use strict";iChart.Charting.ChartButton=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Button",this.drawType="auto",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!0,this.storageEnable=!1,this.settings={controls:[]}},inheritPrototype(iChart.Charting.ChartButton,iChart.Charting.ChartElement),iChart.Charting.ChartButton.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t),this.points[0].fActive=1,this.controls={1:{enabled:!0,element:this,x:0,y:0,w:100,h:17,click:function(){console.log(this)},label:_t("6346","Новый приказ"),fillColor:"rgba(220,220,220,1)",strokeStyle:"#999999"}};for(var e=0;e<this.settings.controls.length;e++)for(var i in this.controls)this.settings.controls[e].type==this.controls[i].type&&this.settings.controls[e].value==this.controls[i].value&&(this.controls[i].active=!0);this.maps={0:{element:this,click:function(){this.element.settings.click.call(this)},hoverIn:function(){this.element.points[0].fHover=1,this.element.layer.render()},hoverOut:function(){this.element.points[0].fHover=0,this.element.layer.render()}}}},iChart.Charting.ChartButton.prototype.drawInternal=function(t,e){if(!(e.length<1)){this.settings.fillStyle=this.settings.fillStyle||"#3AAE3E";var i,a=this.layer.chart.areas[0].getXPositionByIndex(this.layer.chart.areas[0].xSeries.length-1-this.layer.chart.chartOptions.futureAmount)+40,a=Math.min(a,this.layer.chart.areas[0].getXPositionByIndex(this.layer.chart.areas[0].xSeries.length-1)),r=this.layer.chart.areas[0].getXValue(a),a=this.layer.chart.areas[0].ySeries[0].points[this.layer.chart.areas[0].ySeries[0].points.length-this.layer.chart.chartOptions.futureAmount-1];for(i in this.points[0].x=1e3*r,this.points[0].y=a[2],e[0].x=this.layer.area.getXPositionByValue(r),this.controls){var s=this.controls[i];s.enabled&&this.drawControl(t,e,s)}}},iChart.Charting.ChartButton.prototype.drawControl=function(t,e,i){t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.points[0].fHover?"rgba(58,174,62,1)":i.fillColor,t.lineWidth="1";var a=t.measureText(i.label).width,e=e[0];t.strokeStyle=i.strokeStyle;t.beginPath(),t.moveTo(e.x,e.y+Math.round(i.h/2)),t.lineTo(e.x,e.y-Math.round(i.h/2)),t.quadraticCurveTo(e.x,e.y-Math.round(i.h/2)-5,e.x+5,e.y-Math.round(i.h/2)-5),t.lineTo(e.x+a+5,e.y-Math.round(i.h/2)-5),t.quadraticCurveTo(e.x+a+10,e.y-Math.round(i.h/2)-5,e.x+a+10,e.y-Math.round(i.h/2)),t.lineTo(e.x+a+10,e.y+Math.round(i.h/2)),t.quadraticCurveTo(e.x+a+10,e.y+Math.round(i.h/2)+5,e.x+a+5,e.y+Math.round(i.h/2)+5),t.lineTo(e.x+5,e.y+Math.round(i.h/2)+5),t.quadraticCurveTo(e.x,e.y+Math.round(i.h/2)+5,e.x,e.y+Math.round(i.h/2)),t.closePath(),t.fill(),t.stroke(),t.fillStyle="#FFFFFF",t.fillText(i.label,e.x+5,e.y),t.restore()},iChart.Charting.ChartButton.prototype.drawPoints=function(t,e){},iChart.Charting.ChartButton.prototype.setTestSegments=function(){var t=this.layer.context;t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle";t=t.measureText(this.controls[1].label).width;this.testContext.segments=[],this.testContext.maps={},this.testContext.maps[0]=[{x:this.testContext.points[0].x,y:this.testContext.points[0].y-Math.round(this.controls[1].h/2)-5},{x:this.testContext.points[0].x+t+10,y:this.testContext.points[0].y+Math.round(this.controls[1].h/2)+5}]},iChart.Charting.ChartButton.prototype.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"}}(),function(){"use strict";iChart.Charting.ChartEvent=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Event",this.drawType="auto",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.id=0,this.settings={color:"red",size:5,shape:"disk",pointFormatter:function(){return""},onHover:function(){},onOut:function(){}}},inheritPrototype(iChart.Charting.ChartEvent,iChart.Charting.ChartElement),iChart.Charting.ChartEvent.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t)},iChart.Charting.ChartEvent.prototype.drawInternal=function(t,e){if(!(e.length<1)){switch(t.save(),t.fillStyle=this.settings.color,t.inHover&&(t.fillStyle="#0000ff",t.stokeStyle="#000"),this.settings.shape){case"circle":this.drawCircle(t,e);break;case"disk":this.drawDisc(t,e);break;case"square":this.drawSquare(t,e);break;case"diamond":this.drawDiamond(t,e);break;case"triangle":this.drawTriangle(t,e);break;default:this.drawDisc(t,e)}t.restore()}},iChart.Charting.ChartEvent.prototype.drawDisc=function(t,e){t.beginPath(),t.arc(e[0].x,e[0].y,this.settings.size,0,2*Math.PI,!0),t.fill(),t.closePath()},iChart.Charting.ChartEvent.prototype.drawCircle=function(t,e){t.beginPath(),t.lineWidth=.5*this.settings.size,t.arc(e[0].x,e[0].y,this.settings.size,0,2*Math.PI,!0),t.closePath(),t.inHover||(t.strokeStyle=this.settings.color),t.stroke()},iChart.Charting.ChartEvent.prototype.drawSquare=function(t,e){t.beginPath();var i=this.settings.size;t.moveTo(e[0].x-i,e[0].y-i),t.lineTo(e[0].x-i,e[0].y+i),t.lineTo(e[0].x+i,e[0].y+i),t.lineTo(e[0].x+i,e[0].y-i),t.lineTo(e[0].x-i,e[0].y-i),t.fill(),t.closePath()},iChart.Charting.ChartEvent.prototype.drawDiamond=function(t,e){t.beginPath();var i=this.settings.size;t.moveTo(e[0].x,e[0].y-i),t.lineTo(e[0].x-2*i/3,e[0].y),t.lineTo(e[0].x,e[0].y+i),t.lineTo(e[0].x+2*i/3,e[0].y),t.lineTo(e[0].x,e[0].y-i),t.fill(),t.closePath()},iChart.Charting.ChartEvent.prototype.drawTriangle=function(t,e){t.beginPath();var i=2*this.settings.size*Math.sin(Math.PI/3)/2;t.moveTo(e[0].x,e[0].y-i),t.lineTo(e[0].x-i,e[0].y+this.settings.size),t.lineTo(e[0].x+i,e[0].y+this.settings.size),t.lineTo(e[0].x,e[0].y-i),t.fill(),t.closePath()},iChart.Charting.ChartEvent.prototype.onHover=function(t){var e=this.getCoordinates(t,this.points),t=e[0].y+$(this.layer.chart.container).offset().top,e=e[0].x+$(this.layer.chart.container).offset().left;this.drawTooltip(this.settings,t,e),"function"==typeof this.settings.onHover&&this.settings.onHover.call(this)},iChart.Charting.ChartEvent.prototype.onOut=function(t){$("[chart-element-tooltip]").hide(),"function"==typeof this.settings.onOut&&this.settings.onOut.call(this)},iChart.Charting.ChartEvent.prototype.drawTooltip=function(t,e,i){0==this.layer.chart.env.wrapper.find("[chart-element-tooltip]").length&&$("body").append('<div chart-element-tooltip class="qtip qtip-default qtip-tipsy qtip-pos-rc" tracking="false" role="alert" aria-live="polite" aria-atomic="false" style="z-index: 15002;"><div class="qtip-tip" style="background-color: transparent ! important; border: 0px none ! important; height: 6px; width: 6px; line-height: 6px; top: 50%; margin-top: -3px; right: -6px;"><canvas style="background-color: transparent ! important; border: 0px none ! important;" height="6" width="6"></canvas></div><div class="qtip-content" id="qtip-34-content" aria-atomic="true"></div></div></div>');var a=this.settings.pointFormatter.call(this.settings);a&&($("[chart-element-tooltip] .qtip-content").html(a),$("[chart-element-tooltip]").css({top:e-$("[chart-element-tooltip]").height()+"px",left:i+12+"px"}).show())},iChart.Charting.ChartEvent.prototype.setTestSegments=function(){this.testContext.segments=[[this.testContext.points[0],{x:this.testContext.points[0].x,y:this.testContext.points[0].y}]]}}(),function(){"use strict";iChart.Charting.ChartLevel=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Level",this.drawType="auto",this.hoverCursor=MOBILE_BROWSER_DETECTED?"move":"url('"+this.layer.chart.env.lib_path+"/styles/cursors/red_vertical_cursor.cur'), move",this.moveCursor=MOBILE_BROWSER_DETECTED?"move":"url('"+this.layer.chart.env.lib_path+"/styles/cursors/red_vertical_cursor.cur'), move",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!0,this.storageEnable=!1,this.settings={text:"",color:"#ED1ACE",textColor:"red",inactiveHoverColor:"#4684c6",inactiveColor:"#AAAAAA",offset:40,width:150,height:30},this.drawSingle=!0},inheritPrototype(iChart.Charting.ChartLevel,iChart.Charting.ChartElement),iChart.Charting.ChartLevel.prototype.setSettings=function(t){this.points[0].fActive=1,this.points[0].fHover=0,this.settings.onDrop=function(t){isNaN(parseInt(t))||(parseInt(t),t={event:"drop",element:this,value:this.points[0].y},this.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t]))},this.controls={0:{active:!0,enabled:!1,element:this,click:function(){var t={event:"close",element:this,value:this.points[0].y};this.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t]),this.element.setTestSegments(),this.element.layer.render()},type:"close",value:"element"}},this.maps={0:{element:this,click:function(){this.element.points[0].fActive=1,this.element.setTestSegments();var t={event:"click",element:this.element,value:this.element.points[0].y};this.element.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t])},hoverIn:function(){this.element.points[0].fHover=1,this.element.layer.render();var t={event:"hoverIn",element:this.element,value:this.element.points[0].y};this.element.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t])},hoverOut:function(){this.element.points[0].fHover=0,this.element.layer.render();var t={event:"hoverOut",element:this.element,value:this.element.points[0].y};this.element.layer.chart.env.wrapper.trigger("iguanaChartEvents",["instrument",t])},type:"element",value:"element"}},this.settings=$.extend(this.settings,t)},iChart.Charting.ChartLevel.prototype.drawInternal=function(t,e){if(!(e.length<1)){var i=this.layer.chart.env.viewData.chart.areas[0].getXPositionByIndex(this.layer.chart.env.viewData.chart.areas[0].xSeries.length-1-this.layer.chart.env.viewData.chart.chartOptions.futureAmount)+this.settings.offset,i=Math.min(i,this.layer.chart.env.viewData.chart.areas[0].getXPositionByIndex(this.layer.chart.env.viewData.chart.areas[0].xSeries.length-1)),i=this.layer.chart.env.viewData.chart.areas[0].getXValue(i);for(r in this.points[0].x=1e3*i,e[0].x=this.layer.area.getXPositionByValue(i),this.controls){var a=this.controls[r];a.enabled&&this.drawControl(t,e,a)}t.fillStyle="rgba(255,255,255,1)";for(var r=e.length-1;0<=r;r--)3<=r||(this.drawPriceBox(t,e,r),this.drawLabel(t,e,r))}},iChart.Charting.ChartLevel.prototype.drawPoints=function(t,e){},iChart.Charting.ChartLevel.prototype.drawExtended=function(t){var e,i;if(i=void 0!==this.markers?(e=this.getCoordinates(t,this.markers),this.markers):(e=this.getCoordinates(t,this.points),this.points),!(e.length<1))for(var a,r=0;r<e.length&&r<3;r++)i[r].fActive&&(a=iChart.roundToPrecision(i[r].y,this.layer.chart.env.userSettings.currentSecurity.min_step),this.layer.chart.renderer.drawLable(t,this.settings.color,this.settings.textColor,this.layer.area.innerWidth,e[r].y,a))},iChart.Charting.ChartLevel.prototype.drawControl=function(t,e,i){t.save(),"close"!=i.type||(e=e[0])&&(t.fillStyle="#ff9999",t.strokeStyle="#777777",t.beginPath(),t.lineWidth=2,t.moveTo(e.x+this.settings.width+10-4,e.y-15-4),t.lineTo(e.x+this.settings.width+10+4,e.y-15+4),t.moveTo(e.x+this.settings.width+10+4,e.y-15-4),t.lineTo(e.x+this.settings.width+10-4,e.y-15+4),t.closePath(),t.stroke()),t.restore()},iChart.Charting.ChartLevel.prototype.drawPriceBox=function(t,e,i){var a=this.settings.color;this.points[i].fActive?(t.save(),t.fillStyle=a,t.beginPath(),t.moveTo(e[i].x-10,e[i].y-10),t.lineTo(e[i].x+this.settings.width,e[i].y-10),t.lineTo(e[i].x+this.settings.width+8,e[i].y),t.lineTo(e[i].x+this.settings.width,e[i].y+10),t.lineTo(e[i].x-10,e[i].y+10),t.lineTo(e[i].x-10,e[i].y-10),t.moveTo(e[i].x+10,e[i].y-10),t.lineTo(e[i].x+10,e[i].y+10),t.closePath(),t.fill(),t.restore(),t.save(),t.strokeStyle=this.settings.textColor,t.beginPath(),t.moveTo(e[i].x-5,e[i].y-3),t.lineTo(e[i].x+5,e[i].y-3),t.moveTo(e[i].x-5,e[i].y),t.lineTo(e[i].x+5,e[i].y),t.moveTo(e[i].x-5,e[i].y+3),t.lineTo(e[i].x+5,e[i].y+3),t.closePath(),t.stroke(),t.strokeStyle=a,t.beginPath(),t.moveTo(e[i].x+this.settings.width+8,e[i].y),t.lineTo(t.canvas.width,e[i].y),t.moveTo(0,e[i].y),t.lineTo(e[i].x-10,e[i].y)):(t.save(),this.points[i].fHover?t.strokeStyle=this.settings.inactiveHoverColor:t.strokeStyle=this.settings.inactiveColor,t.beginPath(),t.moveTo(e[i].x-10,e[i].y-10),t.lineTo(e[i].x+this.settings.width,e[i].y-10),t.lineTo(e[i].x+this.settings.width+8,e[i].y),t.lineTo(e[i].x+this.settings.width,e[i].y+10),t.lineTo(e[i].x-10,e[i].y+10),t.lineTo(e[i].x-10,e[i].y-10)),t.closePath(),t.stroke(),t.restore()},iChart.Charting.ChartLevel.prototype.drawLabel=function(t,e,i){var a;this.points[0].y;void 0!==this.markers&&this.markers[0].y,a=this.settings.text,t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.settings.textColor,this.points[i].fActive||(this.points[i].fHover?t.fillStyle=this.settings.inactiveHoverColor:t.fillStyle=this.settings.inactiveColor),t.fillText(a,e[i].x+15,e[i].y),t.restore()},iChart.Charting.ChartLevel.prototype.setTestSegments=function(){for(var t in this.testContext.segments=[],this.testContext.controls={},this.controls){var e=this.testContext.points[t];e&&(this.testContext.controls[t]=[{x:e.x+this.settings.width+2,y:e.y-23},{x:e.x+this.settings.width+2+16,y:e.y-23+16}])}this.testContext.maps={},this.testContext.maps[0]=[{x:this.testContext.points[0].x+10,y:this.testContext.points[0].y-10},{x:this.testContext.points[0].x+this.settings.width+10,y:this.testContext.points[0].y+10}]},iChart.Charting.ChartLevel.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartLevel.prototype.onDrop=function(t){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this,t)},iChart.Charting.ChartLevel.prototype.setValue=function(t){this.points[0].y=t,this.layer.render()},iChart.Charting.ChartLevel.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"}}(),function(){"use strict";iChart.Charting.ChartRange=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Range",this.drawType="auto",this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartRange,iChart.Charting.ChartElement),iChart.Charting.ChartRange.prototype.drawInternal=function(t,e){e.length<2||(t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),e[1].x,e[0].x,e[1].y,e[0].y,t.beginPath(),t.moveTo(e[0].x,0),t.lineTo(e[0].x,t.canvas.height),t.stroke(),t.beginPath(),t.lineTo(e[1].x,0),t.lineTo(e[1].x,t.canvas.height),t.stroke(),t.beginPath(),t.moveTo(e[0].x,0),t.lineTo(e[0].x,t.canvas.height),t.lineTo(e[1].x,t.canvas.height),t.lineTo(e[1].x,0),t.fill(),t.restore())},iChart.Charting.ChartRange.prototype.setTestSegments=function(){this.layer.context;var t=this.testContext.points[0].x,e=this.testContext.points[1].x;this.testContext.segments=[];for(var i=t;i<=e;i+=16)this.testContext.segments.push([{x:i,y:0},{x:i,y:1e11}]);this.testContext.segments.push([{x:e,y:0},{x:e,y:1e11}])}}(),function(){"use strict";iChart.Charting.ChartPosition=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Position",this.drawType="auto",this.hoverCursor="default",this.moveCursor="default",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.storageEnable=!1,this.settings={},this.positionAbsolute=!0},inheritPrototype(iChart.Charting.ChartPosition,iChart.Charting.ChartElement),iChart.Charting.ChartPosition.prototype.drawInternal=function(t,e){if(!(e.length<1)){this.settings.fillStyle=this.settings.fillStyle||"#3AAE3E";var i=this.layer.chart.areas[0].xSeries[this.layer.chart.areas[0].xSeries.length-this.layer.chart.chartOptions.futureAmount-1];this.points[0].x=1e3*i,e[0].x=this.layer.area.getXPositionByValue(i);var a=this.settings.fillStyle,r=this.getCoordinates(t,[{x:this.settings.time,y:0}]),i=0;if(r.length&&(i=r[0].x),this.selected||t.inHover)t.save(),t.beginPath(),t.strokeStyle=a,t.lineWidth=1,t.moveTo(i,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore(),this.drawLable(t,a,this.settings.textColor,e[0].x,e[0].y,this.settings);else{t.save(),t.strokeStyle=a,t.lineWidth=1,t.beginPath();for(var s=0;s<=t.canvas.width;s+=20)t.moveTo(s,e[0].y),t.lineTo(s+12,e[0].y);t.stroke(),t.restore()}}},iChart.Charting.ChartPosition.prototype.drawExtended=function(t){var e,i,a;this.selected&&((e=this.getCoordinates(t,this.points)).length<1||(i=iChart.formatNumber(this.points[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),this.layer.chart.renderer.drawLable(t,this.settings.fillStyle,0,this.layer.area.innerWidth,e[0].y,i),void 0!==this.markers&&(e=this.getCoordinates(t,this.markers),i=iChart.formatNumber(this.markers[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),a=t.inHover?void 0!==this.settings.fillStyleHover?this.settings.fillStyleHover:iChart.Charting.ChartPosition.lightColor(this.settings.fillStyle):this.settings.fillStyle,this.layer.chart.renderer.drawLable(t,a,0,this.layer.area.innerWidth,e[0].y,i))))},iChart.Charting.ChartPosition.prototype.drawTrades=function(e,i,t){var a=[];$.each(t.trades,function(t,e){a.push({x:e.x,y:e.y})}),this.getCoordinates(e,a).forEach(function(t){t.x>i||(e.save(),e.beginPath(),e.arc(t.x,t.y,5,0,2*Math.PI,!0),e.fillStyle="#607d8b",e.fill(),e.arc(t.x,t.y,2,0,2*Math.PI,!0),e.fillStyle="#ffffff",e.fill(),e.closePath(),e.restore())})},iChart.Charting.ChartPosition.prototype.drawLable=function(t,e,i,a,r,s){e=e||"#333333",i=i||"#FFFFFF",t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=e,t.lineWidth="1";var n=t.measureText(s.positionText+s.profitText).width;a=t.canvas.width-120;e=t.canvas.width-120-n;t.beginPath(),t.moveTo(a-n-5,r+5),t.lineTo(a-n-5,r-5),t.quadraticCurveTo(a-n-5,r-10,a-n,r-10),t.lineTo(a,r-10),t.quadraticCurveTo(5+a,r-10,5+a,r-5),t.lineTo(5+a,r+5),t.quadraticCurveTo(5+a,r+10,a,r+10),t.lineTo(a-n,r+10),t.quadraticCurveTo(a-n-5,r+10,a-n-5,r+5),t.closePath(),t.fill(),s.profitText&&(t.fillStyle=i,t.fillText(s.positionText,a-n,r),n=t.measureText(s.profitText).width,t.fillStyle=s.profitColor,t.beginPath(),t.moveTo(a-n,r+5),t.lineTo(a-n,r-5),t.lineTo(a-n,r-10),t.lineTo(a,r-10),t.quadraticCurveTo(5+a,r-10,5+a,r-5),t.lineTo(5+a,r+5),t.quadraticCurveTo(5+a,r+10,a,r+10),t.lineTo(a-n,r+10),t.lineTo(a-n,r+10),t.closePath(),t.fill(),this.drawCancelButton(t,a,r-10),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=i,t.fillText(s.profitText,a-n,r)),t.restore(),this.drawTrades(t,e,this.settings)},iChart.Charting.ChartPosition.prototype.drawCancelButton=function(t,e,i){t.beginPath(),t.moveTo(e,i),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.lineTo(e,i+20),t.stroke(),t.lineTo(e+15,i+20),t.quadraticCurveTo(e+20,i+20,e+20,i+15),t.lineTo(e+20,i+5),t.quadraticCurveTo(e+20,i,e+15,i),t.closePath(),t.fillStyle="#e53935",t.fill(),t.beginPath(),t.moveTo(e+5,i+5),t.lineTo(e+15,i+15),t.moveTo(e+5,i+15),t.lineTo(e+15,i+5),t.stroke(),t.closePath(),t.restore()},iChart.Charting.ChartPosition.prototype.drawPoints=function(t,e){},iChart.Charting.ChartPosition.prototype.drawTestSegments=function(t){if(void 0!==this.testContext){for(var e in t.save(),t.beginPath(),t.fillStyle="rgba(0,0,0,0.75)",this.testContext.segments){var i=this.testContext.segments[e];t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.stroke()}t.closePath(),t.restore()}},iChart.Charting.ChartPosition.prototype.setTestSegments=function(){var t,e;this.selected?((e=this.layer.context).font="normal 13px Arial,Helvetica,sans-serif",e.textAlign="left",e.textBaseline="middle",t=e.measureText(this.settings.text).width,e=e.canvas.width-120,this.testContext.segments=[[{x:e-t,y:this.testContext.points[0].y-4},{x:e,y:this.testContext.points[0].y-4}],[{x:e,y:this.testContext.points[0].y-4},{x:e,y:this.testContext.points[0].y+4}],[{x:e,y:this.testContext.points[0].y+4},{x:e-t,y:this.testContext.points[0].y+4}],[{x:e-t,y:this.testContext.points[0].y+4},{x:e-t,y:this.testContext.points[0].y-4}],[{x:e-t,y:this.testContext.points[0].y},{x:e,y:this.testContext.points[0].y}],[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]):this.testContext&&(this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]])},iChart.Charting.ChartPosition.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartPosition.prototype.onSelect=function(t){iChart.Charting.ChartElement.prototype.onSelect.call(this,t),this.setTestSegments()},iChart.Charting.ChartPosition.prototype.onBlur=function(){this.setTestSegments()},iChart.Charting.ChartPosition.prototype.onDrop=function(){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this)},iChart.Charting.ChartPosition.prototype.onHover=function(){clearTimeout(this.layer.chart.env.timers.positionClose),this.cancelControl(1)},iChart.Charting.ChartPosition.prototype.onOut=function(){clearTimeout(this.layer.chart.env.timers.positionClose);var t=this;this.layer.chart.env.timers.orderClose=setTimeout(function(){t.cancelControl(0)},300)},iChart.Charting.ChartPosition.prototype.cancelControl=function(t){var e,i;"function"==typeof this.settings.onCancel&&(t?($("#ichartPositionCancelCtrl").hide(),t=(i=this.layer.context).canvas.width-120,i=this.getCoordinates(i,this.points),$("#ichartPositionCancelCtrl").length||$("<span/>",{id:"ichartPositionCancelCtrl",style:"color:transparent",class:"m-chart-instrument-delete",text:"✕",title:_t("15807","Закрыть позицию по рынку")}).hide().appendTo(this.layer.chart.container),e=this,$("#ichartPositionCancelCtrl").unbind("click").bind("click",function(t){"function"==typeof e.settings.onCancel&&e.settings.onCancel.call(e),$("#ichartOrderCancelCtrl").hide()}).bind("mouseover",function(){clearTimeout(e.layer.chart.env.timers.positionClose)}).bind("mouseleave",function(){clearTimeout(e.layer.chart.env.timers.positionClose),e.layer.chart.env.timers.positionClose=setTimeout(function(){e.cancelControl(0)},1e3)}),i=i[0].y-8,t=2+t,$("#ichartPositionCancelCtrl").css({top:i,left:t}).show()):$("#ichartPositionCancelCtrl").hide())},iChart.Charting.ChartPosition.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"}}(),function(){"use strict";iChart.Charting.ChartTradePanel=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="TradePanel",this.drawType="auto",this.hoverCursor=this.selected?"row-resize":"pointer",this.moveCursor=this.selected?"row-resize":"pointer",this.maxPointCount=1,this.hasSettings=!0,this.controlEnable=!1,this.storageEnable=!1,this.settings={},this.positionAbsolute=!0},inheritPrototype(iChart.Charting.ChartTradePanel,iChart.Charting.ChartElement),iChart.Charting.ChartTradePanel.prototype.drawInternal=function(t,e){var i;e.length<1||(this.hoverCursor=this.selected?"row-resize":"pointer",this.moveCursor=this.selected?"row-resize":"pointer",this.settings.autoInit&&(this.selected=!0,(this.layer.selected=this).settings.autoInit=!1),this.layer.history.sort(function(t,e){return t&&"TradePanel"==t.elementType&&t.selected?1:-1}),(this.selected&&!this.layer.selected||this.selected&&this.id!=this.layer.selected.id)&&(this.selected=!1),e[0].x=this.layer.area.getXPositionByValue(void 0),i=(this.markers||this.points)[0].y,"limit"==this.settings.type?this.settings.fillStyle=jNTChartTrading.order.operation_type<3?"#7cb342":"#e53935":"sl"==this.settings.type?this.settings.fillStyle="#e53935":"tp"==this.settings.type&&(this.settings.fillStyle="#7cb342"),this.settings.fillStyle=this.selected?this.settings.fillStyle:"rgba(238, 238, 238, 0.3)",this.settings.fillStyle=!this.selected&&t.inHover?"rgba(238, 238, 238, 1)":this.settings.fillStyle,this.settings.textColor=this.selected?"#FFFFFF":this.layer.chart.chartOptions.labelColor,this.settings.text=jNTChartTrading.order.operation_type<3?this.settings.buyText:this.settings.sellText,this.settings.price=_s(i,_d(this.settings.min_step)),this.settings.quantity=_s(this.settings.quantity),i=(0<(i=100*(this.settings.price/this.settings.ltp-1))?"+":"")+_s(i,2)+"%",this.settings.text=this.settings.text.replace("%quantity%",this.settings.quantity.trim()),this.settings.text=this.settings.text.replace("%price%",this.settings.price.trim()),this.settings.text=this.settings.text.replace("%percent%",i),this.settings.sendingOrder&&(this.settings.text=_t("15808","Выставляем новый приказ ..."),this.settings.fillStyle="rgba(119,119,119,1)",this.settings.textColor="#ffffff"),i=this.layer.chart.areas[0].xSeries[this.layer.chart.areas[0].xSeries.length-this.layer.chart.chartOptions.futureAmount-1],this.points[0].x=1e3*i,e[0].x=this.layer.area.getXPositionByValue(i)+50,i=this.settings.fillStyle,(this.selected||t.inHover)&&(t.save(),t.beginPath(),t.strokeStyle=i,t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore()),this.drawLable(t,i,this.settings.textColor,e[0].x,e[0].y,this.settings.text))},iChart.Charting.ChartTradePanel.prototype.drawExtended=function(t){var e,i,a;this.selected&&((e=this.getCoordinates(t,this.points)).length<1||(i=iChart.formatNumber(this.points[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),this.layer.chart.renderer.drawLable(t,this.settings.fillStyle,0,this.layer.area.innerWidth,e[0].y,i),void 0!==this.markers&&(e=this.getCoordinates(t,this.markers),i=iChart.formatNumber(this.markers[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),a=t.inHover?void 0!==this.settings.fillStyleHover?this.settings.fillStyleHover:iChart.Charting.ChartTradePanel.lightColor(this.settings.fillStyle):this.settings.fillStyle,this.layer.chart.renderer.drawLable(t,a,0,this.layer.area.innerWidth,e[0].y,i))))},iChart.Charting.ChartTradePanel.prototype.drawLable=function(t,e,i,a,r,s){t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=this.settings.fillStyle,t.strokeStyle="#eeeeee",t.lineWidth="1";var n=t.measureText(s).width;a+=n,t.beginPath(),t.moveTo(a-n-5,r+5),t.lineTo(a-n-5,r-5),t.quadraticCurveTo(a-n-5,r-10,a-n,r-10),t.lineTo(a,r-10),t.lineTo(a+8,r),t.lineTo(a,r+10),t.lineTo(a-n,r+10),t.quadraticCurveTo(a-n-5,r+10,a-n-5,r+5),t.closePath(),t.save();var o=this.layer.chart.chartOptions.shadowColor;this.selected?(t.shadowColor=o,t.shadowBlur=10,t.shadowOffsetX=5,t.shadowOffsetY=5,t.fill(),t.lineWidth="3",t.strokeStyle=t.fillStyle,t.beginPath(),t.moveTo(a+10,r-10),t.lineTo(a+18,r),t.lineTo(a+10,r+10),t.moveTo(a+10,r-10),t.closePath(),t.stroke()):t.inHover?(t.shadowColor=o,t.shadowBlur=5,t.shadowOffsetX=2,t.shadowOffsetY=2,t.fill()):t.stroke(),t.restore(),t.fillStyle=this.settings.textColor,t.fillText(s,a-n,r),t.restore()},iChart.Charting.ChartTradePanel.prototype.drawPoints=function(t,e){},iChart.Charting.ChartTradePanel.prototype.drawTestSegments=function(t){if(void 0!==this.testContext){for(var e in t.save(),t.beginPath(),t.fillStyle="rgba(0,0,0,0.75)",this.testContext.segments){var i=this.testContext.segments[e];t.moveTo(i[0].x,i[0].y),t.lineTo(i[1].x,i[1].y),t.stroke()}t.closePath(),t.restore()}},iChart.Charting.ChartTradePanel.prototype.setTestSegments=function(){var t,e;this.testContext&&((e=this.layer.context).font="normal 13px Arial,Helvetica,sans-serif",e.textAlign="left",e.textBaseline="middle",t=e.measureText(this.settings.text).width,e=this.layer.area.getXPositionByValue(this.points[0].x/1e3)+t+50,this.testContext.segments=[[{x:e-t,y:this.testContext.points[0].y-4},{x:e,y:this.testContext.points[0].y-4}],[{x:e,y:this.testContext.points[0].y+4},{x:e-t,y:this.testContext.points[0].y+4}]])},iChart.Charting.ChartTradePanel.prototype.onDrag=function(t){"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t),"function"==typeof this.settings.onDrag&&this.settings.onDrag.call(this,t)},iChart.Charting.ChartTradePanel.prototype.onSelect=function(t){iChart.Charting.ChartElement.prototype.onSelect.call(this,t)},iChart.Charting.ChartTradePanel.prototype.onBlur=function(){},iChart.Charting.ChartTradePanel.prototype.onDrop=function(){"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this)},iChart.Charting.ChartTradePanel.lightColor=function(t){t=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split(/,\s*/);for(var e=0;e<3;e++)t[e]=parseInt(t[e])+40;return"rgba("+t.join(", ")+")"},iChart.Charting.ChartTradePanel.prototype.onMouseDown=function(t){"function"==typeof this.settings.onSelect&&this.settings.onSelect.call(this,t)}}(),function(){"use strict";iChart.Charting.ChartTrendorder=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="Trendorder",this.drawType="auto",this.hoverCursor="row-resize",this.moveCursor="row-resize",this.hoverPointCursor="move",this.movePointCursor="move",this.maxPointCount=2,this.hasSettings=!0,this.controlEnable=!0,this.storageEnable=!1,this.drawSingle=!0,this.freezed=!0,this.settings={text:"",textHeight:13,fillStyle:"#f44336",textColor:"#FFFFFF",mode:"line"},this.positionAbsolute=!0},inheritPrototype(iChart.Charting.ChartTrendorder,iChart.Charting.ChartElement),iChart.Charting.ChartTrendorder.prototype.setSettings=function(t){this.settings=$.extend(this.settings,t),void 0===t.price2?(this.points[0]={x:t.date,y:t.price},this.points[1]={x:t.date,y:t.price}):(this.points[0]={x:t.date,y:t.price},this.points[1]={x:t.date2,y:t.price2},t=this.getFloatCoords(),this.trendLineSettings={points:this.getBorderPoints(t)})},iChart.Charting.ChartTrendorder.prototype.calcPointsPosition=function(t,e){e=e||150;var i,a,r,s=this.getCoordinates(this.layer.context,this.points),n=this.getBorderPoints(s),n=(n[0].x+n[1].x)/2;t<n?(this.points[0].x=1e3*this.layer.area.getXValue(t),r=iChart.getLineEquation(this.trendLineSettings.points[0],this.trendLineSettings.points[1],t),this.points[0].y=this.layer.area.getYValue(r.y),r=iChart.getLineEquation(this.trendLineSettings.points[0],this.trendLineSettings.points[1],n),this.points[1].x=1e3*this.layer.area.getXValue(n),this.points[1].y=this.layer.area.getYValue(r.y),s=this.getCoordinates(this.layer.context,this.points),Math.sqrt(Math.pow(s[0].x-s[1].x,2)+Math.pow(s[0].y-s[1].y,2))<e&&(i=Math.atan((s[0].y-s[1].y)/(s[0].x-s[1].x)),a=s[0].x+(e+5)*Math.cos(i),r=iChart.getLineEquation(this.trendLineSettings.points[0],this.trendLineSettings.points[1],a),this.points[1].x=1e3*this.layer.area.getXValue(a),this.points[1].y=this.layer.area.getYValue(r.y))):(this.points[1].x=1e3*this.layer.area.getXValue(t),r=iChart.getLineEquation(this.trendLineSettings.points[0],this.trendLineSettings.points[1],t),this.points[1].y=this.layer.area.getYValue(r.y),r=iChart.getLineEquation(this.trendLineSettings.points[0],this.trendLineSettings.points[1],n),this.points[0].x=1e3*this.layer.area.getXValue(n),this.points[0].y=this.layer.area.getYValue(r.y),s=this.getCoordinates(this.layer.context,this.points),Math.sqrt(Math.pow(s[0].x-s[1].x,2)+Math.pow(s[0].y-s[1].y,2))<e&&(i=Math.atan((s[0].y-s[1].y)/(s[0].x-s[1].x)),a=s[1].x-(e+5)*Math.cos(i),r=iChart.getLineEquation(this.trendLineSettings.points[0],this.trendLineSettings.points[1],a),this.points[0].x=1e3*this.layer.area.getXValue(a),this.points[0].y=this.layer.area.getYValue(r.y)))},iChart.Charting.ChartTrendorder.prototype.getFloatCoords=function(t){t=void 0!==t?t:this.points;var e=[{x:0,y:0},{x:0,y:0}];return e[0].x=this.layer.area.getXPositionByValue(t[0].x/1e3),e[0].y=this.layer.area.getYPosition(t[0].y),e[1].x=this.layer.area.getXPositionByValue(t[1].x/1e3),e[1].y=this.layer.area.getYPosition(t[1].y),e},iChart.Charting.ChartTrendorder.prototype.normalizeCoords=function(t,e){return this.moveForward(),this.getCoordinates(t,this.points)},iChart.Charting.ChartTrendorder.prototype.lineNormalizeCoords=function(t,e){e[1].x=t.canvas.width-80,this.points[1].x=1e3*this.layer.area.getXValue(e[1].x),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle";var i=t.measureText(this.settings.text).width;e[0].x=t.canvas.width-80-i-80,this.points[0].x=1e3*this.layer.area.getXValue(e[0].x)},iChart.Charting.ChartTrendorder.prototype.drawLineMode=function(t,e){this.settings.fillStyle=this.settings.fillStyle||"#3AAE3E";var i=this.settings.fillStyle;if(this.selected||t.inHover)t.save(),t.beginPath(),t.strokeStyle=i,t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.restore(),this.drawLable(t,i,this.settings.textColor,e[0].x,e[0].y,this.settings.text),this.selected&&(this.drawPoint(t,e[0].x,e[0].y,i,4),this.drawPoint(t,e[1].x,e[1].y,i,4));else{t.save(),t.strokeStyle=i,t.lineWidth=1,t.beginPath();for(var a=0;a<=t.canvas.width;a+=20)t.moveTo(a,e[0].y),t.lineTo(a+12,e[0].y);t.stroke(),t.restore()}},iChart.Charting.ChartTrendorder.prototype.getOpenOrderData=function(){var t=this.layer.chart.areas[0].xSeries[this.layer.chart.areas[0].xSeries.length-this.layer.chart.chartOptions.futureAmount-1];return{time:t,x:this.layer.area.getXPositionByValue(t)}},iChart.Charting.ChartTrendorder.prototype.getExpireOrderData=function(){var t=this.getOpenOrderData(),t=new Date(1e3*(t.time+60*this.layer.chart.env.dataSource.dataSettings.timeframe));return{time:t,x:this.layer.area.getXPositionByValue(t/1e3)}},iChart.Charting.ChartTrendorder.prototype.getOpenCoords=function(t){var e=this.getOpenOrderData();return iChart.getLineEquation(t[0],t[1],e.x)},iChart.Charting.ChartTrendorder.prototype.getExpireCoords=function(t){var e=this.getExpireOrderData();return iChart.getLineEquation(t[0],t[1],e.x)},iChart.Charting.ChartTrendorder.prototype.getOrderParams=function(t){var e=this.getOpenCoords(t),t=this.getExpireCoords(t);return{points:[{x:1e3*this.layer.area.getXValue(e.x),y:this.layer.area.getYValue(e.y)},{x:1e3*this.layer.area.getXValue(t.x),y:this.layer.area.getYValue(t.y)}]}},iChart.Charting.ChartTrendorder.prototype.getBorderPoints=function(t){var e,i;return t[0].y<0||t[0].y>this.layer.canvas.height||t[0].x<0||t[0].x>this.layer.canvas.width?(e=iChart.getLineEquation(t[0],t[1],0),i=iChart.getLineEquation(t[0],t[1],this.layer.canvas.width)):((e=iChart.getLineEquation(t[0],t[1],0)).y<0?(e.y=0,e.x=(e.y-e.b)/e.k):e.y>this.layer.canvas.height&&(e.y=this.layer.canvas.height,e.x=(e.y-e.b)/e.k),(i=iChart.getLineEquation(t[0],t[1],this.layer.canvas.width)).y<0?(i.y=0,i.x=(i.y-i.b)/i.k):i.y>this.layer.canvas.height&&(i.y=this.layer.canvas.height,i.x=(i.y-i.b)/i.k)),[e,i]},iChart.Charting.ChartTrendorder.prototype.drawTrendMode=function(t,e){a=void 0!==this.markers?this.markers:(this.selected||this.freezed||(console.trace(),this.moveForward()),this.points),this.trendLineSettings={points:this.getBorderPoints(this.getFloatCoords(a))};var i=this.getOpenCoords(e);t.save(),t.beginPath(),t.setLineDash([8,3]);var a=this.settings.fillStyle;t.strokeStyle=a,t.moveTo(i.x,i.y),t.lineTo(this.trendLineSettings.points[0].x,this.trendLineSettings.points[0].y),t.stroke(),t.restore(),t.save(),t.lineWidth=4,t.strokeStyle=this.settings.fillStyle,t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(this.trendLineSettings.points[1].x,this.trendLineSettings.points[1].y),t.stroke(),t.restore(),this.settings.newOrderParams=this.getOrderParams(e),this.selected?(this.drawPoint(t,e[0].x,e[0].y,a,4),this.drawPoint(t,e[1].x,e[1].y,a,4),this.drawLableTrend(t,e)):t.inHover&&this.drawLableTrend(t,e)},iChart.Charting.ChartTrendorder.prototype.findYForward=function(t){for(var e=iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.layer.chart.areas[0].xSeries,this.settings.date/1e3),i=this.layer.area.getXIndexByValue(t/1e3),a=60*this.layer.chart.env.dataSource.dataSettings.timeframe,r={x:this.settings.date,y:this.settings.price},s={x:this.settings.date2,y:this.settings.price2},n=0,o=e+1;o<=i;o++){var h,l=this.layer.chart.areas[0].xSeries[o]-this.layer.chart.areas[0].xSeries[o-1];1<l/a&&(h=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[o-1]),l=iChart.getLineEquation(r,s,1e3*(this.layer.chart.areas[0].xSeries[o-1]+l-a)),n+=h.y-l.y)}return iChart.getLineEquation(r,s,t).y+n},iChart.Charting.ChartTrendorder.prototype.moveForward=function(){this.points[1].x<$.now()&&(this.points[1].x=$.now(),this.points[1].y=this.findYForward(this.points[1].x))},iChart.Charting.ChartTrendorder.prototype.pointsForward=function(t){for(var e=iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.layer.chart.areas[0].xSeries,this.settings.date/1e3),i=this.layer.chart.areas[0].xSeries.length-1,a=60*this.layer.chart.env.dataSource.dataSettings.timeframe,r={x:this.settings.date,y:this.settings.price},s={x:this.settings.date2,y:this.settings.price2},n=e;n<=i;n++){var o=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[n]),h=this.layer.area.getXPositionByValue(o.x/1e3),l=this.layer.area.getYPosition(o.y);this.drawPoint(t,h,l,"rgba(255,100,100, 0.3)",4)}for(var c=0,n=e+1;n<=i;n++){var d,p=this.layer.chart.areas[0].xSeries[n]-this.layer.chart.areas[0].xSeries[n-1];1<p/a&&(d=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[n-1]),p=iChart.getLineEquation(r,s,1e3*(this.layer.chart.areas[0].xSeries[n-1]+p-a)),c+=d.y-p.y);o=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[n]),h=this.layer.area.getXPositionByValue(o.x/1e3),l=this.layer.area.getYPosition(o.y+c);this.drawPoint(t,h,l,"#66FF66",3)}},iChart.Charting.ChartTrendorder.prototype.pointsBack=function(t){for(var e=this.layer.chart.areas[0].xSeries.length-2,i=this.layer.chart.areas[0].viewport.x.min,a=60*this.layer.chart.env.dataSource.dataSettings.timeframe,r={x:this.settings.date,y:this.settings.price},s={x:this.settings.date2,y:this.settings.price2},n=0,o=e;i<o;o--){var h=this.layer.chart.areas[0].xSeries[o+1]-this.layer.chart.areas[0].xSeries[o];1<h/a&&(1<h/86400&&(h-=h%86400),l=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[o-1]),n+=iChart.getLineEquation(r,s,1e3*(this.layer.chart.areas[0].xSeries[o-1]+h-a)).y-l.y);var h=iChart.getLineEquation(r,s,1e3*this.layer.chart.areas[0].xSeries[o]),l=this.layer.area.getXPositionByValue(h.x/1e3),h=this.layer.area.getYPosition(h.y+n);this.drawPoint(t,l,h,"#66FF66")}},iChart.Charting.ChartTrendorder.prototype.drawInternal=function(t,e){var i;e.length<2||("line"==this.settings.mode?(this.lineNormalizeCoords(t,e),this.drawLineMode(t,e)):(i=!1,this.settings.newOrderParams||(e=this.normalizeCoords(t,e),i=!0),this.drawTrendMode(t,e),i&&this.calcPointsPosition(e[1].x,150)))},iChart.Charting.ChartTrendorder.prototype.drawPoint=function(t,e,i,a,r){t.save(),t.beginPath(),t.lineWidth=1,t.strokeStyle=a,t.fillStyle=a,r=r||2,t.arc(e,i,r,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()},iChart.Charting.ChartTrendorder.prototype.drawExtended=function(t){var e,i,a;this.selected&&((e=this.getCoordinates(t,this.points)).length<1||(i=iChart.formatNumber(this.points[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),this.layer.chart.renderer.drawLable(t,this.settings.fillStyle,0,this.layer.area.innerWidth,e[0].y,i),void 0!==this.markers&&(e=this.getCoordinates(t,this.markers),i=iChart.formatNumber(this.markers[0].y,{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),a=t.inHover?void 0!==this.settings.fillStyleHover?this.settings.fillStyleHover:iChart.Charting.ChartTrendorder.lightColor(this.settings.fillStyle):this.settings.fillStyle,this.layer.chart.renderer.drawLable(t,a,0,this.layer.area.innerWidth,e[0].y,i))))},iChart.Charting.ChartTrendorder.prototype.drawLable=function(t,e,i,a,r,s){e=e||"#333333",i=i||"#FFFFFF",t.save(),t.font="normal 13px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=e,t.lineWidth="2";var n=t.measureText(s).width+5,a=t.canvas.width-120;t.beginPath(),t.moveTo(a-n-5,r+5),t.lineTo(a-n-5,r-5),t.quadraticCurveTo(a-n-5,r-10,a-n,r-10),t.lineTo(a,r-10),t.quadraticCurveTo(5+a,r-10,5+a,r-5),t.lineTo(5+a,r+5),t.quadraticCurveTo(5+a,r+10,a,r+10),t.lineTo(a-n,r+10),t.quadraticCurveTo(a-n-5,r+10,a-n-5,r+5),t.closePath(),t.save();e=this.layer.chart.chartOptions.shadowColor;this.selected?(t.shadowColor=e,t.shadowBlur=20,t.shadowOffsetX=15,t.shadowOffsetY=15):t.inHover&&(t.shadowColor=e,t.shadowBlur=10,t.shadowOffsetX=5,t.shadowOffsetY=5),t.restore(),t.fill(),this.drawCancelButton(t,a,r-10),t.fillStyle=i,t.fillText(s,a-n,r),t.restore()},iChart.Charting.ChartTrendorder.prototype.drawLableTrend=function(t,e){var i=this.settings.text,a=this.settings.textColor,r=this.settings.textHeight,s=1.2*r,n=(e[0].x+e[1].x)/2,o=(e[0].y+e[1].y)/2,h={center:{x:"",y:""},left:{x:"",y:""},right:{x:"",y:""}},l=Math.atan((e[0].y-e[1].y)/(e[0].x-e[1].x));t.save(),t.font="normal "+r+"px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.lineWidth="1";e=t.measureText(i).width;t.restore(),h.center.x=n-s*Math.cos(Math.PI/2+l),h.center.y=o-s*Math.sin(Math.PI/2+l),h.left.x=h.center.x-e/2*Math.cos(l),h.left.y=h.center.y-e/2*Math.sin(l),h.right.x=h.center.x+(e/2+20)*Math.cos(l),h.right.y=h.center.y+(e/2+20)*Math.sin(l),this.trendLabelSettings={alpha:l,labelCoords:h},t.save(),t.font="normal "+r+"px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.lineWidth="1",t.strokeStyle=this.settings.fillStyle,t.fillStyle=this.settings.fillStyle;r=Math.round(r/2);t.translate(h.left.x,h.left.y),t.rotate(l),t.beginPath(),t.moveTo(-3,0+r),t.lineTo(-3,0-r),t.quadraticCurveTo(-3,0-r-3,0,0-r-3),t.lineTo(0+e,0-r-3),t.quadraticCurveTo(0+e+3,0-r-3,0+e+3,0-r),t.lineTo(0+e+3,0+r),t.quadraticCurveTo(0+e+3,0+r+3,0+e,0+r+3),t.lineTo(0,0+r+3),t.quadraticCurveTo(-3,0+r+3,-3,0+r),t.closePath(),t.fill(),t.fillStyle=a,t.fillText(i,0,0),this.drawCancelButton(t,0+e+3,0-r-3),t.restore()},iChart.Charting.ChartTrendorder.prototype.drawCancelButton=function(t,e,i){t.beginPath(),t.moveTo(e,i),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.lineTo(e,i+20),t.stroke(),t.lineTo(e+15,i+20),t.quadraticCurveTo(e+20,i+20,e+20,i+15),t.lineTo(e+20,i+5),t.quadraticCurveTo(e+20,i,e+15,i),t.closePath(),t.fillStyle="#e53935",t.fill(),t.beginPath(),t.moveTo(e+5,i+5),t.lineTo(e+15,i+15),t.moveTo(e+5,i+15),t.lineTo(e+15,i+5),t.stroke(),t.closePath()},iChart.Charting.ChartTrendorder.prototype.drawPoints=function(t,e){if(!this.selected)return 0;function i(t,e,i,a,r,s){e+=(s?-1:1)*a*Math.cos(r),i+=(s?-1:1)*a*Math.sin(r);t.lineWidth=1;var n=s?-.2*Math.PI+r:.8*Math.PI+r,o=s?.2*Math.PI+r:1.2*Math.PI+r,h=s?0*Math.PI+r:+Math.PI+r,l=e+10*(s?-1:1)*Math.cos(Math.PI/2+r),c=i+10*(s?-1:1)*Math.sin(Math.PI/2+r),d=e+10*(s?1:-1)*Math.cos(Math.PI/2+r),e=i+10*(s?1:-1)*Math.sin(Math.PI/2+r);t.beginPath(),t.arc(l,c,a,n,h),t.stroke(),t.beginPath(),t.arc(d,e,a,h,o),t.stroke();i=l+a*Math.cos(n),s=c+a*Math.sin(n),r=n+Math.PI/16,h=l+.9*a*Math.cos(r),n=c+.9*a*Math.sin(r),l+=1.1*a*Math.cos(r),c+=1.1*a*Math.sin(r);t.beginPath(),t.moveTo(h,n),t.lineTo(i,s),t.lineTo(l,c);i=d+a*Math.cos(o),s=e+a*Math.sin(o),r=o-Math.PI/16,h=d+.9*a*Math.cos(r),n=e+.9*a*Math.sin(r),l=d+1.1*a*Math.cos(r),c=e+1.1*a*Math.sin(r);t.moveTo(h,n),t.lineTo(i,s),t.lineTo(l,c),t.stroke()}var a=Math.atan((e[0].y-e[1].y)/(e[0].x-e[1].x));t.save(),t.strokeStyle=this.settings.fillStyle,t.fillStyle=this.settings.fillStyle,i(t,e[0].x,e[0].y,30,a,!1),i(t,e[1].x,e[1].y,30,a,!0),t.restore()},iChart.Charting.ChartTrendorder.prototype.setTestSegments=function(){var t,e;"line"==this.settings.mode?this.selected?((e=this.layer.context).font="normal 13px Arial,Helvetica,sans-serif",e.textAlign="left",e.textBaseline="middle",t=e.measureText(this.settings.text).width,e=e.canvas.width-120,this.testContext.segments=[[{x:e-t,y:this.testContext.points[0].y-4},{x:e,y:this.testContext.points[0].y-4}],[{x:e-t,y:this.testContext.points[0].y+4},{x:e,y:this.testContext.points[0].y+4}],[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]):this.testContext&&(this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}]]):(this.testContext.segments=[],this.testContext.segments=[[{x:this.trendLineSettings.points[0].x,y:this.trendLineSettings.points[0].y},{x:this.trendLineSettings.points[1].x,y:this.trendLineSettings.points[1].y}]],this.trendLabelSettings&&this.testContext.segments.push([{x:this.trendLabelSettings.labelCoords.left.x,y:this.trendLabelSettings.labelCoords.left.y},{x:this.trendLabelSettings.labelCoords.right.x,y:this.trendLabelSettings.labelCoords.right.y}]))},iChart.Charting.ChartTrendorder.prototype.onDrag=function(t){if(!t[0]||!t[1])return!1;"line"==this.settings.mode&&(t[0].y!=this.points[0].y&&this.points[1].y==t[1].y||t[0].y==this.points[0].y&&this.points[1].y!=t[1].y)&&(this.settings.mode="trend",this.settings.date2=new Date(t[1].x),this.settings.price2=this.points[1].y,e=this.getCoordinates(this.layer.context,t),this.settings.newOrderParams=this.getOrderParams(e));var e=1e3*(this.layer.area.getXValue(1)-this.layer.area.getXValue(0));this.points[0].x!=t[0].x&&t[0].x>=t[1].x-e?t[0].x=t[1].x-e:this.points[1].x!=t[1].x&&t[1].x<=t[0].x+e&&(t[1].x=t[0].x+e),"function"==typeof this.settings.restriction&&this.settings.restriction.call(this,t)},iChart.Charting.ChartTrendorder.prototype.onSelect=function(t){iChart.Charting.ChartElement.prototype.onSelect.call(this,t),this.getTestContext(!0)},iChart.Charting.ChartTrendorder.prototype.onBlur=function(){this.settings.mode,this.getTestContext(!0)},iChart.Charting.ChartTrendorder.prototype.onDrop=function(){"trend"==this.settings.mode&&console.log("newOrderParams",this.settings.newOrderParams),"function"==typeof this.settings.onDrop&&this.settings.onDrop.call(this)},iChart.Charting.ChartTrendorder.prototype.onHover=function(t,e){clearTimeout(this.layer.chart.env.timers.orderClose),this.cancelControl(1)},iChart.Charting.ChartTrendorder.prototype.onOut=function(){clearTimeout(this.layer.chart.env.timers.orderClose);var t=this;this.layer.chart.env.timers.orderClose=setTimeout(function(){t.cancelControl(0)},300)},iChart.Charting.ChartTrendorder.prototype.cancelControl=function(t){var e,i,a,r;"function"==typeof this.settings.onCancel&&(t?($("#ichartOrderCancelCtrl").hide(),t=(e=this.layer.context).canvas.width-120,e=this.getCoordinates(e,this.points),$("#ichartOrderCancelCtrl").length||$("<span/>",{id:"ichartOrderCancelCtrl",style:"color:transparent",class:"m-chart-instrument-delete",text:"✕",title:_t("2958","Снять")}).hide().appendTo(this.layer.chart.container),i=this,$("#ichartOrderCancelCtrl").unbind("click").bind("click",function(t){"function"==typeof i.settings.onCancel&&i.settings.onCancel.call(i),$("#ichartOrderCancelCtrl").hide()}).bind("mouseover",function(){clearTimeout(i.layer.chart.env.timers.orderClose)}).bind("mouseleave",function(){clearTimeout(i.layer.chart.env.timers.orderClose),i.layer.chart.env.timers.orderClose=setTimeout(function(){i.cancelControl(0)},1e3)}),"line"==this.settings.mode?(a=e[0].y-8,r=2+t):this.trendLabelSettings&&(a=this.trendLabelSettings.labelCoords.right.y-10-10*Math.sin(this.trendLabelSettings.alpha),r=this.trendLabelSettings.labelCoords.right.x-10-10*Math.cos(this.trendLabelSettings.alpha)),$("#ichartOrderCancelCtrl").css({top:a,left:r}).show()):$("#ichartOrderCancelCtrl").hide())},iChart.Charting.ChartTrendorder.prototype.onMouseDown=function(t,e,i){"trend"!=this.settings.mode||this.selected||this.calcPointsPosition(e,150),"function"==typeof this.settings.onSelect&&this.settings.onSelect.call(this,t)},iChart.Charting.ChartTrendorder.lightColor=function(t){}}(),function(){"use strict";iChart.Charting.ChartHorizontalRange=function(t){iChart.Charting.ChartElement.prototype.constructor.call(this,t),this.elementType="HorizontalRange",this.drawType="manually",this.maxPointCount=2,this.hasSettings=!0,this.settings=$.extend({},t.chart.env.userSettings.chartSettings.contextSettings)},inheritPrototype(iChart.Charting.ChartHorizontalRange,iChart.Charting.ChartElement),iChart.Charting.ChartHorizontalRange.prototype.drawInternal=function(t,e){var i;e.length<2||(i=this.layer.area.getXValue(t.canvas.width-200),this.points[0].x=1e3*i,e[0].x=t.canvas.width-200,this.points[1].x=1e3*i,e[1].x=t.canvas.width-200,t.save(),t.beginPath(),this.initDrawSettings(t,this.settings),t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.stroke(),t.moveTo(0,e[1].y),t.lineTo(t.canvas.width,e[1].y),t.stroke(),t.moveTo(0,e[0].y),t.lineTo(t.canvas.width,e[0].y),t.lineTo(t.canvas.width,e[1].y),t.lineTo(0,e[1].y),t.lineTo(0,e[0].y),t.fill(),t.restore())},iChart.Charting.ChartHorizontalRange.prototype.drawExtended=function(t){var e,i,a;this.settings.drawLabel&&((e=this.getCoordinates(t,this.points)).length<2||(i=this.settings,a=this.layer.chart.renderer.formatNumber(this.layer.area.getYValue(e[0].y),{decimalPrecision:this.layer.chart.labelPrecision,scale:0}),this.layer.chart.renderer.drawLable(t,i.strokeStyle,0,this.layer.area.innerWidth,e[0].y,a)))},iChart.Charting.ChartHorizontalRange.prototype.setTestSegments=function(){this.testContext.segments=[[{x:this.layer.area.innerOffset.left,y:this.testContext.points[0].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[0].y}],[{x:this.layer.area.innerOffset.left,y:this.testContext.points[1].y},{x:this.layer.area.innerOffset.left+this.layer.area.innerWidth,y:this.testContext.points[1].y}]]}}(),function(T){"use strict";iChart.Charting.Crosshair=function(t){this.$chart=t.$chart,this.container=null,this.areas=null,this.dots=null,this.hidden=!0,this.pageX=null,this.pageY=null,this.pointMap=void 0,this.yLabel=null},iChart.Charting.Crosshair.prototype.hide=function(){if(!this.hidden){for(var t=0;t<this.dots.length;++t)this.dots[t].style.display="none";null!==this.yLabel&&(this.yLabel.style.display="none");for(t=0;t<this.areas.length;++t){var e=this.areas[t];!1===e.enabled||e.isLayer||e.isScroller||(e.horizontal.style.display="none",e.vertical.style.display="none",e.tooltip.innerHTML=e.tooltipInnerHtml||"")}this.hidden=!0}},iChart.Charting.Crosshair.prototype.render=function(t,e,i){if(t!==this.pageX||e!==this.pageY||i){this.pageX=t,this.pageY=e;var e=this.$chart.offset(),e=this.areas[0].chart._containerSize.offset,a={};a.left=Math.round(this.pageX-e.left),a.top=Math.round(this.pageY-e.top);for(var r,s,n={x:!1,y:!1},o=0;o<this.areas.length;++o)!1===(x=this.areas[o]).enabled||x.isLayer||x.isScroller||("top"==x.chart.chartOptions.tooltipPosition?r=x.innerOffset.top-20:"bottom"==x.chart.chartOptions.tooltipPosition&&(r=x.innerOffset.top-38+x.innerHeight),T(x.tooltip).css({left:x.innerOffset.left+"px",top:r+"px"}),n[o]={},n.x=(n[o].x=a.left>=x.innerOffset.left&&a.left<=x.innerOffset.left+x.innerWidth)||n.x,n.y=(n[o].y=a.top>=x.innerOffset.top&&a.top<=x.innerOffset.top+x.innerHeight)||n.y);if(n.x&&n.y){if(void 0===this.pointMap){if(0===(x=this.areas[0]).xSeries.length)return void this.hide();var h=x.getXIndex(a.left-x.innerOffset.left);if(h<x.viewport.x.bounded.min||h>x.viewport.x.bounded.max)return void this.hide();h=Math.max(x.viewport.x.bounded.min,Math.min(x.viewport.x.bounded.max,Math.round(h))),a.left=x.innerOffset.left+Math.round(x.getXPositionByIndex(h));for(o=0;o<this.dots.length;++o){var l=this.dots[o];(y=(u=(x=this.areas[l.areaIndex]).ySeries[l.seriesIndex2]).points[h])?(f=y[l.yValueIndex],u.multiplier&&(f=u.multiplier*f-100),0<=(C=x.getYPosition(f))&&C<=x.innerHeight?(l.style.display="",l.style.left=a.left-4+"px",l.style.top=x.innerOffset.top+C-4+"px"):l.style.display="none"):l.style.display="none"}for(o=0;o<this.areas.length;++o)if(!1!==(x=this.areas[o]).enabled&&!x.isScroller){var c,d=[];x.isLayer||(c=new Date(1e3*x.xSeries[h]),d.push(iChart.formatDateTime(c,"dd.MM.yyyy"+(this.showTime?" HH:mm":""))));for(var p=0;p<x.ySeries.length;++p)for(var u=x.ySeries[p],g=0;g<u.labels.length;++g){var f,m=u.labels[g][0],v=u.labels[g][1];(y=u.points[h])&&(f=y[m],f=u.multiplier?(0<(f=u.multiplier*f-100)?"+":"")+iChart.formatNumber(f,u.formatProvider)+"%":f<100?iChart.formatNumber(f,{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(f,{decimalPlaces:2,decimalPrecision:null,scale:0}),d.push(v+" <span class='m-chart-legend-value'>"+f+"</span>"))}x.isLayer?T.grep(this.areas,function(t){return t.name===x.parentName})[0].tooltip.innerHTML+=" &ensp; "+d.join(" &ensp; "):x.tooltip.innerHTML=d.join(" &ensp; ")}}else{if(void 0===(s=this.pointMap[a.left]))return void this.hide();a.left=s.offset;for(o=0;o<this.dots.length;++o){var y,C,l=this.dots[o];(y=s.y[l.seriesIndex])?(C=y[l.yValueIndex].p,!1===(x=this.areas[l.areaIndex]).enabled||x.isScroller||(C>=x.innerOffset.top&&C<=x.innerOffset.top+x.innerHeight?(l.style.display="",l.style.left=a.left-4+"px",l.style.top=C-4+"px"):l.style.display="none")):l.style.display="none"}for(o=0;o<this.areas.length;++o)!1===(x=this.areas[o]).enabled||x.isScroller||(x.tooltip.innerHTML=s.tooltips[o])}for(var x,o=0;o<this.areas.length;++o)!1===(x=this.areas[o]).enabled||x.isLayer||x.isScroller||(x.tooltip.style.display="",n[o].x?(x.vertical.style.display="",x.vertical.style.left=a.left+"px",n[o].y?(x.horizontal.style.display="",x.horizontal.style.top=+a.top+"px",null===this.yLabel||x.chart.overlay.drag?this.yLabel.style.display="none":(this.yLabel.innerHTML=iChart.formatNumber(this._getYValue(x,a.top-x.innerOffset.top),{decimalPrecision:5}),this.yLabel.style.display="",this.yLabel.style.top=a.top-8+"px")):x.horizontal.style.display="none"):(x.horizontal.style.display="none",x.vertical.style.display="none"));this.hidden=!1}else this.hide()}},iChart.Charting.Crosshair.prototype.mouseMoveHandler=function(t){var e;void 0===t&&(t=window.event),t=void 0!==t.pageX?(e=t.pageX,t.pageY):(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.clientY+document.body.scrollTop+document.documentElement.scrollTop),e=Math.round(e),t=Math.round(t),this.render(e,t)},iChart.Charting.Crosshair.prototype.update=function(t,e){if(this.container=e,this._clear(),!t||!t.areas)throw"No data available.";this.areas=t.areas,this.chartWidth=this.areas[0].chart._containerSize.width,this.showTime=t.showTime,this._initDots(),this._initYLabel(),this._initPointMap(t),this.addMouseMoveHandler(this)},iChart.Charting.Crosshair.prototype._clear=function(){this.removeMouseMoveHandler(),T(".m-chart-d, .m-chart-h, .m-chart-t, .m-chart-v, .m-chart-y",this.$chart.parent()).remove(),this.areas=[],this.dots=[],this.yLabel=null},iChart.Charting.Crosshair.prototype._getYValue=function(t,e){return 0===t.axisY.scale?t.axisY.max:t.axisY.max-e/t.axisY.scale},iChart.Charting.Crosshair.prototype._initDots=function(){this.dots=[];for(var t=0;t<this.areas.length;++t){var e=this.areas[t];if(!1!==e.enabled&&!e.isLayer&&!e.isScroller)for(var i=0;i<e.ySeries.length;++i){var a=e.ySeries[i],r=a.dotColor||a.color||"";""!==r&&((r=T("<div/>",{class:"m-chart-d"}).css({"background-color":r,display:"none"}).insertAfter(this.$chart).get(0)).areaIndex=t,r.seriesIndex=a.index,r.seriesIndex2=i,r.yValueIndex=a.dotIndex||0,this.dots.push(r))}}},iChart.Charting.Crosshair.prototype._initPointMap=function(t){for(var e=0;e<this.areas.length;++e){var i,a=this.areas[e];if(!1!==a.enabled&&!a.isScroller){if(a.isLayer||(a.horizontal=T("<div/>",{class:"m-chart-h"}).css({display:"none",left:a.innerOffset.left+"px",width:a.innerWidth+"px"}).insertAfter(this.$chart).get(0),a.vertical=T("<div/>",{class:"m-chart-v"}).css({display:"none",top:a.innerOffset.top+"px",height:a.innerHeight+"px"}).insertAfter(this.$chart).get(0)),void 0===t.pointMap){if(a.viewport.x.bounded.min<=a.viewport.x.bounded.max){var r,s=[],n=Math.min(a.viewport.x.bounded.max,a.xSeries.length-1-a.chart.chartOptions.futureAmount);a.isLayer||(r=new Date(1e3*a.xSeries[n]),s.push(iChart.formatDateTime(r,"dd.MM.yyyy"+(this.showTime?" HH:mm":""))));for(var o=0;o<a.ySeries.length;++o)for(var h=a.ySeries[o],l=0;l<h.labels.length;++l){var c=h.labels[l][0],d=h.labels[l][1],p=h.points[n];p&&(p=p[c],p=h.multiplier?(0<(p=h.multiplier*p-100)?"+":"")+iChart.formatNumber(p,h.formatProvider)+"%":p<100?iChart.formatNumber(p,{decimalPlaces:null,decimalPrecision:6,scale:0}):iChart.formatNumber(p,{decimalPlaces:2,decimalPrecision:null,scale:0}),s.push(d+" <span class='m-chart-legend-value'>"+p+"</span>"))}a.isLayer?T.grep(this.areas,function(t){return t.name===a.parentName})[0].tooltipInnerHtml+=" &ensp; "+s.join(" &ensp; "):a.tooltipInnerHtml=s.join(" &ensp; ")}}else for(var u in t.pointMap)if(t.pointMap.hasOwnProperty(u)){void 0===(m=t.pointMap[u]).tooltips&&(m.tooltips=new Array(this.areas.length)),(s=[]).push(m.x);for(o=0;o<a.ySeries.length;++o)for(var g=a.ySeries[o],l=0;l<g.labels.length;++l){var c=g.labels[l][0],d=g.labels[l][1],f=m.y[g.index];f&&s.push(d+" <span class='m-chart-legend-value'>"+f[c].v+"</span>")}a.tooltipInnerHtml=s.join(" &nbsp; "),m.offset=u,m.tooltips[e]=a.tooltipInnerHtml}a.isLayer?(r=T.grep(this.areas,function(t){return t.name===a.parentName})[0],T(r.tooltip).html(r.tooltipInnerHtml||"")):("top"==a.chart.chartOptions.tooltipPosition?i=a.innerOffset.top-20:"bottom"==a.chart.chartOptions.tooltipPosition&&(i=a.innerOffset.top-38+a.innerHeight),a.tooltip=T("<div/>",{class:"m-chart-t"}).css({left:a.innerOffset.left+"px",top:i+"px",background:a.chart.chartOptions.backgroundColor}).html(a.tooltipInnerHtml||"").insertAfter(this.$chart).get(0))}}if(void 0!==t.pointMap){this.pointMap=new Array(this.chartWidth);for(e=0;e<this.chartWidth;++e){for(var o=0,m=t.pointMap[e];this._isEmptyPoint(m)&&(0<e-o||e+o<this.chartWidth);)++o,m=t.pointMap[e-o],this._isEmptyPoint(m)&&(m=t.pointMap[e+o]);this._isEmptyPoint(m)||(this.pointMap[e]=m)}}},iChart.Charting.Crosshair.prototype._initYLabel=function(){var t=this.areas[0];t&&!1!==t.enabled&&!t.isScroller&&(this.yLabel=T("<div/>",{class:"m-chart-y"}).css({background:t.chart.chartOptions.backgroundColor,display:"none",left:t.innerOffset.left+t.innerWidth-(t.chart.chartOptions.yLabelsOutside?0:50)+"px",position:"absolute",margin:"0 0 0 5px"}).insertAfter(this.$chart).get(0))},iChart.Charting.Crosshair.prototype._isEmptyPoint=function(t){if(void 0===t)return!0;for(var e=0;e<t.y.length;++e)if(null!==t.y[e])return!1;return!0},iChart.Charting.Crosshair.prototype.addMouseMoveHandler=function(t){this.mouseMoveHandler&&this.removeMouseMoveHandler(),this.mouseMoveHandler=t.mouseMoveHandler.bind(this),T(this.container).on("mousemove",this.mouseMoveHandler)},iChart.Charting.Crosshair.prototype.removeMouseMoveHandler=function(){void 0!==this.mouseMoveHandler&&T(this.container).off("mousemove ",this.mouseMoveHandler)},T.fn.crosshair=function(t,e){if(!this.length)return this;var i=this.data("crosshair");return void 0===i&&(i=new iChart.Charting.Crosshair({$chart:this}),this.data("crosshair",i)),i.update(t,e),this}}(jQuery),function(){"use strict";iChart.Charting.ChartDataSource=function(t,e){var i={useHash:!1,date_from:formatDate(-90),date_to:formatDate(0),graphicIndicators:"",hash:"",id:"",interval:"D1",timeframe:1440};e=e||{},this.chart=t,this.data=e.data||{},this.dataSettings=e.dataSettings||i,this.preInitCallback=("function"==typeof e.preInitCallback?e.preInitCallback:function(t,e){t(e.chartOptions)}).bind(this),this.onRequestCallback=("function"==typeof e.onRequestCallback?e.onRequestCallback:function(t,e){console.log(e),e=this.dataAdapter(this.data,e),this.chart.wrapper.trigger("iguanaChartEvents",["chartDataReceived",e]),t(e),this.chart.wrapper.trigger("iguanaChartEvents",["chartDataReady",e]),this.chart.dataRequestCounter++}).bind(this)},iChart.Charting.ChartDataSource.prototype.set=function(t){},iChart.Charting.ChartDataSource.prototype.preInit=function(t,e){var i;this.dataSettings.date_from=e.date_from||this.dataSettings.date_from||formatDate(-90),this.dataSettings.date_to=e.date_to||this.dataSettings.date_to||formatDate(0),e.period&&(i=this.chart.getPeriodDates(e.period),this.dataSettings.date_from=i.date_from,this.dataSettings.date_to=i.date_to),this.dataSettings.start=this.dataSettings.start||this.dataSettings.date_from,this.dataSettings.end=this.dataSettings.end||this.dataSettings.date_to,this.dataSettings.interval=e.interval||this.dataSettings.interval,this.dataSettings.timeframe=iChart.getChartTimeframe(this.dataSettings.interval),e.chartOptions=$.extend(!0,{},e.chartOptions),e.theme=void 0!==e.theme?e.theme:IGUANACHART_THEME,e.theme&&(void 0!==(i=$.grep($iguanaChart.thems,function(t){return t.name==e.theme?t:null})[0])?e.chartOptions=$.extend(!0,{},e.chartOptions,i.settings):"default"==e.theme&&(e.chartOptions=$.extend(!0,{},e.chartOptions,$iguanaChart.defaultTheme))),this.preInitCallback(t,e)},iChart.Charting.ChartDataSource.prototype.onRequest=function(t,e){this.onRequestCallback(t,e)},iChart.Charting.ChartDataSource.prototype.dataAdapter=function(t,e){var i={xSeries:[],ySeries:[],success:!0,warnings:[],message:""},a={chartType:"Column",enabled:!0,formatProvider:{decimalPlaces:"2",decimalPrecision:null},indicatorIndex:null,indicatorIndex2:null,kind:"HLOC",name:e.id,overlay:!1,points:[],valuesPerPoint:4},e={chartType:"Column",enabled:!0,formatProvider:{decimalPlaces:null,decimalPrecision:null},indicatorIndex:null,indicatorIndex2:null,kind:"Volume",name:e.id+" - V",overlay:!1,points:[],valuesPerPoint:1};if(t.hloc){var r=Object.keys(t.hloc);if(1==r.length){i.ySeries[0]=$.extend(!0,{},a),i.ySeries[1]=$.extend(!0,{},e),i.ySeries[0].name=r[0];for(var s=0;s<t.xSeries[r[0]].length;s++)i.xSeries.push(+t.xSeries[r[0]][s]+getTimeOffsetServer(tzOffsetMoscow)),i.ySeries[0].points.push(t.hloc[r[0]][s]),i.ySeries[1].points.push([t.vl[r[0]][s]])}else if(1<r.length){for(var n={},o=0;o<r.length;o++)for(s=0;s<t.xSeries[r[o]].length;s++)void 0===n[t.xSeries[r[o]][s]]&&(n[t.xSeries[r[o]][s]]={}),n[t.xSeries[r[o]][s]][r[o]]=t.hloc[r[o]][s];for(var h,o=0;o<r.length;o++)i.ySeries[o]=$.extend(!0,{},a),i.ySeries[o].name=r[o];for(h in n){i.xSeries.push(+h+getTimeOffsetServer(tzOffsetMoscow));for(o=0;o<r.length;o++)void 0===n[h][r[o]]?i.ySeries[o].points.push([null,null,null,null]):i.ySeries[o].points.push(n[h][r[o]])}}}return i}}(),function(){"use strict";iChart.Charting.ChartOptions=function(){this.backgroundColor="#ffffff",this.axisColor="#999999",this.labelColor="#595959",this.labelFont="10px Arial",this.showLabels=!0,this.gridColor="#cccccc",this._gridStyle="dashed",this.watermarkShow=!0,this.watermarkColor="rgba(238,238,238,1)",this.watermarkFont="bold 40px Verdana",this.watermarkSubFont="bold 25px Verdana",this.watermarkText="",this.watermarkSubText="",this.candleUp="#66B85C",this.candleDown="#C75757",this.candleBorderUp="#66B85C",this.candleBorderDown="#C75757",this.candleWick=!0,this.candleWickStyle="#595959",this.stockUp="#66B85C",this.stockDown="#C75757",this.stockWidth=1,this.lineColor="#595959",this.lineWidth=1,this.areaColor="#eff6fb",this.areaLineColor="#cccccc",this.volumeStyle="rgba(119, 119, 119, 0.3)",this.scrollerOverlayColor="rgba(0,0,0, 0.1)",this.scrollerHandlerColor="rgba(255,255,255, 1)",this.areaPaddingBottom=30,this.areaPaddingLeft=0,this.areaPaddingRight=60,this.areaPaddingTop=0,this.paddingBottom=0,this.candleBorder=0,this.tooltipPosition="bottom",this.showAxes=0,this.shadowColor="#999999",this.indicatorColors=[["#3D96AE","#80699B","#DB843D","#B5CA92"],["#A47D7C","#B5CA92","#e0400a","#617db4"],["#ff8c00","#617db4","#999999","#80699B"],["#3D96AE","#80699B","#DB843D","#B5CA92"],["#A47D7C","#B5CA92","#e0400a","#617db4"],["#ff8c00","#617db4","#999999","#80699B"],["#3D96AE","#80699B","#DB843D","#B5CA92"],["#A47D7C","#B5CA92","#e0400a","#617db4"],["#ff8c00","#617db4","#999999","#80699B"],["#3D96AE","#80699B","#DB843D","#B5CA92"],["#A47D7C","#B5CA92","#e0400a","#617db4"],["#ff8c00","#617db4","#999999","#80699B"]],this.minAreaHeight=100,this.minHeight=0,this.seriesColors=["#4BA1B8","#FF8C00","#A47D7C","#3D96AE","#80699B","#DB843D","#80699B"],this.mousewheelZoom=!0,this.maxZoom=20,this.panStep=.3,this.primaryAreaHeight=350,this.primaryAreaAxisYpaddingTop=30,this.primaryAreaAxisYpaddingBottom=30,this.primaryToSecondaryAreaHeightRatio=2,this.scrollerHeight=80,this.updateInterval=!0,this.showCurrentLabel=!0,this.yLabelsOutside=!0,this.percentMode=!1,this.futureAmount=100,this.crosshairEnable=!0,this._chartType="Candlestick",this._showVolume="hidden",this.showVolumeByPrice=!1,this.floatingLegend=!1,this.floatingLegendFontSize=12,this.floatingLegendTextColor="#444444",this.floatingLegendBorderColor="rgba(82,175,201,1)",this.floatingLegendBackground="rgba(82,175,201,.6)",this.legendAlign="top",this.elementStyle={Arrow:{fillStyle:"rgba(255,0,0,.2)",strokeStyle:"rgba(255,0,0,1)",lineWidth:3},Text:{fontColor:"#777777",fontSize:"28"}},this.uiTools={top:!1},this.inertialScrolling=!0},iChart.Charting.ChartOptions.themesParams=["backgroundColor","axisColor","showAxes","labelColor","gridColor","gridStyle","watermarkColor","watermarkFont","watermarkSubFont","candleUp","candleDown","candleBorder","candleBorderUp","candleBorderDown","candleWick","candleWickStyle","stockUp","stockDown","stockWidth","lineColor","lineWidth","areaColor","areaLineColor","volumeStyle","scrollerOverlayColor","scrollerHandlerColor","shadowColor","chartType"],iChart.Charting.ChartOptions.getThemeOptions=function(i){var a={};return i&&$.each(this.themesParams,function(t,e){"object"==typeof i[e]?$.isArray(i[e])?a[e]=$.extend(!0,[],i[e]):a[e]=$.extend(!0,{},i[e]):i[e]&&(a[e]=i[e])}),a},Object.defineProperty(iChart.Charting.ChartOptions.prototype,"chartType",{get:function(){return this._chartType},set:function(t){0<=["Candlestick","Stock","Line","Area"].indexOf(t)?this._chartType=t:(this._chartType="Candlestick",console.warn("ChartOptions: Недопустимое значение chartType:'%s'. Установлен по умлчанию: 'Candlestick'",t))}}),Object.defineProperty(iChart.Charting.ChartOptions.prototype,"showVolume",{get:function(){return this._showVolume},set:function(t){0<=["inside","outside","hidden"].indexOf(t)?this._showVolume=t:(this._showVolume="hidden",console.warn("ChartOptions: Недопустимое значение showVolume. Установлен по умлчанию: 'hidden'"))}}),Object.defineProperty(iChart.Charting.ChartOptions.prototype,"gridStyle",{get:function(){return this._gridStyle},set:function(t){0<=["dashed","solid"].indexOf(t)?this._gridStyle=t:(this._gridStyle="dashed",console.warn("ChartOptions: Недопустимое значение gridStyle. Установлен по умлчанию: 'dashed'"))}})}(),function(){"use strict";var a=0;iChart.Charting.Chart=function(t){this.env=t.env,this._id=a++,this.chartOptions=new iChart.Charting.ChartOptions,this.dataCountMin=50,this.historyEnd=t.historyEnd,this.labelPrecision=5,this.dataCallback=t.dataCallback,this.onCreateAreas=t.onCreateAreas||$.noop,this.onDataSettingsChange=t.onDataSettingsChange||$.noop,this.onIntervalChange=t.onIntervalChange||$.noop,this.onPositionAreas=t.onPositionAreas||$.noop,this.onPostRender=t.onPostRender||$.noop,this.onPreRender=t.onPreRender||$.noop,this.contextmenuCallback=t.contextmenuCallback||$.noop,this._dataLoading=!1,this.areas=null,this.canvas=null,this.isComparison=!1,this.viewport={x:{min:null,max:null},y:{min:null,max:null}},this.container=t.container,$(this.container).unbind("selectstart"),$(this.container).attr("unselectable","on").css("user-select","none").on("selectstart",!1),this.overlay=new iChart.Charting.ChartDrawingLayer(this),this.widgetLay=new iChart.Charting.ChartWidgetLayer(this,t.widget),this.renderer=new iChart.Charting.ChartRenderer(this),this.selection=new iChart.Charting.ChartSelection(this.container),this.selection.movestart=$.proxy(this._selectionMoveStartCallback,this),this.selection.move=$.proxy(this._selectionMoveCallback,this),this.selection.moveend=$.proxy(this._selectionMoveEndCallback,this),this.setSelectionMode("pan");var e,i=this;$(this.container).on("mousewheel",function(t){$.proxy(i._mousewheelCallback(t),i)}),this.touches=new iChart.Charting.ChartTouches(this),$(this.container).off("contextmenu").on("contextmenu",function(t){$.proxy(i.contextmenuCallback(t),i),i.env.wrapper.trigger("iguanaChartEvents",["contextmenuCallback",t])}),$(this.env.container).height()||(e=this.calculateHeight(),$(this.env.container).height(e.height)),this.chartOptions=$.extend(!0,this.chartOptions,t),this.crosshair=!1,this._resized=!0,this._containerSize={}},iChart.Charting.Chart.prototype.clearIndicators=function(t){for(var e=0;e<this.areas.length;++e){var i=this.areas[e];if(!t||i===t){for(var a=[],r=0;r<i.ySeries.length;++r)"TechnicalAnalysis"!==i.ySeries[r].kind&&"TA_LIB"!==i.ySeries[r].kind||(a.push(i.ySeries[r].indicatorIndex),i.ySeries.splice(r,1),--r);if(a.length){for(var s in this._dataSettings)for(r=0;r<a.length;r++)this._dataSettings.hasOwnProperty(s)&&s.match(new RegExp("^i"+a[r],"i"))&&delete this._dataSettings[s];0===i.ySeries.length&&(void 0!==i.overlay&&$(i.overlay.canvas).remove(),this.areas.splice(e,1)[0].dispose(),--e)}}}this.onDataSettingsChange.call(this),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}),this.env.wrapper.trigger("iguanaChartEvents",["clearIndicators"])},iChart.Charting.Chart.prototype.findAreaAtPosition=function(t,e){for(var i={},a=0;a<this.areas.length;++a)if(i.area=this.areas[a],i.area.enabled&&t>=i.area.offset.left&&t<=i.area.offset.left+i.area.outerWidth&&e>=i.area.offset.top&&e<=i.area.offset.top+i.area.outerHeight)return i.insideX=t>=i.area.innerOffset.left&&t<=i.area.innerOffset.left+i.area.innerWidth,i.insideY=e>=i.area.innerOffset.top&&e<=i.area.innerOffset.top+i.area.innerHeight,i.insideX||i.insideY?i:null;return null},iChart.Charting.Chart.prototype.getSeriesCollection=function(){for(var t=[],e=0;e<this.areas.length;++e)for(var i=this.areas[e].ySeries,a=0;a<i.length;++a)"TA_LIB"!=i[a].kind&&-1===t.indexOf(i[a])&&t.push(i[a]);return t},iChart.Charting.Chart.prototype.loadMissingData=function(){var t=this.areas[0];if(this._dataStart){var e,i=Math.round(t.xSeries.min-this.viewport.x.min);if(0<i){(e=$.extend(!0,{},this._dataSettings)).count=-Math.max(this.dataCountAdapt(i),i),e.intervalMode="OpenRay",e.start=iChart.formatDateTime(this._dataStart),delete e.end;var a=iChart.parseDateTime(e.start),i=iChart.parseDateTime(e.start);return a.setHours(0),a.setMinutes(0),a.setSeconds(0),i.setHours(0),i.setMinutes(0),i.setSeconds(0),1440==e.timeframe?(a.setMonth(0),a.setDate(0),i.setFullYear(i.getFullYear()+1,0,0),e.count=-1):60==e.timeframe||15==e.timeframe?(a.setMonth(a.getMonth()-1),a.setDate(0),i.setMonth(i.getMonth()+1),i.setDate(0),e.count=-1):5==e.timeframe?(i.setDate(i.getDate()+(7-(0==i.getDay()?7:i.getDay()))),a.setDate(a.getDate()-(0==a.getDay()?7:a.getDay())),e.count=-1):1==e.timeframe&&(i.setDate(i.getDate()+1),a.setDate(a.getDate()-1),e.count=-100),e.date_from=iChart.formatDateTime(a,"dd.MM.yyyy HH:mm"),e.date_to=iChart.formatDateTime(i,"dd.MM.yyyy HH:mm"),e.start=e.date_to,void this.requestData(e,!1,!1)}}!this._dataEnd||0<(t=Math.round(this.viewport.x.max-t.xSeries.max))&&((e=$.extend(!0,{},this._dataSettings)).count=Math.max(this.dataCountAdapt(t),t)+this.chartOptions.futureAmount,e.intervalMode="OpenRay",e.start=iChart.formatDateTime(this._dataEnd),e.date_to=iChart.formatDateTime(this._dataEnd,"dd.MM.yyyy HH:mm"),delete e.end,this.requestData(e,!1,!1))},iChart.Charting.Chart.prototype.dataCountAdapt=function(t){var e=50;switch(this._dataSettings.timeframe){case 1:e=500;break;case 5:e=300;break;case 15:e=200;break;case 30:e=150;break;case 60:e=120;break;case 1440:e=100}return e+t},iChart.Charting.Chart.prototype.pan=function(t){for(var e,i=0;i<this.areas.length&&(e=this.areas[i]).name!==this.viewport.areaName;++i)e=null;if(null===e&&(e=this.areas[0]),this.viewport.areaName=e.name,"left"===t||"right"===t){null===this.viewport.x.min&&(this.viewport.x.min=e.viewport.x.bounded.min),null===this.viewport.x.max&&(this.viewport.x.max=e.viewport.x.bounded.max);var a=Math.max(1,this.chartOptions.panStep*(this.viewport.x.max-this.viewport.x.min));"left"===t&&(a*=-1),this.viewport.x.min+=a,this.viewport.x.max+=a}else{if("top"!==t&&"bottom"!==t)return;null===this.viewport.y.min&&(this.viewport.y.min=e.viewport.y.min),null===this.viewport.y.max&&(this.viewport.y.max=e.viewport.x.max);a=this.chartOptions.panStep*(this.viewport.y.max-this.viewport.y.min);"bottom"===t&&(a*=-1),this.viewport.y.min+=a,this.viewport.y.max+=a}this._fixViewportBounds(),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),this.loadMissingData()},iChart.Charting.Chart.prototype.parseDataSettings=function(t){t=$.extend(!0,{},t);return t.start=iChart.parseDateTime(t.start),t.end=iChart.parseDateTime(t.end),t.timeframe=parseInt(t.timeframe,10),isNaN(Date.parse(t.date_from))&&(t.date_from=new Date),isNaN(Date.parse(t.date_to))&&(t.date_to=new Date),t},iChart.Charting.Chart.prototype.render=function(t,e){if(!this.areas)return console.log("No ares to render. Abort"),!1;if(t.context&&t.forceRecalc)throw new Error("Parameters 'forceRecalc' and 'context' parameters cannot be specified at the same time.");var i,a;t.resetViewport&&(this.viewport.x.min=null,this.viewport.x.max=null,this.viewport.y.min=null,this.viewport.y.max=null);var r=t.context;if(t.forceRecalc){if(this._positionAreas(),!this.canvas)return console.log("No canvas to render. Abort"),!1;r=iChart.getContext(this.canvas),(a={x:{}}).x.min=this.viewport.x.min,a.x.max=this.viewport.x.max,a.y={};for(var s=0;s<this.areas.length;++s)(i=this.areas[s]).name===this.viewport.areaName?(a.y.min=this.viewport.y.min,a.y.max=this.viewport.y.max):(a.y.min=null,a.y.max=null),i.calculateInnerDimensions(a)}return this.onPreRender.call(this,t,r),this.renderer.renderChart(r),this.onPostRender.call(this,t,r),t.forceRecalc&&(this.widgetLay&&this.widgetLay.update(),this.overlay&&this.overlay.update()),"undefined"!=typeof FlashCanvas&&r.e(),t.testForIntervalChange&&this._testForIntervalChange(e),!0},iChart.Charting.Chart.prototype.requestData=function(e,i,a,r){var t,s,n,o=new RegExp("^i[0-9]+$","i");for(t in e)o.test(t)&&e[t]&&this.env.viewData.indicators[e[t]]&&"TA_LIB"==this.env.viewData.indicators[e[t]].type&&(e[t]="");this._dataLoading||(this._dataLoading=!0,this.touches.disabled=!0,n=0,(s=this).env.dataSource.onRequest(function(t){s.setWarnings(t.warnings),t.success&&(n=s.updateData(t,e,i),s.render({forceRecalc:!0,resetViewport:a,testForIntervalChange:!0},r)),setTimeout(function(){s.scheduleUpdate()},2e3),s._dataLoading=!1,s&&s.areas&&n&&s.areas[0].xSeries.min>s.viewport.x.min&&s.loadMissingData(),s.indicatorsApply()},e))},iChart.Charting.Chart.prototype.indicatorsApply=function(){if(void 0!==this.env.TA){var o={};if(this.areas)for(var t=0;t<this.areas.length;++t)for(var e,i,a,r=this.areas[t],s=0;s<r.ySeries.length;++s)"TA_LIB"===r.ySeries[s].kind&&(e=r.ySeries[s].indicatorIndex,i=r.ySeries[s].name,a=$.extend(!0,{},r.ySeries[s].params),this.env.TA[i]&&!o[i+"/"+e]&&(this.env.TA[i](0,e),this.env.TA[i](1,e,a),o[i+"/"+e]=!0));var h=this,l=iChart.parseQueryString(this.env.dataSource.dataSettings.graphicIndicators);$.each(l,function(t,e){if(e&&t.match(/^i[0-9]+$/)&&h.env.viewData.indicators[e]&&"TA_LIB"==h.env.viewData.indicators[e].type){var i=t.match(/^i([0-9]+)$/)[1];if(!o[e+"/"+i]){for(var a={},r=0;r<h.env.viewData.indicators[e].parameters.length;r++){var s=h.env.viewData.indicators[e].parameters[r],n=h.env.TA.mapParam(s.Code);l[t+"_"+n]?a[s.Code]=+l[t+"_"+n]:a[s.Code]=+l[t+"_"+s.Code]||s.Value}h.env.TA[e](0,i),h.env.TA[e](1,i,a)}}})}},iChart.Charting.Chart.prototype.resetZoom=function(){this.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!0})},iChart.Charting.Chart.prototype.resize=function(){this._resized=!0,this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}),this.selection.recalculateContainerPosition()},iChart.Charting.Chart.prototype.scheduleUpdate=function(){clearTimeout(this.env.timers.scheduleUpdate),this.chartOptions.updateInterval&&this._dataSettings.id==this.env.viewData.chart._dataSettings.id&&$(this.env.container).length&&(this.env.timers.scheduleUpdate=setTimeout($.proxy(this.update,this,!0),2e4*this.env.viewData.chart._dataSettings.timeframe))},iChart.Charting.Chart.prototype.setChartType=function(t){this.chartOptions.chartType===t||this.isComparison||(this.chartOptions.chartType=t,this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))},iChart.Charting.Chart.prototype.setDataSettings=function(t,e){var i=this._dataSettings;this._dataSettings=this.parseDataSettings(t);var a=$.extend(!0,{},this._dataSettings);void 0!==i&&(n={},i.interval!=this._dataSettings.interval&&(n.interval=this._dataSettings.interval,this.env.wrapper.trigger("iguanaChartEvents",["intervalChange",this._dataSettings.interval])),i.id!=this._dataSettings.id&&(n.id=this._dataSettings.id),i.type!=this._dataSettings.type&&(n.type=this._dataSettings.type),Object.keys(n).length&&this.env.wrapper.trigger("iguanaChartEvents",["settingsChange",n]));var r=new Date(1800,0,1),s=this.historyEnd||new Date,t=(a.start||r).getTime(),n=(a.end||s).getTime();if(i&&i.id===a.id&&i.timeframe===a.timeframe&&!e){var o=!0,h=new RegExp("^i[0-9]+(_.*)?$","i");for(l in i)if(i.hasOwnProperty(l)&&h.test(l)&&(!a.hasOwnProperty(l)||i[l]!==a[l])){o=!1;break}if(o)for(var l in a)if(a.hasOwnProperty(l)&&h.test(l)&&(!i.hasOwnProperty(l)||i[l]!==a[l])){o=!1;break}if(o){var e=(i.start||r).getTime(),c=(i.end||s).getTime();if(e==t&&c===n)return!1;if(e=(this._dataStart||r).getTime(),c=(this._dataEnd||s).getTime(),e<=t&&n<=c)return this.env.wrapper.trigger("iguanaChartEvents",["clearLoader"]),this.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!0}),!0;t<e&&c===n?(a.intervalMode="OpenRay",a.count=-Math.max(this.dataCountMin,Math.round((e-t)/(6e4*a.timeframe))+50),a.start=new Date(e)):e==t&&c<n&&(a.intervalMode="OpenRay",a.count=Math.max(this.dataCountMin,Math.round((n-c)/(6e4*a.timeframe))+50),a.start=new Date(c))}}c=!a.intervalMode;return c&&(a.intervalMode="ClosedRay",a.count=-Math.max(this.dataCountMin,Math.round((n-t)/(6e4*a.timeframe)/2)),a.start=a.end,n=iChart.parseDateTime(a.date_to),t=iChart.parseDateTime(a.date_from),1440==a.timeframe?(n.setFullYear(n.getFullYear()-5),(t=new Date(Math.max(t.getTime(),n.getTime()))).setMonth(0),t.setDate(0),a.count=-1):60==a.timeframe?(n.setMonth(n.getMonth()-3),(t=new Date(Math.max(t.getTime(),n.getTime()))).setMonth(t.getMonth()-1),t.setDate(0),a.count=-10):15==a.timeframe?(n.setMonth(n.getMonth()-1),(t=new Date(Math.max(t.getTime(),n.getTime()))).setDate(0),a.count=-10):5==a.timeframe?(n.setDate(n.getDate()-14),(t=new Date(Math.max(t.getTime(),n.getTime()))).setHours(0),t.setMinutes(0),t.setSeconds(0),t.setDate(t.getDate()-t.getDay()),a.count=-100):1==a.timeframe&&(n.setDate(n.getDate()-5),(t=new Date(Math.max(t.getTime(),n.getTime()))).setHours(0),t.setMinutes(0),t.setSeconds(0),t.setDate(t.getDate()-1),a.count=-200),t.setHours(0),t.setMinutes(0),t.setSeconds(0),a.date_from=iChart.formatDateTime(t,"dd.MM.yyyy HH:mm")),delete a.end,a.start=iChart.formatDateTime(iChart.parseDateTime(a.start),"dd.MM.yyyy HH:mm"),this.requestData(a,c,!0),!0},iChart.Charting.Chart.prototype.setSelectionMode=function(t){if(this.container){switch(t){case"pan":this.container.style.cursor=this.overlay.defaultCursor=MOBILE_BROWSER_DETECTED?"move":"url('"+this.env.lib_path+"/styles/cursors/grab.cur'), move";break;case"zoom":this.container.style.cursor=this.overlay.defaultCursor="crosshair";break;case"wait":this.container.style.cursor=this.overlay.defaultCursor="wait";break;default:throw new Error("Selection mode '"+t+"' is invalid.")}this.selection.mode=t}},iChart.Charting.Chart.prototype.setWarnings=function(t){var e=$(".m-chart-warnings",this.container);t&&t.length?(0===e.length?e=$("<div/>",{class:"m-chart-warnings"}).appendTo(this.container):e.show(),e.text(t.join("\r\n"))):e.hide()},iChart.Charting.Chart.prototype.showTime=function(){return parseInt(this._dataSettings.timeframe,10)%1440!=0},iChart.Charting.Chart.prototype.toBase64=function(t){var e=document.createElement("canvas");if(e.id="iChart-chart",e.style.left=0,e.style.position="absolute",e.style.top=-this.canvas.height,document.body.appendChild(e),void 0===e.getContext){if("undefined"==typeof FlashCanvas)return void alert("Ваш браузер не поддерживается.");FlashCanvas.initElement(e)}e.width=this.canvas.width,e.height=this.canvas.height;var i=iChart.getContext(e);this.render({context:i,forceRecalc:!1,resetViewport:!1,testForIntervalChange:!1}),this.overlay.render(i),this.renderer.renderLegends(i);t=e.toDataURL(t);$(e).remove();e=";base64,";return t.substring(t.indexOf(e)+e.length)},iChart.Charting.Chart.prototype.update=function(t){var e=$.extend(!0,{},this._dataSettings);e.intervalMode="ClosedRay",t&&(e.intervalMode="OpenRay"),e.count=this.dataCountMin;var i=this.areas[0].xSeries;0!==i.length&&(e.date_from=iChart.formatDateTime(new Date(1e3*i[i.length-this.chartOptions.futureAmount-1]),"dd.MM.yyyy HH:mm"),e.date_to=e.date_from,e.start=e.date_from),delete e.end,this.requestData(e,!1,!1,t)},iChart.Charting.Chart.prototype.updateData=function(t,e,i){if("ClosedRay"!==e.intervalMode&&"OpenRay"!==e.intervalMode)throw new Error("Interval mode '"+e.intervalMode+"' is invalid.");var a;if(e.count<0?(t.xSeries.length<-e.count?this._dataStart=null:this._dataStart=new Date(1e3*t.xSeries[0]),i&&(this._dataEnd=iChart.parseDateTime(e.start))):(i&&(this._dataStart=iChart.parseDateTime(e.start)),t.xSeries.length<e.count?this._dataEnd=null:this._dataEnd=new Date(1e3*t.xSeries[t.xSeries.length-1])),0!==t.xSeries.length&&(a=new Date(1e3*t.xSeries[t.xSeries.length-1]),(!this.historyEnd||a.getTime()>this.historyEnd.getTime())&&(this.historyEnd=a)),i)return this._setData(t,e);if(0!==t.xSeries.length){t=this._mergeData(t,e);return e.count<0&&!t?this._dataStart=null:0<e.count&&!t&&(this._dataEnd=null),t}},iChart.Charting.Chart.prototype.zoom=function(t){this._zoomInternal(null,t)},iChart.Charting.Chart.prototype.addFuture=function(){var t=this.areas[0].xSeries,e=this._dataSettings;if(this.chartOptions.futureAmount)for(var i=60*e.timeframe,a=0;a<this.chartOptions.futureAmount;a++)t.push(t[t.length-1]+i);for(var r=$.grep(this.getSeriesCollection(),function(t){return t.enableMerge}),a=0;a<r.length;++a){var s=r[a];if(this.chartOptions.futureAmount)if(1==s.valuesPerPoint)for(var n=0;n<this.chartOptions.futureAmount;n++)s.points.push([null]);else for(n=0;n<this.chartOptions.futureAmount;n++)s.points.push([null,null,null,null])}for(a=0;a<this.areas.length;++a)this.areas[a].setMinMax();this._setXLabelFormat()},iChart.Charting.Chart.prototype.removeFuture=function(){var t=this.areas[0].xSeries;this.chartOptions.futureAmount&&t.splice(-this.chartOptions.futureAmount,this.chartOptions.futureAmount);var e=$.grep(this.getSeriesCollection(),function(t){return t.enableMerge});if(this.chartOptions.futureAmount)for(var i=0;i<e.length;i++)e[i].points.splice(-this.chartOptions.futureAmount,this.chartOptions.futureAmount);for(i=0;i<this.areas.length;++i)this.areas[i].setMinMax();this._setXLabelFormat()},iChart.Charting.Chart.prototype._fixViewportBounds=function(){for(var t,e,i=null,a=0;a<this.areas.length;++a)this.areas[a].name===this.viewport.areaName&&(i=this.areas[a]);null!==i&&(null!==this.viewport.x.min&&null!==this.viewport.x.max&&(t=.7*(this.viewport.x.max-this.viewport.x.min),0<(e=this.viewport.x.max-(i.xSeries.max-i.chart.chartOptions.futureAmount)-t)?(this.viewport.x.min-=e,this.viewport.x.max-=e):0<(e=i.xSeries.min-this.viewport.x.min-t)&&(this.viewport.x.min+=e,this.viewport.x.max+=e)),null!==this.viewport.y.min&&null!==this.viewport.y.max&&(t=.7*(this.viewport.y.max-this.viewport.y.min),0<(e=this.viewport.y.max-i.ySeries.bounds.max-t)?(this.viewport.y.min-=e,this.viewport.y.max-=e):0<(e=i.ySeries.bounds.min-this.viewport.y.min-t)&&(this.viewport.y.min+=e,this.viewport.y.max+=e)))},iChart.Charting.Chart.prototype._mergeData=function(t,e){var i=!1,a=this.areas[0].xSeries,r=a.length;this.chartOptions.futureAmount&&a.splice(-this.chartOptions.futureAmount,this.chartOptions.futureAmount);var s=$.grep(this.getSeriesCollection(),function(t){return t.enableMerge});if(this.chartOptions.futureAmount)for(var n=0;n<s.length;n++)s[n].points.splice(-this.chartOptions.futureAmount,this.chartOptions.futureAmount);if(e.count<0){for(var o=n=t.xSeries.length-1;t.xSeries[n]>a[0]&&0<n;)n--;var h=n;t.xSeries.splice(h,o-h+1);for(var l=t.ySeries.length-1;0<=l;--l)t.ySeries[l].points.splice(h,o-h+1);var c=t.xSeries.length;t.xSeries[t.xSeries.length-1]===a[0]&&(a.splice(0,1),--c,i=!0),null!==this.viewport.x.min&&(this.viewport.x.min+=c),null!==this.viewport.x.max&&(this.viewport.x.max+=c),this.selection&&this.selection.shiftAnchor(c);for(l=t.xSeries.length-1;0<=l;--l)a.splice(0,0,t.xSeries[l])}else{for(var d=a.length,p=d,c=0;a[p-1]>=t.xSeries[0];)p--;a[p]!=t.xSeries[0]&&p!=d&&(c=1),p-=c,a.splice(p,t.xSeries.length);for(l=0;l<t.xSeries.length;++l)a.splice(p+l,0,t.xSeries[l]);for(n=0;n<s.length;n++)s[n].points.splice(p,t.xSeries.length)}if(this.chartOptions.futureAmount)for(var u=60*(e.timeframe||this.env.dataSource.dataSettings.timeframe),n=0;n<this.chartOptions.futureAmount;n++)a.push(a[a.length-1]+u);for(var g=[],f=[],m={},n=0;n<t.ySeries.length;++n)switch((C=t.ySeries[n]).kind){case"HLOC":g.push(C);break;case"TechnicalAnalysis":C.overlay?g.push(C):void 0===m[C.indicatorIndex]?m[C.indicatorIndex]=[C]:m[C.indicatorIndex].push(C);break;case"Volume":f.push(C);break;default:continue}for(var v,y=[],n=0;n<g.length;++n)y.push(g[n]);if(!this.isComparison)for(n=0;n<f.length;++n)y.push(f[n]);for(v in m)if(m.hasOwnProperty(v))for(n=0;n<m[v].length;++n)y.push(m[v][n]);if(s.length>y.length)throw new Error("Y series count mismatch while merging chart data, expected "+s.length+", got "+y.length+".");for(n=0;n<s.length;++n){var C=s[n],x=y[n];if(C.kind===x.kind){if(e.count<0){i&&C.points.splice(0,1);for(l=x.points.length-1;0<=l;--l)C.points.splice(0,0,x.points[l])}else{i&&C.points.pop();for(l=0;l<x.points.length;++l)C.points.splice(p+l,0,x.points[l])}if(this.chartOptions.futureAmount)if(1==C.valuesPerPoint)for(l=0;l<this.chartOptions.futureAmount;l++)C.points.push([null]);else for(l=0;l<this.chartOptions.futureAmount;l++)C.points.push([null,null,null,null])}}for(n=0;n<this.areas.length;++n)this.areas[n].setMinMax();return this._setXLabelFormat(),a.length-r},iChart.Charting.Chart.prototype._mousewheelCallback=function(t){var e,i,a,r,s;this.chartOptions.mousewheelZoom&&(s=$(this.container).offset(),e=t.pageX-s.left,i=t.pageY-s.top,a=this.findAreaAtPosition(e,i),r=t.deltaY,s=t.deltaFactor,null!==a&&(this._zoomInternal(a.area,.2*r*s/53,"x",a.area.getXIndex(e-a.area.innerOffset.left),a.area.getYValue(i-a.area.innerOffset.top)),t.preventDefault()))},iChart.Charting.Chart.prototype.calculateHeight=function(){var t,e,i,a,r,s=this.areas?$.grep(this.areas,function(t){return t.enabled}):[],n=0;if(t=this.chartOptions.uiTools.top?this.env.ui.$topToolBarContainer.height():0,r=this.chartOptions.minHeight&&this.areas?(e=this.chartOptions.minHeight-this.chartOptions.scrollerHeight-t,i=$.grep(s,function(t){return!t.isLayer}).length,a=Math.max(this.chartOptions.minAreaHeight,Math.floor(e/(i+(0===this.chartOptions.scrollerHeight?0:-1)+this.chartOptions.primaryToSecondaryAreaHeightRatio-1))),Math.floor(this.chartOptions.primaryToSecondaryAreaHeightRatio*a)):(a=Math.round(this.chartOptions.primaryAreaHeight/this.chartOptions.primaryToSecondaryAreaHeightRatio),this.chartOptions.primaryAreaHeight),n+=t,this.areas)for(var o=0;o<s.length;++o){var h=s[o];h.isLayer?(h.offset.left=0,h.outerWidth=0,h.outerHeight=a,h.offset.top=r-h.outerHeight):(h.offset.top=n,h.offset.left=0,h.outerWidth=0,h.outerHeight="Scroller"===h.name?this.chartOptions.scrollerHeight:"ChartArea1"===h.name?r:a,h.updateCloseButton(),n+=h.outerHeight+h.margin.bottom)}else n+=r+=this.chartOptions.scrollerHeight;return{height:n,primaryHeight:r}},iChart.Charting.Chart.prototype._positionAreas=function(){if(this.container){var t=$(this.container);!t.length||!this._resized&&this._containerSize.height&&this._containerSize.width||(this._containerSize.height=t.height(),this._containerSize.width=t.width(),this._containerSize.offset=t.offset(),this._resized=!1);var e,i,a,r,s=this._containerSize.height,n=this._containerSize.width,o=$.grep(this.areas,function(t){return t.enabled}),h=0,l=n;e=this.chartOptions.uiTools.top?this.env.ui.$topToolBarContainer.height():0,r=this.chartOptions.minHeight?(i=this.chartOptions.minHeight-this.chartOptions.scrollerHeight-e,u=$.grep(o,function(t){return!t.isLayer}).length,a=Math.max(this.chartOptions.minAreaHeight,Math.floor(i/(u+(0===this.chartOptions.scrollerHeight?0:-1)+this.chartOptions.primaryToSecondaryAreaHeightRatio-1))),Math.floor(this.chartOptions.primaryToSecondaryAreaHeightRatio*a)):(a=Math.round(this.chartOptions.primaryAreaHeight/this.chartOptions.primaryToSecondaryAreaHeightRatio),this.chartOptions.primaryAreaHeight);for(var c=0;c<o.length;++c)(p=o[c]).isLayer?(p.offset.left=0,p.outerWidth=l,p.outerHeight=a,p.offset.top=r-p.outerHeight):(p.offset.top=h,p.offset.left=0,p.outerWidth=l,p.outerHeight="Scroller"===p.name?this.chartOptions.scrollerHeight:"ChartArea1"===p.name?r:a,p.updateCloseButton(),h+=p.outerHeight+p.margin.bottom);var d=this.areas[0];d.axisX.paddingLeft=10,d.axisX.paddingRight=10,d.axisY.paddingTop=this.chartOptions.primaryAreaAxisYpaddingTop,d.axisY.paddingBottom=this.chartOptions.primaryAreaAxisYpaddingBottom,d.padding.bottom=this.chartOptions.areaPaddingBottom,d.padding.left=this.chartOptions.areaPaddingLeft,d.padding.right=this.chartOptions.yLabelsOutside?this.chartOptions.areaPaddingRight:0,d.padding.top=this.chartOptions.areaPaddingTop;for(var p,c=1;c<this.areas.length;++c)switch((p=this.areas[c]).name){case"ChartArea1":break;case"ChartArea2":p.axisX.paddingLeft=d.axisX.paddingLeft,p.axisX.paddingRight=d.axisX.paddingRight,p.axisY.paddingTop=0,p.axisY.paddingBottom=0,p.isLayer?(p.padding.bottom=d.padding.bottom,p.padding.top=d.padding.top):(p.padding.bottom=8,p.padding.top=18),p.padding.left=d.padding.left,p.padding.right=d.padding.right;break;case"Scroller":p.axisX.paddingLeft=d.axisX.paddingLeft,p.axisX.paddingRight=d.axisX.paddingRight,p.axisY.paddingTop=10,p.axisY.paddingBottom=10,p.padding.bottom=32,p.padding.left=d.padding.left,p.padding.right=d.padding.right;break;default:p.axisX.paddingLeft=d.axisX.paddingLeft,p.axisX.paddingRight=d.axisX.paddingRight,p.axisY.paddingTop=10,p.axisY.paddingBottom=10,p.isLayer?(p.padding.bottom=d.padding.bottom,p.padding.top=d.padding.top):(p.padding.bottom=32,p.padding.top=0),p.padding.left=d.padding.left,p.padding.right=d.padding.right}this.positionVolumeByPriceArea();var u=this.onPositionAreas.call(this);u&&(l=u.width||l,h=u.height||h),s=h,h+=e,this.canvas=iChart.Charting.initCanvas(this.container,this.canvas,n,s),t.height(s)}},iChart.Charting.Chart.prototype._selectionMouseDownCallback=function(t){},iChart.Charting.Chart.prototype._selectionMoveStartCallback=function(t){switch(t.moved=!1,t.mode){case"pan":if(t.position1=this.findAreaAtPosition(t.x1,t.y1),null===t.position1)break;var e=t.position1.area;if(t.position1.insideX&&t.position1.insideY){t.resizeScrollerL=e.isScroller&&e.$scrollerOverlayCenterL.data("iChart-hover"),t.resizeScrollerR=e.isScroller&&!t.resizeScrollerL&&e.$scrollerOverlayCenterR.data("iChart-hover");var i=e.isScroller?e.scrollerViewport:e.viewport;t.resizeScrollerR?t.setAnchor((null===this.viewport.x.max||this.viewport.areaName!==e.name?i:this.viewport).x.max,(null===this.viewport.y.min||this.viewport.areaName!==e.name?i:this.viewport).y.min):t.setAnchor((null===this.viewport.x.min||this.viewport.areaName!==e.name?i:this.viewport).x.min,(null===this.viewport.y.min||this.viewport.areaName!==e.name?i:this.viewport).y.min)}else{if(e.isScroller){t.position1=null;break}t.position1.insideX?t.setAnchor(e.getXIndex(t.x1-e.innerOffset.left),null):t.position1.insideY&&t.setAnchor(null,e.getYValue(t.y1-e.innerOffset.top)),t.resizeScrollerL=!1,t.resizeScrollerR=!1}t.resizeScrollerL||t.resizeScrollerR?this.container.style.cursor=this.overlay.defaultCursor="ew-resize":this.container.style.cursor=this.overlay.defaultCursor=MOBILE_BROWSER_DETECTED?"move":"url('"+this.env.lib_path+"/styles/cursors/grabbing.cur'), move";break;case"zoom":t.setAnchor(null,null),this.container.style.cursor=this.overlay.defaultCursor="crosshair";break;case"wait":break;default:throw new Error("Selection mode '"+t.mode+"' is invalid.")}},iChart.Charting.Chart.prototype._selectionMouseMoveCallback=function(t){},iChart.Charting.Chart.prototype._selectionMoveCallback=function(t){switch(t.moved=!0,t.mode){case"pan":if(null===t.position1)break;if(t.position2=this.findAreaAtPosition(t.x2,t.y2),null===t.position2)break;if(t.position2.area!==t.position1.area||t.position2.insideX!==t.position1.insideX||t.position2.insideY!==t.position1.insideY)break;var e,i,a,r=t.position1.area;return t.position1.insideX&&t.position1.insideY?(e=r.isScroller?r.scrollerViewport:r.viewport,i=(r.isScroller?-1:1)*(r.getXIndex(t.x2-r.innerOffset.left)-r.getXIndex(t.x1-r.innerOffset.left)),t.resizeScrollerR?i+=(null===this.viewport.x.max||this.viewport.areaName!==r.name?e:this.viewport).x.max-t.anchorX:i+=(null===this.viewport.x.min||this.viewport.areaName!==r.name?e:this.viewport).x.min-t.anchorX,a=r.isScroller?0:r.getYValue(t.y2-r.innerOffset.top)-r.getYValue(t.y1-r.innerOffset.top)+((null===this.viewport.y.min||this.viewport.areaName!==r.name?e:this.viewport).y.min-t.anchorY),t.resizeScrollerR||(this.viewport.x.max=(null===this.viewport.x.max||this.viewport.areaName!==r.name?e:this.viewport).x.max,1<this.viewport.x.max-((null===this.viewport.x.min||this.viewport.areaName!==r.name?e:this.viewport).x.min-i)&&(this.viewport.x.min=(null===this.viewport.x.min||this.viewport.areaName!==r.name?e:this.viewport).x.min-i)),t.resizeScrollerL||(this.viewport.x.min=(null===this.viewport.x.min||this.viewport.areaName!==r.name?e:this.viewport).x.min,1<(null===this.viewport.x.max||this.viewport.areaName!==r.name?e:this.viewport).x.max-i-this.viewport.x.min&&(this.viewport.x.max=(null===this.viewport.x.max||this.viewport.areaName!==r.name?e:this.viewport).x.max-i)),0!=a&&null!==this.viewport.y.min&&null!==this.viewport.y.max&&(this.viewport.y.min=(this.viewport.areaName===r.name?this.viewport:e).y.min-a,this.viewport.y.max=(this.viewport.areaName===r.name?this.viewport:e).y.max-a),this.viewport.areaName=r.name):(t.position1.insideX?this._zoomInternal(r,3*(t.x2-t.x1)/r.innerWidth,"x",t.anchorX,null):t.position1.insideY&&this._zoomInternal(r,3*(t.y2-t.y1)/r.innerHeight,"y",null,t.anchorY),t.x1=t.x2,t.y1=t.y2),this._fixViewportBounds(),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),this.loadMissingData(),!1;case"zoom":case"wait":return!0;default:throw new Error("Selection mode '"+t.mode+"' is invalid.")}},iChart.Charting.Chart.prototype._selectionMouseUpCallback=function(t){},iChart.Charting.Chart.prototype._selectionMoveEndCallback=function(t){if("pan"===t.mode?this.container.style.cursor=this.overlay.defaultCursor=MOBILE_BROWSER_DETECTED?"move":"url('"+this.env.lib_path+"/styles/cursors/grab.cur'), move":this.container.style.cursor=this.overlay.defaultCursor="crosshair",!t.moved&&!t.position1.insideX&&t.position1.insideY)return this.chartOptions.showCurrentLabel=!this.chartOptions.showCurrentLabel,this.env.wrapper.trigger("iguanaChartEvents",["chartOptionsChanged",{showCurrentLabel:this.chartOptions.showCurrentLabel}]),void this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0});var e="pan"===t.mode?1:20;if(!(Math.abs(t.x2-t.x1)<e&&Math.abs(t.y2-t.y1)<e)&&null!==t.position1&&(t.position2=this.findAreaAtPosition(t.x2,t.y2),null!==t.position2&&t.position2.area===t.position1.area&&t.position2.insideX===t.position1.insideX&&t.position2.insideY===t.position1.insideY)){var i,a=t.position1.area;switch(t.mode){case"pan":t.position1.insideX&&t.position1.insideY?(r=a.isScroller?a.scrollerViewport:a.viewport,i=(a.isScroller?-1:1)*(a.getXIndex(t.x2-a.innerOffset.left)-a.getXIndex(t.x1-a.innerOffset.left)),t.resizeScrollerR?i+=(null===this.viewport.x.max||this.viewport.areaName!==a.name?r:this.viewport).x.max-t.anchorX:i+=(null===this.viewport.x.min||this.viewport.areaName!==a.name?r:this.viewport).x.min-t.anchorX,s=a.isScroller?0:a.getYValue(t.y2-a.innerOffset.top)-a.getYValue(t.y1-a.innerOffset.top)+((null===this.viewport.y.min||this.viewport.areaName!==a.name?r:this.viewport).y.min-t.anchorY),t.resizeScrollerR||(this.viewport.x.max=(null===this.viewport.x.max||this.viewport.areaName!==a.name?r:this.viewport).x.max,1<this.viewport.x.max-((null===this.viewport.x.min||this.viewport.areaName!==a.name?r:this.viewport).x.min-i)&&(this.viewport.x.min=(null===this.viewport.x.min||this.viewport.areaName!==a.name?r:this.viewport).x.min-i)),t.resizeScrollerL||(this.viewport.x.min=(null===this.viewport.x.min||this.viewport.areaName!==a.name?r:this.viewport).x.min,1<(null===this.viewport.x.max||this.viewport.areaName!==a.name?r:this.viewport).x.max-i-this.viewport.x.min&&(this.viewport.x.max=(null===this.viewport.x.max||this.viewport.areaName!==a.name?r:this.viewport).x.max-i)),(t.resizeScrollerL||t.resizeScrollerR)&&null!==this.viewport.x.min&&null!==this.viewport.x.max&&this.viewport.x.min>this.viewport.x.max&&(i=this.viewport.x.min,this.viewport.x.min=this.viewport.x.max,this.viewport.x.max=i),0!=s&&null!==this.viewport.y.min&&null!==this.viewport.y.max&&(this.viewport.y.min=(this.viewport.areaName===a.name?this.viewport:r).y.min-s,this.viewport.y.max=(this.viewport.areaName===a.name?this.viewport:r).y.max-s)):t.position1.insideX?this._zoomInternal(a,(t.x2-t.x1)/a.innerWidth,"x",t.anchorX,null):t.position1.insideY&&this._zoomInternal(a,(t.y2-t.y1)/a.innerHeight,"y",null,t.anchorY),this._fixViewportBounds();break;case"zoom":var r=a.getXIndex((t.x1<t.x2?t.x1:t.x2)-a.innerOffset.left),s=a.getXIndex((t.x1<t.x2?t.x2:t.x1)-a.innerOffset.left);this.viewport.x.min=Math.max(a.xSeries.min,Math.min(r,a.xSeries.max)),this.viewport.x.max=Math.min(a.xSeries.max,s),this.viewport.y.min=a.getYValue((t.y1>t.y2?t.y1:t.y2)-a.innerOffset.top),this.viewport.y.max=a.getYValue((t.y1>t.y2?t.y2:t.y1)-a.innerOffset.top);break;case"wait":break;default:throw new Error("Selection mode '"+t.mode+"' is invalid.")}this.viewport.areaName=a.name,this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),this.loadMissingData(),"pan"==t.mode&&!a.isScroller&&this.chartOptions.inertialScrolling&&this.env.scrollTo(t)}},iChart.Charting.Chart.prototype._setData=function(t,e){if(this.areas)for(var i=0;i<this.areas.length;++i)this.areas[i].dispose();this.areas=[];var a=new iChart.Charting.ChartArea({chart:this,name:"ChartArea1",showLabels:this.showLabels}),r=new iChart.Charting.ChartArea({chart:this,isScroller:!0,name:"Scroller",showLegend:!1}),s=new iChart.Charting.ChartArea({chart:this,name:"ChartArea2",parentName:"outside"===this.chartOptions.showVolume?void 0:a.name,showAxes:"outside"==this.chartOptions.showVolume,showLabels:"outside"==this.chartOptions.showVolume,showLegend:"outside"==this.chartOptions.showVolume,showWatermark:"outside"==this.chartOptions.showVolume}),n=[],o=[],h=[],l={};if(this.chartOptions.futureAmount){for(var c=60*e.timeframe,i=0;i<this.chartOptions.futureAmount;i++)t.xSeries.push(t.xSeries[t.xSeries.length-1]+c);for(i=0;i<t.ySeries.length;i++)if(1==t.ySeries[i].valuesPerPoint)for(var d=0;d<this.chartOptions.futureAmount;d++)t.ySeries[i].points.push([null]);else for(d=0;d<this.chartOptions.futureAmount;d++)t.ySeries[i].points.push([null,null,null,null])}for(var p=0,u=0,i=0;i<t.ySeries.length;++i){switch((T=t.ySeries[i]).isStartedFromZero=!1,T.kind){case"HLOC":T.chartArea=a.name;var g=$.extend([],this.chartOptions.seriesColors);g.splice(0,0,this.chartOptions.lineColor),T.color=g[n.length%g.length],n.push(T),o.push(T);break;case"TechnicalAnalysis":for(var f=T.name.replace(/\s.*$/,""),d=u;d<3;d++)if(u++,e["i"+d]==f){var m=d;break}var v=this.chartOptions.indicatorColors[m],g=this.env.userSettings.chartSettings.indicatorsColor;g[f]&&void 0!==g[f][m]?(g=g[f][m][T.indicatorIndex2%g[f][m].length],T.color=g||v[T.indicatorIndex2%v.length]):T.color=v[T.indicatorIndex2%v.length];v=this.env.userSettings.chartSettings.indicatorsWidth;v[f]&&void 0!==v[f][m][T.indicatorIndex2%v[f][m].length]?T.width=v[f][m][T.indicatorIndex2%v[f][m].length]||2:T.width=2,T.overlay?(T.chartArea=a.name,n.push(T)):(T.chartArea="ChartAreaI"+T.indicatorIndex,void 0===l[T.indicatorIndex]?l[T.indicatorIndex]=[T]:l[T.indicatorIndex].push(T));break;case"Volume":T.chartType="Column",T.color=this.chartOptions.volumeStyle,T.isStartedFromZero=!0,T.chartArea=a.name,T.chartArea=s.name,h.push(T);break;default:continue}T.enableMerge=!0,T.index=p++,4===T.valuesPerPoint?(T.closeValueIndex=3,T.lowValueIndex=1):(T.closeValueIndex=0,T.lowValueIndex=0),T.highValueIndex=0}this.isComparison=1<o.length||this.chartOptions.percentMode;for(var y,C,x,i=0;i<t.ySeries.length;++i){var T,S=(T=t.ySeries[i]).color?T.color.replace(/rgba\((.+),[^,]+\)/,"rgb($1)"):"",A=(A=$("<span/>",{class:"m-chart-legend-color"}).css({"background-color":S}).html("&nbsp;")).add($("<span/>",{class:"m-chart-legend-name"}).css({color:S}).text(T.name)),S=T.name,A=$("<div/>").append(A).html();4===T.valuesPerPoint?(T.dotIndex=3,this.isComparison?T.labels=[[3,A]]:T.labels=[[2,A+"O:"],[0,"H:"],[1,"L:"],[3,"C:"]]):2==T.valuesPerPoint?T.labels=[[1,A+_t("2589","Мин:")],[0,_t("2590","Макс:")]]:T.labels=[[0,A,S]]}if(a.axisX.showLabels=!0,a.enabled=!0,a.xSeries=t.xSeries,a.ySeries=n,this.areas.push(a),r.axisX.showLabels=!0,r.enabled=0!==this.chartOptions.scrollerHeight,r.xSeries=t.xSeries,r.ySeries=o,r.enabled&&this.areas.push(r),!this.isComparison){if(s.enabled=!0,s.enabled){s.enabled=!1;for(i=0;i<h.length;++i)if(h[i].enabled){s.enabled=!0;break}}s.enabled&&(s.axisX.showLabels=!1,s.xSeries=a.xSeries,s.ySeries=h,this.areas.push(s)),s.enabled="inside"===this.chartOptions.showVolume||"outside"===this.chartOptions.showVolume}for(y in l)l.hasOwnProperty(y)&&((C=new iChart.Charting.ChartArea({chart:this})).axisX.showLabels=!1,C.enabled=!0,C.xSeries=a.xSeries,C.ySeries=l[y],C.name=C.ySeries[0].chartArea,x=this,C.onClose=function(){x.clearIndicators(this)},this.areas.push(C));this.createValueByPriceArea(),this.onCreateAreas.call(this,t,e);for(i=0;i<this.areas.length;++i)this.areas[i].setMinMax();return this._setXLabelFormat(),t.xSeries.length},iChart.Charting.Chart.prototype.createValueByPriceArea=function(){var a=this,t=new iChart.Charting.ChartArea({chart:this,ignoreViewport:!0,name:"VolumeByPriceArea",onCalculateViewport:function(t){function e(t,e){return t.min+(t.max-t.min)*(t[t.min]-e)/(t[t.min]-t[t.max])}var i=a.areas[0].viewport;return t.x.min=e(this.xSeries,i.y.max),t.x.max=e(this.xSeries,i.y.min),t.x.bounded.min=Math.max(this.xSeries.min,Math.floor(t.x.min)),t.x.bounded.max=Math.min(this.xSeries.max,Math.ceil(t.x.max)),t},parentName:"ChartArea1",showAxes:!1,showLabels:!1,showLegend:!1,showWatermark:!1});t.axisX.showLabels=!0,t.enabled=this.chartOptions.showVolumeByPrice,t.rotate=!0,t.ySeries=[{chartType:"Column",closeValueIndex:0,color:this.chartOptions.volumeStyle,enabled:!0,enableMerge:!1,formatProvider:{decimalPlaces:"2",decimalPrecision:null},highValueIndex:0,isStartedFromZero:!0,kind:"Other",lowValueIndex:0,name:"V(Price)",valuesPerPoint:1}],t.xSeries=[],t.ySeries[0].points=[],this.chartOptions.showVolumeByPrice&&this.updateVolumeByPrice();var e=$.grep(this.areas,function(t){return"VolumeByPriceArea"===t.name})[0];e&&t.enabled&&(e.enabled=!1),this.areas.push(t)},iChart.Charting.Chart.prototype.updateVolumeByPrice=function(){if(this.chartOptions.showVolumeByPrice){for(var t=0,e=this.areas[0].viewport.y.max,i=Math.floor(this.areas[0].viewport.x.min);i<=Math.ceil(this.areas[0].viewport.x.max);i++)this.areas[0]&&this.areas[0].ySeries[0]&&this.areas[0].ySeries[0].points[i]&&(t<this.areas[0].ySeries[0].points[i][0]&&(t=this.areas[0].ySeries[0].points[i][0]),e>this.areas[0].ySeries[0].points[i][1]&&(e=this.areas[0].ySeries[0].points[i][1]));for(var a=(t-e)/50,r={},i=Math.floor(this.areas[0].viewport.x.min);i<=Math.ceil(this.areas[0].viewport.x.max);i++)void(r[i]=0)!==this.areas[2].ySeries&&(this.areas[2].ySeries[0].points[i]&&this.areas[0].ySeries[0].points[i]&&this.areas[0].ySeries[0].points[i][0]-this.areas[0].ySeries[0].points[i][1]!=0?r[i]=this.areas[2].ySeries[0].points[i][0]/(this.areas[0].ySeries[0].points[i][0]-this.areas[0].ySeries[0].points[i][1])*a:this.areas[2].ySeries[0].points[i]&&this.areas[0].ySeries[0].points[i]&&this.areas[0].ySeries[0].points[i][0]-this.areas[0].ySeries[0].points[i][1]==0&&(r[i]=this.areas[2].ySeries[0].points[i][0]));for(var s=[],n=[],o=t;e<o;o-=a){s.push(o);for(var h,l,c=0,i=Math.floor(this.areas[0].viewport.x.min);i<=Math.ceil(this.areas[0].viewport.x.max);i++)this.areas[0].ySeries[0].points[i]&&(h=this.areas[0].ySeries[0].points[i][0],l=this.areas[0].ySeries[0].points[i][1],(h<o&&o-a<h||l<o&&o-a<l||o<h&&l<o-a)&&(c+=r[i]));n.push([c])}var d=$.grep(this.areas,function(t){return"VolumeByPriceArea"===t.name})[0];d&&(d.enabled=!0,d.xSeries=s,d.ySeries[0].points=n,d.setMinMax(),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))}},iChart.Charting.Chart.prototype.positionVolumeByPriceArea=function(){var t,e=$.grep(this.areas,function(t){return"VolumeByPriceArea"===t.name})[0];e&&(t=this.areas[0],e.axisX.paddingLeft=t.axisY.paddingTop,e.axisX.paddingRight=t.axisY.paddingBottom,e.axisX.pointPadding=0,e.axisY.paddingTop=0,e.axisY.paddingBottom=0,e.enabled=this.chartOptions.showVolumeByPrice,e.outerHeight=t.outerHeight,e.outerWidth=Math.round(t.outerWidth/5),e.offset.top=t.offset.top)},iChart.Charting.Chart.prototype._setXLabelFormat=function(){var t=this.areas[0];t.xSeries.min>t.xSeries.max||(new Date,new Date(1e3*t.xSeries[t.xSeries.min]),this.showTime()?this.dateFormat="HH:mm\r\nd MMM":this.dateFormat="d MMM\r\nyyyy")},iChart.Charting.Chart.prototype._testForIntervalChange=function(t){var e,i,a,r,s;this._dataSettings&&(e=this.areas[0],i=this._dataSettings.start,a=this._dataSettings.end,r=e.xSeries[e.viewport.x.bounded.min],s=e.xSeries[e.viewport.x.bounded.max],this._dataSettings.start=r&&(e.viewport.x.bounded.min!==e.xSeries.min||this._dataStart)?new Date(1e3*r):null,this._dataSettings.end=s&&(e.viewport.x.bounded.max!==e.xSeries.max||this._dataEnd)?new Date(1e3*s):null,void 0!==i&&(!this._dataSettings.start!=!i||!this._dataSettings.end!=!a||this._dataSettings.start&&this._dataSettings.start.getTime()!==i.getTime()||this._dataSettings.end&&this._dataSettings.end.getTime()!==a.getTime())&&(this.onDataSettingsChange.call(this,t),this.onIntervalChange.call(this,this._dataSettings.start,this._dataSettings.end)))},iChart.Charting.Chart.prototype._zoomInternal=function(t,e,i,a,r){if(!t){for(var s=0;s<this.areas.length;++s)this.areas[s].name===this.viewport.areaName&&(t=this.areas[s]);t=t||this.areas[0]}var n;"Scroller"!==t.name?(this.viewport.areaName!==t.name&&(this.viewport.y.min=null,this.viewport.y.max=null),this.viewport.areaName=t.name,"y"!==i&&(null===this.viewport.x.min&&(this.viewport.x.min=t.viewport.x.bounded.min),null===this.viewport.x.max&&(this.viewport.x.max=t.viewport.x.bounded.max),$.isNumeric(a)||(a=(this.viewport.x.min+this.viewport.x.max)/2),t.xSeries.min<t.xSeries.max&&this.viewport.x.min<this.viewport.x.max&&(e<0?e=Math.max(e,1-(t.xSeries.max-t.xSeries.min)/(.3*(this.viewport.x.max-this.viewport.x.min))):0<e&&(e=Math.min(e,1-(t.xSeries.max-t.xSeries.min)/(1e3*(this.viewport.x.max-this.viewport.x.min)))))),"x"!==i&&(null===this.viewport.y.min&&(this.viewport.y.min=t.viewport.y.min),null===this.viewport.y.max&&(this.viewport.y.max=t.viewport.y.max),$.isNumeric(r)||(r=(this.viewport.y.min+this.viewport.y.max)/2),t.ySeries.bounds.min<t.ySeries.bounds.max&&(e<0?e=Math.max(e,1-(t.ySeries.bounds.max-t.ySeries.bounds.min)/(.3*(this.viewport.y.max-this.viewport.y.min))):0<e&&(e=Math.min(e,1-(t.ySeries.bounds.max-t.ySeries.bounds.min)/(1e3*(this.viewport.y.max-this.viewport.y.min)))))),"y"!==i&&(n=this.viewport.x.max-e*(this.viewport.x.max-a)-(this.viewport.x.min+e*(a-this.viewport.x.min)),(0<this.chartOptions.maxZoom&&n>=this.chartOptions.maxZoom||e<0||0==this.chartOptions.maxZoom)&&(this.viewport.x.min+=e*(a-this.viewport.x.min))),"x"!==i&&(this.viewport.y.min+=e*(r-this.viewport.y.min),this.viewport.y.max-=e*(this.viewport.y.max-r))):(this.viewport.areaName!==t.name&&(this.viewport.y.min=null,this.viewport.y.max=null),this.viewport.areaName=t.name,null===this.viewport.x.min&&(this.viewport.x.min=t.scrollerViewport.x.bounded.min),null===this.viewport.x.max&&(this.viewport.x.max=t.scrollerViewport.x.bounded.max),a=(this.viewport.x.max-this.viewport.x.min)/10,i=0<e?1:-1,r=t.viewport.x.bounded.max-t.chart.chartOptions.futureAmount+5*(this.viewport.x.max-this.viewport.x.min)/10,e=t.viewport.x.bounded.min-5*(this.viewport.x.max-this.viewport.x.min)/10,(this.viewport.x.max<r||-1==i)&&(this.viewport.x.min>e||1==i)&&(this.viewport.x.min+=i*a,this.viewport.x.max+=i*a)),this.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),this.loadMissingData()}}(),function(){"use strict";iChart.Charting.ChartArea=function(t){var e;this.axisX={},this.axisX.paddingLeft=0,this.axisX.paddingRight=0,this.axisX.pointPadding=.5,this.axisY={},this.axisY.PaddingTop=0,this.axisY.PaddingBottom=0,this.chart=t.chart,this.ignoreViewport=!!t.ignoreViewport,this.innerHeight=0,this.innerWidth=0,this.innerOffset={},this.innerOffset.left=0,this.innerOffset.top=0,this.isLayer=!!t.parentName,this.isScroller=!!t.isScroller,this.margin={},this.margin.bottom=0,this.name=t.name,this.offset={},this.offset.left=0,this.offset.top=0,this.onCalculateViewport=t.onCalculateViewport||$.noop,this.outerHeight=0,this.outerWidth=0,this.padding={},this.padding.top=0,this.padding.right=0,this.padding.bottom=0,this.padding.left=0,this.parentName=t.parentName,this.rotate=!!t.rotate,this.scrollerViewport=null,this.showAxes=void 0===t.showAxes||!!t.showAxes,this.showLabels=void 0===t.showLabels||!!t.showLabels,this.showLegend=void 0===t.showLegend||!!t.showLegend,this.showWatermark=void 0===t.showWatermark||!!t.showWatermark,this.viewport={},this.viewport.x={},this.viewport.x.bounded={},this.viewport.y={},this.xSeries=null,this.ySeries=[],this.isScroller&&($(this.chart.container).find("div.m-chart-scrollerOverlay").remove(),this.$scrollerOverlay=$("<div class='m-chart-scrollerOverlay'/>").css({position:"absolute","z-index":1}).appendTo(this.chart.container),this.$scrollerOverlayRight=$("<div class='js-scrollerOverlay m-chart-scrollerOverlayRight'/>").hide().css({}).appendTo(this.$scrollerOverlay),this.$scrollerOverlayCenter=$("<div/>").hide().css({position:"absolute","z-index":1}).appendTo(this.$scrollerOverlay),this.$scrollerOverlayCenterR=$("<div/>",{text:"|",class:"js-scrollerHandler m-chart-scrollerOverlayHandle"}).hide().css({}).appendTo(this.$scrollerOverlay),this.$scrollerOverlayCenterR.hover(function(){$(this).data("iChart-hover",!0)},function(){$(this).removeData("iChart-hover")}).attr("unselectable","on").css("user-select","none").on("selectstart",!1),this.$scrollerOverlayCenterL=$("<div />",{text:"|",class:"js-scrollerHandler m-chart-scrollerOverlayHandle"}).hide().css({}).appendTo(this.$scrollerOverlay),this.$scrollerOverlayCenterL.hover(function(){$(this).data("iChart-hover",!0)},function(){$(this).removeData("iChart-hover")}).attr("unselectable","on").css("user-select","none").on("selectstart",!1),this.$scrollerOverlayLeft=$("<div class='js-scrollerOverlay m-chart-scrollerOverlayLeft'/>").hide().css({}).appendTo(this.$scrollerOverlay),$(this.chart.container).find("div.m-chart-scrollforward").remove(),(e=this).$scrollForward=$("<div class='m-chart-scrollforward m-chart-btn' style='min-width: 40px; width:40px; background: #777777; transition: all 0ms'; ><span class='uk-icon-step-forward'></span></div>").hide().appendTo(this.$scrollerOverlay).click(function(){e.chart.env.scrollForward()}))},iChart.Charting.ChartArea.prototype.calculateInnerDimensions=function(t){var e;this.isScroller?(this.scrollerViewport=this._calculateViewport(t),this.viewport=this._calculateViewport()):this.viewport=this._calculateViewport(t),this.viewport&&(this.innerOffset.left=this.offset.left+this.padding.left,this.innerOffset.top=this.offset.top+this.padding.top,this.innerWidth=this.outerWidth-this.padding.left-this.padding.right,this.innerHeight=this.outerHeight-this.padding.top-this.padding.bottom,this.rotate?(this.axisX.length=this.innerHeight,this.axisY.length=this.innerWidth):(this.axisX.length=this.innerWidth,this.axisY.length=this.innerHeight),e=this.axisX.paddingLeft*(this.viewport.x.max-this.viewport.x.min+2*this.axisX.pointPadding)/(this.axisX.length-2*this.axisX.paddingLeft),t=this.axisX.paddingRight*(this.viewport.x.max-this.viewport.x.min+2*this.axisX.pointPadding)/(this.axisX.length-2*this.axisX.paddingRight),this.axisX.min=this.viewport.x.min-this.axisX.pointPadding-e,this.axisX.max=this.viewport.x.max+this.axisX.pointPadding+t,this.axisX.pointWidth=Math.min(Math.max(0,Math.floor(.4*this.axisX.length/(this.viewport.x.max-this.viewport.x.min+1))),50),e=this.axisY.paddingTop*(this.viewport.y.max-this.viewport.y.min)/(this.axisY.length-2*this.axisY.paddingTop),t=this.axisY.paddingBottom*(this.viewport.y.max-this.viewport.y.min)/(this.axisY.length-2*this.axisY.paddingBottom),this.axisY.min=this.viewport.y.min-t,this.axisY.max=this.viewport.y.max+e,this.axisX.scale=this.axisX.length/(this.axisX.max-this.axisX.min),this.axisY.scale=this.axisY.min===this.axisY.max?0:this.axisY.length/(this.axisY.max-this.axisY.min),this.axisY.zeroPosition=Math.round(this.getYPosition(0,!1)),this.isScroller&&(t=Math.round(this.getXPositionByIndex(this.scrollerViewport.x.bounded.min)),e=Math.round(this.getXPositionByIndex(this.scrollerViewport.x.bounded.max)),this.$scrollerOverlayLeft.show().width(t).height(this.innerHeight).css({left:this.innerOffset.left+"px",top:this.innerOffset.top+"px"}),this.$scrollerOverlayCenter.show().width(e-t).height(this.innerHeight).css({left:this.innerOffset.left+t+"px",top:this.innerOffset.top+"px"}),this.$scrollerOverlayCenterL.show().css({left:this.innerOffset.left+t-5+"px",top:this.innerOffset.top+this.innerHeight/2-11+"px"}),this.$scrollerOverlayCenterR.show().css({left:this.innerOffset.left+e-5+"px",top:this.innerOffset.top+this.innerHeight/2-11+"px"}),this.$scrollerOverlayRight.show().width(this.innerWidth-e).height(this.innerHeight).css({left:this.innerOffset.left+e+"px",top:this.innerOffset.top+"px"}),this.scrollerViewport.x.bounded.max<this.xSeries.length-1-this.chart.chartOptions.futureAmount?(this.$scrollForward.width(this.innerHeight),this.$scrollForward.fadeIn().css({width:"40px","min-width":"40px",left:this.innerWidth+this.innerOffset.left-this.$scrollForward.width()-10+"px",top:this.innerOffset.top+"px"})):this.$scrollForward.fadeOut()))},iChart.Charting.ChartArea.prototype.dispose=function(){this.isScroller&&(this.$scrollerOverlayLeft.remove(),delete this.$scrollerOverlayLeft,this.$scrollerOverlayCenter.remove(),delete this.$scrollerOverlayCenter,this.$scrollerOverlayCenterL.remove(),delete this.$scrollerOverlayCenterL,this.$scrollerOverlayCenterR.remove(),delete this.$scrollerOverlayCenterR,this.$scrollerOverlayRight.remove(),delete this.$scrollerOverlayRight),this.$closeButton&&(this.$closeButton.remove(),delete this.$closeButton)},iChart.Charting.ChartArea.prototype.getXIndex=function(t){return this.axisX.min+t/this.axisX.scale},iChart.Charting.ChartArea.prototype.getXPositionByIndex=function(t){return this.axisX.scale*(t-this.axisX.min)},iChart.Charting.ChartArea.prototype.getXIndexByValue=function(t){if(!$.isNumeric(t))return NaN;if(this.xSeries.min>this.xSeries.max)return NaN;if(t<this.xSeries[this.xSeries.min]||t>this.xSeries[this.xSeries.max])return t>this.xSeries[this.xSeries.max]?this.xSeries.max+(t-this.xSeries[this.xSeries.max])/(this.xSeries[this.xSeries.max]-this.xSeries[this.xSeries.max-1]):NaN;var e=iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.xSeries,t);return-1===e?NaN:(e!==this.xSeries.min&&(e-=(this.xSeries[e]-t)/(this.xSeries[e]-this.xSeries[e-1])),e)},iChart.Charting.ChartArea.prototype.getXIndexByValue2=function(t){if(!$.isNumeric(t))return NaN;if(this.xSeries.min>this.xSeries.max)return NaN;if(t<this.xSeries[this.xSeries.min])return this.xSeries.min;if(t>this.xSeries[this.xSeries.max])return this.xSeries.max;var e=iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.xSeries,t);return-1===e?NaN:(e!==this.xSeries.min&&(e-=(this.xSeries[e]-t)/(this.xSeries[e]-this.xSeries[e-1])),e)},iChart.Charting.ChartArea.prototype.getXPositionByValue=function(t){t=this.getXIndexByValue(t);return isNaN(t)?NaN:this.getXPositionByIndex(t)},iChart.Charting.ChartArea.prototype.getXValue=function(t){var e=this.getXIndex(t),i=Math.floor(e),t=Math.ceil(e);if(!(t<this.xSeries.min))return i<this.xSeries.min?this.xSeries[t]:t>this.xSeries.max?this.xSeries[this.xSeries.max]+(e-this.xSeries.max)*(this.xSeries[this.xSeries.max]-this.xSeries[this.xSeries.max-1]):i===t?this.xSeries[i]:this.xSeries[i]+(e-i)*(this.xSeries[t]-this.xSeries[i])},iChart.Charting.ChartArea.prototype.getYMinMax=function(t,e){for(var i={isStartedFromZero:!1,min:null,max:null},a=0;a<this.ySeries.length;++a){var r=this.ySeries[a],s=r.points;if(i.isStartedFromZero=i.isStartedFromZero||r.isStartedFromZero,this.chart.isComparison&&"TA_LIB"!=r.kind){r.multiplier=0;for(var n,o=t;o<=e;++o)null!=(h=s[o])&&(null!==(n=h[r.closeValueIndex])&&(n=r.multiplier?r.multiplier*n-100:(r.multiplier=100/n,0),null===i.min?i.min=n:i.min=Math.min(i.min,n),null===i.max?i.max=n:i.max=Math.max(i.max,n)))}else for(var h,o=t;o<=e;++o)null!=(h=s[o])&&(null===i.min?i.min=h[r.lowValueIndex]:null!==h[r.lowValueIndex]&&(i.min=Math.min(i.min,h[r.lowValueIndex])),null===i.max?i.max=h[r.highValueIndex]:i.max=Math.max(i.max,h[r.highValueIndex]))}if("ChartArea1"==this.name)for(var l=["HorizontalLine"],c=this.chart.overlay.history,a=0;a<c.length;a++){var d=c[a];if(!(0<=$.inArray(d.elementType,l))){for(var p=!1,o=0;o<d.points.length;o++)if(d.points[o].x>=1e3*this.xSeries[t]&&d.points[o].x<=1e3*this.xSeries[e]||d.positionAbsolute)p=!0;else if(d.points[o].x<this.xSeries[0]||d.points[o].x>this.xSeries[this.xSeries.length-1]){p=!1;break}if(p)for(var u,o=0;o<d.points.length;o++)d.points[o].y&&(u=this.chart.isComparison&&"TA_LIB"!=r.kind&&this.ySeries[0].points.length?100*(d.points[o].y/this.ySeries[0].points[t][3]-1):d.points[o].y,i.max=Math.max(i.max,u),i.min=Math.min(i.min,u))}}var g;return(g=i).isStartedFromZero&&(null!==g.min&&0<g.min?g.min=0:null!==g.max&&g.max<0&&(g.max=0)),i},iChart.Charting.ChartArea.prototype.getYPosition=function(t){return 0===this.axisY.scale?.5*this.axisY.length:this.axisY.scale*(this.axisY.max-t)},iChart.Charting.ChartArea.prototype.getYValue=function(t){return 0===this.axisY.scale?this.axisY.max:this.axisY.max-t/this.axisY.scale},iChart.Charting.ChartArea.prototype.setMinMax=function(){this.xSeries.min=0,this.xSeries.max=this.xSeries.length-1,this.ySeries.bounds=this.getYMinMax(this.xSeries.min,this.xSeries.max)},iChart.Charting.ChartArea.prototype.updateCloseButton=function(){this.onClose&&(this.$closeButton||(this.$closeButton=$("<button/>",{class:"m-chart-area-close",text:"×",title:"Скрыть"}).appendTo(this.chart.container),this.$closeButton.on("click",$.proxy(this.onClose,this))),this.$closeButton.css({top:this.offset.top+"px"}))},iChart.Charting.ChartArea.prototype._calculateViewport=function(t){if(0===this.xSeries.length)return null;var e,i,a,r={x:{}};return r.x.bounded={},r.y={},this.ignoreViewport||!t?(r.x.min=this.xSeries.min,r.x.bounded.min=this.xSeries.min):null===t.x.min?(-1===(i=(e=this.chart._dataSettings.start)?iChart.Charting.indexOfFirstElementGreaterThanOrEqualTo(this.xSeries,Math.round(e.getTime()/1e3)):0)&&(console.warn("Start date/time '"+e.toString()+"' is outside the bounds of the data."),i=0),r.x.min=i,r.x.bounded.min=i):(r.x.min=t.x.min,r.x.bounded.min=Math.max(this.xSeries.min,Math.floor(t.x.min))),this.ignoreViewport||!t?(r.x.max=this.xSeries.max,r.x.bounded.max=this.xSeries.max):null===t.x.max?this.chart._dataSettings.end?(i=this.chart._dataSettings.end,-1===(a=iChart.Charting.indexOfLastElementLessThanOrEqualTo(this.xSeries,Math.round(i.getTime()/1e3)))&&(console.error("End date/time '"+i.toString()+"' is outside the bounds of the data."),a=this.xSeries.length-1),r.x.max=a,r.x.bounded.max=a):(r.x.max=this.xSeries.max,r.x.bounded.max=this.xSeries.max):(r.x.max=t.x.max,r.x.bounded.max=Math.min(this.xSeries.max,Math.ceil(t.x.max))),this.ignoreViewport||!t?(r.y.min=this.ySeries.bounds.min,r.y.max=this.ySeries.bounds.max):(r.y.min=t.y.min,r.y.max=t.y.max,null!==r.y.min&&null!==r.y.max||(r.x.bounded.min===this.xSeries.min&&r.x.bounded.max===this.xSeries.max?(null===t.y.min&&(r.y.min=this.ySeries.bounds.min),null===t.y.max&&(r.y.max=this.ySeries.bounds.max)):(a=this.getYMinMax(r.x.bounded.min,r.x.bounded.max),null===t.y.min&&(r.y.min=a.min),null===t.y.max&&(r.y.max=a.max)))),this.ySeries.bounds.isStartedFromZero&&(null!==r.y.min&&0<r.y.min?null===t.y.min&&(r.y.min=0):null!==r.y.max&&r.y.max<0&&null===t.y.max&&(r.y.max=0)),r=this.onCalculateViewport.call(this,r)||r}}(),function(){"use strict";iChart.Charting.ChartRenderer=function(t){this.chart=t},iChart.Charting.ChartRenderer.prototype.formatDateTime=function(t){t=new Date(1e3*t);return iChart.formatDateTime(t,this.chart.dateFormat)},iChart.Charting.ChartRenderer.prototype.formatNumber=function(t,e){e=iChart.formatNumber(t,e);return this.chart.isComparison&&(0<t&&(e="+"+e),e+="%"),e},iChart.Charting.ChartRenderer.prototype.renderArea=function(t,e){var i;t.enabled&&(e.save(),e.translate(t.innerOffset.left,t.innerOffset.top),t.rotate&&e.transform(0,1,-1,0,t.innerWidth,0),t.showAxes&&this.chart.chartOptions.showAxes&&this.renderAxes(t,e),"ChartArea1"==t.name&&(e.fillStyle=this.chart.chartOptions.watermarkColor,e.font=this.chart.chartOptions.watermarkFont,e.textAlign="left",e.textBaseline="bottom",this.chart.chartOptions.watermarkShow&&(i=(t.innerWidth-e.measureText(this.chart.chartOptions.watermarkText).width)/2,e.fillText(this.chart.chartOptions.watermarkText,i,t.innerHeight/2-5),e.font=this.chart.chartOptions.watermarkSubFont,i=(t.innerWidth-e.measureText(this.chart.chartOptions.watermarkSubText).width)/2,e.fillText(this.chart.chartOptions.watermarkSubText,i,t.innerHeight/2+45))),t.title&&(e.fillStyle=this.chart.chartOptions.watermarkColor,e.font=this.chart.chartOptions.watermarkFont,e.textAlign="left",e.textBaseline="bottom",this.chart.chartOptions.watermarkShow&&(i=(t.innerWidth-e.measureText(t.title).width)/2,e.fillText(t.title,i,t.innerHeight/2-5))),0!==t.xSeries.length&&0!==t.ySeries.length&&(t.showLabels&&(this.renderXLabels(t,e),this.renderYLabels(t,e)),this.renderSeriesCollection(t,e),"ChartArea1"==t.name&&t.chart.chartOptions.showCurrentLabel&&this.renderCurrentLabel(t,e)),e.restore())},iChart.Charting.ChartRenderer.prototype.renderCurrentLabel=function(t,e){var i,a=t.innerWidth,r=!1,s=!1;this.chart.isComparison?(h=iChart.Charting.getNearestNotNullIndex(t.ySeries[0].points,t.viewport.x.bounded.min),i=iChart.Charting.getNearestNotNullIndex(t.ySeries[0].points,t.ySeries[0].points.length-t.chart.chartOptions.futureAmount-1),h=t.ySeries[0].points[i]&&t.ySeries[0].points[h]?100*(t.ySeries[0].points[i][3]/t.ySeries[0].points[h][3]-1):0):(h=(o=t.ySeries[0].points[t.ySeries[0].points.length-t.chart.chartOptions.futureAmount-1])&&o[3]?o[3]:0,o&&o[4]&&o[5]&&(s=Math.round(t.getYPosition(o[4],!1)),r=Math.round(t.getYPosition(o[5],!1))));var n,o=Math.round(t.getYPosition(h,!1)),t=this.formatNumber(h,{decimalPrecision:this.chart.labelPrecision,scale:0}),h=parseFloat(t.replace(/ /g,""));null!=this.labelValue&&h<this.labelValue?(n="#f44336",this.labelColor="#f44336"):null!=this.labelValue&&h>this.labelValue?(n="#7cb342",this.labelColor="#7cb342"):n=this.labelColor||"#333",this.labelValue=h,r&&s?this.drawLable(e,n,"#FFFFFF",a,o,t,{bidY:r,offerY:s}):this.drawLable(e,n,"#FFFFFF",a,o,t)},iChart.Charting.ChartRenderer.prototype.drawLable=function(t,e,i,a,r,s,n){e=e||"#333333",i=i||"#FFFFFF",t.save(),t.font="normal 11px Arial,Helvetica,sans-serif",t.textAlign="left",t.textBaseline="middle",t.fillStyle=e,t.strokeStyle=e,t.fillRect(a+8,r-8,t.measureText(s).width+10,15),t.beginPath(),t.moveTo(a+8,r-8),t.lineTo(a+8,r+7),t.lineTo(a,r),t.lineTo(a+8,r-8),t.lineTo(a+8,r+7),t.closePath(),t.fill(),t.fillStyle=i,t.fillText(s,a+8,r),t.translate(.5,.5),t.beginPath(),t.lineWidth=1,t.moveTo(0,r),t.lineTo(a,r),t.stroke(),t.closePath(),n&&(t.beginPath(),t.fillStyle="#f44336",t.moveTo(a-4,n.bidY-4),t.lineTo(a-4,n.bidY+3),t.lineTo(a,n.bidY),t.lineTo(a-4,n.bidY-4),t.lineTo(a-4,n.bidY+3),t.fill(),t.closePath(),t.beginPath(),t.fillStyle="#7cb342",t.moveTo(a-4,n.offerY-4),t.lineTo(a-4,n.offerY+3),t.lineTo(a,n.offerY),t.lineTo(a-4,n.offerY-4),t.lineTo(a-4,n.offerY+3),t.fill(),t.closePath()),t.restore()},iChart.Charting.ChartRenderer.prototype.renderAxes=function(t,e){e.save(),e.translate(.5,.5),e.strokeStyle=this.chart.chartOptions.axisColor,e.beginPath(),e.moveTo(0,0),e.lineTo(t.axisX.length,0),e.lineTo(t.axisX.length,t.axisY.length),e.lineTo(0,t.axisY.length),e.closePath(),e.stroke(),e.restore()},iChart.Charting.ChartRenderer.prototype.renderChart=function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=this.chart.chartOptions.backgroundColor,t.fillRect(0,0,t.canvas.width,t.canvas.height);for(var e=0;e<this.chart.areas.length;++e){this.chart.areas[e];this.renderArea(this.chart.areas[e],t),void 0!==this.chart.areas[e].overlay&&this.chart.areas[e].overlay.update(this.chart.areas[e])}},iChart.Charting.ChartRenderer.prototype.renderLegends=function(t){for(var e=0;e<this.chart.areas.length;++e){var i=this.chart.areas[e];if(i.showLegend&&!i.rotate&&!(i.viewport.x.bounded.min>i.viewport.x.bounded.max)){t.save(),t.translate(i.innerOffset.left,i.innerOffset.top-3),t.fillStyle="#000000",t.font="11px Tahoma",t.textAlign="left",t.textBaseline="bottom";var a=new Date(1e3*i.xSeries[i.viewport.x.bounded.max]),a=iChart.formatDateTime(a,this.chart.showTime()?"dd.MM.yyyy HH:mm":"dd.MM.yyyy");t.fillText(a,0,0);var r=t.measureText(a);t.translate(r.width+7,0);for(var s=i.ySeries.slice(0),n=0;n<this.chart.areas.length;++n)this.chart.areas[n].parentName!==i.name||this.chart.areas[n].rotate||(s=s.concat(this.chart.areas[n].ySeries));for(n=0;n<s.length;++n){var o,h=s[n];t.fillStyle=h.color.replace(/rgba\((.+),[^,]+\)/,"rgb($1)"),t.beginPath(),t.arc(6,-6,6,0,2*Math.PI,!0),t.closePath(),t.fill(),t.translate(19,0),t.font="bold 11px Tahoma",t.fillText(h.name,0,0),r=t.measureText(h.name),t.translate(r.width+7,0),o=4===h.valuesPerPoint?[[2,"O: "],[0,"H: "],[1,"L: "],[3,"C: "]]:2==h.valuesPerPoint?[[1,"Мин: "],[0,"Макс: "]]:[[0,""]],t.fillStyle="#000000",t.font="11px Tahoma";for(var l=0;l<o.length;++l){var c=o[l][0],d=o[l][1],p=h.points[i.viewport.x.bounded.max];p&&(d+=iChart.formatNumber(p[c],h.formatProvider),t.fillText(d,0,0),r=t.measureText(d),t.translate(r.width+7,0))}}t.restore()}}},iChart.Charting.ChartRenderer.prototype.renderPoint=function(t,e,i,a,r){var s=e.points[i];if(s)switch(e.chartType){case"Candlestick":case"Stock":if(!(s[0]||s[1]||s[2]||s[3]))return;var n=Math.round(t.getXPositionByIndex(i)),o=Math.round(t.getYPosition(s[0],e.inline)),h=Math.round(t.getYPosition(s[1],e.inline));if(0===t.axisX.pointWidth){a.moveTo(n,h),a.lineTo(n,o);break}var l,c,d=Math.round(t.getYPosition(s[2],e.inline)),p=Math.round(t.getYPosition(s[3],e.inline));"Candlestick"===e.chartType?(a.save(),s[2]<s[3]?(l=d,c=p,t.chart.chartOptions.candleUp&&(a.fillStyle=t.chart.chartOptions.candleUp),t.chart.chartOptions.candleBorder?a.strokeStyle=t.chart.chartOptions.candleBorderUp:a.strokeStyle=a.fillStyle,a.fillRect(n-t.axisX.pointWidth,c,2*t.axisX.pointWidth,l-c)):(l=p,c=d,t.chart.chartOptions.candleDown&&(a.fillStyle=t.chart.chartOptions.candleDown),a.fillRect(n-t.axisX.pointWidth,c,2*t.axisX.pointWidth,l-c),t.chart.chartOptions.candleBorder?a.strokeStyle=t.chart.chartOptions.candleBorderDown:a.strokeStyle=a.fillStyle),a.strokeRect(n-t.axisX.pointWidth,c,2*t.axisX.pointWidth,l-c),a.restore(),t.chart.chartOptions.candleWick&&(a.strokeStyle=t.chart.chartOptions.candleWickStyle,a.moveTo(n,o),a.lineTo(n,c),a.moveTo(n,l),a.lineTo(n,h))):(s[2]<s[3]?t.chart.chartOptions.stockUp?a.strokeStyle=t.chart.chartOptions.stockUp:e.upStyle&&(a.strokeStyle=e.color):t.chart.chartOptions.stockDown?a.strokeStyle=t.chart.chartOptions.stockDown:e.upStyle&&(a.strokeStyle=e.color),t.chart.chartOptions.stockWidth&&(a.lineWidth=t.chart.chartOptions.stockWidth),a.beginPath(),a.moveTo(n,h),a.lineTo(n,o),a.moveTo(n,d),a.lineTo(n-t.axisX.pointWidth,d),a.moveTo(n,p),a.lineTo(n+t.axisX.pointWidth,p),a.stroke());break;case"Column":if(s[e.closeValueIndex]){n=Math.round(t.getXPositionByIndex(i)),p=Math.round(t.getYPosition(s[e.closeValueIndex],e.inline));if(0===t.axisX.pointWidth){a.moveTo(n,t.axisY.zeroPosition),a.lineTo(n,p);break}a.fillRect(n-t.axisX.pointWidth,Math.min(t.axisY.zeroPosition,p),2*t.axisX.pointWidth,Math.abs(p-t.axisY.zeroPosition)),a.strokeRect(n-t.axisX.pointWidth,Math.min(t.axisY.zeroPosition,p),2*t.axisX.pointWidth,Math.abs(p-t.axisY.zeroPosition))}break;case"Area":var n=t.getXPositionByIndex(i),u=s[e.closeValueIndex];t.chart.chartOptions.areaLineColor&&(a.strokeStyle=t.chart.chartOptions.areaLineColor),null!==u&&(this.chart.isComparison&&"TA_LIB"!=e.kind&&(u=r.multiplier?u*r.multiplier-100:(r.multiplier=100/u,0)),p=t.getYPosition(u,e.inline),r.lineStarted?a.lineTo(n,p):(r.lineStarted=!0,a.moveTo(n,p)));break;case"Line":n=t.getXPositionByIndex(i);null!==(u=s[e.closeValueIndex])&&(this.chart.isComparison&&"TA_LIB"!=e.kind&&(u=r.multiplier?u*r.multiplier-100:(r.multiplier=100/u,0)),p=t.getYPosition(u,e.inline),r.lineStarted?a.lineTo(n,p):(r.lineStarted=!0,a.moveTo(n,p)));break;case"Point":n=Math.round(t.getXPositionByIndex(i)),p=Math.round(t.getYPosition(s[e.closeValueIndex],e.inline));a.beginPath(),a.arc(n,p,2.5,0,2*Math.PI,!0),a.closePath(),a.fill();break;default:throw new Error("Chart type '"+e.chartType+"' is invalid.")}},iChart.Charting.ChartRenderer.prototype.renderSeries=function(t,e,i,a){if(!(t.viewport.x.bounded.min>t.viewport.x.bounded.max)){"HLOC"===e.kind&&(this.chart.isComparison?e.chartType="Line":t.isScroller?e.chartType="Area":e.chartType=this.chart.chartOptions.chartType),i.fillStyle=e.color,i.strokeStyle=e.color,"HLOC"===e.kind?("Line"===e.chartType?(i.lineWidth=this.chart.chartOptions.lineWidth,(r=$.extend([],this.chart.chartOptions.seriesColors)).splice(0,0,this.chart.chartOptions.lineColor),i.fillStyle=i.strokeStyle=r[a%r.length]):e.width?i.lineWidth=e.width:i.lineWidth=1,"Column"===e.chartType&&(i.fillStyle=t.chart.chartOptions.volumeStyle,i.strokeStyle=t.chart.chartOptions.volumeStyle)):"Volume"===e.kind?"Column"===e.chartType&&(i.fillStyle=t.chart.chartOptions.volumeStyle,i.strokeStyle=t.chart.chartOptions.volumeStyle):e.width&&"Column"!==e.chartType?i.lineWidth=e.width:"Area"===e.chartType||"Line"===e.chartType?i.lineWidth=2:i.lineWidth=1;var r="Area"===e.chartType||"Candlestick"===e.chartType||"Column"===e.chartType&&0===t.axisX.pointWidth||"Line"===e.chartType||"Stock"===e.chartType;r&&i.beginPath();for(var s={},n=t.viewport.x.bounded.min;n<=t.viewport.x.bounded.max;++n)this.renderPoint(t,e,n,i,s);r&&i.stroke(),"Area"===e.chartType&&(r=t.getXPositionByIndex(Math.min(e.points.length-this.chart.chartOptions.futureAmount-1,t.viewport.x.bounded.max)),i.fillStyle=this.chart.chartOptions.areaColor,i.lineTo(r,Math.round(t.getYPosition(t.axisY.min))),i.lineTo(t.getXPositionByIndex(t.viewport.x.bounded.min),Math.round(t.getYPosition(t.axisY.min))),i.closePath(),i.fill())}},iChart.Charting.ChartRenderer.prototype.renderSeriesCollection=function(t,e){e.save(),e.translate(.5,.5),e.beginPath(),e.moveTo(1,1),e.lineTo(1,t.axisY.length-1),e.lineTo(t.axisX.length-1,t.axisY.length-1),e.lineTo(t.axisX.length-1,1),e.closePath(),e.clip();for(var i=0;i<t.ySeries.length;++i)this.renderSeries(t,t.ySeries[i],e,i);e.restore()},iChart.Charting.ChartRenderer.prototype.renderXLabels=function(t,e){e.save(),e.translate(.5,t.axisY.length),e.fillStyle=this.chart.chartOptions.labelColor,e.font=this.chart.chartOptions.labelFont,e.textAlign="center",e.textBaseline="bottom";for(var i,a=Math.max(1,Math.floor((t.axisX.max-t.axisX.min+1)/(t.axisX.length/75))),r=t.xSeries.min+Math.ceil((t.axisX.min-t.xSeries.min)/a)*a;r<=Math.floor(t.axisX.max);r+=a){var s=t.xSeries[r];if(void 0!==s){var s=this.formatDateTime(s),n=Math.round(t.getXPositionByIndex(r));if(this.chart.chartOptions.showLabels){this.chart.chartOptions.showAxes&&(e.strokeStyle=this.chart.chartOptions.axisColor,e.beginPath(),e.moveTo(n,0),e.lineTo(n,5),e.stroke());var o=s.split("\r\n");2===o.length&&(o[1]===i?o.length=1:i=o[1]);for(var h=0;h<o.length;++h)e.fillText(o[h],n,15+11*h)}if(e.strokeStyle=this.chart.chartOptions.gridColor,e.beginPath(),"dashed"===this.chart.chartOptions.gridStyle)for(var l=-4;l>=-t.axisY.length;l-=4)e.moveTo(n,l),e.lineTo(n,l+3);else"solid"===this.chart.chartOptions.gridStyle&&(e.moveTo(n,0),e.lineTo(n,-t.axisY.length));e.stroke()}}e.restore()},iChart.Charting.ChartRenderer.prototype.renderYLabel=function(t,e,i,a){var i=this.formatNumber(e,{decimalPrecision:this.chart.labelPrecision,scale:i}),r=Math.round(t.getYPosition(e,!1));if(this.chart.chartOptions.showAxes&&(a.strokeStyle=this.chart.chartOptions.axisColor,a.beginPath(),a.moveTo(0,r),a.lineTo(5,r),a.stroke()),this.chart.chartOptions.showLabels&&(a.fillStyle=this.chart.chartOptions.labelColor,this.chart.chartOptions.yLabelsOutside?a.fillText(i,8,r):a.fillText(i,10*-Math.ceil(a.measureText(i).width/10),r-5)),a.beginPath(),0===e)a.strokeStyle=this.chart.chartOptions.axisColor,a.moveTo(0,r),a.lineTo(-t.axisX.length,r);else if(a.strokeStyle=this.chart.chartOptions.gridColor,"dashed"===this.chart.chartOptions.gridStyle)for(var s=-4;s>=-t.axisX.length;s-=4)a.moveTo(s,r),a.lineTo(s+3,r);else"solid"===this.chart.chartOptions.gridStyle&&(a.moveTo(0,r),a.lineTo(-t.axisX.length,r));a.stroke()},iChart.Charting.ChartRenderer.prototype.renderYLabels=function(t,e){var i;if(e.save(),e.translate(t.axisX.length,.5),e.font=this.chart.chartOptions.labelFont,e.textAlign="left",e.textBaseline="middle",0<(i=this.chart.chartOptions.yLabelsOutside?(t.axisY.max-t.axisY.min)/(t.axisY.length/20):(t.axisY.max-t.axisY.min)/(t.axisY.length/(t.axisY.length/4)))){for(var a=0;i<1;)--a,i*=10;for(;10<=i;)++a,i/=10;for(var r=[1,1.5,2,2.5,3,4,5,7.5],s=0;r[s]<i&&s<r.length;)++s;i=(s===r.length?10:r[s])*Math.pow(10,a)}var n=0,o=Math.max(Math.abs(t.axisY.min),Math.abs(t.axisY.max));1e7<=o&&(n=Math.floor(Math.log(o)/Math.log(1e3)));var h=i/o;(!$.isNumeric(h)||h<1e-4)&&(i=parseFloat((o/Math.pow(10,this.chart.labelPrecision-1)).toPrecision(1)));var l=!1,c=Math.floor(t.axisY.max/i)*i;if($.isNumeric(c))for(;c>=t.axisY.min;)this.renderYLabel(t,c,n,e),c-=i,l=!0;l||this.renderYLabel(t,(t.axisY.max+t.axisY.min)/2,n,e),e.restore()}}(),function(){"use strict";iChart.Charting.ChartSelection=function(t){this.$container=$(t),this.$selection=$("<div/>",{class:"m-chart-selection"}).appendTo(this.$container),this.$container.off("mouseup.selection").off("mousedown.selection").off("mousemove.selection"),$(this.$container).on("mouseup.selection",this,function(t){t.data.disabled||t.data.selection&&(t.data.selection=!1,t.data.$selection.hide(),t.data.recalculateContainerPosition(),t.data.x2=t.pageX-t.data.containerOffset.left,t.data.y2=t.pageY-t.data.containerOffset.top,0<=t.data.x2&&t.data.x2<=t.data.containerWidth&&0<=t.data.y2&&t.data.y2<=t.data.containerHeight&&t.data.moveend&&t.data.moveend(t.data))}),this.$container.on("mousedown.selection",this,function(t){t.data.disabled||1!=t.which||(iChart.animateId&&cancelAnimationFrame(iChart.animateId),t.data.selection=!0,t.data.recalculateContainerPosition(),t.data.x1=t.pageX-t.data.containerOffset.left,t.data.y1=t.pageY-t.data.containerOffset.top,t.data.timeStampLast=t.timeStamp,t.data.timeStamp=t.timeStamp,t.data.xPrev=t.data.x1,t.data.yPrev=t.data.y1,t.data.movestart&&t.data.movestart(t.data))}),this.$container.on("mousemove.selection",this,function(t){var e,i;t.data.disabled||t.data.selection&&(i=t.pageX,e=t.pageY,void 0===i&&(i=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),i=Math.round(i-t.data.containerOffset.left),e=Math.round(e-t.data.containerOffset.top),t.data.x2===i&&t.data.y2===e||(t.data.xPrev=t.data.x2,t.data.yPrev=t.data.y2,t.data.x2=i,t.data.y2=e,t.data.timeStampLast=t.data.timeStamp,t.data.timeStamp=t.timeStamp,t.data.xSpeed=Math.abs(t.data.xPrev-i)/(t.data.timeStamp-t.data.timeStampLast),0<=t.data.x2&&t.data.x2<=t.data.containerWidth&&0<=t.data.y2&&t.data.y2<=t.data.containerHeight&&(i=!0,t.data.move&&(i=t.data.move(t.data)),i&&t.data.$selection.css({display:"",left:self.x1<self.x2?self.x1:self.x2,top:self.y1<self.y2?self.y1:self.y2,width:self.x1<self.x2?self.x2-self.x1:self.x1-self.x2,height:self.y1<self.y2?self.y2-self.y1:self.y1-self.y2}))))})},iChart.Charting.ChartSelection.prototype.disabled=!1,iChart.Charting.ChartSelection.prototype.moved=!1,iChart.Charting.ChartSelection.prototype.movestart=null,iChart.Charting.ChartSelection.prototype.move=null,iChart.Charting.ChartSelection.prototype.moveend=null,iChart.Charting.ChartSelection.prototype.selection=!1,iChart.Charting.ChartSelection.prototype.x1=null,iChart.Charting.ChartSelection.prototype.y1=null,iChart.Charting.ChartSelection.prototype.x2=null,iChart.Charting.ChartSelection.prototype.y2=null,iChart.Charting.ChartSelection.prototype.shiftAnchor=function(t,e){null!==this.anchorX&&t&&(this.anchorX+=t),null!==this.anchorY&&e&&(this.anchorY+=e)},iChart.Charting.ChartSelection.prototype.setAnchor=function(t,e){this.anchorX=t,this.anchorY=e},iChart.Charting.ChartSelection.prototype.disable=function(){this.disabled=!0,this.selection=!1,this.x1=null,this.y1=null,this.x2=null,this.y2=null},iChart.Charting.ChartSelection.prototype.enable=function(){this.disabled=!1,this.selection=!1,this.x1=null,this.y1=null,this.x2=null,this.y2=null},iChart.Charting.ChartSelection.prototype.recalculateContainerPosition=function(){this.containerOffset=this.$container.offset(),this.containerWidth=this.$container.width(),this.containerHeight=this.$container.height()}}(),function(){"use strict";iChart.Charting.ChartTouches=function(t){this.chart=t,this.$container=$(t.container);var h=this;this.$container.hammer({recognizers:[[Hammer.Pan],[Hammer.Pinch,{enable:!0}]]}).on("pinchstart pinchmove pinchend panstart panmove panend",function(t){if("touch"===t.gesture.pointerType&&h.chart.areas){var i=h.chart.areas[0],a=h.$container.offset();switch(t.type){case"panstart":var e=t.gesture.pointers[0].pageX-t.gesture.deltaX-a.left;h.startTouchIndexes.push(i.getXIndex(e)),h.lastGesture=t.gesture,void 0===h.chart.selection.data&&(h.chart.selection.data={}),h.chart.selection.data.timeStampLast=t.timeStamp,h.chart.selection.data.timeStamp=t.timeStamp,h.chart.selection.data.x1=e,h.chart.selection.data.xPrev=e,h.chart.selection.data.x=e,iChart.animateId&&cancelAnimationFrame(iChart.animateId),h.chart.selection.setAnchor(i.viewport.x.min,i.viewport.y.min);break;case"panend":h.startTouchIndexes=[],h.lastGesture=null,h.chart.chartOptions.inertialScrolling&&h.chart.env.scrollTo(h.chart.selection.data);break;case"panmove":var r=t.gesture.pointers[0].pageX-a.left;null===h.chart.viewport.x.min&&(h.chart.viewport.x.min=i.viewport.x.min),null===h.chart.viewport.x.max&&(h.chart.viewport.x.max=i.viewport.x.max),h.chart.viewport.areaName=i.name,h.chart.selection.data.xPrev=h.chart.selection.data.x,h.chart.selection.data.x=r,h.chart.selection.data.x2=r,h.chart.selection.data.timeStampLast=h.chart.selection.data.timeStamp,h.chart.selection.data.timeStamp=t.timeStamp,h.chart.selection.data.xSpeed=Math.abs(h.chart.selection.data.xPrev-r)/(h.chart.selection.data.timeStamp-h.chart.selection.data.timeStampLast);var s=t.gesture.deltaX-h.lastGesture.deltaX,s=i.getXIndex(s)-i.getXIndex(0);1<h.chart.viewport.x.max-h.chart.viewport.x.min-s&&(h.chart.viewport.x.min+=-s),1<h.chart.viewport.x.max-s-h.chart.viewport.x.min&&(h.chart.viewport.x.max+=-s),h.chart._fixViewportBounds(),h.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),h.chart.loadMissingData();var n=t.gesture.deltaY-h.lastGesture.deltaY;window.scroll(0,window.pageYOffset-n),h.lastGesture=t.gesture;break;case"pinchstart":h.disabled=!1,$.each(t.gesture.pointers,function(t,e){e=e.pageX-a.left;h.startTouchIndexes.push(i.getXIndex(e))});break;case"pinchend":h.startTouchIndexes=[];break;case"pinchmove":if(h.disabled)return;var o=h.startTouchIndexes.indexOf(Math.min.apply(null,h.startTouchIndexes)),e=h.startTouchIndexes.indexOf(Math.max.apply(null,h.startTouchIndexes)),r=t.gesture.pointers[o].pageX-a.left,s=t.gesture.pointers[e].pageX-a.left;null===h.chart.viewport.x.min&&(h.chart.viewport.x.min=i.viewport.x.bounded.min),null===h.chart.viewport.x.max&&(h.chart.viewport.x.max=i.viewport.x.bounded.max);n=h.startTouchIndexes[o]-r*(h.startTouchIndexes[e]-h.startTouchIndexes[o])/(s-r),s=h.startTouchIndexes[e]+(i.innerWidth-s)*(h.startTouchIndexes[e]-h.startTouchIndexes[o])/(s-r),r=s-n;0<h.chart.chartOptions.maxZoom&&r>=h.chart.chartOptions.maxZoom&&(h.chart.viewport.x.min=n,h.chart.viewport.x.max=s,h.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}),h.chart.loadMissingData())}}})},iChart.Charting.ChartTouches.prototype.disabled=!1,iChart.Charting.ChartTouches.prototype.startTouchIndexes=[],iChart.Charting.ChartTouches.prototype.lastGesture=null}(),function(){"use strict";iChart.Charting.Prediction=function(t,e){return this.data=t,this.chart=e,this.style={patternend:{strokeStyle:"rgb(153,153,153)",lineWidth:1,lineDash:[7,2]},rectangle:{up:{strokeStyle:"rgb(0,137,0)",lineWidth:1,lineDash:[5,2],fillStyle:"rgba(0,137,0,.3)"},down:{strokeStyle:"rgb(255,2,27)",lineWidth:1,lineDash:[5,2],fillStyle:"rgba(255,2,27,.3)"}},polygon:{strokeStyle:"rgb(102,178,139)",strokeStyle2:"rgb(72,118,177)",lineWidth:3,fillStyle:"rgba(82,175,201,.2)"},fibonacci:{correction:{strokeStyle:"rgb(119,119,119)"},arrow:{strokeStyle:"rgb(251,0,251)",lineWidth:1},line:{strokeStyle:"rgb(204,204,204)",lineWidth:1}},arrow:{down:{strokeStyle:"rgb(219,132,61)",lineWidth:3},up:{strokeStyle:"rgb(15,156,0)",lineWidth:3}},line:{simple:{strokeStyle:"rgb(153,153,153)"},resistance:{strokeStyle:"rgb(102,178,139)",lineWidth:2},support:{strokeStyle:"rgb(72,118,177)",lineWidth:2},patternend:{strokeStyle:"rgb(153,153,153)",lineWidth:1,lineDash:[7,2]}},label:{size:15}},this},iChart.Charting.Prediction.prototype.draw=function(){switch(this.data.patterntype){case"ChartPattern":this.ChartPattern();break;case"FibonacciPattern":this.FibonacciPattern();break;case"KeyLevelsPattern":this.KeyLevelsPattern();break;default:return}this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})},iChart.Charting.Prediction.prototype.getTimeRange=function(){switch(this.data.patterntype){case"ChartPattern":return[1e3*(e=Math.min(this.data.resistancex0,this.data.supportx0)),1e3*(i=null!=this.data.predictiontimefrom?this.data.predictiontimeto:parseInt(this.data.patternendtime)+60*this.data.interval*7)];case"FibonacciPattern":var t=this.data.timeA;0<this.data.timeX&&(t=Math.min(t,this.data.timeX));var e=t;return 0<this.data.timeD&&0<this.data.priceD?i=this.data.timeD:0<this.data.priceD&&(i=parseFloat(this.data.timeC)+60*parseFloat(this.data.interval)*parseInt(this.data.length)),0<this.data.target0&&0<this.data.target10&&(i=parseInt(t)+this.data.interval*this.data.length*(this.data.interval<1440?3:1)),[1e3*e,1e3*i];case"KeyLevelsPattern":var i;return[1e3*(e=this.data.point1),1e3*(i=this.data.predictionpricefrom?parseFloat(this.data.predictiontimefrom)+60*parseFloat(this.data.interval)*parseInt(this.data.predictiontimebars):parseInt(this.data.patternendtime)+60*parseFloat(this.data.interval)*7)];default:return!1}},iChart.Charting.Prediction.prototype.ChartPattern=function(){var t,e,i,a,r,s=this.chart.areas[0].getXPositionByValue(this.data.patternendtime),n=this.chart.areas[0].getXPositionByValue(this.data.resistancex0),o=this.chart.areas[0].getXPositionByValue(this.data.resistancex1),h=this.chart.areas[0].getXPositionByValue(this.data.supportx0),l=this.chart.areas[0].getXPositionByValue(this.data.supportx1),c=this.chart.areas[0].getYPosition(this.data.resistancey0),d=this.chart.areas[0].getYPosition(this.data.resistancey1),p=this.chart.areas[0].getYPosition(this.data.supporty0),u=this.chart.areas[0].getYPosition(this.data.supporty1),g=Math.min(this.data.resistancex0,this.data.supportx0),f=Math.max(this.data.resistancex1,this.data.supportx1),m=this.chart.areas[0].getXPositionByValue(g),v=(this.chart.areas[0].getXPositionByValue(f),(m-n)*(d-c)/(o-n)+parseFloat(c)),y=(m-h)*(u-p)/(l-h)+parseFloat(p),C=(s-n)*(d-c)/(o-n)+parseFloat(c),g=(s-h)*(u-p)/(l-h)+parseFloat(p),f=this.chart.overlay.createElement("Polygon");f.points=[{x:1e3*this.chart.areas[0].getXValue(m),y:this.chart.areas[0].getYValue(v)},{x:1e3*this.chart.areas[0].getXValue(s),y:this.chart.areas[0].getYValue(C)},{x:1e3*this.chart.areas[0].getXValue(s),y:this.chart.areas[0].getYValue(g)},{x:1e3*this.chart.areas[0].getXValue(m),y:this.chart.areas[0].getYValue(y)}],f.settings=this.style.polygon,this.chart.overlay.history.push(f),(f=this.chart.overlay.createElement("VerticalLine")).hasSettings=!0,f.settings=this.style.line.patternend,f.points=[{x:1e3*this.chart.areas[0].getXValue(s),y:this.chart.areas[0].getYValue(y)}],this.chart.overlay.history.push(f),null!=this.data.predictiontimefrom?(t=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1],a=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1),e=this.chart.areas[0].ySeries[0].points[a][3],i=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))+7],i=Math.min(i,parseFloat(this.data.predictiontimefrom)+Math.round((this.data.predictiontimeto-this.data.predictiontimefrom)/2)),(f=this.chart.overlay.createElement("Arrow")).hasSettings=!0,1==this.data.direction?(f.points=[{x:1e3*t,y:e},{x:1e3*i,y:this.data.predictionpricefrom}],f.settings=this.style.arrow.up):(f.points=[{x:1e3*t,y:e},{x:1e3*i,y:this.data.predictionpriceto}],f.settings=this.style.arrow.down),this.chart.overlay.history.push(f),(f=this.chart.overlay.createElement("Rectangle")).hasSettings=!0,1==this.data.direction?f.settings=this.style.rectangle.up:f.settings=this.style.rectangle.down,y=this.chart.areas[0].getXValue(this.chart.areas[0].getXPositionByIndex(this.chart.areas[0].getXIndexByValue2(this.data.predictiontimeto))),f.points=[{x:1e3*this.data.patternendtime,y:this.data.predictionpricefrom},{x:1e3*y,y:this.data.predictionpriceto}]):(t=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1],a=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1),e=this.chart.areas[0].ySeries[0].points[a][3],i=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))+7],a=this.chart.areas[0].getXPositionByValue(i),(f=this.chart.overlay.createElement("Arrow")).hasSettings=!0,1==this.data.direction?(r=(a-n)*(d-c)/(o-n)+parseFloat(c),f.settings=this.style.arrow.up):(r=(a-h)*(u-p)/(l-h)+parseFloat(p),f.settings=this.style.arrow.down),f.points=[{x:1e3*t,y:e},{x:1e3*i,y:this.chart.areas[0].getYValue(r)}]),this.chart.overlay.history.push(f),this.chart.overlay.render(),this.chart.overlay.syncHash()},iChart.Charting.Prediction.prototype.FibonacciPattern=function(){0<this.data.priceX&&((e=this.chart.overlay.createElement("Line")).hasSettings=!0,e.settings=this.style.line.support,e.points=[{x:1e3*this.data.timeX,y:this.data.priceX},{x:1e3*this.data.timeA,y:this.data.priceA}],this.chart.overlay.history.push(e)),0<this.data.priceA&&((e=this.chart.overlay.createElement("Line")).hasSettings=!0,e.settings=this.style.line.support,e.points=[{x:1e3*this.data.timeA,y:this.data.priceA},{x:1e3*this.data.timeB,y:this.data.priceB}],this.chart.overlay.history.push(e)),(e=this.chart.overlay.createElement("Line")).hasSettings=!0,e.settings=this.style.line.support,e.points=[{x:1e3*this.data.timeB,y:this.data.priceB},{x:1e3*this.data.timeC,y:this.data.priceC}],this.chart.overlay.history.push(e);var t=this.data.timeA;0<this.data.timeX&&(t=Math.min(t,this.data.timeX));var e,i,a=this.chart.areas[0].getXIndexByValue2(t)+parseInt(this.data.interval/this.chart._dataSettings.timeframe*this.data.length*1.6);0<this.data.timeD&&0<this.data.priceD?((e=this.chart.overlay.createElement("Line")).hasSettings=!0,e.settings=this.style.line.support,e.points=[{x:1e3*this.data.timeC,y:this.data.priceC},{x:1e3*this.data.timeD,y:this.data.priceD}],this.chart.overlay.history.push(e)):0<this.data.priceD&&((e=this.chart.overlay.createElement("Arrow")).hasSettings=!0,e.settings=this.style.fibonacci.arrow,e.points=[{x:1e3*this.data.timeC,y:this.data.priceC},{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.priceD}],this.chart.overlay.history.push(e),0<this.data.priceX&&((e=this.chart.overlay.createElement("Line")).hasSettings=!0,e.settings=this.style.fibonacci.line,e.points=[{x:1e3*this.data.timeX,y:this.data.priceX},{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.priceD}],this.chart.overlay.history.push(e))),0<this.data.target0&&0<this.data.target10&&((e=this.chart.overlay.createElement("FibonacciCorrection")).hasSettings=!0,e.settings=this.style.fibonacci.correction,e.points=[{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.target0},{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.target10}],this.chart.overlay.history.push(e)),0<this.data.target0&&0<this.data.target3&&(e=this.chart.overlay.createElement("Arrow"),t=this.chart.areas[0].xSeries[a+4],e.points=[{x:1e3*this.chart.areas[0].xSeries[a],y:this.data.target0},{x:1e3*t,y:this.data.target3}],e.hasSettings=!0,e.settings=this.style.fibonacci.correction,this.chart.overlay.history.push(e)),(e=this.chart.overlay.createElement("VerticalLine")).points=[{x:1e3*this.data.patternendtime,y:this.data.price}],e.hasSettings=!0,e.settings=this.style.line.simple,this.chart.overlay.history.push(e),0<this.data.timeX&&((e=this.chart.overlay.createElement("Label")).settings={text:"X",size:this.style.label.size},i="down"==this.data.directionX?(i=this.chart.areas[0].getYPosition(this.data.priceX)+this.style.label.size,this.chart.areas[0].getYValue(i)):this.data.priceX,e.points=[{x:1e3*this.data.timeX,y:i}],this.chart.overlay.history.push(e)),0<this.data.timeA&&((e=this.chart.overlay.createElement("Label")).settings={text:"A",size:this.style.label.size},i="down"==this.data.directionA?(i=this.chart.areas[0].getYPosition(this.data.priceA)+this.style.label.size,this.chart.areas[0].getYValue(i)):this.data.priceA,e.points=[{x:1e3*this.data.timeA,y:i}],this.chart.overlay.history.push(e)),0<this.data.timeB&&((e=this.chart.overlay.createElement("Label")).settings={text:"B",size:this.style.label.size},i="down"==this.data.directionB?(i=this.chart.areas[0].getYPosition(this.data.priceB)+this.style.label.size,this.chart.areas[0].getYValue(i)):this.data.priceB,e.points=[{x:1e3*this.data.timeB,y:i}],this.chart.overlay.history.push(e)),0<this.data.timeC&&((e=this.chart.overlay.createElement("Label")).settings={text:"C",size:this.style.label.size},i="down"==this.data.directionC?(i=this.chart.areas[0].getYPosition(this.data.priceC)+this.style.label.size,this.chart.areas[0].getYValue(i)):this.data.priceC,e.points=[{x:1e3*this.data.timeC,y:i}],this.chart.overlay.history.push(e)),0<this.data.timeD&&((e=this.chart.overlay.createElement("Label")).settings={text:"D",size:this.style.label.size},i="down"==this.data.directionD?(i=this.chart.areas[0].getYPosition(this.data.priceD)+this.style.label.size,this.chart.areas[0].getYValue(i)):this.data.priceD,e.points=[{x:1e3*this.data.timeD,y:i}],this.chart.overlay.history.push(e)),this.chart.overlay.render(),this.chart.overlay.syncHash()},iChart.Charting.Prediction.prototype.KeyLevelsPattern=function(){var t,e,i,a,r,s=this.chart.overlay.createElement("HorizontalLine");s.points=[{x:1e3*this.data.patternendtime,y:this.data.price}],s.hasSettings=!0,s.settings=this.style.line.simple,this.chart.overlay.history.push(s),(s=this.chart.overlay.createElement("VerticalLine")).points=[{x:1e3*this.data.patternendtime,y:this.data.price}],s.hasSettings=!0,s.settings=this.style.line.simple,this.chart.overlay.history.push(s),(s=this.chart.overlay.createElement("Line")).points=[{x:1e3*this.data.point1,y:this.data.price},{x:1e3*this.data.patternendtime,y:this.data.price}],s.hasSettings=!0,"Support"==this.data.pattern?s.settings=this.style.line.support:s.settings=this.style.line.resistance,this.chart.overlay.history.push(s),this.data.predictionpricefrom?(e=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1],i=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1),a=this.chart.areas[0].ySeries[0].points[i][3],r=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))+7],(s=this.chart.overlay.createElement("Arrow")).hasSettings=!0,1==this.data.direction?(t=this.data.predictionpricefrom,s.settings=this.style.arrow.up):(s.settings=this.style.arrow.down,t=this.data.predictionpriceto),s.points=[{x:1e3*e,y:a},{x:1e3*r,y:t}],this.chart.overlay.history.push(s),(s=this.chart.overlay.createElement("Rectangle")).hasSettings=!0,1==this.data.direction?s.settings=this.style.rectangle.up:s.settings=this.style.rectangle.down,t=parseFloat(this.data.predictiontimefrom)+60*parseFloat(this.data.interval)*parseInt(this.data.predictiontimebars),t=this.chart.areas[0].getXValue(this.chart.areas[0].getXPositionByIndex(this.chart.areas[0].getXIndexByValue2(t))),s.points=[{x:1e3*this.data.patternendtime,y:this.data.predictionpricefrom},{x:1e3*t,y:this.data.predictionpriceto}]):(e=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1],i=iChart.Charting.getNearestNotNullIndex(this.chart.areas[0].ySeries[0].points,Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))-1),a=this.chart.areas[0].ySeries[0].points[i][3],r=this.chart.areas[0].xSeries[Math.round(this.chart.areas[0].getXIndexByValue2(this.data.patternendtime))+7],(s=this.chart.overlay.createElement("Arrow")).points=[{x:1e3*e,y:a},{x:1e3*r,y:this.data.price}],s.hasSettings=!0,1==this.data.direction?s.settings=this.style.arrow.up:s.settings=this.style.arrow.down),this.chart.overlay.history.push(s),this.chart.overlay.render(),this.chart.overlay.syncHash()},iChart.Charting.Prediction.prototype.getThirdPoint=function(t,e,i){t=(parseFloat(i)-parseFloat(t.x))*(parseFloat(e.y)-parseFloat(t.y))/(parseFloat(e.x)-parseFloat(t.x))+parseFloat(t.y);return{x:parseFloat(i),y:t}},iChart.Charting.Prediction.prototype.getIntersection=function(t,e,i,a){if((t.y-e.y)*(a.x-i.x)-(i.y-a.y)*(e.x-t.x)==0||a.x-i.x==0)return!1;t=-((t.x*e.y-e.x*t.y)*(a.x-i.x)-(i.x*a.y-a.x*i.y)*(e.x-t.x))/((t.y-e.y)*(a.x-i.x)-(i.y-a.y)*(e.x-t.x));return{x:t,y:((i.y-a.y)*-t-(i.x*a.y-a.x*i.y))/(a.x-i.x)}}}(),$.views.settings.allowCode(!0),$.templates("iChart_mainTmpl",'<div class="iChart-control-form" style="min-height: 200px"><div class="js-chartContainerWrapper"><div class="iChartToolsContainer"><div class="iChartToolsTop" style="display: none;"></div></div><div id="{{:id}}" class="m-chart-container" style="height: 100%;"></div></div><div data-uk-modal="{center:true}" class="uk-modal iChart-form-simple-v js-chartTADialog uk-padding-remove {{:name}}" id="iChart-tech-analysis-dialog" style="display: none;"><div class="uk-modal-dialog"><a class="uk-modal-close uk-close"></a><div class="uk-modal-header">'+_t("3101","Индикаторы")+'</div><div class="js-chartTADialogContainer"></div><div class="uk-modal-footer"><div class="uk-flex uk-flex-middle uk-flex-space-between tm-pad-large"><div class="js-indicator-add md-btn md-btn-small md-btn-success">'+_t("15460","Добавить индикатор")+'</div><div class="md-btn-group"><a class="md-btn md-btn-small md-btn-primary indicators-set" href="#">'+_t("532","Применить")+'</a><a class="md-btn md-btn-small indicators-default" href="#">'+_t("15461","Для всех")+'</a><a class="md-btn md-btn-small indicators-close" href="#">'+_t("1403","Отмена")+'</a></div></div></div></div></div><div class="chart-loader-wrapper" style="top: 0; width: 100%; height: 100%;"><div class="chart-loader"></div></div></div>'),$.templates("iChart_topToolBarTmpl",'<div class="tm-tool-bar uk-flex uk-flex-space-between"><div class="uk-flex uk-flex-left uk-position-relative"><div data-uk-dropdown="" class="uk-position-relative"><div class="tm-graph-button active uk-flex uk-flex-center uk-flex-middle" data-uk-tooltip="{pos:\'top\'}" title=""><i class="sprite sprite-icon-line js-chart-ui-control-state" data-property="chartType"></i></div><div class="uk-dropdown-blank" style="width: auto"><div class="uk-flex uk-flex-left tm-shadow"><div class="tm-graph-button uk-flex uk-flex-column uk-flex-center uk-flex-middle" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17371","Line chart")+'"><i class="sprite sprite-icon-line js-chart-ui-control" data-property="chartType" data-value="Line"></i></div><div class="tm-graph-button uk-flex uk-flex-column uk-flex-center uk-flex-middle" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17372","Candlestick chart")+'"><i class="sprite sprite-icon-candle js-chart-ui-control" data-property="chartType" data-value="Candlestick"></i></div><div class="tm-graph-button uk-flex uk-flex-column uk-flex-center uk-flex-middle" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17373","Bar chart")+'"><i class="sprite sprite-icon-bars js-chart-ui-control" data-property="chartType" data-value="Stock"></i></div></div></div></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control js-chart-ui-control-state" data-property="showVolumeByPrice" data-value="false" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17374","Display volume horizontally")+'"><i class="sprite sprite-icon-h-volume"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control js-chart-ui-control-state" data-property="showVolume" data-value="false" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17375","Display volume vertically")+'"><i class="sprite sprite-icon-v-volume"></i></div><div class="tm-graph-button uk-flex uk-flex-column uk-flex-center uk-flex-middle js-chart-ui-control js-chart-ui-control-state" data-property="percentMode" data-value="false" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17376","Relative price")+'"><i class="sprite sprite-icon-price"></i></div><i class="sprite sprite-icon-divider"></i><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control js-chart-ui-control-state" data-property="themeConfig" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17377","Visual Settings")+'"><i class="sprite sprite-icon-palette"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control js-chart-ui-control-state" data-property="instrumentText" data-value="Text" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17378","Add Text")+'"><i class="sprite sprite-icon-font"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control js-chart-ui-control-state" data-property="instrumentText" data-value="Bubble" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17379","Add Tooltip")+'"><i class="sprite sprite-icon-f-comment"></i></div><div data-uk-dropdown="" class="uk-position-relative"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control-state" data-property="instrumentLine" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17380","Draw Line")+'"><i class="sprite sprite-icon-arrow-line"></i></div><div class="uk-dropdown-blank" style="width: auto"><div class="uk-flex uk-flex-left tm-shadow"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentLine" data-value="Arrow" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17386","Arrow")+'"><i class="sprite sprite-icon-arrow-line"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentLine" data-value="Line" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17381","Free Line")+'"><i class="sprite sprite-icon-free-line"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentLine" data-value="HorizontalLine" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17382","Horizontal line")+'"><i class="sprite sprite-icon-h-line"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentLine" data-value="VerticalLine" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17383","Vertical line")+'"><i class="sprite sprite-icon-v-line"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentLine" data-value="Channel" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17384","Channel")+'"><i class="sprite sprite-icon-channel"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentLine" data-value="Trend" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17385","Corner Trend")+'"><i class="sprite sprite-icon-angle-trend"></i></div></div></div></div><div data-uk-dropdown="" class="uk-position-relative"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control-state" data-property="instrumentForm" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17387","Draw Form")+'"><i class="sprite sprite sprite-icon-f-square"></i></div><div class="uk-dropdown-blank" style="width: auto"><div class="uk-flex uk-flex-left tm-shadow"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentForm" data-value="Polygon" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17388","Poligon")+'"><i class="sprite sprite-icon-f-poligon"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentForm" data-value="Rectangle" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17389","Rectangle")+'"><i class="sprite sprite-icon-f-square"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentForm" data-value="Triangle" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17390","Triangle")+'"><i class="sprite sprite-icon-f-triangle"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentForm" data-value="Ellipse" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17391","Ellipse")+'"><i class="sprite sprite-icon-f-ellipse"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentForm" data-value="FibonacciArc" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17392","Fibonacci Archs")+'"><i class="sprite sprite-icon-f-fibonacci-arcs"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentForm" data-value="FibonacciFan" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17393","Fibonacci Fan")+'"><i class="sprite sprite-icon-f-fibonacci-fan"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentForm" data-value="FibonacciCorrection" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17394","Fibonacci Retracement")+'"><i class="sprite sprite-icon-f-fibonacci-correction"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="instrumentForm" data-value="HorizontalRange" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17912","Горизонтальный диапазон")+'"><i class="sprite sprite-icon-h-line-double"></i></div></div></div></div><div data-uk-dropdown="" class="uk-position-relative"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle" data-uk-tooltip="{pos:\'top\'}" title=""><i class="sprite sprite-icon-1px js-chart-ui-control-state" data-property="lineWidthSelector"></i></div><div class="uk-dropdown-blank" style="width: auto"><div class="uk-flex uk-flex-left tm-shadow"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="lineWidthSelector" data-value="1" data-uk-tooltip="{pos:\'top\'}" title="Line 1px"><i class="sprite sprite-icon-1px"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="lineWidthSelector" data-value="2" data-uk-tooltip="{pos:\'top\'}" title="Line 2px"><i class="sprite sprite-icon-2px"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="lineWidthSelector" data-value="3" data-uk-tooltip="{pos:\'top\'}" title="Line 3px"><i class="sprite sprite-icon-3px"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="lineWidthSelector" data-value="4" data-uk-tooltip="{pos:\'top\'}" title="Line 4px"><i class="sprite sprite-icon-4px"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="lineWidthSelector" data-value="5" data-uk-tooltip="{pos:\'top\'}" title="Line 5px"><i class="sprite sprite-icon-5px"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="lineWidthSelector" data-value="8" data-uk-tooltip="{pos:\'top\'}" title="Line 8px"><i class="sprite sprite-icon-8px"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="lineWidthSelector" data-value="10" data-uk-tooltip="{pos:\'top\'}" title="Line 10px"><i class="sprite sprite-icon-10px"></i></div></div></div></div><div data-uk-dropdown="" class="uk-position-relative js-chart-ui-control" data-property="fillStyle"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle" data-uk-tooltip="{pos:\'top\'}" title="Fill Color"><div class="tm-fill-color js-chart-ui-control-state" data-property="fillStyle" style="background-color: rgba(82, 175, 201, 0.5);"></div><i class="sprite sprite-icon-fill-color"></i></div><div class="uk-dropdown-blank" style="width: auto"><div class="uk-flex uk-flex-left tm-shadow js-chart-ui-control-holder"><div class="js-colorPalette" data-option="fillStyle"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="fillStyle" data-element="canvas" value="" size="10"/></div></div></div><div data-uk-dropdown="" class="uk-position-relative js-chart-ui-control" data-property="strokeStyle"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle" data-uk-tooltip="{pos:\'top\'}" title="Line Color"><div class="tm-line-color js-chart-ui-control-state" data-property="strokeStyle" style="background-color: rgb(82, 175, 201);"></div><i class="sprite sprite-icon-line-color"></i></div><div class="uk-dropdown-blank" style="width: auto"><div class="uk-flex uk-flex-left tm-shadow js-chart-ui-control-holder"><div class="js-colorPalette" data-option="strokeStyle"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="strokeStyle" data-element="canvas" value="" size="10"/></div></div></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="captureImage" data-value="" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17493","Screenshot")+'"><i class="sprite sprite-icon-camera"></i></div><i class="sprite sprite-icon-divider"></i><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="clearInstruments" data-value="" data-uk-tooltip="{pos:\'top\'}" title="'+_t("17395","Clear Chart")+'"><i class="sprite sprite-icon-trash"></i></div></div><div class="uk-flex uk-flex-left"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="dataInterval" data-value="I1" data-uk-tooltip="{pos:\'top\'}" title="1 minute > day"><i class="sprite sprite-icon-1m"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="dataInterval" data-value="I5" data-uk-tooltip="{pos:\'top\'}" title="5 minutes > 3 days"><i class="sprite sprite-icon-5m"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="dataInterval" data-value="I15" data-uk-tooltip="{pos:\'top\'}" title="15 minutes > week"><i class="sprite sprite-icon-15m"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="dataInterval" data-value="H1" data-uk-tooltip="{pos:\'top\'}" title="Hour"><i class="sprite sprite-icon-h"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="dataInterval" data-value="D1" data-uk-tooltip="{pos:\'top\'}" title="Day"><i class="sprite sprite-icon-d"></i></div><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle js-chart-ui-control" data-property="dataInterval" data-value="D7" data-uk-tooltip="{pos:\'top\'}" title="Week"><i class="sprite sprite-icon-w"></i></div><i class="sprite sprite-icon-divider"></i><div class="js-chart-ui-indicators"></div></div>'),$.templates("indicatorsCurrentTmpl",'{{for userData}}<div><span>{{:name}}</span> <span>{{if params}}{{* window.i=0;}}({{props params}}{{* if (i>0) { }}, {{* } }}{{>prop}}{{* i++;}}{{/props}}){{/if}}</span><span><a href="javascript:void(0);" onclick="return false;" data-index="{{:#index}}" class="js-edit-indicator uk-icon-cog uk-margin-left"></a><a href="javascript:void(0);" onclick="return false;" data-index="{{:#index}}" class="js-remove-indicator uk-icon-close uk-margin-left"></a></span></div>{{/for}}'),$.templates("indicatorsListTmpl",'<ul class="uk-list uk-list-line">{{for indicators}}<li><a href="javascript:void(0);" onclick="return false;" class="js-add-indicator" data-value="{{:value}}">{{:value}}</a></li>{{/for}}</ul>'),$.templates("indicatorsDropdownTmpl",'<div class="js-iChartTools-indicators uk-button-dropdown" data-uk-dropdown="{mode:\'click\', pos:\'bottom-right\'}" class="uk-position-relative"><div class="tm-graph-button uk-flex uk-flex-center uk-flex-middle" data-uk-tooltip="{pos:\'top\'}" title="Add Indicator" style="min-width: 100px"><i class="sprite sprite-icon-text-indicators"></i></div><div class="uk-dropdown uk-dropdown-bottom uk-dropdown-scrollable" style="top: 30px; left: 0px;"><div class="tm-shadow"><div class="uk-panel js-iChartTools-indicators-current">{{include tmpl="indicatorsCurrentTmpl"/}}</div><div class="js-iChartTools-indicators-list">{{include tmpl="indicatorsListTmpl"/}}</div></div></div></div>'),$.templates("indicatorDialogTmpl",'<div class="iChartDialog" style="display: none; width: 300px;"><div> {{:name}} </div><div class="js-iChartTools-indicators-params">{{for parameters}}<div>{{:Name}} <input type="text" name="{{:Code}}" value="{{:Value}}" /></div>{{/for}}</div><div class="js-iChartTools-indicators-colorContainer"></div><div class="js-iChartTools-indicators-widthContainer"></div><div><a  href="javascript:void(0);" onclick="return false;" class="uk-button js-set-params-indicator">Ok</a><a  href="javascript:void(0);" onclick="$.modal.impl.close(); return false;" class="uk-button">Cancel</a></div></div>'),$.templates("captureDialogTmpl",'<div class="iChartDialog" style="display: none;"><img class="js-iChartTools-capture"/><div class="uk-flex uk-flex-right"><a  href="javascript:void(0);" onclick="$.modal.impl.close(); return false;" class="uk-button js-set-params-indicator">Ok</a></div></div>'),$.templates("themeConfigSelectorTmpl",'<div class="uk-button-dropdown" data-uk-dropdown="{mode:\'click\'}" aria-haspopup="true" aria-expanded="false"><button class="uk-button uk-button-success">'+_t("13663","Темы")+' <i class="uk-icon-caret-down"></i></button><div class="uk-dropdown uk-dropdown-up uk-dropdown-small uk-dropdown-scrollable"><ul class="uk-nav uk-nav-dropdown">{{for themes}}<li><a href="#" class="js-themeSelect" data-theme="{{: name }}">{{: name }}{{if custom}}<span class="js-themeDelete uk-icon-trash-o uk-margin-small-left uk-badge uk-badge-warning uk-panel-hover uk-float-right" data-name="{{: name }}" title="'+_t("4023","Удалить")+'"></span>{{/if}}</a></li>{{/for}}<li class="uk-nav-divider"></li><li><a href="#" class="js-themeSaveAs">'+_t("13664","Сохранить как")+"</a></li></ul></div></div>"),$.templates("themeConfigTmpl",'<div class="js-themeConfig" style="display: none"><div class="js-themeConfigOptions"></div><div class="uk-grid uk-grid-small"><div class="uk-width-1-1"><div class="js-themeConfigSelector"></div></div></div><hr class="uk-grid-divider" style="margin: 15px 0"><div class="uk-grid uk-grid-small"><div class="uk-width-7-10 js-themeAdditionButtons"></div><div class="uk-width-3-10 uk-text-right"><button class="uk-button js-chartOptions" data-value="cancel">'+_t("1403","Отмена")+'</button> <button class="uk-button  uk-button-primary js-chartOptions" data-value="ok">'+_t("3920","OK")+"</button></div></div></div>"),$.templates("themeConfigOptionsTmpl",'<div class="uk-grid"><div class="uk-width-1-2"><div class="uk-grid"><div class="uk-width-3-4">'+_t("13643","Фон")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="backgroundColor" style="background-color: {{: chartOptions.backgroundColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="backgroundColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="backgroundColor" data-element="canvas" value="{{: chartOptions.backgroundColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13644","Линии осей")+'</div><div class="uk-width-1-4"><div class="js-checkbox" data-option="showAxes"><input type="checkbox" class="js-flag" data-option="showAxes" {{if chartOptions.showAxes}}checked="checked"{{/if}}/></div></div><div class="uk-width-3-4">'+_t("13645","Цвет осей")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="axisColor" style="background-color: {{: chartOptions.axisColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="axisColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="axisColor" data-element="canvas" value="{{: chartOptions.axisColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13646","Цвет меток")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="labelColor" style="background-color: {{: chartOptions.labelColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="labelColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="labelColor" data-element="canvas" value="{{: chartOptions.labelColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13647","Цвет сетки")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="gridColor" style="background-color: {{: chartOptions.gridColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="gridColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="gridColor" data-element="canvas" value="{{: chartOptions.gridColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13648","Цвет текста подложки")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="watermarkColor" style="background-color: {{: chartOptions.watermarkColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="watermarkColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="watermarkColor" data-element="canvas" value="{{: chartOptions.watermarkColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13649","Цвет области")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="areaColor" style="background-color: {{: chartOptions.areaColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="areaColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="areaColor" data-element="canvas" value="{{: chartOptions.areaColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13650","Цвет границы области")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="areaLineColor" style="background-color: {{: chartOptions.areaLineColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="areaLineColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="areaLineColor" data-element="canvas" value="{{: chartOptions.areaLineColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13651","Цвет объемов")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="volumeStyle" style="background-color: {{: chartOptions.volumeStyle }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="volumeStyle"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="volumeStyle" data-element="canvas" value="{{: chartOptions.volumeStyle }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13652","Цвет фона скроллера")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="scrollerOverlayColor" style="background-color: {{: chartOptions.scrollerOverlayColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="scrollerOverlayColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="scrollerOverlayColor" data-element="canvas" value="{{: chartOptions.scrollerOverlayColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13653","Цвет скроллера")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="scrollerHandlerColor" style="background-color: {{: chartOptions.scrollerHandlerColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="scrollerHandlerColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="scrollerHandlerColor" data-element="canvas" value="{{: chartOptions.scrollerHandlerColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("15810","Цвет теней")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="shadowColor" style="background-color: {{: chartOptions.shadowColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="shadowColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="shadowColor" data-element="canvas" value="{{: chartOptions.shadowColor }}" size="10"/></div></div></div></div></div><div class="uk-width-1-2"><div class="uk-grid"><div class="uk-width-3-4">'+_t("3103","Свеча вверх")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleUp" style="background-color: {{: chartOptions.candleUp }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleUp"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleUp" data-element="canvas" value="{{: chartOptions.candleUp }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("3104","Свеча вниз")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleDown" style="background-color: {{: chartOptions.candleDown }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleDown"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleDown" data-element="canvas" value="{{: chartOptions.candleDown }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13654","Обводка свечи")+'</div><div class="uk-width-1-4"><div class="js-checkbox" data-option="candleBorder"><input type="checkbox" class="js-flag" data-option="candleBorder" {{if chartOptions.candleBorder}}checked="checked"{{/if}}/></div></div><div class="uk-width-3-4">'+_t("13655","Обводка свечи вверх")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleBorderUp" style="background-color: {{: chartOptions.candleBorderUp }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleBorderUp"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleBorderUp" data-element="canvas" value="{{: chartOptions.candleBorderUp }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13656","Обводка свечи вниз")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleBorderDown" style="background-color: {{: chartOptions.candleBorderDown }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleBorderDown"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleBorderDown" data-element="canvas" value="{{: chartOptions.candleBorderDown }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13657","Тень свечи")+'</div><div class="uk-width-1-4"><div class="js-checkbox" data-option="candleWick"><input type="checkbox" class="js-flag" data-option="candleWick" {{if chartOptions.candleWick}}checked="checked"{{/if}}/></div></div><div class="uk-width-3-4">'+_t("13658","Цвет тени свечи")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="candleWickStyle" style="background-color: {{: chartOptions.candleWickStyle }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="candleWickStyle"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="candleWickStyle" data-element="canvas" value="{{: chartOptions.candleWickStyle }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13659","Бар вверх")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="stockUp" style="background-color: {{: chartOptions.stockUp }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="stockUp"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="stockUp" data-element="canvas" value="{{: chartOptions.stockUp }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13660","Бар вниз")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="stockDown" style="background-color: {{: chartOptions.stockDown }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="stockDown"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="stockDown" data-element="canvas" value="{{: chartOptions.stockDown }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13661","Толщина бара")+'</div><div class="uk-width-1-4"><div class="js-widthSlector" data-option="stockWidth"><div class="js-widthSlectorValue lineWidth" data-option="stockWidth" data-style="{{: chartOptions.stockWidth }}"></div><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-widthSlectorWrapper" data-option="stockWidth" value="{{: chartOptions.stockWidth }}"><span class="lineWidth js-lineWidth" data-style="1"></span><span class="lineWidth js-lineWidth" data-style="2"></span><span class="lineWidth js-lineWidth" data-style="3"></span><span class="lineWidth js-lineWidth" data-style="4"></span></div></div></div></div><div class="uk-width-3-4">'+_t("1365","Линия")+'</div><div class="uk-width-1-4"><div class="js-colorSelector" data-option="lineColor" style="background-color: {{: chartOptions.lineColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="lineColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="lineColor" data-element="canvas" value="{{: chartOptions.lineColor }}" size="10"/></div></div></div><div class="uk-width-3-4">'+_t("13662","Толщина линии")+'</div><div class="uk-width-1-4"><div class="js-widthSlector" data-option="lineWidth"><div class="js-widthSlectorValue lineWidth" data-option="lineWidth" data-style="{{: chartOptions.lineWidth }}"></div><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-widthSlectorWrapper" data-option="lineWidth" value="{{: chartOptions.lineWidth }}"><span class="lineWidth js-lineWidth" data-style="1"></span><span class="lineWidth js-lineWidth" data-style="2"></span><span class="lineWidth js-lineWidth" data-style="3"></span><span class="lineWidth js-lineWidth" data-style="4"></span><span class="lineWidth js-lineWidth" data-style="5"></span><span class="lineWidth js-lineWidth" data-style="8"></span><span class="lineWidth js-lineWidth" data-style="10"></span></div></div></div></div></div></div></div>'),$.templates("iChart_intervalsTmpl",'<div class="uk-margin-small-left js-iChartTools-intervals" style="display: inline-block">{{for intervals}}<a class="uk-button js-chart-interval" href="javascript:void(0);" onclick="return false;" data-value="{{:value}}">{{:name}}</a>{{/for}}</div>'),$.templates("iChart_textPopupSettingsTmpl",'<div class="uk-margin-small-left js-iChartTools-textPopupSettings" style="display: none;"><div style=""><div class="uk-grid uk-grid-small"><div class="uk-width-1-5"><div class="uk-form-select" data-uk-form-select><span>'+_t("17600","Size")+'</span><select name="fontSize">{{for options.sizes}}<option value="{{:value}}" {{if value == ~root.values.fontSize}} selected {{/if}}>{{:name}}</option>{{/for}}</select></div></div><div class="uk-width-2-5"><div class="uk-form-select" data-uk-form-select><span>'+_t("17601","Font")+'</span><select name="fontFamaly">{{for options.fonts}}<option value="{{:value}}" {{if value == ~root.values.fontFamaly}} selected {{/if}}>{{:name}}</option>{{/for}}</select></div></div><div class="uk-width-2-5"><div class="js-colorSelector" data-option="fontColor" style="background-color: {{: values.fontColor }}"><div class="menuHolder" style="display: none; padding: 10px;"><div class="js-colorPalette" data-option="backgroundColor"></div><input type="hidden" class="js-colorPicker" data-opacity="1.0" data-option="fontColor" data-element="canvas" value="{{: values.fontColor }}" size="10"/></div></div></div><div class="uk-width-1-1"><textarea name="text" style="width: 100%; height: 150px;">{{:values.text}}</textarea></div><div class="uk-width-1-1 uk-text-right"><button class="uk-button  uk-button-primary js-textPopupSettings" data-value="ok">'+_t("3920","OK")+'</button><button class="uk-button js-textPopupSettings" data-value="cancel">'+_t("1403","Отмена")+"</button> </div></div></div></div>");var iChartDataSource={data:{},dataSettings:{useHash:!1,date_from:formatDate(-90),date_to:formatDate(0),graphicIndicators:"",timeframe:1440,hash:"",id:"AAPL.US",interval:"D1",compareIds:"",compareStocks:"",compareTickets:"",start:"",end:""},host:"",url:"/api/get-hloc?",getUrl:function(t){t={id:t.id,compareIds:t.compareIds,compareStocks:t.compareStocks,compareTickets:t.compareTickets,count:t.count,timeframe:iChart.getChartTimeframe(t.interval),date_from:t.date_from,date_to:t.date_to,interval:t.interval,intervalMode:t.intervalMode,type:t.type,demo:t.demo};return t.hash=t.id.toString()+Date.parse(t.date_from).toString()+Date.parse(t.date_to).toString()+JSON.stringify(t).hashCode(),iChartDataSource.host+iChartDataSource.url+iChart.toQueryString(t)},onRequestCallback:function(r,t){if(!t.id)return 0;t.demo="undefined"!=typeof jNTUserinfo&&jNTUserinfo.isDemo?1:0;var s=t,n=this,o=this.chart;this.chart.wrapper.trigger("iguanaChartEvents",["chartDataRequest",iChartDataSource.getUrl(t)]),this.chart.ajaxDataRequest=$.ajax({dataType:"text json",error:function(t,e,i){clearTimeout(o.timers.loading),o.wrapper.trigger("iguanaChartEvents",["clearLoader"]),o.viewData.chart.setSelectionMode("pan"),console.log("Error: "+e),r({success:!1})},success:function(t,e,i){var a;o.wrapper.trigger("iguanaChartEvents",["chartDataReceived",t]),t.info&&t.info[o.dataSource.dataSettings.id]?(a=t.info[o.dataSource.dataSettings.id],o.userSettings.currentSecurity={id:a.nt_ticker,short_name:a.short_name,default_ticker:a.default_ticker,nt_ticker:a.nt_ticker,firstDate:a.firstDate,currency:a.currency,min_step:a.min_step},o.viewData.chart.chartOptions.watermarkText=a.nt_ticker,o.viewData.chart.chartOptions.watermarkSubText=a.short_name,t=n.dataAdapter(t,s),clearTimeout(o.timers.loading),o.wrapper.trigger("iguanaChartEvents",["clearLoader"]),o.viewData.chart.setSelectionMode("pan"),0==t.success&&console.log("ERROR:",t.d.Message),r(t||{warnings:[_t("2125","Ошибка: пустой ответ.")],success:!1}),o.response=t.d,o.wrapper.trigger("iguanaChartEvents",["chartDataReady",t]),o.dataRequestCounter++,o.fixViewport(),o.updateUnlocked=!0):r({success:!1})},url:iChartDataSource.getUrl(t)})},preInitCallback:function(t,e){if(void 0===e&&(e={}),e.ticker=e.ticker||this.chart.dataSource.dataSettings.id||"SBER",e.f_history=void 0===e.f_history?0:e.f_history,this.chart.userSettings=$.extend(!0,{},$iguanaChart.defaultSettings,e.userSettings),e.hash){this.chart.dataSource.dataSettings.hash=e.hash;var i,a=iChart.parseQueryString(e.hash.substr(1));for(i in this.chart.dataSource.dataSettings)a[i]&&(this.chart.dataSource.dataSettings[i]=a[i]);var r,s=[];for(r in a)r.match(new RegExp("^i[0-9]","i"))&&(s[r.charAt(0)+r.substr(1)]=a[r]);s.length&&(this.chart.dataSource.dataSettings.graphicIndicators=iChart.toQueryString(s)),e.ticker=a.id,e.interval=a.interval}this.chart.userSettings.currentSecurity={id:e.ticker,short_name:e.ticker,default_ticker:e.ticker,nt_ticker:e.ticker,firstDate:"",currency:"",min_step:""},this.chart.dataSource.dataSettings.useHash=!1,this.chart.dataSource.dataSettings.id=e.ticker,this.chart.dataSource.dataSettings.intervalRestriction="",e.chartOptions.watermarkText=e.ticker,e.chartOptions.watermarkSubText=e.ticker,void 0!==e.type&&(e.chartOptions.chartType=e.type),t(e.chartOptions)}},APO,APO,PPO,PPO;IguanaChart=function(t){"use strict";var o=this;this.name=t.name||"chart",this.container=t.container||"#iChart-chart-container",this.wrapper=t.wrapper,this.lib_path=t.lib_path||"/iguanachart/",this.toQueryString=function(t){var e,i=[];for(e in t){var a=t[e];if(void 0!==a&&""!==a)if($.isArray(a))for(var r=0;r<a.length;++r)i.push(encodeURIComponent(e)+"="+encodeURIComponent(a[r]));else i.push(encodeURIComponent(e)+"="+encodeURIComponent(a))}return i.join("&")},this.dataSource=new iChart.Charting.ChartDataSource(this,t.dataSource),this.userSettings={chartSettings:{contextSettings:{fillStyle:"rgba(82,175,201,.2)",strokeStyle:"rgba(82,175,201,1)",lineWidth:1,fontFamaly:"Arial,Helvetica,sans-serif",fontColor:"#444444",fontSize:"14"},indicatorsColor:{},indicatorsWidth:{},showTransactionsMode:0,tradingToolsEnable:1,autochartistEnable:0,showVolume:"inside",showVolumeByPrice:!1,defaultTheme:1},currentSecurity:{id:"",short_name:"",default_ticker:"",nt_ticker:"",firstDate:"",currency:"",min_step:""}},this.viewData={},this.viewData.indicators=iChart.indicators,this.timers={},this.ajaxDataRequest=null,this.orders={},this.userTransactionAmount=-1,this.updateUnlocked=!0,this.initChart=function(t){var e;this.uiGraphIndicatorsWindow2={element:$(this.wrapper).find(".js-chartTADialog."+this.name)},this.loadHash(),"object"!=typeof t&&(t={}),this.settings={},this.settings.paddingBottom=void 0!==t.paddingBottom?t.paddingBottom:50,void 0===this.viewData.chart?(e={onPostRender:function(){o.checkDateInterval(new Date(1e3*this.areas[0].xSeries[this.areas[0].viewport.x.bounded.min]),new Date(1e3*this.areas[0].xSeries[this.areas[0].viewport.x.bounded.max])),$("#chartLoading").remove(),o.wrapper.trigger("iguanaChartEvents",["RenderChartSuccess"])},onCreateAreas:this.chart_onCreateAreas,onDataSettingsChange:this.chart_onDataSettingsChange,onIntervalChange:this.chart_onIntervalChange,contextmenuCallback:t.contextmenuCallback,container:$(this.container).get(0),dataSettings:this.getChartDataUserSettings(),widget:t.widget,env:this},e=$.extend(!0,e,t),this.viewData.chart=new iChart.Charting.Chart(e),this.TA=new iChart.Charting.TA({chart:this.viewData.chart}),this.viewData.chart.setDataSettings(this.dataSource.dataSettings),this.ui=new iChart.ui(this)):(this.viewData.chart.chartOptions=$.extend(!0,this.viewData.chart.chartOptions,t),this.viewData.chart.overlay.deserialize(iChart.parseQueryString((this.dataSource.dataSettings.hash||"#").substr(1))),this.viewData.chart.setDataSettings(this.getChartDataUserSettings())),this.dataRequestCounter=0,this.ui.render(),$(window).off("mousemove").on("mousemove",function(t){$(window).data("mousePosX",t.pageX),$(window).data("mousePosY",t.pageY)})},this.chart_dataAdapter=function(t,e){var i={d:{xSeries:[],ySeries:[],success:!0,warnings:[],message:""}},a={chartType:"Column",enabled:!0,formatProvider:{decimalPlaces:"2",decimalPrecision:null},indicatorIndex:null,indicatorIndex2:null,kind:"HLOC",name:e.id,overlay:!1,points:[],valuesPerPoint:4},e={chartType:"Column",enabled:!0,formatProvider:{decimalPlaces:null,decimalPrecision:null},indicatorIndex:null,indicatorIndex2:null,kind:"Volume",name:e.id+" - V",overlay:!1,points:[],valuesPerPoint:1};if(t.hloc){var r=Object.keys(t.hloc);if(1==r.length){i.d.ySeries[0]=$.extend(!0,{},a),i.d.ySeries[1]=$.extend(!0,{},e),i.d.ySeries[0].name=r[0];for(var s=0;s<t.xSeries[r[0]].length;s++)i.d.xSeries.push(+t.xSeries[r[0]][s]+getTimeOffsetServer(tzOffsetMoscow)),i.d.ySeries[0].points.push(t.hloc[r[0]][s]),i.d.ySeries[1].points.push([t.vl[r[0]][s]])}else if(1<r.length){for(var n={},o=0;o<r.length;o++)for(s=0;s<t.xSeries[r[o]].length;s++)void 0===n[t.xSeries[r[o]][s]]&&(n[t.xSeries[r[o]][s]]={}),n[t.xSeries[r[o]][s]][r[o]]=t.hloc[r[o]][s];for(var h,o=0;o<r.length;o++)i.d.ySeries[o]=$.extend(!0,{},a),i.d.ySeries[o].name=r[o];for(h in n){i.d.xSeries.push(+h+getTimeOffsetServer(tzOffsetMoscow));for(o=0;o<r.length;o++)void 0===n[h][r[o]]?i.d.ySeries[o].points.push([null,null,null,null]):i.d.ySeries[o].points.push(n[h][r[o]])}}}return i},this.chart_onCreateAreas=function(){},this.chart_onDataSettingsChange=function(t){var e=0==o.dataSource.dataSettings.useHash?o.dataSource.dataSettings.hash||"#":document.location.hash,e=iChart.parseQueryString(e.substr(1)),e=o.getDrawParams(e);delete o.viewData.chart._dataSettings.hash;e="#"+iChart.toQueryString($.extend(o.viewData.chart._dataSettings,e));o.viewData.hash=e,0==o.dataSource.dataSettings.useHash?o.dataSource.dataSettings.hash!=e&&(o.dataSource.dataSettings.hash=e,$(this.container).trigger("iguanaChartEvents",["hashChanged",e])):document.location.hash!=e&&(document.location.hash=e,$(this.container).trigger("iguanaChartEvents",["hashChanged",e]))},this.getDrawParams=function(t){var e,i={};for(e in t)(e.match(/^L$/)||e.match(/^L[0-9]{1,2}_/))&&(i[e]=t[e]);return i},this.chart_onIntervalChange=function(t){o.viewData.chart&&o.viewData.chart.updateVolumeByPrice()},this.toggleVolumeByPrice_onClick=function(){var t;this.viewData.chart.chartOptions.showVolumeByPrice=!this.viewData.chart.chartOptions.showVolumeByPrice,this.viewData.chart&&this.viewData.chart.areas&&((t=$.grep(this.viewData.chart.areas,function(t){return"ChartArea2"===t.name})[0])&&(this.viewData.chart.updateVolumeByPrice(),t.enabled=this.viewData.chart.chartOptions.showVolumeByPrice),this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))},this.VolumeByPrice_onClick=function(t){o.viewData.chart.chartOptions.showVolumeByPrice=void 0!==t?t:!o.viewData.chart.chartOptions.showVolumeByPrice,o.viewData.chart&&o.viewData.chart.areas&&($.grep(o.viewData.chart.areas,function(t){return"VolumeByPriceArea"===t.name})[0]&&o.viewData.chart.updateVolumeByPrice(),o.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))},this.VolumeByDate_onClick=function(t){o.viewData.chart.chartOptions.showVolume=!0===t||!1===t?t?"inside":"hidden":"inside"==t||"outside"==t?t:"inside"===o.viewData.chart.chartOptions.showVolume||"outside"===o.viewData.chart.chartOptions.showVolume?"hidden":"inside",o.viewData.chart&&o.viewData.chart.areas&&((t=$.grep(o.viewData.chart.areas,function(t){return"ChartArea2"===t.name})[0])&&(t.enabled="inside"===o.viewData.chart.chartOptions.showVolume||"outside"===o.viewData.chart.chartOptions.showVolume),o.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))},this.apply_onClick=function(){o.update()},this.chartType_onChange=function(){var t=$(this).val();o.viewData.chart&&(o.viewData.chart.setChartType(t),o.chartType_elementControl(t)),o.setHashValue("type",t),o.viewData.chart.setChartType(t)},this.chartType_elementControl=function(t){$("div.chartType").removeClass("active"),$("div.chartType div.isMenu").hide(),$('div[value="'+t+'"]').addClass("active"),$('div[value="'+t+'"] div.isMenu').show()},this.clearIndicators_onClick=function(){for(var t=0;t<30;++t)$("[name='i"+t+"']").val("").trigger("change"),o.updateIndicatorDetails("i"+t,!1);o.viewData.chart&&o.viewData.chart.clearIndicators()},this.getChartDataUserSettings=function(){var t={};return t.id=this.dataSource.dataSettings.id,t.date_from=this.dataSource.dataSettings.date_from,t.date_to=this.dataSource.dataSettings.date_to,t.start=this.dataSource.dataSettings.date_from,t.end=this.dataSource.dataSettings.date_to,t.interval=this.dataSource.dataSettings.interval,t.timeframe=iChart.getChartTimeframe(this.dataSource.dataSettings.interval),t.type=this.dataSource.dataSettings.type,t.compareIds=this.dataSource.dataSettings.compareIds,t.compareTickets=this.dataSource.dataSettings.compareTickets,t.compareStocks=this.dataSource.dataSettings.compareStocks,$.extend(t,iChart.parseQueryString(this.dataSource.dataSettings.graphicIndicators)),t},this.getMinChartHeight=function(){var t=$(this.container);return 0!=t.length?$(window).height()-t.offset().top-(this.settings&&this.settings.paddingBottom?this.settings.paddingBottom:0):$(window).height()},this.indicator_onChange=function(){o.updateIndicatorDetails($(this).attr("name").substr(1),{name:$(this).val()})},this.loadHash=function(t){var e=$("[name=graphicIndicators]").val(),i=this.dataSource.dataSettings.hash||"#"+e||"#&i0=SMA&i0_Period=10&i1=PSAR&i1_Acceleration=0.02&i1_Maximum=0.2",e=iChart.parseQueryString(i.substr(1));return void 0!==this.viewData.chart&&("object"!=typeof(i=iChart.parseQueryString(localStorage.userSettingsGraphicIndicators))||$.isEmptyObject(i)||$.extend(e,i)),e},this.pan_onClick=function(){o.viewData.chart&&o.viewData.chart.pan($(this).attr("data-direction"))},this.timeframe_onChange=function(){this.update()},this.removeSelectedInstrument_onClick=function(){return o.viewData.chart.overlay&&o.viewData.chart.overlay.removeSelected(),!1},this.removeAllInstruments_onClick=function(){return o.viewData.chart.overlay&&o.viewData.chart.overlay.clear(),$(".m-chart-instrument-delete, .m-chart-instrument-settings").hide(),!1},this.resetZoom_onClick=function(){o.viewData.chart&&o.viewData.chart.resetZoom()},this.update=function(){var t=this.getChartDataUserSettings();0!=this.dataSource.dataSettings.useHash&&this.setHashValues(t),this.viewData.chart&&this.viewData.chart.setDataSettings(t)},this.updateForce=function(){var t=this.getChartDataUserSettings();0!=this.dataSource.dataSettings.useHash&&this.setHashValues(t),this.viewData.chart&&this.viewData.chart.setDataSettings(t,!0)},this.updateChart_onClick=function(){this.update()},this.removeIndicator_onClick=function(){$(this).parents(".js-chart-indiacator-block").remove()},this.addIndicator_onClick=function(){var t;o.uiGraphIndicatorsWindow2.element.is(":visible")&&(t=o.deserializeIndicators(o.uiGraphIndicatorsWindow2.element.find(":input").serialize(),!1),o.updateIndicatorDetails(t.length,""))},this.serializeIndicators=function(t){for(var e="",i=0;i<t.length;i++)if(e+="i"+i+"="+t[i].name+"&",t[i].params)for(var a in t[i].params)e+="i"+i+"_"+a+"="+t[i].params[a]+"&";return e},this.deserializeIndicators=function(t,e){e=void 0===e||!!e;var i,a,r,s=iChart.parseQueryString(t),n=[];for(i in s)"fs"!==i&&!i.match(new RegExp("^i[0-9]+","i"))||(a=i.match(new RegExp("^i([0-9])+_","i")),(r=i.match(new RegExp("^i([0-9])+$","i")))?(n[+r[1]]||(n[+r[1]]={}),n[+r[1]].name=s[i]):a&&(n[+a[1]]||(n[+a[1]]={}),n[+a[1]].params||(n[+a[1]].params={}),n[+a[1]].params[i.replace(/i[0-9]+_/i,"")]=+s[i]));return e&&(n=n.filter(function(t){return null!=t})),n},this.updateIndicatorDetails=function(t,e,i){i=!!i;var a=this.uiGraphIndicatorsWindow2.element.find(".js-chartTADialog-i"+t+"-settings");if(!a.length){var r,s='<option value="">'+_t("14773","Выберите индикатор")+"</option>";for(r in this.viewData.indicators)"TA_LIB"==this.viewData.indicators[r].type&&(s+='<option value="'+r+'" '+(r==e.name?"selected":"")+">"+this.viewData.indicators[r].name+"</option>");var n='<div style="border-bottom: 1px solid rgba(0, 0, 0, 0.12)" class="js-chart-indiacator-block tm-pad-large js-chartTADialog-i'+t+'-settings" id="iChart-i'+t+'-settings"><div class="uk-panel"><div class="uk-flex uk-flex-middle uk-flex-space-between uk-margin-small-bottom"><div class="uk-h4">'+_t("12834","Индикатор")+" "+(t+1)+'</div><div class="js-indicator-remove uk-icon-close uk-panel-hover uk-badge uk-button uk-button-mini"></div></div><div class="uk-form"><select name="i'+t+'" class="indicatorsSelect">'+s+"</select></div></div></div>";this.uiGraphIndicatorsWindow2.element.find(".js-chartTADialogContainer").append(n),a=this.uiGraphIndicatorsWindow2.element.find(".js-chartTADialog-i"+t+"-settings")}$(".iChart-indicator-description, .iChart-indicator-parameters, .iChart-indicator-colors, .iChart-indicator-width",a).remove();n=this.viewData.indicators[e.name]||{description:"",parameters:[]};$("<div/>",{class:"iChart-indicator-description"}).html(n.description).appendTo(a);for(var o=n.parameters,h=0;h<o.length;++h){var l="i"+t+"_"+o[h].Code,c=$("<div/>",{class:"iChart-indicator-parameters uk-form",text:o[h].Name+": "}).appendTo(a);$("<input/>",{name:l,type:"text",value:o[h].Value}).css({width:"50px"}).appendTo(c)}var d=$("<div/>",{class:"iChart-indicator-colors",id:"iChart-indicator-colors"}).appendTo(a),p=$("<div/>",{class:"iChart-indicator-width",id:"iChart-indicator-width"}).appendTo(a),u=t;if(this.viewData.indicators[e.name])for(var g,f=0;f<this.viewData.indicators[e.name].output;f++)void 0!==this.viewData.chart&&(g=this.viewData.chart.chartOptions.indicatorColors[u][f],this.userSettings.chartSettings.indicatorsColor[e.name]&&this.userSettings.chartSettings.indicatorsColor[e.name][u]&&this.userSettings.chartSettings.indicatorsColor[e.name][u][f]&&(g=this.userSettings.chartSettings.indicatorsColor[e.name][u][f]),$("<input/>",{type:"hidden",class:"iChart-indicator-color iChart-indicator-color-"+u+f,id:"iChart-indicator-color-"+u+f,indicator:e.name,colorIndex:u+"-"+f,"ui-pos":u<2?"bottom":"top"}).val(g).appendTo(d),this.initInsrMinicolors($(".iChart-indicator-color-"+u+f)),g=2,this.userSettings.chartSettings.indicatorsWidth[e.name]&&this.userSettings.chartSettings.indicatorsWidth[e.name][u]&&this.userSettings.chartSettings.indicatorsWidth[e.name][u][f]&&(g=this.userSettings.chartSettings.indicatorsWidth[e.name][u][f]),g=$('<span class="lineWidth indicatorWidthSelector-'+u+f+'" data-chartName="'+this.name+'" data-style="'+g+'"></span>').appendTo(p),$('<div class="indicatorMenuHolder-'+u+f+'" data-chartName="'+this.name+'" style="display: none" widthIndex="'+u+"-"+f+'"><div widthIndex="'+u+"-"+f+'" indicator="'+e.name+'"><span class="lineWidth js-lineWidth '+this.name+'" data-style="1"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="2"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="3"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="4"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="5"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="8"></span><span class="lineWidth js-lineWidth '+this.name+'" data-style="10"></span></div></div>').appendTo(p),this.initIndicatorWidthMenu(g,$(".indicatorMenuHolder-"+u+f+"[data-chartName='"+this.name+"']").html()));i&&this.update()},this.setIndicators=function(t){var n;window.localStorage.setItem("userSettingsGraphicIndicators",t),this.dataSource.dataSettings.graphicIndicators=t,this.setScheduleUpdateState(0),this.TA.removeIndicator(),void 0!==o.TA&&(n=iChart.parseQueryString(this.dataSource.dataSettings.graphicIndicators),$.each(n,function(t,e){var i={};if(e&&t.match(/^i[0-9]+$/)&&o.viewData.indicators[e]&&"TA_LIB"==o.viewData.indicators[e].type){for(var a=t.match(/^i([0-9]+)$/)[1],r=0;r<o.viewData.indicators[e].parameters.length;r++){var s=o.viewData.indicators[e].parameters[r];i[s.Code]=n[t+"_"+s.Code]}o.TA[e](0,a),o.TA[e](1,a,i)}})),this.wrapper.trigger("iguanaChartEvents",["hashChanged"]),this.wrapper.trigger("iguanaChartEvents",["indicatorsChanged",this.deserializeIndicators(this.dataSource.dataSettings.graphicIndicators)]),this.timers.updateInterval&&this.setScheduleUpdateState(1,this.timers.updateInterval)},this.showIndicators=function(t){t=t||{},this.timers.updateInterval=this.viewData.chart.chartOptions.updateInterval,this.setScheduleUpdateState(0);var e=this.deserializeIndicators(this.dataSource.dataSettings.graphicIndicators);this.uiGraphIndicatorsWindow2.element.find(".js-chartTADialogContainer").empty();for(var i=0;i<e.length;i++)for(var a in this.updateIndicatorDetails(i,e[i],!1),e[i].params){var r="i"+i+"_"+a;this.uiGraphIndicatorsWindow2.element.find("[name='"+r+"']").val(e[i].params[a])}t.forAll||this.uiGraphIndicatorsWindow2.element.find(".indicators-default").hide(),this.uiGraphIndicatorsWindow2.UIkit||($(this.wrapper).find(".js-chartTADialog."+this.name).appendTo("body"),this.uiGraphIndicatorsWindow2=UIkit.modal($(".js-chartTADialog."+this.name))),this.uiGraphIndicatorsWindow2.show(),$(".indicators-set").off("click"),$(".indicators-close").off("click"),$(".indicators-set").on("click",function(){return window.localStorage.setItem("userSettingsIndicatorsColor",JSON.stringify(o.userSettings.chartSettings.indicatorsColor)),window.localStorage.setItem("userSettingsIndicatorsWidth",JSON.stringify(o.userSettings.chartSettings.indicatorsWidth)),o.setIndicators(o.uiGraphIndicatorsWindow2.element.find(":input").serialize()),o.uiGraphIndicatorsWindow2.hide(),!1}),$(".indicators-close").on("click",function(){return o.uiGraphIndicatorsWindow2.hide(),o.timers.updateInterval&&o.setScheduleUpdateState(1,o.timers.updateInterval),!1})},this.window_onHashChange=function(){var t;void 0!==o&&(t=(0==o.dataSource.dataSettings.useHash?o.dataSource.dataSettings:document.location).hash,decodeURIComponent(t)!==decodeURIComponent(o.viewData.hash)&&(o.loadHash(),o.update(),void 0!==o.viewData.chart&&o.viewData.chart.overlay&&o.viewData.chart.overlay.update()))},this.zoom_onClick=function(){o.viewData.chart&&o.viewData.chart.zoom($(this).attr("data-zoom"))},this.percentMode_onClick=function(){return o.viewData.chart.chartOptions.percentMode?$("#percentMode").removeClass("active"):$("#percentMode").addClass("active"),o.viewData.chart.chartOptions.percentMode=!o.viewData.chart.chartOptions.percentMode,o.updateForce(),o.viewData.chart.chartOptions.percentMode},this.iconsLoad=function(){$(["/i/admin/add.png","/iguanachart/images/buy.png","/iguanachart/images/down.png","/iguanachart/images/icon-exclamation.png","/iguanachart/images/icon-left.png","/iguanachart/images/icon-leftDown.png","/iguanachart/images/icon-leftUp.png","/iguanachart/images/icon-question.png","/iguanachart/images/icon-right.png","/iguanachart/images/icon-rightDown.png","/iguanachart/images/icon-rightUp.png","/iguanachart/images/icon-sell.png","/iguanachart/images/icon-smileDown.png","/iguanachart/images/icon-smileUp.png","/iguanachart/images/icon-up.png","/i/logo_tradernet_min.png"]).preload()},this.drawLables=function(t,i,e,a){e=void 0===e?0:e,a=void 0===a?0:a;var r=$(t).clone();$(r).children("span").remove();var s=$(r).html().split(/ &nbsp; /),n=e,o=s[0].replace(/&nbsp;/g,"");i.font="normal 9px Arial,Helvetica,sans-serif",i.fillStyle="#636669",i.fillText(o,n,a),n+=i.measureText(o).width+10,$(t).children("span:odd").each(function(t,e){o=$(e).text(),i.font="bold 9px Arial,Helvetica,sans-serif",i.fillStyle=$(e).css("color"),i.fillText(o,n,a),n+=i.measureText(o).width,o=s[t+1].replace(/&nbsp;/g,""),i.font="normal 9px Arial,Helvetica,sans-serif",i.fillStyle="#636669",i.fillText(o,n,a),n+=i.measureText(o).width+10})},this.setMousewheelZoomState=function(t){this.viewData.chart.chartOptions.mousewheelZoom=!!t},this.setScheduleUpdateState=function(t){this.viewData.chart.chartOptions.updateInterval=!!t,this.viewData.chart.scheduleUpdate()},this.scrollBack=function(){this.viewData.chart.viewport.x.min=this.viewData.chart.areas[0].viewport.x.min,this.viewData.chart.viewport.x.max=this.viewData.chart.areas[0].viewport.x.max;var i=this.viewData.chart.viewport.x.max-this.viewData.chart.viewport.x.min,a=this.viewData.chart.viewport.x.min,t=1500+a;$("<p>").animate({width:a},{duration:t,step:function(t,e){o.viewData.chart.viewport.x.min=a-t,o.viewData.chart.viewport.x.max=o.viewData.chart.viewport.x.min+i,o.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0})}})},this.scrollForward=function(){this.viewData.chart.viewport.x.min=this.viewData.chart.areas[0].viewport.x.min,this.viewData.chart.viewport.x.max=this.viewData.chart.areas[0].viewport.x.max;var i=this.viewData.chart.viewport.x.max-this.viewData.chart.viewport.x.min,t=this.viewData.chart.areas[0].xSeries.length-1-this.viewData.chart.chartOptions.futureAmount,e=$("<p>").css({width:this.viewData.chart.viewport.x.max}),a=t-this.viewData.chart.viewport.x.max+1500;e.animate({width:t},{duration:a,step:function(t,e){o.viewData.chart.viewport.x.max=t,o.viewData.chart.viewport.x.min=t-i,o.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0})},complete:function(){o.viewData.chart.onDataSettingsChange.call(o.viewData.chart),o.wrapper.trigger("iguanaChartEvents",["hashChanged"])}})},this.scrollTo=function(e){var t=e.xSpeed;if(t<.05)return!1;var i=1e3+100*t,a=t,r=-a/i,s=this,n=this.viewData.chart.viewport.x.min,o=this.viewData.chart.viewport.x.max;iChart.animate({duration:i,timing:function(t){return t},draw:function(t){!isNaN(t)&&0<t&&(t=i*t,t=a*t+r*t*t/2,t=s.viewData.chart.areas[0].getXIndexByValue(s.viewData.chart.areas[0].getXValue(s.viewData.chart.areas[0].getXPositionByIndex(0)+t)),e.x1>e.x2?(s.viewData.chart.viewport.x.min=n+t,s.viewData.chart.viewport.x.max=o+t):e.x1<e.x2&&(s.viewData.chart.viewport.x.min=n-t,s.viewData.chart.viewport.x.max=o-t),s.viewData.chart._fixViewportBounds(),s.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!0}))},complete:function(){s.viewData.chart.loadMissingData()}})},this.updateLastCandle=function(t){var e,i,a,r;t&&(e=t,void 0!==this.viewData.chart&&this.viewData.chart.areas&&this.viewData.chart.canvas&&this.viewData.chart.chartOptions.updateInterval&&e.ltp&&(r=new Date(1e3*this.viewData.chart.areas[0].xSeries[this.viewData.chart.areas[0].xSeries.length-this.viewData.chart.chartOptions.futureAmount-1]),(t=new Date(t.ltt)).getTime()>=r.getTime()&&t.getTime()<r.getTime()+6e4*this.viewData.chart._dataSettings.timeframe?((i=this.viewData.chart.areas[0].ySeries[0].points[this.viewData.chart.areas[0].ySeries[0].points.length-this.viewData.chart.chartOptions.futureAmount-1])[3]=e.ltp,i[0]=Math.max(i[0],i[3]),i[1]=Math.min(i[1],i[3]),i[4]=e.bap,i[5]=e.bbp,a=iChart.getContext(this.viewData.chart.canvas),this.viewData.chart.render({context:a,forceRecalc:!1,resetViewport:!1,testForIntervalChange:!1})):t.getTime()>r.getTime()+6e4*this.viewData.chart._dataSettings.timeframe&&(i=this.getLastPoint(),a={hloc:{},vl:{},xSeries:{}},(r=[])[0]=e.ltp,r[1]=e.ltp,r[2]=e.ltp,r[3]=e.ltp,a.hloc[Object.keys(i.xSeries)[0]]=[r],a.vl[Object.keys(i.xSeries)[0]]=[e.vol],t=(t.getTime()-t.getTime()%(6e4*this.viewData.chart._dataSettings.timeframe))/1e3-getTimeOffsetServer(tzOffsetMoscow),a.xSeries[Object.keys(i.xSeries)[0]]=[t],this.addPoint(a))))},this.getLastPoint=function(){if(void 0!==this.viewData.chart&&this.viewData.chart.areas&&this.viewData.chart.canvas){var i=this.viewData.chart.areas[0].ySeries[0].points.length-this.viewData.chart.chartOptions.futureAmount-1,a=this.viewData.chart.areas[0].ySeries[0].name,r={},s={},t={};return t[a]=[this.viewData.chart.areas[0].xSeries[i]],$.each(this.viewData.chart.areas,function(t,e){$.each(e.ySeries,function(t,e){0<=$.inArray(e.kind,["HLOC","Volume"])&&("HLOC"==e.kind&&(r[a]=[e.points[i]]),"Volume"==e.kind&&(s[a]=[e.points[i]]))})}),{hloc:r,vl:s,xSeries:t}}},this.getLastPointX=function(){if(void 0!==this.viewData.chart&&this.viewData.chart.areas&&this.viewData.chart.canvas){var t=this.viewData.chart.areas[0].ySeries[0].points.length-this.viewData.chart.chartOptions.futureAmount-1;return this.viewData.chart.areas[0].xSeries[t]}return!1},this.addTransactions=function(t,e){if(void 0!==this.viewData.chart){t:for(var i=0;i<t.length;i++){for(var a,r=this.viewData.chart.overlay.history,s=0;s<r.length;s++)if("Trade"==(a=r[s]).elementType&&a.id==t[i].id)continue t;(a=this.viewData.chart.overlay.createElement("Trade")).hasSettings=!0,a.settings=t[i],a.settings.mode=e,a.points=[{x:new Date(t[i].date_time).getTime(),y:t[i].price}],a.id=t[i].id,this.viewData.chart.overlay.history.push(a),this.userTransactionAmount++}this.viewData.chart.overlay.render()}},this.removeTransactions=function(){if(void 0!==this.viewData.chart){for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++)"Trade"==t[e].elementType&&(t.splice(e,1),e--);this.userTransactionAmount=-1,this.viewData.chart.overlay.render()}},this.setButton=function(t){var e;void 0!==this.viewData.chart&&((e=this.viewData.chart.overlay.createElement("Button")).hasSettings=!0,e.setSettings(t),e.points=[{x:t.point,y:t.price}],this.viewData.chart.overlay.history.push(e))},this.updateNewOrderButton=function(){var t=this.viewData.chart.areas[0].getXPositionByIndex(this.viewData.chart.areas[0].xSeries.length-1-this.viewData.chart.chartOptions.futureAmount)+50,t=Math.min(t,this.viewData.chart.areas[0].getXPositionByIndex(this.viewData.chart.areas[0].xSeries.length-1)),e=1e3*this.viewData.chart.areas[0].getXValue(t),i=this.viewData.chart.areas[0].ySeries[0].points[this.viewData.chart.areas[0].ySeries[0].points.length-this.viewData.chart.chartOptions.futureAmount-1],t=this.getNewOrderButton();t?(t.points[0].x=e,t.points[0].y=i[3]):this.setButton({point:e,price:i[3],click:function(){var t=o.viewData.chart.areas[0].ySeries[0].points[o.viewData.chart.areas[0].ySeries[0].points.length-o.viewData.chart.chartOptions.futureAmount-1];jNTChartTrading.show(o.userSettings.currentSecurity.nt_ticker,2,iChart.roundToPrecision(t[3],o.userSettings.currentSecurity.min_step),null,null,function(){o.addVisualTradeUI()}),o.removeNewOrderButton()}})},this.getNewOrderButton=function(){if(void 0!==this.viewData.chart)for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++){var i=t[e];if("Button"==i.elementType)return i}return!1},this.removeNewOrderButton=function(){if(void 0!==this.viewData.chart)for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++)"Button"==t[e].elementType&&(t.splice(e,1),e--)},this.removeLevel=function(){if(void 0!==this.viewData.chart)for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++)"Level"==t[e].elementType&&(t.splice(e,1),e--)},this.addLevel=function(t){if(void 0===this.viewData.chart)return!1;this.removeLevel();var e=this.viewData.chart.overlay.createElement("Level");return e.hasSettings=!0,e.points=[{x:new Date,y:t.price}],e.setSettings(t),this.viewData.chart.overlay.history.push(e),this.viewData.chart.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!1}),e},this.fixViewport=function(){void 0!==this.viewData.chart&&this.viewData.chart.areas&&this.viewData.chart.areas[0].viewport.x.max==this.viewData.chart.areas[0].viewport.x.min&&(this.viewData.chart.viewport.x.max=this.viewData.chart.areas[0].viewport.x.max-this.viewData.chart.chartOptions.futureAmount,this.viewData.chart.viewport.x.min=Math.max(this.viewData.chart.areas[0].viewport.x.max-this.viewData.chart.chartOptions.futureAmount-30,0),this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1}))},this.switchTrading=function(){this.userSettings.chartSettings.tradingToolsEnable=this.userSettings.chartSettings.tradingToolsEnable?0:1,window.localStorage.setItem("userSettingsTradingToolsEnable",this.userSettings.chartSettings.tradingToolsEnable),$(this.container).trigger("iguanaChartEvents",["chartTradingTools",this.userSettings.chartSettings.tradingToolsEnable])},this.tradingToolsControl=function(){this.userSettings.chartSettings.tradingToolsEnable},this.addEvents=function(t){t=t||[];for(var e=0;e<t.length;e++){var i=this.viewData.chart.overlay.createElement("Event");i.hasSettings=!0;var a=$.extend({},t[e]);i.setSettings(a),i.points=[{x:a.x,y:a.y}],i.id="Event",this.viewData.chart.overlay.history.push(i)}this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})},this.clearEvents=function(){if(void 0!==this.viewData.chart){for(var t=this.viewData.chart.overlay.history,e=0;e<t.length;e++)"Event"==t[e].elementType&&(t.splice(e,1),e--);this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}},this.checkDateInterval=function(t,e){var i=iChart.formatDateTime(new Date(t),"dd.MM.yyyy HH:mm"),a=iChart.formatDateTime(new Date(e),"dd.MM.yyyy HH:mm");this.dataSource.dataSettings.date_from!=i||this.dataSource.dataSettings.date_to,this.dataSource.dataSettings.date_from=i,this.dataSource.dataSettings.date_to=a,this.dataSource.dataSettings.start=i,this.dataSource.dataSettings.end=a;var a=this.dataSource.dataSettings.interval,t=((new Date).getTime()-t)/864e5,r=new Array;r.push("I1"),r.push("I5"),r.push("I15"),r.push("H1"),r.push("D1"),r.push("D7");var s={};93<t?s={I1:"D1",I5:"D3",I15:"D7",H1:"M1"}:t<93&&32<=t?s={I1:"D1",I5:"D3",I15:"D7"}:t<32&&10<=t?s={I1:"D1",I5:"D3"}:t<10&&3<=t&&(s={I1:"D1"});for(var n=new Array,o=0;o<r.length;o++){var h=intervalNames(r[o])+(void 0!==s[r[o]]?" > "+intervalShortNames(s[r[o]]):"");n.push({text:h,value:r[o],restriction:s[r[o]]})}t={restriction:s,dataSource:n,value:this.dataSource.dataSettings.interval=a,text:intervalNames(a)};return JSON.stringify(this.dataSource.dataSettings.intervalRestriction)!=JSON.stringify(s)&&a==this.dataSource.dataSettings.interval&&(this.dataSource.dataSettings.intervalRestriction=s,$(this.container).trigger("iguanaChartEvents",["intervalRestriction",t])),t},this.checkPeriodInterval=function(t,e){void 0===e&&(e=!0);var i=new Date,a=new Date,t=$(t).val();switch(t){case"D1":break;case"D7":a.setDate(i.getDate()-7);break;case"M1":a.setMonth(i.getMonth()-1);break;case"M3":a.setMonth(i.getMonth()-3);break;case"M6":a.setMonth(i.getMonth()-6);break;case"Y1":a.setFullYear(i.getFullYear()-1);break;case"Y5":a.setFullYear(i.getFullYear()-5);break;default:a.setMonth(i.getMonth()-3)}t?($("#date_to").val(iChart.formatDateTime(i,"dd.MM.yyyy")),$("#date_from").val(iChart.formatDateTime(a,"dd.MM.yyyy"))):(t=(Date.parse($("#date_to").val())-Date.parse($("#date_from").val()))/1e3,"D1"==$("#interval").val()&&t<86400?$("#date_from").val(iChart.formatDateTime(new Date(Date.parse($("#date_from").val()).getTime()-6048e5),"dd.MM.yyyy")):"D7"==$("#interval").val()&&t<604800&&$("#date_from").val(iChart.formatDateTime(new Date(Date.parse($("#date_from").val()).getTime()-12096e5),"dd.MM.yyyy")))},this.checkPeriod=function(t){var e=iChart.parseDateTime(this.dataSource.dataSettings.date_to),i=new Date(e),a=t.match(/([D,M,Y])(\d+)/);if(a)switch(a[1]){case"D":i.setDate(e.getDate()-+a[2]);break;case"M":i.setMonth(e.getMonth()-+a[2]);break;case"Y":i.setFullYear(e.getFullYear()-+a[2])}else t="D1";t?(this.dataSource.dataSettings.date_from=iChart.formatDateTime(i,"dd.MM.yyyy"),this.dataSource.dataSettings.date_to=iChart.formatDateTime(e,"dd.MM.yyyy")):(t=(iChart.parseDateTime(this.dataSource.dataSettings.date_from).getTime()-iChart.parseDateTime(this.dataSource.dataSettings.date_to).getTime())/1e3,"D1"==this.dataSource.dataSettings.interval&&t<86400?this.dataSource.dataSettings.date_from=iChart.formatDateTime(new Date(iChart.parseDateTime(this.dataSource.dataSettings.date_from).getTime()-6048e5),"dd.MM.yyyy"):"D7"==this.dataSource.dataSettings.interval&&t<604800&&(this.dataSource.dataSettings.date_from=iChart.formatDateTime(new Date(iChart.parseDateTime(this.dataSource.dataSettings.date_from).getTime()-12096e5),"dd.MM.yyyy"))),this.checkDateInterval(iChart.parseDateTime(this.dataSource.dataSettings.date_from),iChart.parseDateTime(this.dataSource.dataSettings.date_to))},this.setInterval=function(t){var e="M1";switch(t){case"I1":e="D1";break;case"I5":e="D3";break;case"I15":e="D7";break;case"H1":e="D14";break;case"D1":e="M6";break;case"D7":e="Y1"}var i=new Date(1e3*this.getLastPointX());i.setHours(0),i.setMinutes(0),i.setSeconds(0),i.setDate(i.getDate()+1),this.dataSource.dataSettings.date_to=i,this.dataSource.dataSettings.interval=t,this.dataSource.dataSettings.timeframe=iChart.getChartTimeframe(t),this.checkPeriod(e),this.updateForce()},this.setHashValue=function(t,e){var i;i=(0==this.dataSource.dataSettings.useHash?this.dataSource.dataSettings:document.location).hash;var a=iChart.parseQueryString(i.substr(1));a[t]=e;a="#"+iChart.toQueryString(a);a!==i&&(0==this.dataSource.dataSettings.useHash?this.dataSource.dataSettings.hash=a:document.location.hash=a,$(this.container).trigger("iguanaChartEvents",["hashChanged",a]))},this.setHashValues=function(t){var e;e=(0==this.dataSource.dataSettings.useHash?this.dataSource.dataSettings:document.location).hash;var i,a=iChart.parseQueryString(e.substr(1));for(i in t)t.hasOwnProperty(i)&&(a[i]=t[i]);var r="#"+iChart.toQueryString(a);r===e||$.isEmptyObject(a)||(0==this.dataSource.dataSettings.useHash?this.dataSource.dataSettings.hash=r:document.location.hash=r,$(this.container).trigger("iguanaChartEvents",["hashChanged",r]))},this.initInsrMinicolors=function(t){var e=t.val();$(t).minicolors({animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,control:"hue",defaultValue:e,hide:null,hideSpeed:100,inline:!1,letterCase:"lowercase",opacity:!1,position:t.attr("ui-pos")+" left",show:null,showSpeed:100,theme:"default"}).change(function(){var t=$(this).attr("colorIndex").split("-")[0],e=$(this).attr("colorIndex").split("-")[1],i=$(this).attr("indicator");$.isArray(o.userSettings.chartSettings.indicatorsColor)&&(o.userSettings.chartSettings.indicatorsColor={}),o.userSettings.chartSettings.indicatorsColor[i]||(o.userSettings.chartSettings.indicatorsColor[i]=[]),o.userSettings.chartSettings.indicatorsColor[i][t]||(o.userSettings.chartSettings.indicatorsColor[i][t]=Array(o.viewData.indicators[i].output)),o.userSettings.chartSettings.indicatorsColor[i][t][e]=$(this).val()})},this.initIndicatorWidthMenu=function(t,e){$(t).qtip({style:{classes:"qtip-light"},position:{at:"left bottom",my:"top left",effect:!1},content:{text:e},hide:{fixed:!0,delay:300,effect:function(){$(this).slideUp(500)}},show:{solo:!0,effect:function(){$(this).slideDown(500)}},events:{show:function(t,e){}}})},this.setIndicatorWidth=function(t){var e=$(t).parent().attr("widthIndex").split("-")[0],i=$(t).parent().attr("widthIndex").split("-")[1],a=$(t).parent().attr("indicator");$.isArray(this.userSettings.chartSettings.indicatorsWidth)&&(this.userSettings.chartSettings.indicatorsWidth={}),this.userSettings.chartSettings.indicatorsWidth[a]||(this.userSettings.chartSettings.indicatorsWidth[a]=[]),this.userSettings.chartSettings.indicatorsWidth[a][e]||(this.userSettings.chartSettings.indicatorsWidth[a][e]=Array(this.viewData.indicators[a].output)),$(".indicatorWidthSelector-"+e+i+"[data-chartName='"+this.name+"']").attr("data-style",$(t).attr("data-style")),this.userSettings.chartSettings.indicatorsWidth[a][e][i]=$(t).attr("data-style")},this.getIndicatorParameters=function(t){var e={};if(void 0!==this.viewData.indicators[t])for(var i=0;i<this.viewData.indicators[t].parameters.length;i++)e[this.viewData.indicators[t].parameters[i].Code]=this.viewData.indicators[t].parameters[i].Value;return e},this.setIndicator=function(t,e,i){if(i=i||0,void 0===this.viewData.indicators[t])throw new Error("Indicator '"+t+"' is not supported.");e=e||this.getIndicatorParameters(t);var a,r={};for(a in r["i"+i]=t,e)r["i"+i+"_"+a]=e[a];var s,n=iChart.parseQueryString(this.dataSource.dataSettings.graphicIndicators);for(s in n)s.match(new RegExp("^i"+i+"_","i"))&&delete n[s];n["i"+i]="",this.dataSource.dataSettings.graphicIndicators=iChart.toQueryString($.extend({},n,r)),this.updateForce()},this.getPeriodDates=function(t){var e=new Date,i=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setDate(e.getDate()+1),i.setHours(0),i.setMinutes(0),i.setSeconds(0);var a=t.match(/([D,M,Y])(\d+)/);if(a)switch(a[1]){case"D":i.setDate(i.getDate()-+a[2]+1);break;case"M":i.setMonth(i.getMonth()-+a[2]);break;case"Y":i.setFullYear(i.getFullYear()-+a[2])}else i.setMonth(i.getMonth()-3);return{date_from:iChart.formatDateTime(i,"dd.MM.yyyy"),date_to:iChart.formatDateTime(e,"dd.MM.yyyy")}},this.addPoint=function(t){t=this.dataSource.dataAdapter(t,{});this.viewData.chart._mergeData(t,{}),this.viewData.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})},this.setStyleToCanvas=function(t,e){var i,a=this.viewData.chart.overlay.selected;null!=a&&a.hasSettings&&((i=a.settings)[e]=t,a.setSettings(i),this.viewData.chart.chartOptions.elementStyle[a.elementType]&&(this.viewData.chart.chartOptions.elementStyle[a.elementType][e]=t)),this.userSettings.chartSettings.contextSettings[e]=t},this.setLineWidthToCanvas=function(t){var e=this.viewData.chart.overlay.selected;null!=e&&e.hasSettings&&(e.settings.lineWidth=t,e.setSettings(e.settings)),this.userSettings.chartSettings.contextSettings.lineWidth=t},"undefined"!=typeof jNTChartTrading&&("undefined"!=typeof jNTUserinfo&&jNTUserinfo.isDemo?"function"==typeof extendIChartWithTrandorders&&extendIChartWithTrandorders.call(this):"function"==typeof extendIChartWithOrders&&extendIChartWithOrders.call(this),"function"==typeof extendIChartWithPositions&&extendIChartWithPositions.call(this),"function"==typeof extendIChartWithTradePanels&&extendIChartWithTradePanels.call(this)),this.setTrendorder=function(t){var e;void 0!==this.viewData.chart&&((e=this.viewData.chart.overlay.createElement("Trendorder")).hasSettings=!0,e.setSettings(t),this.viewData.chart.overlay.history.push(e))},this.drawTrendorder=function(){var t={date:14727987e5,price:142.73127071556314,date2:14727996e5,price2:142.75374359194433,tf:900,fillStyle:"#7cb342",strokeStyle:"#36BDF4",textColor:"#ffffff",text:"Трендовый приказ",mode:"trend",onCancel:function(){console.log(this)}};this.setTrendorder(t),this.viewData.chart.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!1})},$(document).on("change",".indicatorsSelect",this.indicator_onChange),$(document).on("click",".js-indicator-remove",this.removeIndicator_onClick),$(document).on("click",".js-indicator-add",this.addIndicator_onClick),$(document).on("change","[name='timeframe']",this.timeframe_onChange),$(document).on("click","[name='apply']",this.apply_onClick),$(document).on("click","[name='clearIndicators']",this.clearIndicators_onClick),$(document).on("click","[name='pan']",this.pan_onClick),$(document).on("click",".js-lineWidth."+this.name,function(){o.setIndicatorWidth(this)}),$(document).on("click","[name='resetZoom']",this.resetZoom_onClick),$(document).on("click","[name='updateChart']",this.updateChart_onClick),$(document).on("click","[name='zoom']",this.zoom_onClick),$(document).on("dblclick",function(){o.viewData.chart.render({forceRecalc:!0,resetViewport:!0,testForIntervalChange:!1})}),$(o.wrapper).on("iguanaChartEvents",function(t,e,i){"chartDataReady"===e?o.viewData.chart&&0==o.dataRequestCounter&&(o.viewData.chart.updateVolumeByPrice(),o.ui.initStatesControls()):"selectInstrument"===e?o.ui.onSelectInstrument(i):"drawComplete"===e&&(o.ui.setUiStateForInstrumentLine(null,0),o.ui.setUiStateForInstrumentForm(null,0),o.ui.setUiStateForInstrumentText(null,0))}),$(o.wrapper).on("click",".iChart-indicator-description a",function(t){return t.stopPropagation(),t.stopImmediatePropagation(),!1}),$(window).on("resize",function(){o.wrapper.trigger("iguanaChartEvents",["chartResize"])}),$(document).on("click","[name='toggleVolumeByPrice']",this.toggleVolumeByPrice_onClick)},function(){"use strict";iChart.ui=function(t){this.chart=t;var h=this;this.$uiContainer=this.chart.wrapper,this.$topToolBarContainer=this.chart.wrapper.find(".iChartToolsTop"),this.render=function(){this.chart.viewData.chart.chartOptions.uiTools.top&&this.renderTopBar(),this.bindUiControls()},this.renderTopBar=function(){this.$topToolBarContainer.empty(),this.renderTopToolBar(),this.$topToolBarContainer.show()},this.renderIndicators=function(){var t={indicators:Object.keys(iChart.indicators).map(function(t){return iChart.indicators[t]}),userData:this.chart.deserializeIndicators(this.chart.dataSource.dataSettings.graphicIndicators)},t=$.render.indicatorsDropdownTmpl(t);this.chart.wrapper.find(".js-chart-ui-indicators").append(t),$(this.chart.wrapper).off("click",".js-add-indicator").on("click",".js-add-indicator",function(){var t=$(this).data("value"),e={};iChart.indicators[t].parameters.forEach(function(t){e[t.Code]=t.Value});var i=h.chart.deserializeIndicators(h.chart.dataSource.dataSettings.graphicIndicators);i.push({name:t,params:e}),h.chart.dataSource.dataSettings.graphicIndicators=h.chart.serializeIndicators(i),h.chart.setIndicators(h.chart.dataSource.dataSettings.graphicIndicators),h.renderIndicatorsCurrent()}),$(this.chart.wrapper).off("click",".js-remove-indicator").on("click",".js-remove-indicator",function(t){var e=h.chart.deserializeIndicators(h.chart.dataSource.dataSettings.graphicIndicators);e.splice($(this).data("index"),1),h.chart.dataSource.dataSettings.graphicIndicators=h.chart.serializeIndicators(e),h.chart.setIndicators(h.chart.dataSource.dataSettings.graphicIndicators),h.renderIndicatorsCurrent(),t.stopPropagation(),t.preventDefault()}),$(this.chart.wrapper).off("click",".js-edit-indicator").on("click",".js-edit-indicator",function(t){var e=h.chart.deserializeIndicators(h.chart.dataSource.dataSettings.graphicIndicators),i=$(this).data("index"),a=$.extend({},iChart.indicators[e[i].name]);a.parameters.forEach(function(t){t.Value=e[i].params[t.Code]}),h.renderIndicatorDialog(a,i)})},this.renderIndicatorsList=function(){var t={indicators:Object.keys(iChart.indicators).map(function(t){return iChart.indicators[t]})},t=$.render.indicatorsListTmpl(t);this.$topToolBarContainer.find(".js-iChartTools-indicators-list").html(t)},this.renderIndicatorsCurrent=function(){var t={userData:this.chart.deserializeIndicators(this.chart.dataSource.dataSettings.graphicIndicators)},t=$.render.indicatorsCurrentTmpl(t);this.$topToolBarContainer.find(".js-iChartTools-indicators-current").html(t)},this.renderIndicatorDialog=function(t,i){$.modal.impl.d.data&&$.modal.impl.close(),$(".iChartDialog").remove();var e=$($.render.indicatorDialogTmpl(t)),a=e.find(".js-iChartTools-indicators-colorContainer"),r=e.find(".js-iChartTools-indicators-widthContainer"),s=i;if(iChart.indicators[t.value])for(var n,o=0;o<iChart.indicators[t.value].output;o++)void 0!==this.chart.viewData.chart&&(n=this.chart.viewData.chart.chartOptions.indicatorColors[s][o],this.chart.userSettings.chartSettings.indicatorsColor[t.value]&&this.chart.userSettings.chartSettings.indicatorsColor[t.value][s]&&this.chart.userSettings.chartSettings.indicatorsColor[t.value][s][o]&&(n=this.chart.userSettings.chartSettings.indicatorsColor[t.value][s][o]),$("<input/>",{type:"hidden",class:"iChart-indicator-color iChart-indicator-color-"+s+o,id:"iChart-indicator-color-"+s+o,indicator:t.value,colorIndex:s+"-"+o,"ui-pos":s<2?"bottom":"top"}).val(n).appendTo(a),this.chart.initInsrMinicolors(a.find(".iChart-indicator-color-"+s+o)),n=2,this.chart.userSettings.chartSettings.indicatorsWidth[t.value]&&this.chart.userSettings.chartSettings.indicatorsWidth[t.value][s]&&this.chart.userSettings.chartSettings.indicatorsWidth[t.value][s][o]&&(n=this.chart.userSettings.chartSettings.indicatorsWidth[t.value][s][o]),n=$('<span class="lineWidth indicatorWidthSelector-'+s+o+'" data-chartName="'+this.chart.name+'" data-style="'+n+'"></span>').appendTo(r),$('<div class="indicatorMenuHolder-'+s+o+'" data-chartName="'+this.chart.name+'" style="display: none" widthIndex="'+s+"-"+o+'"><div widthIndex="'+s+"-"+o+'" indicator="'+t.value+'"><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="1"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="2"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="3"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="4"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="5"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="8"></span><span class="lineWidth js-lineWidth '+this.chart.name+'" data-style="10"></span></div></div>').appendTo(r),this.chart.initIndicatorWidthMenu(n,r.find(".indicatorMenuHolder-"+s+o+"[data-chartName='"+this.chart.name+"']").html()));$(document).off("click",".js-set-params-indicator").on("click",".js-set-params-indicator",function(t){var e=h.chart.deserializeIndicators(h.chart.dataSource.dataSettings.graphicIndicators);$(".js-iChartTools-indicators-params input").serializeArray().forEach(function(t){e[i].params[t.name]=t.value}),e=h.chart.serializeIndicators(e),h.chart.setIndicators(e),$.modal.impl.close()}),this.chart.wrapper.append(e),$(".iChartDialog").modal({modal:!1,zIndex:1500,title:_t("17398","Настройки индикатора")})},this.renderThemeConfigDialog=function(t){t=t||[];var e,i=$($.render.themeConfigTmpl());t&&((e=i.find(".js-themeAdditionButtons")).empty(),t.forEach(function(t){t=$("<button/>",{class:"uk-button "+t.class,text:t.title});e.append(t)})),i.find(".js-themeConfigOptions").empty().append(this.renderThemeConfigOptions()),i.find(".js-themeConfigSelector").empty().append(this.renderThemeConfigSelector()),i.data("chartOptions",$.extend(!0,{},this.chart.wrapper.iguanaChart("chartOptions"))),this.chart.wrapper.find(".js-themeConfig").remove(),this.chart.wrapper.append(i);function a(){h.chart.wrapper.iguanaChart("chartOptions",i.data("chartOptions")),h.setUiStateForThemeConfig(!1),$.modal.impl.d.data&&$.modal.impl.close()}var r=this.chart.wrapper.find(".js-themeConfig");return r.modal({modal:!1,draggable:!0,maxWidth:600,zIndex:1500,title:_t("13754","Настройки вида"),onClose:a}),r.on("click",".js-chartOptions",function(){switch($(this).attr("data-value")){case"ok":h.chart.wrapper.trigger("iguanaChartEvents",["hashChanged"]),h.chart.wrapper.trigger("iguanaChartEvents",["chartOptionsChanged",iChart.Charting.ChartOptions.getThemeOptions(h.chart.viewData.chart.chartOptions)]),h.chart.userSettings.chartSettings.defaultTheme=0,h.setUiStateForThemeConfig(!1),$.modal.impl.d.data&&$.modal.impl.close(!1);break;case"cancel":a()}}),r.on("click",".js-themeSelect",function(){return h.chart.wrapper.iguanaChart("setTheme",$(this).data("theme")),i.find(".js-themeConfigOptions").empty().append(h.renderThemeConfigOptions()),!1}),r.on("click",".js-themeSaveAs",function(){return UIkit.modal.prompt(_t("5228","Название")+":","",function(t){t&&(t={name:t,settings:iChart.Charting.ChartOptions.getThemeOptions(h.chart.viewData.chart.chartOptions)},$iguanaChart.thems.push($.extend({custom:!0},t)),t=JSON.stringify(t),h.chart.wrapper.trigger("iguanaChartEvents",["themeSave",t]),i.find(".js-themeConfigSelector").empty().append(h.renderThemeConfigSelector()))}),!1}),r.on("click",".js-themeDelete",function(t){var i=$(this).data("name"),e=$.grep($iguanaChart.thems,function(t,e){return t.name==i?t.i=e:null})[0];return $iguanaChart.thems.splice(e,1),r.find('.js-themeSelect[data-theme="'+i+'"]').remove(),h.chart.wrapper.trigger("iguanaChartEvents",["themeDelete",i]),t.stopPropagation(),!1}),r},this.renderThemeConfigSelector=function(){return $($.render.themeConfigSelectorTmpl({themes:$iguanaChart.thems}))},this.renderThemeConfigOptions=function(){var t=$($.render.themeConfigOptionsTmpl({chartOptions:h.chart.viewData.chart.chartOptions}));t.find(".js-widthSlector").each(function(){var i=$(this),t=i.find(".menuHolder").html();i.qtip({style:{classes:"qtip-light"},position:{at:"center right",my:"left center",effect:!1},content:{text:t},hide:{fixed:!0,delay:300,effect:function(){$(this).slideUp(500)}},show:{solo:!0,effect:function(){$(this).slideDown(500)}},events:{show:function(t,e){$(this).find(".js-widthSlectorWrapper").each(function(){var e=$(this);e.off().on("click",".js-lineWidth",function(){var t=$(this).attr("data-style");h.chart.wrapper.iguanaChart("chartOptions",e.attr("data-option"),t),i.find(".js-widthSlectorValue").attr("data-style",t)})})}}})});function i(t,e){var i=$(this).val(),a=i,r=$(this).attr("data-option");i.match(/^rgb.*/)||(a=iChart.hexToRGB(i,e)),h.chart.wrapper.iguanaChart("chartOptions",r,a),$(".js-colorSelector[data-option='"+r+"']").css({"background-color":a}),$(this).minicolors("value",i),$(this).minicolors("opacity",e)}function a(){var t=this.value,e=iChart.hexToRGB(t,1),i=this.element.attr("data-option");h.chart.wrapper.iguanaChart("chartOptions",i,e),$(".js-colorSelector[data-option='"+i+"']").css({"background-color":e}),this.element.parent().find(".js-colorPicker").minicolors("value",t)}return t.find(".js-colorSelector").each(function(){var t=$(this),e=t.find(".menuHolder").html();t.qtip({style:{classes:"qtip-light"},position:{at:"center right",my:"left center",effect:!1,viewport:$("html"),adjust:{method:"shift none"}},content:{text:e},hide:{fixed:!0,delay:300},show:{solo:!0},events:{show:function(t,e){$(t.currentTarget).find(".js-colorPicker").each(function(){h.addMinicolors(this,t.currentTarget,i,a)})}}})}),t.find(".js-checkbox").on("click",".js-flag",function(){h.chart.wrapper.iguanaChart("chartOptions",$(this).attr("data-option"),$(this).prop("checked"))}),t},this.initMinicolors=function(t,e){e="function"==typeof e?e:function(){};var i=$(t),a=!!i.first().attr("data-opacity"),i=(i.first().attr("data-opacity"),(i=i.first().val())||"rgba(82, 175, 201, 0.5)");$(t).minicolors({animationSpeed:50,animationEasing:"swing",change:e,changeDelay:0,control:"hue",defaultValue:i,hide:null,hideSpeed:100,inline:!0,letterCase:"lowercase",opacity:a,position:"bottom left",show:null,showSpeed:100,theme:"default"}),$(t).minicolors("value",i)},this.initColorPalette=function(t,e){e="function"==typeof e?e:function(){},$(t).find(".js-colorPalette").each(function(){null==$(this).data("palette")&&$(this).palette({palette:"basic",columns:2,size:13,change:e})})},this.addMinicolors=function(t,e,i,a){var r;$(t).hasClass("minicolors-input")?(r=$(t).val(),$(t).minicolors("value",r)):(this.initMinicolors(t,i),this.initColorPalette(e,a))},this.renderTopToolBar=function(){var t=$($.render.iChart_topToolBarTmpl());this.$topToolBarContainer.append(t),this.renderIndicators()},this.initStatesControls=function(){var t=this.chart.viewData.chart.chartOptions.chartType;this.setUiStateForChartType(t);t=!!this.chart.viewData.chart.chartOptions.showVolumeByPrice;this.setUiStateForShowVolumeByPrice(t);t=h.chart.viewData.chart.chartOptions.showVolume;this.setUiStateForShowVolume(t);t=h.chart.viewData.chart.chartOptions.percentMode;this.setUiStateForPercentMode(t),this.setUiStateForDataInterval(h.chart.dataSource.dataSettings.interval)},this.bindUiControls=function(){this.$uiContainer.off("click",".js-chart-ui-control").on("click",".js-chart-ui-control",function(t){var e=$(this),i=e.data("property"),e=e.data("value"),i="uiSet_"+i;"function"==typeof h[i]&&h[i](e)}),this.$uiContainer.on("show.uk.dropdown",'.js-chart-ui-control[data-property="fillStyle"]',function(){var t=$(this);$(this).find(".js-colorPicker").each(function(){h.addMinicolors(this,t.find(".js-chart-ui-control-holder"),h.onMinicolorsChange,h.onPaletteChange)})}),this.$uiContainer.on("show.uk.dropdown",'.js-chart-ui-control[data-property="strokeStyle"]',function(){var t=$(this);$(this).find(".js-colorPicker").each(function(){h.addMinicolors(this,t.find(".js-chart-ui-control-holder"),h.onMinicolorsChange,h.onPaletteChange)})})},this.uiSet_chartType=function(t){this.chart.viewData.chart.setChartType(t),this.setUiStateForChartType(t),this.chart.wrapper.trigger("iguanaChartEvents",["chartOptionsChanged",{chartType:t}])},this.uiSet_showVolumeByPrice=function(t){this.chart.VolumeByPrice_onClick();var e=!!this.chart.viewData.chart.chartOptions.showVolumeByPrice;this.setUiStateForShowVolumeByPrice(e),this.chart.wrapper.trigger("iguanaChartEvents",["chartOptionsChanged",{showVolumeByPrice:e}])},this.uiSet_showVolume=function(t){this.chart.VolumeByDate_onClick();var e=h.chart.viewData.chart.chartOptions.showVolume;this.setUiStateForShowVolume(e),this.chart.wrapper.trigger("iguanaChartEvents",["chartOptionsChanged",{showVolume:e}])},this.uiSet_percentMode=function(t){var e=this.chart.percentMode_onClick();this.setUiStateForPercentMode(e),this.chart.wrapper.trigger("iguanaChartEvents",["chartOptionsChanged",{percentMode:e}])},this.uiSet_themeConfig=function(){$.modal.impl.d.data?($.modal.impl.close(),this.setUiStateForThemeConfig(!1)):(this.renderThemeConfigDialog(),this.setUiStateForThemeConfig(!0))},this.uiSet_instrumentLine=function(t){var e=$.extend({},this.chart.userSettings.chartSettings.contextSettings,this.chart.viewData.chart.chartOptions.elementStyle[t]);this.chart.wrapper.iguanaChart("toolStart",t,e),this.setUiStateForInstrumentLine(t,1),this.onSelectInstrument({settings:e})},this.uiSet_instrumentForm=function(t){var e=$.extend({},this.chart.userSettings.chartSettings.contextSettings,this.chart.viewData.chart.chartOptions.elementStyle[t]);this.chart.wrapper.iguanaChart("toolStart",t,e),this.setUiStateForInstrumentForm(t,1),this.onSelectInstrument({settings:e})},this.uiSet_instrumentText=function(t){var e=$.extend({},this.chart.userSettings.chartSettings.contextSettings,this.chart.viewData.chart.chartOptions.elementStyle[t]);this.chart.wrapper.iguanaChart("toolStart",t,e),this.setUiStateForInstrumentText(t,1),this.onSelectInstrument({settings:e})},this.uiSet_clearInstruments=function(){this.chart.removeAllInstruments_onClick()},this.uiSet_lineWidthSelector=function(t){this.chart.setLineWidthToCanvas(t),this.setUiStateForLineWidth(t)},this.uiSet_dataInterval=function(t){this.chart.setInterval(t),this.setUiStateForDataInterval(t)},this.uiSet_captureImage=function(){var t=this.chart.viewData.chart.toBase64("image/png");$.modal.impl.d.data&&$.modal.impl.close(),$(".iChartDialog").remove();var e=$($.render.captureDialogTmpl());e.find(".js-iChartTools-capture").attr("src","data:image/png;base64, "+t),this.chart.wrapper.append(e);e=e.find(".js-iChartTools-capture").get(0).width;$(".iChartDialog").modal({modal:!1,zIndex:1500,maxWidth:e,title:_t("1724","Скачать картинку")})},this.onMinicolorsChange=function(t,e){var i=$(this).val(),a=i,r=$(this).attr("data-option");i.match(/^rgb.*/)||(a=iChart.hexToRGB(i,e)),h.chart.userSettings.chartSettings.contextSettings[r]=a,h.setUiStateForColorSelector(r,a),$(this).minicolors("value",a),h.chart.setStyleToCanvas(a,r)},this.onPaletteChange=function(){var t=this.value,e=this.element.attr("data-option"),i=t;t.match(/^rgb.*/)||(i=iChart.hexToRGB(t,1)),h.chart.userSettings.chartSettings.contextSettings[e]=i,h.setUiStateForColorSelector(e,i),this.element.parent().find(".js-colorPicker").minicolors("value",i),h.chart.setStyleToCanvas(i,e)},this.setUiStateForChartType=function(t,e){t&&(e=this.getUiStateForChartType(t)),this.$uiContainer.find('.js-chart-ui-control-state[data-property="chartType"]').removeClass("sprite-icon-line sprite-icon-candle sprite-icon-bars").addClass(e)},this.getUiStateForChartType=function(t){var e="sprite-icon-line";switch(t){case"Candlestick":e="sprite-icon-candle";break;case"Stock":e="sprite-icon-bars";break;case"Line":e="sprite-icon-line"}return e},this.setUiStateForShowVolumeByPrice=function(t){t?this.$uiContainer.find('.js-chart-ui-control-state[data-property="showVolumeByPrice"]').addClass("active"):this.$uiContainer.find('.js-chart-ui-control-state[data-property="showVolumeByPrice"]').removeClass("active")},this.setUiStateForShowVolume=function(t){"inside"==t||"outside"==t?this.$uiContainer.find('.js-chart-ui-control-state[data-property="showVolume"]').addClass("active"):this.$uiContainer.find('.js-chart-ui-control-state[data-property="showVolume"]').removeClass("active")},this.setUiStateForPercentMode=function(t){t?this.$uiContainer.find('.js-chart-ui-control-state[data-property="percentMode"]').addClass("active"):this.$uiContainer.find('.js-chart-ui-control-state[data-property="percentMode"]').removeClass("active")},this.setUiStateForThemeConfig=function(t){t?this.$uiContainer.find('.js-chart-ui-control-state[data-property="themeConfig"]').addClass("active"):this.$uiContainer.find('.js-chart-ui-control-state[data-property="themeConfig"]').removeClass("active")},this.setUiStateForLineWidth=function(t){this.$uiContainer.find('.js-chart-ui-control-state[data-property="lineWidthSelector"]').removeClass("sprite-icon-1px sprite-icon-2px sprite-icon-3px sprite-icon-4px sprite-icon-5px sprite-icon-8px sprite-icon-10px").addClass("sprite-icon-"+t+"px")},this.setUiStateForColorSelector=function(t,e){e.match(/^rgb.*/)||(e=iChart.hexToRGB(e,1)),this.$uiContainer.find('.js-chart-ui-control-state[data-property="'+t+'"]').css({"background-color":e}),this.$uiContainer.find('.js-chart-ui-control[data-property="'+t+'"] .js-colorPicker').val(e)},this.setUiStateForInstrumentLine=function(t,e){e=!!e;var i="";switch(t){case"Line":i="sprite-icon-free-line";break;case"HorizontalLine":i="sprite-icon-h-line";break;case"VerticalLine":i="sprite-icon-v-line";break;case"Channel":i="sprite-icon-channel";break;case"Trend":i="sprite-icon-angle-trend";break;case"Arrow":i="sprite-icon-arrow-line"}e?this.$uiContainer.find('.js-chart-ui-control-state[data-property="instrumentLine"]').addClass("active"):this.$uiContainer.find('.js-chart-ui-control-state[data-property="instrumentLine"]').removeClass("active"),t&&this.$uiContainer.find('.js-chart-ui-control-state[data-property="instrumentLine"] i.sprite').removeClass("sprite-icon-free-line sprite-icon-h-line sprite-icon-v-line sprite-icon-channel sprite-icon-angle-trend sprite-icon-arrow-line").addClass(i)},this.setUiStateForInstrumentForm=function(t,e){e=!!e;var i="";switch(t){case"Polygon":i="sprite-icon-f-poligon";break;case"Rectangle":i="sprite-icon-f-square";break;case"Triangle":i="sprite-icon-f-triangle";break;case"Ellipse":i="sprite-icon-f-ellipse";break;case"FibonacciArc":i="sprite-icon-f-fibonacci-arcs";break;case"FibonacciFan":i="sprite-icon-f-fibonacci-fan";break;case"FibonacciCorrection":i="sprite-icon-f-fibonacci-correction";break;case"HorizontalRange":i="sprite-icon-h-line-double"}e?this.$uiContainer.find('.js-chart-ui-control-state[data-property="instrumentForm"]').addClass("active"):this.$uiContainer.find('.js-chart-ui-control-state[data-property="instrumentForm"]').removeClass("active"),t&&this.$uiContainer.find('.js-chart-ui-control-state[data-property="instrumentForm"] i.sprite').removeClass("sprite-icon-f-poligon sprite-icon-f-square sprite-icon-f-triangle").removeClass("sprite-icon-f-ellipse sprite-icon-f-fibonacci-arcs sprite-icon-f-fibonacci-fan sprite-icon-f-fibonacci-correction").addClass(i)},this.setUiStateForInstrumentText=function(t,e){(e=!!e)?this.$uiContainer.find('.js-chart-ui-control-state[data-property="instrumentText"][data-value="'+t+'"]').addClass("active"):this.$uiContainer.find('.js-chart-ui-control-state[data-property="instrumentText"]').removeClass("active")},this.onSelectInstrument=function(t){t.settings&&(t.settings.lineWidth&&this.setUiStateForLineWidth(t.settings.lineWidth),t.settings.fillStyle&&this.setUiStateForColorSelector("fillStyle",t.settings.fillStyle),t.settings.strokeStyle&&this.setUiStateForColorSelector("strokeStyle",t.settings.strokeStyle))},this.setUiStateForDataInterval=function(t){this.$uiContainer.find('.js-chart-ui-control[data-property="dataInterval"]').removeClass("active"),t&&this.$uiContainer.find('.js-chart-ui-control[data-property="dataInterval"][data-value="'+t+'"]').addClass("active")}}}(),function(h){$iguanaChart={defaultTheme:{},thems:[{name:"White",settings:{backgroundColor:"#ffffff",axisColor:"#999999",showAxes:!1,labelColor:"#595959",gridColor:"#cccccc",gridStyle:"dashed",watermarkColor:"rgba(238,238,238,1)",watermarkFont:"bold 40px Verdana",watermarkSubFont:"bold 25px Verdana",candleUp:"#66B85C",candleDown:"#C75757",candleBorder:!0,candleBorderUp:"#66B85C",candleBorderDown:"#C75757",candleWick:!0,candleWickStyle:"#595959",stockUp:"#66B85C",stockDown:"#C75757",stockWidth:1,lineColor:"#595959",lineWidth:1,areaColor:"#eff6fb",areaLineColor:"#cccccc",volumeStyle:"rgba(119, 119, 119, 0.3)",scrollerOverlayColor:"rgba(0,0,0, 0.1)",scrollerHandlerColor:"rgba(255,255,255, 1)",shadowColor:"#999999"}},{name:"Dark",settings:{backgroundColor:"#202020",axisColor:"#656565",showAxes:!1,showLabels:!0,labelColor:"#595959",gridColor:"#333333",gridStyle:"dashed",watermarkColor:"rgba(238,238,238, 0.2)",watermarkFont:"bold 40px Verdana",watermarkSubFont:"bold 25px Verdana",candleUp:"#66B85C",candleDown:"#C75757",candleBorder:!0,candleBorderUp:"#66B85C",candleBorderDown:"#C75757",candleWick:!0,candleWickStyle:"#878787",stockUp:"#66B85C",stockDown:"#C75757",stockWidth:1,lineColor:"#A4A4A4",lineWidth:1,areaColor:"#232323",areaLineColor:"#A4A4A4",volumeStyle:"rgba(119, 119, 119, 0.3)",scrollerOverlayColor:"rgba(255,255,255, 0.1)",scrollerHandlerColor:"rgba(130,130,130, 1)",shadowColor:"#000000"}}],defaultSettings:{chartSettings:{contextSettings:{fillStyle:"rgba(82,175,201,.2)",strokeStyle:"rgba(82,175,201,1)",lineWidth:1,fontFamaly:"Arial,Helvetica,sans-serif",fontColor:"#444444",fontSize:"14"},indicatorsColor:{},indicatorsWidth:{},showTransactionsMode:0,tradingToolsEnable:0,autochartistEnable:0,defaultTheme:1},currentSecurity:{id:"",short_name:"",default_ticker:"",nt_ticker:"",firstDate:"",currency:"",min_step:""}},getTemplate:function(t,e){return'<div class="iChart-control-form" style="min-height: 200px"><div class="js-chartContainerWrapper"><div class="iChartToolsContainer"><div class="iChartToolsTop" style="display: none;"></div></div><div id="'+t+'" class="m-chart-container" style="height: 100%;"></div></div><div data-uk-modal="{center:true}" class="uk-modal iChart-form-simple-v js-chartTADialog uk-padding-remove '+e+'" id="iChart-tech-analysis-dialog" style="display: none;"><div class="uk-modal-dialog"><a class="uk-modal-close uk-close"></a><div class="uk-modal-header">'+_t("3101","Индикаторы")+'</div><div class="js-chartTADialogContainer"></div><div class="uk-modal-footer"><div class="uk-flex uk-flex-middle uk-flex-space-between tm-pad-large"><div class="js-indicator-add md-btn md-btn-small md-btn-success">'+_t("15460","Добавить индикатор")+'</div><div class="md-btn-group"><a class="md-btn md-btn-small md-btn-primary indicators-set" href="#">'+_t("532","Применить")+'</a><a class="md-btn md-btn-small indicators-default" href="#">'+_t("15461","Для всех")+'</a><a class="md-btn md-btn-small indicators-close" href="#">'+_t("1403","Отмена")+'</a></div></div></div></div></div><div class="chart-loader-wrapper" style="top: 0; width: 100%; height: 100%;"><div class="chart-loader"></div></div></div>'}},$iguanaChart.init=function(e,i){e.dataSource.preInit(function(t){e.initChart(t),void 0!==i.events&&e.addEvents(i.events)},i)},$iguanaChart.optionsStore=function(){var t=JSON.parse(window.localStorage.getItem("chartsStore")||"{}");h.isPlainObject(arguments[0])&&!h.isEmptyObject(arguments[0])?t=h.extend(t,data):"string"==typeof arguments[0]&&(t[arguments[0]]=arguments[1]),window.localStorage.setItem("chartsStore",JSON.stringify(t))},$iguanaChart.optionsRestore=function(t){var e=JSON.parse(window.localStorage.getItem("chartsStore")||"{}");return t?e[t]:e};var r={init:function(t,e){var r=this;if(r.data("iguanaChart")){var i,a=r.data("iguanaChart");for(i in a.timers)clearTimeout(a.timers[i]);a.ajaxDataRequest.abort(),a.viewData.chart._dataLoading=!1,$iguanaChart.init(r.data("iguanaChart"),t)}else{var s="chart"+e+"_"+(new Date).getTime(),n=s+"_container",o=$iguanaChart.getTemplate(n,s),e=t.lib_path||"",e=new IguanaChart({name:s,container:"#"+n,wrapper:r,lib_path:e,dataSource:h.extend(!0,{},t.dataSource)});r.html(o).data("iguanaChart",e).on("iguanaChartEvents",function(t,e,i){switch(e){case"chartDataReceived":var a=r.data("tmLoader");clearTimeout(a),r.find(".chart-loader-wrapper").css({opacity:"0.0",height:0,left:"-2000px",transition:"opacity .75s ease-in-out, height 0s ease-in-out .75s, left 0s ease-in-out .75s"});break;case"chartDataRequest":a=r.data("tmLoader");clearTimeout(a),a=setTimeout(function(){r.find(".chart-loader-wrapper").css({opacity:"1.0",height:"100%",left:0,transition:"opacity .0s ease-in-out, height 0s ease-in-out .0s"})},750),r.data("tmLoader",a)}}),$iguanaChart.init(r.data("iguanaChart"),t)}this.trigger("iguanaChartEvents",["initComplete",t])},setType:function(t){var e=this.data("iguanaChart");e.viewData.chart&&e.viewData.chart.setChartType(t),e.setHashValue("type",t),this.trigger("iguanaChartEvents",["setType",t])},setTheme:function(t){var e=t[0],i=h.grep($iguanaChart.thems,function(t){return t.name==e?t:null})[0];if(void 0===i)throw new Error('Theme "'+e+'" is not exist.');t=this.data("iguanaChart").viewData.chart;h.extend(t.chartOptions,i.settings),r.render.call(this),this.trigger("iguanaChartEvents",["setTheme",e])},render:function(t){h.isArray(t)||(t=[]);var e=this.data("iguanaChart"),i=void 0===t[0]||!!t[0],a=void 0!==t[1]&&!!t[1],r=void 0!==t[2]&&!!t[2];e.viewData.chart&&((t=e.viewData.chart).render({forceRecalc:i,resetViewport:a,testForIntervalChange:r}),h(e.container).find(".js-scrollerOverlay").css({background:t.chartOptions.scrollerOverlayColor}),h(e.container).find(".js-scrollerHandler").css({background:t.chartOptions.scrollerHandlerColor}))},chartOptions:function(t){var e=this.data("iguanaChart").viewData.chart;if(void 0===t[0])return e.chartOptions;"object"==typeof t[0]?h.extend(!0,e.chartOptions,t[0]):"string"==typeof t[0]&&void 0!==t[1]&&(e.chartOptions[t[0]]=t[1]),r.render.call(this)},events:function(t){var e=this.data("iguanaChart");e.clearEvents(),void 0!==t[0]&&e.addEvents(t[0]),r.render.call(this)},toolStart:function(t){var e=this.data("iguanaChart").viewData.chart;return e.overlay&&e.overlay.start(t[0]).setSettings(t[1]),!1},addPoint:function(t){this.data("iguanaChart").addPoint(t[0])},destroy:function(){if(this.data("iguanaChart")){var t,e=this.data("iguanaChart");for(t in e.timers)clearTimeout(e.timers[t]),e.ajaxDataRequest.abort()}}};h.fn.iguanaChart=function(i){if(void 0===i||"object"==typeof i)return this.each(function(t){var e=h(this);return r.init.call(e,i,t),e});if("string"!=typeof i)return console.error("Options should be object, string or undefined");var a=Array.prototype.slice.call(arguments,1);if(r[i]&&"function"==typeof r[i]){if(a.length)return this.each(function(t){var e=h(this);return r[i].call(e,a),e});var t=h(this).eq(0);return r[i].call(t,a)}return console.error("Method should be function")}}(jQuery),TA={TICKER:0,PER:1,DATE:2,TIME:3,OPEN:4,HIGH:5,LOW:6,CLOSE:7,VOL:8,FULLDATE:9,FULLTIME:10,DATESTRING:11,TA_COMPATIBILITY_DEFAULT:0},TA.TA_GLOBALS_COMPATIBILITY=TA.TA_COMPATIBILITY_DEFAULT,TA.MATypes={SMA:0,EMA:1,WMA:2,DEMA:3,TEMA:4,TRIMA:5,KAMA:6,MAMA:7,T3:8},TA.TA_IS_ZERO=function(t){return-1e-8<t&&t<1e-8},TA.PER_TO_K=function(t){return 2/(t+1)},TA.TA_FUNC_UNST_EMA=0,TA.TA_FUNC_UNST_ADX=1,TA.TA_Globals={unstablePeriod:[0,0]},TA.TA_GLOBALS_UNSTABLE_PERIOD=function(t,e){return TA.TA_Globals.unstablePeriod[t]},TA.BASE_TEMPLATE={__TICKER__:void 0,DefaultSettings:{},CheckStandartValue:function(t,e){return t||this.Settings[e]&&this.DefaultSettings[e]},SetSettings:function(t){if(t)for(var e in t!=this.DefaultSettings&&this.SetSettings(this.DefaultSettings),t)this.Settings[e]=+t[e];return this},GetSettings:function(){var t,e=this.DefaultSettings;for(t in e)e[t]=this.Settings[t];return e},IndividualSettings:{},SetIndividualSettings:function(t){return t=MainController.RatesController.getTicker(t),this.SetSettings(this.DefaultSettings),this.IndividualSettings[t]&&this.SetSettings(this.IndividualSettings[t]),this},checkTicker:function(t){return t=MainController.RatesController.getTicker(t),this.__TICKER__==t||(this.__TICKER__=t,this.SetIndividualSettings(t),!1)},getSettingsParameters:function(t){var e,i=[];for(e in this.Settings)(!t||t.indexOf(e)+1)&&("number"==typeof this.Settings[e]?i.push({name:e,values:this.Settings[e]+"-"+this.Settings[e]+":1"}):"boolean"==typeof this.Settings[e]?i.push({name:e,values:[!0,!1]}):i.push({name:e,values:[this.Settings[e]]}));return i},Create:function(){var t=$.extend(!0,{},this);return function t(e,i){for(var a in i){"object"==typeof i[a]&&i[a]&&i[a]!={}&&t(e[a],i[a]);var r=i.__lookupSetter__(a),s=i.__lookupGetter__(a);(r||s)&&(e[a]||delete e[a],r&&e.__defineSetter__(a,r),s&&e.__defineGetter__(a,s))}}(t,this),t}},TA.INDICATOR_TEMPLATE=TA.BASE_TEMPLATE.Create(),TA.INDICATOR_TEMPLATE.Create=function(t){var e=TA.BASE_TEMPLATE.Create.apply(this);return e.justifyCalculate=function(){var t=this.calculate.apply(this,arguments);if($.isArray(t))for(var e=this._lookback(this.Settings.TimePeriod),i=0;i<e;i++)t.unshift(0);else{var a,e=this._lookback(this.Settings.TimePeriod);for(a in t)for(i=0;i<e;i++)t[a].unshift(0)}return t},t&&this.SetSettings(t),e},TA.INDICATOR_TEMPLATE.initChart=function(t,e,i){return this.checkTicker(i),this},TA.INDICATOR_TEMPLATE.filterSignalsArray=function(t,e){return[]},TA.INDICATOR_TEMPLATE.filterSignal=function(t,e,i){return{clear:!0}},TA.INDICATOR_TEMPLATE.getOpenSignal=function(t,e){return this.checkTicker(e),null},TA.INDICATOR_TEMPLATE.getCloseSignal=function(t,e){return this.checkTicker(e),!1},TA.INDICATOR_TEMPLATE.getGraphicSettingsParameters=function(t){return this.getSettingsParameters.apply(this,arguments)},TA.INDICATOR_TEMPLATE.getTradeSettingsParameters=function(t){return this.getSettingsParameters.apply(this,arguments)},TA.CONTROLLER_TEMPLATE=TA.BASE_TEMPLATE.Create(),TA.CONTROLLER_TEMPLATE.getByFilter=function(t){return[]},TA.CONTROLLER_TEMPLATE.init=function(){return this.checkTicker(),this},TA.CONTROLLER_TEMPLATE.initChart=function(t,e,i){return this.checkTicker(i),this},TA.CONTROLLER_TEMPLATE._data=null,TA.CONTROLLER_TEMPLATE.__defineGetter__("data",function(){return this._data}),TA.CONTROLLER_TEMPLATE.__defineSetter__("data",function(t){return this.update(t)}),TA.CONTROLLER_TEMPLATE.update=function(t){return this},TA.CONTROLLER_TEMPLATE.isEmpty=function(){return!this._data.length},TA.INDICATOR_TEMPLATE?TA.AD=TA.INDICATOR_TEMPLATE.Create():TA.AD={},TA.AD.name="AD",TA.AD.type="line",TA.AD.DefaultSettings={},TA.AD.Settings={},TA.AD.calculate=function(t,e,i){var a,r,s,n,o,h,l,c,d=[];if(t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(!d)throw"TA_BAD_PARAM";for(a=e-t+1,r=t,c=s=0;0!=a;)l=(n=i[r][TA.HIGH])-(o=i[r][TA.LOW]),h=i[r][TA.CLOSE],0<l&&(c+=(h-o-(n-h))/l*i[r][TA.VOL]),d[s++]=c,r++,a--;return d},TA.AD.getValue=function(t,e){var i=0,a=t[e][TA.HIGH],r=t[e][TA.LOW],s=a-r,n=t[e][TA.CLOSE];return 0<s&&(i+=(n-r-(a-n))/s*t[e][TA.VOL]),i},TA.AD._lookback=function(){return 0},TA.AD._S=function(t,e,i){var a,r,s,n,o,h,l,c,d=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(!d)throw"TA_BAD_PARAM";for(a=e-t+1,r=t,c=s=0;0!=a;)l=(n=i[r][TA.HIGH])-(o=i[r][TA.LOW]),h=i[r][TA.CLOSE],0<l&&(c+=(h-o-(n-h))/l*i[r][TA.VOL]),d[s++]=c,r++,a--;return d},TA.INDICATOR_TEMPLATE?TA.ADOSC=TA.INDICATOR_TEMPLATE.Create():TA.ADOSC={},TA.ADOSC.name="ADOSC",TA.ADOSC.type="line",TA.ADOSC.DefaultSettings={FastPeriod:3,SlowPeriod:10},TA.ADOSC.Settings={},TA.ADOSC.calculate=function(startIdx,endIdx,dataShape,settings){var today,outIdx,lookbackTotal,slowestPeriod,high,low,close,tmp,slowEMA,slowk,one_minus_slowk,fastEMA,fastk,one_minus_fastk,ad,outReal=[];if(this.SetSettings(settings),startIdx=startIdx||0,endIdx=endIdx||dataShape.length-1,startIdx<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(endIdx<0||endIdx<startIdx)throw"TA_OUT_OF_RANGE_END_INDEX";if(!dataShape||!dataShape.length)throw"TA_BAD_PARAM";if(this.Settings.FastPeriod){if(this.Settings.FastPeriod<2||1e5<this.Settings.FastPeriod)throw"TA_BAD_PARAM"}else this.Settings.FastPeriod=3;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||1e5<this.Settings.SlowPeriod)throw"TA_BAD_PARAM"}else this.Settings.SlowPeriod=10;if(slowestPeriod=this.Settings.FastPeriod<this.Settings.SlowPeriod?this.Settings.SlowPeriod:this.Settings.FastPeriod,lookbackTotal=TA.EMA._lookback(slowestPeriod),startIdx<lookbackTotal&&(startIdx=lookbackTotal),endIdx<startIdx)return outReal;today=startIdx-lookbackTotal,ad=0;var CALCULATE_AD="   {       high  = dataShape[today][TA.HIGH];       low   = dataShape[today][TA.LOW];       tmp   = high-low;       close = dataShape[today][TA.CLOSE];       if( tmp > 0.0 )          ad += (((close-low)-(high-close))/tmp)*(dataShape[today][TA.VOL]);       today++;    }",fastk=TA.PER_TO_K(this.Settings.FastPeriod),one_minus_fastk=1-fastk,slowk=TA.PER_TO_K(this.Settings.SlowPeriod),one_minus_slowk=1-slowk;for(eval(CALCULATE_AD),fastEMA=ad,slowEMA=ad;today<startIdx;)eval(CALCULATE_AD),fastEMA=fastk*ad+one_minus_fastk*fastEMA,slowEMA=slowk*ad+one_minus_slowk*slowEMA;for(outIdx=0;today<=endIdx;)eval(CALCULATE_AD),fastEMA=fastk*ad+one_minus_fastk*fastEMA,slowEMA=slowk*ad+one_minus_slowk*slowEMA,outReal[outIdx++]=fastEMA-slowEMA;return outReal},TA.ADOSC.getValue=function(t,e,i){return NaN},TA.ADOSC._lookback=function(){var t;if(this.Settings.FastPeriod)this.Settings.FastPeriod=3;else if(this.Settings.FastPeriod<2||1e5<this.Settings.FastPeriod)return-1;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||1e5<this.Settings.SlowPeriod)return-1}else this.Settings.SlowPeriod=10;return t=this.Settings.FastPeriod<this.Settings.SlowPeriod?this.Settings.SlowPeriod:this.Settings.FastPeriod,TA.EMA._lookback(t)},TA.ADOSC._S=function(t,e,i,a){return NaN},TA.ADOSC.initChart=function(t,e,i){INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.ADOSC.SetSettings(TA.ADOSC.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.ADX=TA.INDICATOR_TEMPLATE.Create():TA.ADX={},TA.ADX.name="ADX",TA.ADX.type="line",TA.ADX.DefaultSettings={TimePeriod:14},TA.ADX.Settings={},TA.ADX.calculate=function(startIdx,endIdx,dataShape,settings,dontFillTotalArray){var today,lookbackTotal,outIdx,prevHigh,prevLow,prevClose,prevMinusDM,prevPlusDM,prevTR,tempReal,tempReal2,diffP,diffM,minusDI,plusDI,sumDX,prevADX,i,outReal=[];function TRUE_RANGE(t,e,i,a){return"      "+a+" = "+t+"-"+e+";       tempReal2 = Math.abs("+t+"-"+i+");       if( tempReal2 > "+a+" )          "+a+" = tempReal2;       tempReal2 = Math.abs("+e+"-"+i+");       if( tempReal2 > "+a+" )          "+a+" = tempReal2;"}if(this.SetSettings(settings),startIdx=startIdx||0,endIdx=endIdx||dataShape.length-1,startIdx<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(endIdx<0||endIdx<startIdx)throw"TA_OUT_OF_RANGE_END_INDEX";if(!dataShape||!dataShape.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=14;function round_pos(t){return t}if(lookbackTotal=2*this.Settings.TimePeriod-1,startIdx<lookbackTotal&&(startIdx=lookbackTotal),endIdx<startIdx)return outReal;for(outIdx=0,prevMinusDM=0,prevPlusDM=0,prevTR=0,today=startIdx-lookbackTotal,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE],i=this.Settings.TimePeriod-1;0<i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffM&&diffP<diffM?prevMinusDM+=diffM:0<diffP&&diffM<diffP&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR+=tempReal,prevClose=dataShape[today][TA.CLOSE];for(sumDX=0,i=this.Settings.TimePeriod;0<i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,0<diffM&&diffP<diffM?prevMinusDM+=diffM:0<diffP&&diffM<diffP&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)||(minusDI=round_pos(prevMinusDM/prevTR*100),plusDI=round_pos(prevPlusDM/prevTR*100),tempReal=minusDI+plusDI,TA.TA_IS_ZERO(tempReal)||(sumDX+=round_pos(Math.abs(minusDI-plusDI)/tempReal*100)));for(prevADX=round_pos(sumDX/this.Settings.TimePeriod),i=TA.TA_GLOBALS_UNSTABLE_PERIOD(TA.TA_FUNC_UNST_ADX);0<i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,0<diffM&&diffP<diffM?prevMinusDM+=diffM:0<diffP&&diffM<diffP&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)||(minusDI=round_pos(prevMinusDM/prevTR*100),plusDI=round_pos(prevPlusDM/prevTR*100),tempReal=minusDI+plusDI,TA.TA_IS_ZERO(tempReal)||(tempReal=round_pos(Math.abs(minusDI-plusDI)/tempReal*100),prevADX=round_pos((prevADX*(this.Settings.TimePeriod-1)+tempReal)/this.Settings.TimePeriod)));for(outReal[0]=prevADX,outIdx=1;today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,0<diffM&&diffP<diffM?prevMinusDM+=diffM:0<diffP&&diffM<diffP&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)||(minusDI=round_pos(prevMinusDM/prevTR*100),plusDI=round_pos(prevPlusDM/prevTR*100),tempReal=minusDI+plusDI,TA.TA_IS_ZERO(tempReal)||(tempReal=round_pos(Math.abs(minusDI-plusDI)/tempReal*100),prevADX=round_pos((prevADX*(this.Settings.TimePeriod-1)+tempReal)/this.Settings.TimePeriod))),outReal[outIdx++]=prevADX;if(!dontFillTotalArray){if(outReal.length>=dataShape.length)throw"Ошибка расчета ADX";if(outReal.length<=dataShape.length)for(;outReal.length!=dataShape.length;)outReal.unshift(0)}return outReal},TA.ADX.getValue=function(t,e,i){},TA.ADX._lookback=function(){return 2*this.Settings.TimePeriod-1},TA.ADX._S=function(t,e,i,a){},TA.ADX.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.ADX.SetSettings(TA.ADX.DefaultSettings),APO=TA.INDICATOR_TEMPLATE?TA.INDICATOR_TEMPLATE.Create():{},APO.name="APO",APO.type="line",APO.DefaultSettings={FastPeriod:12,SlowPeriod:26,MAType:TA.MATypes.SMA,CandleValueIdx:TA.CLOSE},APO.Settings={},APO._S=function(t,e,i,a){},APO.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},APO.SetSettings(APO.DefaultSettings),APO._lookback=function(t,e,i){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.FastPeriod;if(e){if(e<2||1e5<e)return-1}else e=this.DefaultSettings.SlowPeriod;if(i){if(i<0||8<i)return-1}else i=this.DefaultSettings.MAType;return MA._lookback(Math.max(e,t),i)},APO.calculate=function(t,e,i,a){var r=[];if(a&&this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.FastPeriod){if(this.Settings.FastPeriod<2||1e5<this.Settings.FastPeriod)throw"TA_BAD_PARAM"}else this.Settings.FastPeriod=this.DefaultSettings.FastPeriod;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||1e5<this.Settings.SlowPeriod)throw"TA_BAD_PARAM"}else this.Settings.SlowPeriod=this.DefaultSettings.SlowPeriod;if(this.Settings.MAType)this.Settings.MAType=this.DefaultSettings.MAType;else if(this.Settings.MAType<0||8<this.Settings.MAType)throw"TA_BAD_PARAM";return this.INT_PO(t,e,i,this.Settings.FastPeriod,this.Settings.SlowPeriod,this.Settings.MAType,r,[],0)},APO.INT_PO=function(t,e,i,a,r,s,n,o,h){var l,c,d=0,p=0;r<a&&(c=r,r=a,a=c);s=MA.Create({TimePeriod:a,MAType:s,CandleValueIdx:this.Settings.CandleValueIdx});if(o=s.calculate(t,e,i),o&&o.length&&(n=s.calculate(t,e,i,{TimePeriod:r}))&&n.length)if(c=o.length-1-(n.length-1),0!=h)for(d=0,p=c;d<o.length-1;d++,p++)l=n[d],TA.TA_IS_ZERO(l)?n[d]=0:n[d]=(o[p]-l)/l*100;else for(d=0,p=c;d<o.length-1;d++,p++)n[d]=o[p]-n[d];return n},TA.INDICATOR_TEMPLATE?TA.AROON=TA.INDICATOR_TEMPLATE.Create():TA.AROON={},TA.AROON.name="AROON",TA.AROON.type="line",TA.AROON.DefaultSettings={TimePeriod:14},TA.AROON.Settings={},TA.AROON._S=function(t,e,i,a){},TA.AROON.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE&&TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.AROON.SetSettings(TA.AROON.DefaultSettings),TA.AROON.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g=[],f=[];if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<this.Settings.TimePeriod&&(t=this.Settings.TimePeriod),e<t)return{AroonDown:g,AroonUp:f};for(h=0,l=(p=t)-this.Settings.TimePeriod,d=c=-1,s=r=0,o=100/this.Settings.TimePeriod;p<=e;){if(n=i[p][TA.LOW],c<l)for(r=i[c=l][TA.LOW],u=c;++u<=p;)(n=i[u][TA.LOW])<=r&&(c=u,r=n);else n<=r&&(c=p,r=n);if(n=i[p][TA.HIGH],d<l)for(s=i[d=l][TA.HIGH],u=d;++u<=p;)s<=(n=i[u][TA.HIGH])&&(d=u,s=n);else s<=n&&(d=p,s=n);f[h]=o*(this.Settings.TimePeriod-(p-d)),g[h]=o*(this.Settings.TimePeriod-(p-c)),h++,l++,p++}return{AroonDown:g,AroonUp:f}},TA.AROON.getValue=function(t,e,i){},TA.AROON._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return t},TA.INDICATOR_TEMPLATE?TA.ATR=TA.INDICATOR_TEMPLATE.Create():TA.ATR={},TA.ATR.name="ATR",TA.ATR.type="line",TA.ATR.DefaultSettings={TimePeriod:14},TA.ATR.Settings={},TA.ATR._lookback=function(t){if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return 1<t?t:1},TA.ATR.calculate=function(t,e,i,a){var r,s,n,o,h,l=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<(a=this._lookback(this.Settings.TimePeriod))&&(t=a),e<t)return l;if(this.Settings.TimePeriod<=1)return TA.TRANGE.calculate(t,e,i,{});if(!(h=TA.TRANGE.calculate(t-a+1,e,i,{}))||!h.length)return l;for(var c=[],d=0;d<h.length-1;d++)c.push([h[d]]);if(!(i=TA.SMA.calculate(this.Settings.TimePeriod-1,this.Settings.TimePeriod-1,c,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:0}))||!i.length)return l;for(o=i[0],s=this.Settings.TimePeriod,r=0;0!=r;)o*=this.Settings.TimePeriod-1,o+=h[s++],o/=this.Settings.TimePeriod,r--;for(r=1,l[0]=o,n=e-t+1;0!=--n;)o*=this.Settings.TimePeriod-1,o+=h[s++],o/=this.Settings.TimePeriod,l[r++]=o;return l},TA.INDICATOR_TEMPLATE?TA.BBANDS=TA.INDICATOR_TEMPLATE.Create():TA.BBANDS={},TA.BBANDS.name="BBANDS",TA.BBANDS.type="line",TA.BBANDS.DefaultSettings={TimePeriod:7,DeviationsUp:2,DeviationsDown:2,MAType:TA.MATypes.SMA,CandleValueIdx:TA.CLOSE},TA.BBANDS.Settings={},TA.BBANDS.calculate=function(t,e,i,a){var r,s,n,o,h=[],l=[],c=[],d=[],p=[];if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(this.Settings.DeviationsUp){if(this.Settings.DeviationsUp<-3e37||3e37<this.Settings.DeviationsUp)throw"TA_BAD_PARAM"}else this.Settings.DeviationsUp=this.DefaultSettings.DeviationsUp;if(this.Settings.DeviationsDown){if(this.Settings.DeviationsDown<-3e37||3e37<this.Settings.DeviationsDown)throw"TA_BAD_PARAM"}else this.Settings.DeviationsDown=this.DefaultSettings.DeviationsDown;if(this.Settings.MAType)this.Settings.MAType=this.DefaultSettings.MAType;else if(this.Settings.MAType<0||8<this.Settings.MAType)throw"TA_BAD_PARAM";if(!c)throw"TA_BAD_PARAM";if(0,!p)throw"TA_BAD_PARAM";if(h=d,l=c,!(h=TA.MA.Create({TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType}).calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType}))||!h.length)return{UpperBand:[],LowerBand:[],MiddleBand:[]};if(!(l=TA.STDDEV.Create({TimePeriod:this.Settings.TimePeriod,Deviations:1}).calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,Deviations:1}))||!l.length)return{UpperBand:[],LowerBand:[],MiddleBand:[]};if(o=(d=h.slice()).length,this.Settings.DeviationsUp==this.Settings.DeviationsDown)if(1==this.Settings.DeviationsUp)for(r=0;r<o;r++)s=l[r],n=d[r],c[r]=n+s,p[r]=n-s;else for(r=0;r<o;r++)s=l[r]*this.Settings.DeviationsUp,n=d[r],c[r]=n+s,p[r]=n-s;else if(1==this.Settings.DeviationsUp)for(r=0;r<o;r++)s=l[r],n=d[r],c[r]=n+s,p[r]=n-s*this.Settings.DeviationsDown;else if(1==this.Settings.DeviationsDown)for(r=0;r<o;r++)s=l[r],n=d[r],p[r]=n-s,c[r]=n+s*this.Settings.DeviationsUp;else for(r=0;r<o;r++)s=l[r],n=d[r],c[r]=n+s*this.Settings.DeviationsUp,p[r]=n-s*this.Settings.DeviationsDown;return{UpperBand:c,LowerBand:p,MiddleBand:d}},TA.BBANDS.getValue=function(t,e,i){},TA.BBANDS._lookback=function(t,e,i,a){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<-3e37||3e37<e)return-1}else e=this.DefaultSettings.DeviationsUp;if(i){if(i<-3e37||3e37<i)return-1}else i=this.DefaultSettings.DeviationsDown;if(a){if(a<0||8<a)return-1}else a=this.DefaultSettings.MAType;return TA.MA._lookback(t,a)},TA.BBANDS.SetSettings(TA.BBANDS.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.CCI=TA.INDICATOR_TEMPLATE.Create():TA.CCI={},TA.CCI.name="CCI",TA.CCI.type="line",TA.CCI.DefaultSettings={TimePeriod:14},TA.CCI.Settings={},TA.CCI.calculate=function(t,e,i,a){var r,s,n,o,h,l;this.SetSettings(a);new Array(30);var c,d,p,u=[];if(t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(!u)throw"TA_BAD_PARAM";if(t<(a=this.Settings.TimePeriod-1)&&(t=a),e<t)return u;if(d=[],p=this.Settings.TimePeriod-1,c=0,o=t-a,1<this.Settings.TimePeriod)for(;o<t;)d[c]=(i[o][TA.HIGH]+i[o][TA.LOW]+i[o][TA.CLOSE])/3,o++,p<++c&&(c=0);l=0;do{for(n=(i[o][TA.HIGH]+i[o][TA.LOW]+i[o][TA.CLOSE])/3,d[c]=n,h=s=0;h<this.Settings.TimePeriod;h++)s+=d[h];for(s/=this.Settings.TimePeriod,h=r=0;h<this.Settings.TimePeriod;h++)r+=Math.abs(d[h]-s)}while(n=n-s,u[l++]=0!=n&&0!=r?n/(r/this.Settings.TimePeriod*.015):0,p<++c&&(c=0),++o<=e);return u},TA.CCI.getValue=function(t,e,i){},TA.CCI._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return t-1},TA.CCI._S=function(t,e,i,a){},TA.CCI.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE&&TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.CCI.SetSettings(TA.CCI.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.CHV=TA.INDICATOR_TEMPLATE.Create():TA.CHV={},TA.CHV.name="CHV",TA.CHV.type="line",TA.CHV.DefaultSettings={TimePeriod:10,TimePeriodRoc:10,CandleValueIdx:TA.CLOSE},TA.CHV.Settings={},TA.CHV.calculate=function(t,e,i,a){var r=[],s=[];this.SetSettings(a);for(var n=t;n<=e;++n)s[n]=[i[n][TA.HIGH]-i[n][TA.LOW]];for(var o=TA.EMA.Create({TimePeriod:this.Settings.TimePeriod,CandleValueIdx:0}).calculate(t,e,s,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:0}),h=o.length-this.Settings.TimePeriodRoc,n=0;n<h;n++)r[n]=100*(o[n+this.Settings.TimePeriodRoc]-o[n])/o[n];return r},TA.CHV._lookback=function(t){return TA.EMA._lookback(t)+this.Settings.TimePeriodRoc},TA.INDICATOR_TEMPLATE?TA.DPO=TA.INDICATOR_TEMPLATE.Create():TA.DPO={},TA.DPO.name="DPO",TA.DPO.type="line",TA.DPO.DefaultSettings={TimePeriod:20,CandleValueIdx:TA.CLOSE},TA.DPO.Settings={},TA.DPO.calculate=function(t,e,i,a){var r=[];this.SetSettings(a);for(var s=TA.SMA.Create({TimePeriod:this.Settings.TimePeriod}).calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:TA.CLOSE}),t=this.Settings.TimePeriod,n=TA.SMA._lookback(t),o=e-(n+=1+(t/2|0));0<=o;--o)r[o]=i[o+n][TA.CLOSE]-s[o];return r},TA.DPO._lookback=function(t){return TA.SMA._lookback(t)+(t/2|0)+1},TA.INDICATOR_TEMPLATE?TA.ELDR=TA.INDICATOR_TEMPLATE.Create():TA.ELDR={},TA.ELDR.name="ELDR",TA.ELDR.type="line",TA.ELDR.DefaultSettings={TimePeriod:13,MAType:TA.MATypes.EMA},TA.ELDR.Settings={},TA.ELDR._lookback=function(t,e){if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<0||8<e)return-1}else e=this.DefaultSettings.MAType;return TA.MA._lookback(t,e)},TA.ELDR.calculate=function(t,e,i,a){var r=[],s=[],n=[],o=[],h=[],l=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;lookbackTotal=TA.EMA._lookback(this.Settings.TimePeriod);for(var c=TA.MA.Create({TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType}).calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType,CandleValueIdx:TA.CLOSE}),d=0;d<c.length;d++)r[d]=i[d+lookbackTotal][TA.HIGH]-c[d],s[d]=i[d+lookbackTotal][TA.LOW]-c[d],n[d]=(i[d+lookbackTotal][TA.HIGH]+i[d+lookbackTotal][TA.LOW])/2-c[d];n.forEach(function(t,e){l[e]=[t]});for(o=TA.MA.Create({TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType}).calculate(0,l.length-1,l,{TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType,CandleValueIdx:0}),d=0;d<this.Settings.TimePeriod-1;d++)o.splice(0,0,0);for(h=TA.MA.Create({TimePeriod:this.Settings.TimePeriod,MAType:this.Settings.MAType}).calculate(0,l.length-1,l,{TimePeriod:2,MAType:this.Settings.MAType,CandleValueIdx:0}),d=0;d<1;d++)h.splice(0,0,0);return{ELDR:n,Signal:o,Smooth:h,EMA:c}},TA.INDICATOR_TEMPLATE?TA.EMA=TA.INDICATOR_TEMPLATE.Create():TA.EMA={},TA.EMA.name="EMA",TA.EMA.type="line",TA.EMA.DefaultSettings={TimePeriod:30,CandleValueIdx:TA.CLOSE},TA.EMA.Settings={},TA.EMA.calculate=function(t,e,i,a){if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=30;return this._int_ema(t,e,i,this.Settings.TimePeriod,TA.PER_TO_K(this.Settings.TimePeriod),[])},TA.EMA._int_ema=function(t,e,i,a,r,s){var n,o,h,l,c,d=this._lookback(a);if(t<d&&(t=d),e<t)return s;if(TA.TA_GLOBALS_COMPATIBILITY==TA.TA_COMPATIBILITY_DEFAULT){for(l=t-d,h=a,n=0;0<h--;)n+=i[l++][this.Settings.CandleValueIdx];o=n/a}else o=i[0][this.Settings.CandleValueIdx],l=1;for(;l<=t;)o=(i[l++][this.Settings.CandleValueIdx]-o)*r+o;for(s[0]=o,c=1;l<=e;)o=(i[l++][this.Settings.CandleValueIdx]-o)*r+o,s[c++]=o;return s},TA.EMA.getValue=function(t,e,i){},TA.EMA._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.Settings.TimePeriod||this.DefaultSettings.TimePeriod;return t-1},TA.EMA._S=function(t,e,i,a){var r,s,n,o,h,l=this._lookback(this.Settings.TimePeriod);if(t<l&&(t=l),e<t)return outReal;if(TA_GLOBALS_COMPATIBILITY==TA_COMPATIBILITY_DEFAULT){for(o=t-l,n=this.Settings.TimePeriod,r=0;0<n--;)r+=i[o++][this.Settings.CandleValueIdx];s=r/this.Settings.TimePeriod}else s=i[0][this.Settings.CandleValueIdx],o=1;for(;o<=t;)s=(i[o++][this.Settings.CandleValueIdx]-s)*optInK_1+s;for(outReal[0]=s,h=1;o<=e;)s=(inReal[o++]-s)*optInK_1+s,outReal[h++]=s;return outReal},TA.EMA.initChart=function(t,e,i){INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.EMA.SetSettings(TA.EMA.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.ENV=TA.INDICATOR_TEMPLATE.Create():TA.ENV={},TA.ENV.name="ENV",TA.ENV.type="line",TA.ENV.DefaultSettings={TimePeriod:20,shift:1,CandleValueIdx:TA.CLOSE},TA.ENV.Settings={},TA.ENV.calculate=function(t,e,i,a){var r=[],s=[];this.SetSettings(a);for(var n=TA.SMA.Create({TimePeriod:this.Settings.TimePeriod}).calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:TA.CLOSE}),o=1+this.Settings.shift/100,h=1-this.Settings.shift/100,l=0;l<n.length;l++)r[l]=n[l]*h,s[l]=n[l]*o;return{Lower:r,Upper:s}},TA.ENV._lookback=function(t){return TA.SMA._lookback(t)},TA.INDICATOR_TEMPLATE?TA.MA=TA.INDICATOR_TEMPLATE.Create():TA.MA={},TA.MA.name="MA",TA.MA.type="line",TA.MA.DefaultSettings={TimePeriod:30,CandleValueIdx:TA.CLOSE,MAType:TA.MATypes.SMA},TA.MA.Settings={},TA.MA.calculate=function(t,e,i,a){this.SetSettings(a);var r,s,n=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=30;if(this.Settings.MAType){if(this.Settings.MAType<0||8<this.Settings.MAType)throw"TA_BAD_PARAM"}else this.Settings.MAType=TA.MATypes.SMA;if(1==this.Settings.TimePeriod){for(nbElement=e-t+1,s=t,r=0;r<nbElement;r++,s++)n[r]=i[s][this.Settings.CandleValueIdx];return n}switch(this.Settings.MAType){case TA.MATypes.SMA:n=TA.SMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.EMA:n=TA.EMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.WMA:n=TA.WMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.DEMA:n=DEMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.TEMA:n=TEMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.TRIMA:n=TRIMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.KAMA:n=KAMA.calculate(t,e,i,this.Settings);break;case TA.MATypes.MAMA:n=MAMA.calculate(t,e,i,{FastLimit:.5,SlowLimit:.05});break;case TA.MATypes.T3:n=T3.calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,VFactor:.7});break;default:throw"TA_BAD_PARAM"}return n},TA.MA.getValue=function(t,e,i){},TA.MA._lookback=function(t,e){var i;if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<0||8<e)return-1}else e=this.DefaultSettings.MAType;if(t<=1)return 0;switch(e){case TA.MATypes.SMA:i=TA.SMA._lookback(t);break;case TA.MATypes.EMA:i=TA.EMA._lookback(t);break;case TA.MATypes.WMA:i=TA.WMA._lookback(t);break;case TA.MATypes.DEMA:i=DEMA._lookback(t);break;case TA.MATypes.TEMA:i=TEMA._lookback(t);break;case TA.MATypes.TRIMA:i=TRIMA._lookback(t);break;case TA.MATypes.KAMA:i=KAMA._lookback(t);break;case TA.MATypes.MAMA:i=MAMA._lookback(.5,.05);break;case TA.MATypes.T3:i=T3._lookback(t,.7);break;default:i=0}return i},TA.MA._S=function(t,e,i,a){},TA.MA.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.MA.SetSettings(TA.MA.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.MACD=TA.INDICATOR_TEMPLATE.Create():TA.MACD={},TA.MACD.name="MACD",TA.MACD.type="line",TA.MACD.DefaultSettings={FastPeriod:12,SlowPeriod:26,SignalPeriod:9,CandleValueIdx:TA.CLOSE},TA.MACD.Settings={},TA.MACD.calculate=function(t,e,i,a){if(a&&this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.FastPeriod){if(this.Settings.FastPeriod<2||1e5<this.Settings.FastPeriod)throw"TA_BAD_PARAM"}else this.Settings.FastPeriod=this.DefaultSettings.FastPeriod;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||1e5<this.Settings.SlowPeriod)throw"TA_BAD_PARAM"}else this.Settings.SlowPeriod=this.DefaultSettings.SlowPeriod;if(this.Settings.SignalPeriod){if(this.Settings.SignalPeriod<1||1e5<this.Settings.SignalPeriod)throw"TA_BAD_PARAM"}else this.Settings.SignalPeriod=this.DefaultSettings.SignalPeriod;a=$.extend(!0,{},this.Settings);return a.SignalPeriod_2=a.SignalPeriod,delete a.SignalPeriod,TA.INT_MACD.calculate(t,e,i,a)},TA.MACD._lookback=function(t,e,i){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.FastPeriod;if(e){if(e<2||1e5<e)return-1}else e=this.DefaultSettings.SlowPeriod;if(i){if(i<1||1e5<i)return-1}else i=this.DefaultSettings.SignalPeriod;var a;return e<t&&(a=e,e=t,t=a),TA.EMA._lookback(e)+TA.EMA._lookback(i)},TA.MACD.SetSettings(TA.MACD.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.INT_MACD=TA.INDICATOR_TEMPLATE.Create():TA.INT_MACD={},TA.INT_MACD.name="INT_MACD",TA.INT_MACD.type="line",TA.INT_MACD.DefaultSettings={FastPeriod:12,SlowPeriod:26,SignalPeriod_2:9,CandleValueIdx:TA.CLOSE},TA.INT_MACD.Settings={},TA.INT_MACD.calculate=function(t,e,i,a){var r,s,n,o,h,l=[],c=[],d=[],p=[],u=[];if(this.Settings&&this.SetSettings(a),this.Settings.SlowPeriod<this.Settings.FastPeriod&&(n=this.Settings.SlowPeriod,this.Settings.SlowPeriod=this.Settings.FastPeriod,this.Settings.FastPeriod=n),r=(0!=this.Settings.SlowPeriod||(this.Settings.SlowPeriod=this.DefaultSettings.SlowPeriod),TA.PER_TO_K(this.Settings.SlowPeriod)),s=(0!=this.Settings.FastPeriod||(this.Settings.FastPeriod=this.DefaultSettings.FastPeriod),TA.PER_TO_K(this.Settings.FastPeriod)),a=o=TA.EMA._lookback(this.Settings.SignalPeriod_2),t<(a+=TA.EMA._lookback(this.Settings.SlowPeriod))&&(t=a),e<t)return{MACD:d,MACDSignal:p,MACDHist:u};if(n=e-t+1+o,n=t-o,TA.EMA.SetSettings({CandleValueIdx:this.Settings.CandleValueIdx}),TA.EMA._int_ema(n,e,i,this.Settings.SlowPeriod,r,l),!l.length)return{MACD:d,MACDSignal:p,MACDHist:u};if(TA.EMA._int_ema(n,e,i,this.Settings.FastPeriod,s,c),!c||!c.length)return{MACD:d,MACDSignal:p,MACDHist:u};for(f=0,h=c.length;f<h;f++)c[f]=c[f]-l[f];d=c.slice(-c.length+this.Settings.SignalPeriod_2-1);for(var g=[],f=0;f<c.length;f++)g.push({7:c[f]});if(TA.EMA._int_ema(0,c.length-1,g,this.Settings.SignalPeriod_2,TA.PER_TO_K(this.Settings.SignalPeriod_2),p),!p.length)return{MACD:d,MACDSignal:p,MACDHist:u};for(f=0,h=p.length;f<h;f++)u[f]=d[f]-p[f];return{MACD:d,MACDSignal:p,MACDHist:u}},TA.INT_MACD._lookback=function(t){TA.EMA._lookback(t)},TA.INT_MACD.SetSettings(TA.INT_MACD.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.MEDPRICE=TA.INDICATOR_TEMPLATE.Create():TA.MEDPRICE={},TA.MEDPRICE.name="MEDPRICE",TA.MEDPRICE.type="line",TA.MEDPRICE.DefaultSettings={},TA.MEDPRICE.Settings={},TA.MEDPRICE._lookback=function(){return 0},TA.MEDPRICE.calculate=function(t,e,i,a){var r,s,n=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";for(r=0,s=t;s<=e;s++)n[r++]=(i[s][TA.HIGH]+i[s][TA.LOW])/2;return n},TA.INDICATOR_TEMPLATE?TA.MFI=TA.INDICATOR_TEMPLATE.Create():TA.MFI={},TA.MFI.name="MFI",TA.MFI.type="line",TA.MFI.DefaultSettings={TimePeriod:14},TA.MFI.Settings={},TA.MFI._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return t},TA.MFI.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d=[];this.SetSettings(a);var p,u=0,g=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(this.Settings.TimePeriod<=0)return d;g=new Array(this.Settings.TimePeriod);for(var f=0;f<g.length;f++)g[f]={};if(!g)return d;if(p=g.length-1,t<(a=this.Settings.TimePeriod)&&(t=a),e<t)return d;for(l=0,n=(i[c=t-a][TA.HIGH]+i[c][TA.LOW]+i[c][TA.CLOSE])/3,s=r=0,c++,f=this.Settings.TimePeriod;0<f;f--)h=(o=(i[c][TA.HIGH]+i[c][TA.LOW]+i[c][TA.CLOSE])/3)-n,n=o,o*=i[c++][TA.VOL],h<0?(s+=g[u].negative=o,g[u].positive=0):(0<h?r+=g[u].positive=o:g[u].positive=0,g[u].negative=0),p<++u&&(u=0);if(t<c)o=r+s,d[l++]=o<1?0:r/o*100;else for(;c<t;)r-=g[u].positive,s-=g[u].negative,h=(o=(i[c][TA.HIGH]+i[c][TA.LOW]+i[c][TA.CLOSE])/3)-n,n=o,o*=i[c++][TA.VOL],h<0?(s+=g[u].negative=o,g[u].positive=0):(0<h?r+=g[u].positive=o:g[u].positive=0,g[u].negative=0),p<++u&&(u=0);for(;c<=e;)r-=g[u].positive,s-=g[u].negative,h=(o=(i[c][TA.HIGH]+i[c][TA.LOW]+i[c][TA.CLOSE])/3)-n,n=o,o*=i[c++][TA.VOL],h<0?(s+=g[u].negative=o,g[u].positive=0):(0<h?r+=g[u].positive=o:g[u].positive=0,g[u].negative=0),o=r+s,d[l++]=o<1?0:r/o*100,p<++u&&(u=0);return d},TA.INDICATOR_TEMPLATE?TA.MINUS_DI=TA.INDICATOR_TEMPLATE.Create():TA.MINUS_DI={},TA.MINUS_DI.name="MINUS_DI",TA.MINUS_DI.type="line",TA.MINUS_DI.DefaultSettings={TimePeriod:14},TA.MINUS_DI.Settings={},TA.MINUS_DI._lookback=function(t){if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return 1<t?t:1},TA.MINUS_DI.calculate=function(startIdx,endIdx,dataShape,settings){var today,lookbackTotal,outIdx,prevHigh,prevLow,prevClose,prevMinusDM,prevTR,tempReal,tempReal2,diffP,diffM,i,outReal=[],outBegIdx,outNBElement;function TRUE_RANGE(t,e,i,a){return"              "+a+" = "+t+"-"+e+";               tempReal2 = Math.abs("+t+"-"+i+");               if( tempReal2 > "+a+" )                  "+a+" = tempReal2;               tempReal2 = Math.abs("+e+"-"+i+");               if( tempReal2 > "+a+" )                  "+a+" = tempReal2;"}if(this.SetSettings(settings),startIdx<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(endIdx<0||endIdx<startIdx)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;function round_pos(t){return t}if(lookbackTotal=1<this.Settings.TimePeriod?this.Settings.TimePeriod:1,startIdx<lookbackTotal&&(startIdx=lookbackTotal),endIdx<startIdx)return outReal;if(outIdx=0,this.Settings.TimePeriod<=1){for(var outBegIdx=startIdx,today=startIdx-1,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE];today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffM&&diffP<diffM?(eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),TA.TA_IS_ZERO(tempReal)?outReal[outIdx++]=0:outReal[outIdx++]=diffM/tempReal):outReal[outIdx++]=0,prevClose=dataShape[today][TA.CLOSE];return outNBElement=outIdx,outReal}for(outBegIdx=today=startIdx,prevMinusDM=0,prevTR=0,today=startIdx-lookbackTotal,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE],i=this.Settings.TimePeriod-1;0<i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffM&&diffP<diffM&&(prevMinusDM+=diffM),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR+=tempReal,prevClose=dataShape[today][TA.CLOSE];for(i=1;0!=i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffM&&diffP<diffM?prevMinusDM=prevMinusDM-prevMinusDM/this.Settings.TimePeriod+diffM:prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE];for(TA.TA_IS_ZERO(prevTR)?outReal[0]=0:outReal[0]=round_pos(prevMinusDM/prevTR*100),outIdx=1;today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffM&&diffP<diffM?prevMinusDM=prevMinusDM-prevMinusDM/this.Settings.TimePeriod+diffM:prevMinusDM-=prevMinusDM/this.Settings.TimePeriod,eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)?outReal[outIdx++]=0:outReal[outIdx++]=round_pos(prevMinusDM/prevTR*100);return outNBElement=outIdx,outReal},TA.INDICATOR_TEMPLATE?TA.MINUS_DM=TA.INDICATOR_TEMPLATE.Create():TA.MINUS_DM={},TA.MINUS_DM.name="MINUS_DM",TA.MINUS_DM.type="line",TA.MINUS_DM.DefaultSettings={TimePeriod:14},TA.MINUS_DM.Settings={},TA.MINUS_DM._lookback=function(t){if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return 1<t?t-1:1},TA.MINUS_DM.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<(a=1<this.Settings.TimePeriod?this.Settings.TimePeriod-1:1)&&(t=a),e<t)return u;if(s=0,this.Settings.TimePeriod<=1){for(n=i[r=t-1][TA.HIGH],o=i[r][TA.LOW];r<e;)c=(h=i[++r][TA.HIGH])-n,n=h,d=o-(h=i[r][TA.LOW]),o=h,u[s++]=0<d&&c<d?d:0;return u}for(l=0,n=i[r=t-a][TA.HIGH],o=i[r][TA.LOW],p=this.Settings.TimePeriod-1;0<p--;)c=(h=i[++r][TA.HIGH])-n,n=h,d=o-(h=i[r][TA.LOW]),o=h,0<d&&c<d&&(l+=d);for(p=0;0!=p--;)c=(h=i[++r][TA.HIGH])-n,n=h,d=o-(h=i[r][TA.LOW]),o=h,0<d&&c<d?l=l-l/this.Settings.TimePeriod+d:l-=l/this.Settings.TimePeriod;for(u[0]=l,s=1;r<e;)c=(h=i[++r][TA.HIGH])-n,n=h,d=o-(h=i[r][TA.LOW]),o=h,0<d&&c<d?l=l-l/this.Settings.TimePeriod+d:l-=l/this.Settings.TimePeriod,u[s++]=l;return u},TA.INDICATOR_TEMPLATE?TA.OBV=TA.INDICATOR_TEMPLATE.Create():TA.OBV={},TA.OBV.name="OBV",TA.OBV.type="line",TA.OBV.DefaultSettings={CandleValueIdx:TA.CLOSE},TA.OBV.Settings={},TA.OBV._lookback=function(){return 0},TA.OBV.calculate=function(t,e,i,a){var r,s,n,o,h,l=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";for(h=i[t][TA.VOL],n=i[t][this.Settings.CandleValueIdx],s=0,r=t;r<=e;r++)n<(o=i[r][this.Settings.CandleValueIdx])?h+=i[r][TA.VOL]:o<n&&(h-=i[r][TA.VOL]),l[s++]=h,n=o;return l},TA.INDICATOR_TEMPLATE?TA.PCH=TA.INDICATOR_TEMPLATE.Create():TA.PCH={},TA.PCH.name="PCH",TA.PCH.type="line",TA.PCH.DefaultSettings={TimePeriodLower:13,TimePeriodUpper:13},TA.PCH.Settings={},TA.PCH._lookback=function(t,e){t=t||(this.Settings.TimePeriodLower||this.DefaultSettings.TimePeriodLower),e=e||(this.Settings.TimePeriodUpper||this.DefaultSettings.TimePeriodUpper);e=Math.min(t,e)-1;return e<1||1e5<e?-1:1<e?e:1},TA.PCH.calculate=function(t,e,i,a){var r=[],s=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";this.SetSettings(a);for(var n=this.Settings.TimePeriodLower,o=this.Settings.TimePeriodUpper,h=n-1;h<=e;h++){for(var l=i[h][TA.LOW],c=h-n+1;c<=h;c++)i[c][TA.LOW]<l&&(l=i[c][TA.LOW]);s.push(l)}for(h=o-1;h<=e;h++){for(var d=i[h][TA.HIGH],c=h-o+1;c<=h;c++)i[c][TA.HIGH]>d&&(d=i[c][TA.HIGH]);r.push(d)}if(o<n)for(h=0;h<n-o;h++)s.splice(0,0,0);else if(o<n)for(h=0;h<o-n;h++)r.splice(0,0,0);return{high:r,low:s}},TA.INDICATOR_TEMPLATE?TA.PLUS_DI=TA.INDICATOR_TEMPLATE.Create():TA.PLUS_DI={},TA.PLUS_DI.name="PLUS_DI",TA.PLUS_DI.type="line",TA.PLUS_DI.DefaultSettings={TimePeriod:14},TA.PLUS_DI.Settings={},TA.PLUS_DI._lookback=function(t){if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return 1<t?t:1},TA.PLUS_DI.calculate=function(startIdx,endIdx,dataShape,settings){var today,lookbackTotal,outIdx,prevHigh,prevLow,prevClose,prevPlusDM,prevTR,tempReal,tempReal2,diffP,diffM,i,outReal=[];function TRUE_RANGE(t,e,i,a){return"              "+a+" = "+t+"-"+e+";               tempReal2 = Math.abs("+t+"-"+i+");               if( tempReal2 > "+a+" )                  "+a+" = tempReal2;               tempReal2 = Math.abs("+e+"-"+i+");               if( tempReal2 > "+a+" )                  "+a+" = tempReal2;"}if(this.SetSettings(settings),startIdx<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(endIdx<0||endIdx<startIdx)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;function round_pos(t){return t}if(lookbackTotal=1<this.Settings.TimePeriod?this.Settings.TimePeriod:1,startIdx<lookbackTotal&&(startIdx=lookbackTotal),endIdx<startIdx){var outBegIdx=0,outNBElement=0;return outReal}if(outIdx=0,this.Settings.TimePeriod<=1){for(var outBegIdx=startIdx,today=startIdx-1,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE];today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffP&&diffM<diffP?(eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),TA.TA_IS_ZERO(tempReal)?outReal[outIdx++]=0:outReal[outIdx++]=diffP/tempReal):outReal[outIdx++]=0,prevClose=dataShape[today][TA.CLOSE];return outNBElement=outIdx,outReal}for(outBegIdx=today=startIdx,prevPlusDM=0,prevTR=0,today=startIdx-lookbackTotal,prevHigh=dataShape[today][TA.HIGH],prevLow=dataShape[today][TA.LOW],prevClose=dataShape[today][TA.CLOSE],i=this.Settings.TimePeriod-1;0<i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffP&&diffM<diffP&&(prevPlusDM+=diffP),eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR+=tempReal,prevClose=dataShape[today][TA.CLOSE];for(i=1;0!=i--;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffP&&diffM<diffP?prevPlusDM=prevPlusDM-prevPlusDM/this.Settings.TimePeriod+diffP:prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE];for(TA.TA_IS_ZERO(prevTR)?outReal[0]=0:outReal[0]=round_pos(prevPlusDM/prevTR*100),outIdx=1;today<endIdx;)today++,tempReal=dataShape[today][TA.HIGH],diffP=tempReal-prevHigh,prevHigh=tempReal,tempReal=dataShape[today][TA.LOW],diffM=prevLow-tempReal,prevLow=tempReal,0<diffP&&diffM<diffP?prevPlusDM=prevPlusDM-prevPlusDM/this.Settings.TimePeriod+diffP:prevPlusDM-=prevPlusDM/this.Settings.TimePeriod,eval(TRUE_RANGE("prevHigh","prevLow","prevClose","tempReal")),prevTR=prevTR-prevTR/this.Settings.TimePeriod+tempReal,prevClose=dataShape[today][TA.CLOSE],TA.TA_IS_ZERO(prevTR)?outReal[outIdx++]=0:outReal[outIdx++]=round_pos(prevPlusDM/prevTR*100);return outNBElement=outIdx,outReal},PPO=TA.INDICATOR_TEMPLATE?TA.INDICATOR_TEMPLATE.Create():{},PPO.DefaultSettings={CandleValueIdx:TA.CLOSE,FastPeriod:12,SlowPeriod:26,MAType:TA.MATypes.SMA},PPO.Settings={},PPO.name="PPO",PPO.type="line",PPO._lookback=function(t,e,i){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.FastPeriod;if(e){if(e<2||1e5<e)return-1}else e=this.DefaultSettings.SlowPeriod;if(i){if(i<0||8<i)return-1}else i=this.DefaultSettings.MAType;return MA._lookback(Math.max(e,t),i)},PPO.calculate=function(t,e,i,a){var r=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.FastPeriod){if(this.Settings.FastPeriod<2||1e5<this.Settings.FastPeriod)throw"TA_BAD_PARAM"}else this.Settings.FastPeriod=this.DefaultSettings.FastPeriod;if(this.Settings.SlowPeriod){if(this.Settings.SlowPeriod<2||1e5<this.Settings.SlowPeriod)throw"TA_BAD_PARAM"}else this.Settings.SlowPeriod=this.DefaultSettings.SlowPeriod;if(this.Settings.MAType){if(this.Settings.MAType<0||8<this.Settings.MAType)throw"TA_BAD_PARAM"}else this.Settings.MAType=this.DefaultSettings.MAType;return APO.INT_PO(t,e,i,this.Settings.FastPeriod,this.Settings.SlowPeriod,this.Settings.MAType,r,[],1)},PPO.SetSettings(PPO.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.ROC=TA.INDICATOR_TEMPLATE.Create():TA.ROC={},TA.ROC.name="ROC",TA.ROC.type="line",TA.ROC.DefaultSettings={CandleValueIdx:TA.CLOSE,TimePeriod:10},TA.ROC.Settings={},TA.ROC._lookback=function(t){if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return t},TA.ROC.calculate=function(t,e,i,a){var r,s,n,o,h=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<1||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(!h)throw"TA_BAD_PARAM";if(t<this.Settings.TimePeriod&&(t=this.Settings.TimePeriod),e<t)return h;for(s=0,n=(r=t)-this.Settings.TimePeriod;r<=e;)o=i[n++][TA.CLOSE],h[s++]=0!=o?100*(i[r][TA.CLOSE]/o-1):0,r++;return h},TA.INDICATOR_TEMPLATE?TA.RSI=TA.INDICATOR_TEMPLATE.Create():TA.RSI={},TA.RSI.name="RSI",TA.RSI.type="line",TA.RSI.DefaultSettings={TimePeriod:14,CandleValueIdx:TA.CLOSE},TA.RSI.Settings={},TA.RSI.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d;this.SetSettings(a);var p=[];if(t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<(a=this._lookback(this.Settings.TimePeriod))&&(t=a),e<t)return p;if(r=0,1==this.Settings.TimePeriod)return p=i.slice(t);for(l=i[s=t-a][this.Settings.CandleValueIdx],h=o=0,s++,n=this.Settings.TimePeriod;0<n;n--)d=(c=i[s++][this.Settings.CandleValueIdx])-l,l=c,d<0?h-=d:o+=d;if(h/=this.Settings.TimePeriod,o/=this.Settings.TimePeriod,t<s)c=o+h,TA.TA_IS_ZERO(c)?p[r++]=0:p[r++]=o/c*100;else for(;s<t;)d=(c=i[s][this.Settings.CandleValueIdx])-l,l=c,h*=this.Settings.TimePeriod-1,o*=this.Settings.TimePeriod-1,d<0?h-=d:o+=d,h/=this.Settings.TimePeriod,o/=this.Settings.TimePeriod,s++;for(;s<=e;)d=(c=i[s++][this.Settings.CandleValueIdx])-l,l=c,h*=this.Settings.TimePeriod-1,o*=this.Settings.TimePeriod-1,d<0?h-=d:o+=d,h/=this.Settings.TimePeriod,c=(o/=this.Settings.TimePeriod)+h,TA.TA_IS_ZERO(c)?p[r++]=0:p[r++]=o/c*100;return p},TA.RSI.getValue=function(t,e,i){},TA.RSI._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.Settings.TimePeriod||this.DefaultSettings.TimePeriod;return t},TA.RSI._S=function(t,e,i,a){},TA.RSI.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE&&TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.RSI.SetSettings(TA.RSI.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.SAR=TA.INDICATOR_TEMPLATE.Create():TA.SAR={},TA.SAR.name="SAR",TA.SAR.type="line",TA.SAR.DefaultSettings={Acceleration:.02,Maximum:.2},TA.SAR.Settings={},TA.SAR._lookback=function(t,e){if(t){if(t<0||3e37<t)return-1}else t=this.DefaultSettings.Acceleration;if(e){if(e<0||3e37<e)return-1}else e=this.DefaultSettings.Maximum;return 1},TA.SAR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.Acceleration){if(this.Settings.Acceleration<0||3e37<this.Settings.Acceleration)throw"TA_BAD_PARAM"}else this.Settings.Acceleration=this.DefaultSettings.Acceleration;if(this.Settings.Maximum){if(this.Settings.Maximum<0||3e37<this.Settings.Maximum)throw"TA_BAD_PARAM"}else this.Settings.Maximum=this.DefaultSettings.Maximum;if(t<1&&(t=1),e<t)return g;for((d=this.Settings.Acceleration)>this.Settings.Maximum&&(d=this.Settings.Acceleration=this.Settings.Maximum),r=0<TA.MINUS_DM.calculate(t,t,i,{TimePeriod:1})[0]?0:1,n=0,o=i[(s=t)-1][TA.HIGH],h=i[s-1][TA.LOW],u=1==r?(p=i[s][TA.HIGH],h):(p=i[s][TA.LOW],o),h=i[s][TA.LOW],o=i[s][TA.HIGH];s<=e;)c=h,l=o,h=i[s][TA.LOW],o=i[s][TA.HIGH],s++,1==r?h<=u?(r=0,(u=p)<l&&(u=l),u<o&&(u=o),g[n++]=u,(u+=(d=this.Settings.Acceleration)*((p=h)-u))<l&&(u=l),u<o&&(u=o)):(g[n++]=u,p<o&&(p=o,(d+=this.Settings.Acceleration)>this.Settings.Maximum&&(d=this.Settings.Maximum)),c<(u+=d*(p-u))&&(u=c),h<u&&(u=h)):u<=o?(r=1,c<(u=p)&&(u=c),h<u&&(u=h),g[n++]=u,c<(u+=(d=this.Settings.Acceleration)*((p=o)-u))&&(u=c),h<u&&(u=h)):(g[n++]=u,h<p&&(p=h,(d+=this.Settings.Acceleration)>this.Settings.Maximum&&(d=this.Settings.Maximum)),(u+=d*(p-u))<l&&(u=l),u<o&&(u=o));return g},TA.INDICATOR_TEMPLATE?TA.SMA=TA.INDICATOR_TEMPLATE.Create():TA.SMA={},TA.SMA.name="SMA",TA.SMA.type="line",TA.SMA.DefaultSettings={TimePeriod:30,CandleValueIdx:TA.CLOSE},TA.SMA.Settings={},TA.SMA.calculate=function(t,e,i,a,r){var s,n,o,h,l,c=[];if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<(a=this.Settings.TimePeriod-1)&&(t=a),e<t)return c;if(s=0,o=l=t-a,1<this.Settings.TimePeriod)for(;o<t;)s+=i[o++][this.Settings.CandleValueIdx];for(h=0;n=s+=i[o++][this.Settings.CandleValueIdx],s-=i[l++][this.Settings.CandleValueIdx],c[h++]=n/this.Settings.TimePeriod,o<=e;);return c},TA.SMA.getValue=function(t,e,i){},TA.SMA._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return t-1},TA.SMA._S=function(t,e,i,a){},TA.SMA.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.SMA.SetSettings(TA.SMA.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.STDDEV=TA.INDICATOR_TEMPLATE.Create():TA.STDDEV={},TA.STDDEV.name="STDDEV",TA.STDDEV.type="line",TA.STDDEV.DefaultSettings={TimePeriod:10,Deviations:1,CandleValueIdx:TA.CLOSE},TA.STDDEV.Settings={},TA.STDDEV.calculate=function(t,e,i,a){var r,s,n=[];if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(this.Settings.Deviations){if(this.Settings.Deviations<-3e37||3e37<this.Settings.Deviations)throw"TA_BAD_PARAM"}else this.Settings.Deviations=this.DefaultSettings.Deviations;if(!(n=TA.INT_VAR.Create({TimePeriod:this.Settings.TimePeriod,CandleValueIdx:this.Settings.CandleValueIdx}).calculate(t,e,i,{TimePeriod:this.Settings.TimePeriod,CandleValueIdx:this.Settings.CandleValueIdx}))||!n.length)return n;if(1!=this.Settings.Deviations)for(r=0;r<void 0;r++)s=n[r],n[r]=s?Math.sqrt(s)*this.Settings.Deviations:0;else for(r=0;r<n.length;r++)s=n[r],n[r]=s?Math.sqrt(s):0;return n},TA.STDDEV.getValue=function(t,e,i){},TA.STDDEV._lookback=function(t,e){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<-3e37||3e37<e)return-1}else e=this.DefaultSettings.Deviations;return TA.VAR._lookback(t,e)},TA.STDDEV._S=function(t,e,i,a){},TA.STDDEV.initChart=function(t,e,i){TA.INDICATOR_TEMPLATE&&TA.INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.STDDEV.SetSettings(TA.STDDEV.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.STOCH=TA.INDICATOR_TEMPLATE.Create():TA.STOCH={},TA.STOCH.name="STOCH",TA.STOCH.type="line",TA.STOCH.DefaultSettings={PeriodFastK:5,PeriodSlowK:3,PeriodSlowD:3,SlowKMAType:TA.MATypes.SMA,SlowDMAType:TA.MATypes.SMA},TA.STOCH.Settings={},TA.STOCH.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g,f=[],m=[];if(a&&this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.PeriodFastK){if(this.Settings.PeriodFastK<1||1e5<this.Settings.PeriodFastK)throw"TA_BAD_PARAM"}else this.Settings.PeriodFastK=this.DefaultSettings.PeriodFastK;if(this.Settings.PeriodSlowK){if(this.Settings.PeriodSlowK<1||1e5<this.Settings.PeriodSlowK)throw"TA_BAD_PARAM"}else this.Settings.PeriodSlowK=this.DefaultSettings.PeriodSlowK;if(this.Settings.PeriodSlowD){if(this.Settings.PeriodSlowD<1||1e5<this.Settings.PeriodSlowD)throw"TA_BAD_PARAM"}else this.Settings.PeriodSlowD=this.DefaultSettings.PeriodSlowD;if(this.Settings.SlowKMAType)this.Settings.SlowKMAType=this.DefaultSettings.SlowKMAType;else if(this.Settings.SlowKMAType<0||8<this.Settings.SlowKMAType)throw"TA_BAD_PARAM";if(this.Settings.SlowDMAType)this.Settings.SlowDMAType=this.DefaultSettings.SlowDMAType;else if(this.Settings.SlowDMAType<0||8<this.Settings.SlowDMAType)throw"TA_BAD_PARAM";if(!f)throw"TA_BAD_PARAM";if(0,v=this.Settings.PeriodFastK-1,d=TA.MA._lookback(this.Settings.PeriodSlowK,this.Settings.SlowKMAType),t<(d=v+(a=TA.MA._lookback(this.Settings.PeriodSlowD,this.Settings.SlowDMAType))+d)&&(t=d),e<t)return{slowK:[],slowD:[]};for(u=(p=t-d)+v,l=c=-1,o=s=r=h=0;u<=e;){if(n=i[u][TA.LOW],l<p){for(r=i[l=p][TA.LOW],g=l;++g<=u;)(n=i[g][TA.LOW])<r&&(l=g,r=n);o=(s-r)/100}else n<=r&&(l=u,o=(s-(r=n))/100);if(n=i[u][TA.HIGH],c<p){for(s=i[c=p][TA.HIGH],g=c;++g<=u;)s<(n=i[g][TA.HIGH])&&(c=g,s=n);o=(s-r)/100}else s<=n&&(c=u,o=((s=n)-r)/100);m[h++]=0!=o?[(i[u][TA.CLOSE]-r)/o]:[0],p++,u++}var v=(f=TA.MA.Create({TimePeriod:this.Settings.PeriodSlowK,MAType:this.Settings.SlowKMAType}).calculate(0,h-1,m,{TimePeriod:this.Settings.PeriodSlowK,MAType:this.Settings.SlowKMAType,CandleValueIdx:0})).length;f.forEach(function(t,e){m[e]=[t]});var y=TA.MA.Create({TimePeriod:this.Settings.PeriodSlowK,MAType:this.Settings.SlowKMAType}).calculate(0,v-1,m,{TimePeriod:this.Settings.PeriodSlowD,MAType:this.Settings.SlowDMAType,CandleValueIdx:0});return{slowK:f=f.slice(a),slowD:y}},TA.STOCH._lookback=function(t,e,i,a,r){if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.PeriodFastK;if(e){if(e<1||1e5<e)return-1}else e=this.DefaultSettings.PeriodSlowK;if(a){if(a<0||8<a)return-1}else a=this.DefaultSettings.SlowKMAType;if(i){if(i<1||1e5<i)return-1}else i=this.DefaultSettings.PeriodSlowD;if(r){if(r<0||8<r)return-1}else r=this.DefaultSettings.SlowDMAType;--t;return t+=TA.MA._lookback(e,a),t+=TA.MA._lookback(i,r)},TA.INDICATOR_TEMPLATE?TA.TEMA=TA.INDICATOR_TEMPLATE.Create():TA.TEMA={},TA.TEMA.name="TEMA",TA.TEMA.type="line",TA.TEMA.DefaultSettings={CandleValueIdx:TA.CLOSE,TimePeriod:12},TA.TEMA.Settings={},TA.TEMA._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return 3*TA.EMA._lookback(t)},TA.TEMA.calculate=function(t,e,i,a){var r,s,n,o,h=[],l=[],c=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<(d=3*(s=TA.EMA._lookback(this.Settings.TimePeriod)))&&(t=d),e<t)return c;a=TA.PER_TO_K(this.Settings.TimePeriod);var d=TA.EMA.Create({TimePeriod:this.Settings.TimePeriod});if(d._int_ema(t-3*s,e,i,this.Settings.TimePeriod,a,h),!h.length)return c;for(var p=[],u=0;u<h.length;u++)p.push([h[u]]);if(d.SetSettings({CandleValueIdx:0}),d._int_ema(0,p.length-1,p,this.Settings.TimePeriod,a,l),!l.length)return c;for(var g=[],u=0;u<l.length;u++)g.push([l[u]]);if(d.SetSettings({CandleValueIdx:0}),d._int_ema(0,g.length-1,g,this.Settings.TimePeriod,a,c),!c.length)return c;for(n=2*s,o=s,r=0;r<c.length;)c[r]+=3*h[n++]-3*l[o++],r++;return c},TA.INDICATOR_TEMPLATE?TA.TRANGE=TA.INDICATOR_TEMPLATE.Create():TA.TRANGE={},TA.TRANGE.name="AROON",TA.TRANGE.type="line",TA.TRANGE.DefaultSettings={},TA.TRANGE.Settings={},TA.TRANGE._lookback=function(){return 1},TA.TRANGE.calculate=function(t,e,i,a){var r,s,n,o,h,l,c=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(t<1&&(t=1),e<t)return c;for(s=0,r=t;r<=e;)h=i[r][TA.LOW],l=i[r][TA.HIGH],o=i[r][TA.CLOSE],(n=l-h)<(l=Math.abs(o-l))&&(n=l),n<(h=Math.abs(o-h))&&(n=h),c[s++]=n,r++;return c},TA.INDICATOR_TEMPLATE?TA.TRIMA=TA.INDICATOR_TEMPLATE.Create():TA.TRIMA={},TA.TRIMA.name="TRIMA",TA.TRIMA.type="line",TA.TRIMA.DefaultSettings={CandleValueIdx:TA.CLOSE,TimePeriod:20},TA.TRIMA.Settings={},TA.TRIMA._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return t-1},TA.TRIMA.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<(a=this.Settings.TimePeriod-1)&&(t=a),e<t)return g;if(h=0,this.Settings.TimePeriod%2==1){for(p=1/(p=((o=this.Settings.TimePeriod>>1)+1)*(o+1)),l=(d=(c=t-a)+o)+o,s=r=0,o=d;c<=o;o--)r+=s+=u=i[o][this.Settings.CandleValueIdx];for(n=0,o=++d;o<=l;o++)r+=n+=u=i[o][this.Settings.CandleValueIdx];for(h=0,u=i[c++][this.Settings.CandleValueIdx],g[h++]=r*p,l++;l<=e;)r-=s,s-=u,s+=u=i[d++][this.Settings.CandleValueIdx],r+=n,n-=u,n+=u=i[l++][this.Settings.CandleValueIdx],r+=u,u=i[c++][this.Settings.CandleValueIdx],g[h++]=r*p}else{for(p=1/(p=(o=this.Settings.TimePeriod>>1)*(o+1)),l=(d=(c=t-a)+o-1)+o,s=r=0,o=d;c<=o;o--)r+=s+=u=i[o][this.Settings.CandleValueIdx];for(n=0,o=++d;o<=l;o++)r+=n+=u=i[o][this.Settings.CandleValueIdx];for(h=0,u=i[c++][this.Settings.CandleValueIdx],g[h++]=r*p,l++;l<=e;)r-=s,s-=u,s+=u=i[d++][this.Settings.CandleValueIdx],r+=n-=u,n+=u=i[l++][this.Settings.CandleValueIdx],r+=u,u=i[c++][this.Settings.CandleValueIdx],g[h++]=r*p}return g},TA.INDICATOR_TEMPLATE?TA.TYPPRICE=TA.INDICATOR_TEMPLATE.Create():TA.TYPPRICE={},TA.TYPPRICE.name="TYPPRICE",TA.TYPPRICE.type="line",TA.TYPPRICE.DefaultSettings={},TA.TYPPRICE.Settings={},TA.TYPPRICE._lookback=function(){return 0},TA.TYPPRICE.calculate=function(t,e,i,a){var r,s,n=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";for(r=0,s=t;s<=e;s++)n[r++]=(i[s][TA.HIGH]+i[s][TA.LOW]+i[s][TA.CLOSE])/3;return n},TA.INDICATOR_TEMPLATE?TA.VAR=TA.INDICATOR_TEMPLATE.Create():TA.VAR={},TA.VAR.name="VAR",TA.VAR.type="line",TA.VAR.DefaultSettings={TimePeriod:2,Deviations:1,CandleValueIdx:TA.CLOSE},TA.VAR.Settings={},TA.VAR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p=[];if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<(a=this.Settings.TimePeriod-1)&&(t=a),e<t)return p;if(n=s=0,l=d=t-a,1<this.Settings.TimePeriod)for(;l<t;)s+=r=i[l++][this.Settings.CandleValueIdx],n+=r*=r;for(c=0;s+=r=i[l++][this.Settings.CandleValueIdx],n+=r*=r,o=s/this.Settings.CandleValueIdx,h=n/this.Settings.CandleValueIdx,s-=r=i[d++][this.Settings.CandleValueIdx],n-=r*=r,p[c++]=h-o*o,l<=e;);return p},TA.VAR.getValue=function(t,e,i){},TA.VAR._lookback=function(t,e){if(t){if(t<1||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;if(e){if(e<-3e37||3e37<e)return-1}else e=this.DefaultSettings.Deviations;return t-1},TA.VAR._S=function(t,e,i,a){},TA.VAR.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.VAR.SetSettings(TA.VAR.DefaultSettings),TA.INT_VAR=TA.VAR.Create(),TA.INT_VAR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p=[];if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<(a=this.Settings.TimePeriod-1)&&(t=a),e<t)return p;if(n=s=0,l=d=t-a,1<this.Settings.TimePeriod)for(;l<t;)s+=r=i[l++][this.Settings.CandleValueIdx],n+=r*=r;for(c=0;s+=r=i[l++][this.Settings.CandleValueIdx],n+=r*=r,o=s/this.Settings.TimePeriod,h=n/this.Settings.TimePeriod,s-=r=i[d++][this.Settings.CandleValueIdx],n-=r*=r,p[c++]=h-o*o,l<=e;);return p},TA.INDICATOR_TEMPLATE?TA.VPT=TA.INDICATOR_TEMPLATE.Create():TA.VPT={},TA.VPT.name="VPT",TA.VPT.type="line",TA.VPT.DefaultSettings={},TA.VPT.Settings={},TA.VPT._lookback=function(){return 0},TA.VPT.calculate=function(t,e,i,a){var r=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";var s=i[t][TA.CLOSE];r[0]=0;for(var n=t+1;n<=e;++n)r[n-t]=r[n-t-1]+i[n][TA.VOL]*(i[n][TA.CLOSE]-s)/s,s=i[n][TA.CLOSE];return r},TA.INDICATOR_TEMPLATE?TA.WCLPRICE=TA.INDICATOR_TEMPLATE.Create():TA.WCLPRICE={},TA.WCLPRICE.name="WCLPRICE",TA.WCLPRICE.type="line",TA.WCLPRICE.DefaultSettings={},TA.WCLPRICE.Settings={},TA.WCLPRICE._lookback=function(){return 0},TA.WCLPRICE.calculate=function(t,e,i,a){var r,s,n=[];if(t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";for(r=0,s=t;s<=e;s++)n[r++]=(i[s][TA.HIGH]+i[s][TA.LOW]+2*i[s][TA.CLOSE])/4;return n},TA.INDICATOR_TEMPLATE?TA.WILLR=TA.INDICATOR_TEMPLATE.Create():TA.WILLR={},TA.WILLR.name="WILLR",TA.WILLR.type="line",TA.WILLR.DefaultSettings={TimePeriod:14},TA.WILLR.Settings={},TA.WILLR._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=this.DefaultSettings.TimePeriod;return t-1},TA.WILLR.calculate=function(t,e,i,a){var r,s,n,o,h,l,c,d,p,u,g=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<(a=this.Settings.TimePeriod-1)&&(t=a),e<t)return g;for(l=(p=t)-a,c=d=-1,o=s=r=h=o=0;p<=e;){if(n=i[p][TA.LOW],c<l){for(r=i[c=l][TA.LOW],u=c;++u<=p;)(n=i[u][TA.LOW])<r&&(c=u,r=n);o=(s-r)/-100}else n<=r&&(c=p,o=(s-(r=n))/-100);if(n=i[p][TA.HIGH],d<l){for(s=i[d=l][TA.HIGH],u=d;++u<=p;)s<(n=i[u][TA.HIGH])&&(d=u,s=n);o=(s-r)/-100}else s<=n&&(d=p,o=((s=n)-r)/-100);g[h++]=0!=o?(s-i[p][TA.CLOSE])/o:0,l++,p++}return g},TA.INDICATOR_TEMPLATE?TA.WMA=TA.INDICATOR_TEMPLATE.Create():TA.WMA={},TA.WMA.name="WMA",TA.WMA.type="line",TA.WMA.DefaultSettings={TimePeriod:30,CandleValueIdx:TA.CLOSE},TA.WMA.Settings={},TA.WMA.calculate=function(t,e,i,a,r){var s,n,o,h,l,c,d,p,u,g=[];if(this.SetSettings(a),t=t||0,e=e||i.length-1,t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(!g)throw"TA_BAD_PARAM";if(t<(a=this.Settings.TimePeriod-1)&&(t=a),e<t)return g;if(1==this.Settings.TimePeriod)return g;for(l=this.Settings.TimePeriod*(+this.Settings.TimePeriod+1)/2,c=d=n=0,s=h=t-a,o=1;s<t;)d+=p=i[s++][this.Settings.CandleValueIdx],c+=p*o,o++;for(u=0;s<=e;)d+=p=i[s++][this.Settings.CandleValueIdx],d-=u,c+=p*this.Settings.TimePeriod,u=i[h++][this.Settings.CandleValueIdx],g[n++]=c/l,c-=d;return g},TA.WMA.getValue=function(t,e,i){},TA.WMA._lookback=function(t){if(t){if(t<2||1e5<t)return-1}else t=30;return t-1},TA.WMA._S=function(t,e,i,a){},TA.WMA.initChart=function(t,e,i){INDICATOR_TEMPLATE&&INDICATOR_TEMPLATE.initChart.apply(this,arguments)},TA.WMA.SetSettings(TA.WMA.DefaultSettings),TA.INDICATOR_TEMPLATE?TA.ZLEMA=TA.INDICATOR_TEMPLATE.Create():TA.ZLEMA={},TA.ZLEMA.name="ZLEMA",TA.ZLEMA.type="line",TA.ZLEMA.DefaultSettings={CandleValueIdx:TA.CLOSE,TimePeriod:12},TA.ZLEMA.Settings={},TA.ZLEMA._lookback=function(t){return 0},TA.ZLEMA.calculate=function(t,e,i,a){var r=o=[];if(this.SetSettings(a),t<0)throw"TA_OUT_OF_RANGE_START_INDEX";if(e<0||e<t)throw"TA_OUT_OF_RANGE_END_INDEX";if(!i||!i.length)throw"TA_BAD_PARAM";if(this.Settings.TimePeriod){if(this.Settings.TimePeriod<2||1e5<this.Settings.TimePeriod)throw"TA_BAD_PARAM"}else this.Settings.TimePeriod=this.DefaultSettings.TimePeriod;if(t<(a=TA.EMA._lookback(this.Settings.TimePeriod))&&(t=a),e<t)return r;for(var s=TA.PER_TO_K(this.Settings.TimePeriod),n=Math.ceil((this.Settings.TimePeriod-1)/2),o=[],h=0;h<=e;h++)o[h]=h<n?i[h][TA.CLOSE]:s*(2*i[h][TA.CLOSE]-i[h-n][TA.CLOSE])+(1-s)*o[h-1];return o},function(){"use strict";var p={chartType:"Line",enabled:!0,formatProvider:{decimalPlaces:"2",decimalPrecision:null},indicatorIndex:0,indicatorIndex2:0,kind:"TA_LIB",name:"",overlay:!0,points:[],valuesPerPoint:1,isStartedFromZero:!1,color:"",width:2,chartArea:"ChartArea1",enableMerge:!0,index:2,closeValueIndex:0,lowValueIndex:0,highValueIndex:0,labels:[]};iChart.Charting.TA=function(t){this.chart=t.chart},iChart.Charting.TA.prototype.addCustomIndicatorSerie=function(t,e,i){if(arguments.length<3)throw _t("14949","Неверные параметры для вывода пользовательской серии.");if(t){this.removeIndicator(e);var a=new iChart.Charting.ChartArea({chart:this.chart}),r="ChartAreaI"+e,t=i.title||indocatorName,s=i.data,n=s.length;a.axisX.showLabels=!1,a.enabled=!0,a.xSeries=this.chart.areas[0].xSeries,a.ySeries=[],a.name=r,a.title=t,a.onClose=function(){this.chart.clearIndicators(this)};var o=[];o[0]=$.extend(!0,{},p),o[0].indicatorIndex=e||0,o[0].color=i.color||this.chart.chartOptions.indicatorColors[e][0],o[0].width=i.width||2,o[0].name=t,o[0].labels=this.getLabels(o[0],[]);this.getData();for(var h=0;h<n;h++)o[0].points.push([0===s[h]?null:s[h]]);a.ySeries.push(o[0]),this.chart.areas.push(a);for(var l=0;l<this.chart.areas.length;++l)this.chart.areas[l].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a.title,params:null,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.getDefaultParams=function(t){var i={};return $.each(iChart.indicators[t].parameters,function(t,e){i[e.Code]=e.Value}),i},iChart.Charting.TA.prototype.getSeries=function(t,e){t=t||"Volume",e=e||"";for(var i=this.chart.areas,a=0;a<i.length;a++){for(var r=-1,s=0;s<i[a].ySeries.length;s++)if("TechnicalAnalysis"===i[a].ySeries[s].kind){var n=i[a].ySeries[s].name.match(/(.+)\s\((.*)\)/);if(n&&n[1]===t&&n[2]==e){r=s;break}}else if(i[a].ySeries[s].kind===t){r=s;break}if(0<=r)break}return 0<=r&&{xSeries:this.chart.areas[a].xSeries.slice(0,this.chart.areas[a].xSeries.length-this.chart.chartOptions.futureAmount),ySeries:this.chart.areas[a].ySeries[s].points.slice(0,this.chart.areas[a].xSeries.length-this.chart.chartOptions.futureAmount)}},iChart.Charting.TA.prototype.getData=function(){for(var t=this.chart.areas[0].xSeries,e=this.chart.areas[0].ySeries[0],i=(i=this.getSeries("Volume"))||{ySeries:[]},a=[],r=0;r<t.length-this.chart.chartOptions.futureAmount;r++){var s=new Date(1e3*t[r]);iChart.formatDateTime(s);s=["",this.chart._dataSettings.timeframe,iChart.formatDateTime(s,"yyyyMMdd"),iChart.formatDateTime(s,"HHmmss"),null!=e.points[r]?e.points[r][2]:a[r-1][4],null!=e.points[r]?e.points[r][0]:a[r-1][5],null!=e.points[r]?e.points[r][1]:a[r-1][6],null!=e.points[r]?e.points[r][3]:a[r-1][7],null!=i.ySeries[r]?i.ySeries[r][0]:0,iChart.formatDateTime(s,"yyyy-MM-ddTHH:mm:ss"),s.getTime(),iChart.formatDateTime(s,"yyyy-MM-ddTHH:mm:ss")];a[r]=s}return a},iChart.Charting.TA.prototype.mapParam=function(t){return{TimePeriod:"Period",PeriodROC:"PeriodROC",shift:"Shift",DeviationsUp:"StdDevUp",DeviationsDown:"StdDevDown"}[t]||""},iChart.Charting.TA.prototype.test=function(){for(var t=parseInt(this.chart._dataSettings.i0_Period),e=this.getData(),i=EMA.calculate(null,null,e,{TimePeriod:t}),i=Array(t-1).concat(i),a=this.getSeries("EMA",t).ySeries,r=0;r<a.length;r++)console.log(r,a[r],i[r],"cl="+e[r][CLOSE],"dt="+(100-a[r]/i[r]*100))},iChart.Charting.TA.prototype.removeIndicator=function(t){if(void 0!==this.chart&&!$.isEmptyObject(this.chart.areas)){for(var e=0;e<this.chart.areas.length;++e){for(var a=this.chart.areas[e],i=[],r=0;r<a.ySeries.length;++r)"TA_LIB"!==a.ySeries[r].kind||a.ySeries[r].indicatorIndex!=t&&void 0!==t||(i.push(a.ySeries[r].indicatorIndex),a.ySeries.splice(r,1),--r);i.length&&(0===a.ySeries.length?(void 0!==a.overlay&&$(a.overlay.canvas).remove(),this.chart.areas.splice(e,1)[0].dispose(),--e):a.title&&(a.title="",$.each(a.ySeries,function(t,e){var i;"TA_LIB"===e.kind&&(i=Object.keys(e.params).map(function(t){return e.params[t]}),a.title+=(a.title?", ":"")+e.name+(i.length?"("+i.join(",")+")":""))})))}this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}},iChart.Charting.TA.prototype.findArea=function(t){if(void 0!==this.chart&&!$.isEmptyObject(this.chart.areas))for(var e=0;e<this.chart.areas.length;++e){var i=this.chart.areas[e];if(i.name==t)return i}return!1},iChart.Charting.TA.prototype.TRPLN=function(t,e){if(t){var i=$("<canvas>").get(0),t=iChart.getContext(i),i=t.createLinearGradient(0,0,80,0);i.addColorStop(1,"#016D06"),i.addColorStop(.5,"#FF9B08"),i.addColorStop(0,"#FF1608"),t.fillStyle=i,t.fillRect(0,0,80,1);for(var a=t.getImageData(0,0,80,1),r=[],s=0;s<a.data.length;s+=4){var n="rgb("+a.data[s]+","+a.data[s+1]+","+a.data[s+2]+")";r.push(n)}for(var o=this.getData(),h=2,l=Array(80),s=0;s<80;s++){l[s]=TA.SMA.justifyCalculate(0,o.length-1,o,{TimePeriod:h},1);var c=$.extend(!0,{},p);c.name="TRPLN"+(s<79?"_"+s:""),c.indicatorIndex=e,c.color=r[s],c.width=1;for(var d=0;d<l[s].length;d++)c.points.push([0===l[s][d]?null:l[s][d]]);this.chart.areas[0].ySeries.push(c),h+=h<100?2:3}$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:"TRPLN",params:null,data:l}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.createSeries=function(t,e){var i=[];e=e||0;for(var a=0;a<this.chart.env.viewData.indicators[t].output;a++){i[a]=$.extend(!0,{},p);var r=(i[a].indicatorIndex=e)%(this.chart.chartOptions.indicatorColors.length-1),s=this.chart.chartOptions.indicatorColors[r][a];this.chart.env.userSettings.chartSettings.indicatorsColor[t]&&this.chart.env.userSettings.chartSettings.indicatorsColor[t][e]&&this.chart.env.userSettings.chartSettings.indicatorsColor[t][e][a]&&(s=this.chart.env.userSettings.chartSettings.indicatorsColor[t][e][a]);r=2;this.chart.env.userSettings.chartSettings.indicatorsWidth[t]&&this.chart.env.userSettings.chartSettings.indicatorsWidth[t][e]&&this.chart.env.userSettings.chartSettings.indicatorsWidth[t][e][a]&&(r=this.chart.env.userSettings.chartSettings.indicatorsWidth[t][e][a]),i[a].color=s,i[a].width=r,i[a].name=t}return i},iChart.Charting.TA.prototype.getLabels=function(t,e,i){var a,r=[];for(a in i=i||"",e)r.push(e[a]);r=r.length?"("+r.join(",")+")":"";var s=t.color.replace(/rgba\((.+),[^,]+\)/,"rgb($1)"),n=(n=$("<span/>",{class:"m-chart-legend-color"}).css({"background-color":s}).html("&nbsp;")).add($("<span/>",{class:"m-chart-legend-name"}).css({color:s}).text(t.name+r+i));return[[0,$("<div/>").append(n).html(),t.name+r+i]]},iChart.Charting.TA.prototype.BBANDS=function(t,e,i){if(t){var a="BBANDS",i=i||this.getDefaultParams(a),t=this.getData(),r=TA[a].justifyCalculate(0,t.length-1,t,i),s=this.createSeries(a,e);s[0].labels=this.getLabels(s[0],i," Upper"),s[0].params=i;for(var n=0;n<r.UpperBand.length;n++)s[0].points.push([0===r.UpperBand[n]?null:r.UpperBand[n]]);this.chart.areas[0].ySeries.push(s[0]),s[1].labels=this.getLabels(s[1],i," Middle"),s[1].params=i;for(n=0;n<r.MiddleBand.length;n++)s[1].points.push([0===r.MiddleBand[n]?null:r.MiddleBand[n]]);this.chart.areas[0].ySeries.push(s[1]),s[2].labels=this.getLabels(s[2],i," Lower"),s[2].params=i;for(n=0;n<r.LowerBand.length;n++)s[2].points.push([0===r.LowerBand[n]?null:r.LowerBand[n]]);this.chart.areas[0].ySeries.push(s[2]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:r}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.AD=function(t,e,i){if(t){var a="AD",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a);t=new iChart.Charting.ChartArea({chart:this.chart});t.axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title=a,t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.AD.justifyCalculate(0,r.length-1,r),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]),this.chart.areas.push(t);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ADOSC=function(t,e,i){if(t){var a="ADOSC",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA[a].justifyCalculate(0,r.length-1,r,i),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ADX=function(t,e,i){if(t){var a="ADX",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.ADX.justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ADXDI=function(t,e,i){if(t){var a="ADXDI",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].chartArea=t.name,s[0].labels=this.getLabels(s[0],i);var n={},r=this.getData();n.ADX=TA.ADX.justifyCalculate(0,r.length-1,r,i,1);for(var o=0;o<n.ADX.length;o++)s[0].points.push([0===n.ADX[o]?null:n.ADX[o]]);t.ySeries.push(s[0]),s[1].name="ADXDI",s[1].params=i,s[1].chartArea=t.name,s[1].labels=this.getLabels(s[1],i," +DI");r=this.getData();n.PLUS_DI=TA.PLUS_DI.justifyCalculate(0,r.length-1,r,i,1);for(o=0;o<n.PLUS_DI.length;o++)s[1].points.push([0===n.PLUS_DI[o]?null:n.PLUS_DI[o]]);t.ySeries.push(s[1]),s[2].name="ADXDI",s[2].params=i,s[2].chartArea=t.name,s[2].labels=this.getLabels(s[2],i," -DI");r=this.getData();n.MINUS_DI=TA.MINUS_DI.justifyCalculate(0,r.length-1,r,i,1);for(o=0;o<n.MINUS_DI.length;o++)s[2].points.push([0===n.MINUS_DI[o]?null:n.MINUS_DI[o]]);t.ySeries.push(s[2]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.AROON=function(t,e,i){if(t){var a="AROON",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var r=this.getData(),s=TA[a].justifyCalculate(0,r.length-1,r,i),n=this.createSeries(a,e);n[0].chartArea=t.name,n[0].params=i,n[0].labels=this.getLabels(n[0],i," Down");for(var o=0;o<s.AroonDown.length;o++)n[0].points.push([0===s.AroonDown[o]?null:s.AroonDown[o]]);t.ySeries.push(n[0]),n[1].chartArea=t.name,n[1].params=i,n[1].labels=this.getLabels(n[1],i," Up");for(o=0;o<s.AroonUp.length;o++)n[1].points.push([0===s.AroonUp[o]?null:s.AroonUp[o]]);t.ySeries.push(n[1]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ATR=function(t,e,i){if(t){var a="ATR",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.ATR.justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.CCI=function(t,e,i){if(t){var a="CCI",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.CCI.justifyCalculate(0,r.length-1,r,i),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.CHV=function(t,e,i){if(t){var a="CHV",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.CHV.justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.DPO=function(t,e,i){if(t){var a="DPO",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.DPO.justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.EMA=function(t,e,i){if(t){var a="EMA";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var t=this.getData(),s=TA.EMA.justifyCalculate(0,t.length-1,t,i),n=0;n<s.length;n++)r[0].points.push([0===s[n]?null:s[n]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ENV=function(t,e,i){if(t){var a="ENV";i=i||this.getDefaultParams(a);var t=this.getData(),r=TA.ENV.justifyCalculate(0,t.length-1,t,i,1),s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[1],i," Upper");for(var n=0;n<r.Upper.length;n++)s[0].points.push([0===r.Upper[n]?null:r.Upper[n]]);this.chart.areas[0].ySeries.push(s[0]),s[1].labels=this.getLabels(s[0],i," Lower");for(n=0;n<r.Lower.length;n++)s[1].points.push([0===r.Lower[n]?null:r.Lower[n]]);this.chart.areas[0].ySeries.push(s[1]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:r}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.MACD=function(t,e,i){if(t){var a="MACD",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a);var t=this.getData(),s=TA[a].justifyCalculate(0,t.length-1,t,i),t=new iChart.Charting.ChartArea({chart:this.chart});t.axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="";r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var n=this.createSeries(a,e);n[0].params=i,n[0].indicatorIndex=e,n[0].labels=this.getLabels(n[0],i);for(var o=0;o<s.MACD.length;o++)n[0].points.push([0===s.MACD[o]?null:s.MACD[o]]);t.ySeries.push(n[0]),n[1].params=i,n[1].indicatorIndex=e,n[1].labels=this.getLabels(n[1],i);for(o=0;o<s.MACDSignal.length;o++)n[1].points.push([0===s.MACDSignal[o]?null:s.MACDSignal[o]]);t.ySeries.push(n[1]),n[2].params=i,n[2].indicatorIndex=e,n[2].chartType="Column",n[2].labels=this.getLabels(n[2],i);for(o=0;o<s.MACDHist.length;o++)n[2].points.push([0===s.MACDHist[o]?null:s.MACDHist[o]]);t.ySeries.push(n[2]),this.chart.areas.push(t);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.MEDPRICE=function(t,e,i){if(t){var a="MEDPRICE";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var t=this.getData(),s=TA[a].justifyCalculate(0,t.length-1,t,i),n=0;n<s.length;n++)r[0].points.push([0===s[n]?null:s[n]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.MFI=function(t,e,i){if(t){var a="MFI",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.MFI.justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.OBV=function(t,e,i){if(t){var a="OBV",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a);t=new iChart.Charting.ChartArea({chart:this.chart});t.axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t);r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.OBV.justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.PSAR=function(t,e,i){if(t){var a="PSAR";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i),r[0].chartType="Point";for(var t=this.getData(),s=TA.SAR.justifyCalculate(0,t.length-1,t,i),n=0;n<s.length;n++)r[0].points.push([0===s[n]?null:s[n]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ROC=function(t,e,i){if(t){var a="ROC",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i),s[0].chartArea=t.name;for(var r=this.getData(),n=TA.ROC.justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.RSI=function(t,e,i){if(t){var a="ChartAreaI_"+e+"_RSI";i=i||this.getDefaultParams("RSI"),(t=this.findArea(a))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=a,t.title="",t.overlay=new iChart.Charting.ChartAreaLayer(this.chart),(r=t.overlay.createElement("HorizontalLine")).points=[{x:$.now(),y:30}],r.hasSettings=!0,r.setSettings({drawLabel:!1,strokeStyle:"#ff5555",lineWidth:1}),t.overlay.history.push(r),(r=t.overlay.createElement("HorizontalLine")).points=[{x:$.now(),y:70}],r.hasSettings=!0,r.setSettings({drawLabel:!1,strokeStyle:"#ff5555",lineWidth:1}),t.overlay.history.push(r),this.chart.areas.push(t));var r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+"RSI"+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries("RSI",e);s[0].params=i,s[0].labels=this.getLabels(s[0],i);for(var r=this.getData(),n=TA.RSI.justifyCalculate(0,r.length-1,r,i),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:"RSI",params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.SMA=function(t,e,i){if(t){i=i||this.getDefaultParams("SMA");var a=this.createSeries("SMA",e);a[0].params=i,a[0].labels=this.getLabels(a[0],i);for(var t=this.getData(),r=TA.SMA.justifyCalculate(0,t.length-1,t,i,1),s=0;s<r.length;s++)a[0].points.push([0===r[s]?null:r[s]]);this.chart.areas[0].ySeries.push(a[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:"SMA",params:i,data:r}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.STDDEV=function(t,e,i){if(t){var a="STDDEV",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i),s[0].chartArea=t.name;for(var r=this.getData(),n=TA[a].justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.TEMA=function(t,e,i){if(t){var a="TEMA";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var t=this.getData(),s=TA.TEMA.justifyCalculate(0,t.length-1,t,i,1),n=0;n<s.length;n++)r[0].points.push([0===s[n]?null:s[n]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.TRIMA=function(t,e,i){if(t){var a="TRIMA";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var t=this.getData(),s=TA[a].justifyCalculate(0,t.length-1,t,i),n=0;n<s.length;n++)r[0].points.push([0===s[n]?null:s[n]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.TYPPRICE=function(t,e,i){if(t){var a="TYPPRICE";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var t=this.getData(),s=TA[a].justifyCalculate(0,t.length-1,t,i),n=0;n<s.length;n++)r[0].points.push([0===s[n]?null:s[n]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.VPT=function(t,e,i){if(t){var a="VPT",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a);t=new iChart.Charting.ChartArea({chart:this.chart});t.axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t);r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i),s[0].indicatorIndex=e;for(var r=this.getData(),n=TA.VPT.justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.WCLPRICE=function(t,e,i){if(t){var a="WCLPRICE";i=i||this.getDefaultParams(a);var r=this.createSeries(a,e);r[0].params=i,r[0].labels=this.getLabels(r[0],i);for(var t=this.getData(),s=TA[a].justifyCalculate(0,t.length-1,t,i),n=0;n<s.length;n++)r[0].points.push([0===s[n]?null:s[n]]);this.chart.areas[0].ySeries.push(r[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.WILLR=function(t,e,i){if(t){var a="WILLR",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a),(t=this.findArea(r))||((t=new iChart.Charting.ChartArea({chart:this.chart})).axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title="",this.chart.areas.push(t));r=Object.keys(i).map(function(t){return i[t]});t.title+=(t.title?", ":"")+a+(r.length?"("+r.join(",")+")":""),t.onClose=function(){this.chart.clearIndicators(this)};var s=this.createSeries(a,e);s[0].params=i,s[0].labels=this.getLabels(s[0],i),s[0].indicatorIndex=e;for(var r=this.getData(),n=TA[a].justifyCalculate(0,r.length-1,r,i,1),o=0;o<n.length;o++)s[0].points.push([0===n[o]?null:n[o]]);t.ySeries.push(s[0]);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:n}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.WMA=function(t,e,i){if(t){i=i||this.getDefaultParams("WMA");var a=this.createSeries("WMA",e);a[0].params=i,a[0].labels=this.getLabels(a[0],i);for(var t=this.getData(),r=TA.WMA.justifyCalculate(0,t.length-1,t,i,1),s=0;s<r.length;s++)a[0].points.push([0===r[s]?null:r[s]]);this.chart.areas[0].ySeries.push(a[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:"WMA",params:i,data:r}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.STOCH=function(t,e,i){if(t){var a="STOCH",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a);t=new iChart.Charting.ChartArea({chart:this.chart});t.axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title=a,t.overlay=new iChart.Charting.ChartAreaLayer(this.chart),t.onClose=function(){this.chart.clearIndicators(this)};var r=this.getData(),s=TA[a].justifyCalculate(0,r.length-1,r,i),n=this.createSeries(a,e);n[0].params=i,n[0].indicatorIndex=e,n[0].labels=this.getLabels(n[0],i,"K");for(var o=0;o<s.slowK.length;o++)n[0].points.push([0===s.slowK[o]?null:s.slowK[o]]);t.ySeries.push(n[0]),n[1].params=i,n[1].indicatorIndex=e,n[1].labels=this.getLabels(n[1],i,"D");for(o=0;o<s.slowD.length;o++)n[1].points.push([0===s.slowD[o]?null:s.slowD[o]]);t.ySeries.push(n[1]);r=t.overlay.createElement("HorizontalLine");r.points=[{x:$.now(),y:20}],r.hasSettings=!0,r.setSettings({drawLabel:!1,strokeStyle:"#ff5555",lineWidth:1}),t.overlay.history.push(r),(r=t.overlay.createElement("HorizontalLine")).points=[{x:$.now(),y:80}],r.hasSettings=!0,r.setSettings({drawLabel:!1,strokeStyle:"#ff5555",lineWidth:1}),t.overlay.history.push(r),this.chart.areas.push(t);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ELDR=function(t,e,i){if(t){var a="ELDR",r="ChartAreaI_"+e+"_"+a;i=i||this.getDefaultParams(a);t=new iChart.Charting.ChartArea({chart:this.chart});t.axisX.showLabels=!1,t.enabled=!0,t.xSeries=this.chart.areas[0].xSeries,t.ySeries=[],t.name=r,t.title=a,t.onClose=function(){this.chart.clearIndicators(this)};var r=this.getData(),s=TA.ELDR.justifyCalculate(0,r.length-1,r,i),n=this.createSeries(a,e);n[0].params=i,n[0].indicatorIndex=e,n[0].chartType="Column",n[0].labels=this.getLabels(n[0],i);for(var o=0;o<s.ELDR.length;o++)n[0].points.push([0===s.ELDR[o]?null:s.ELDR[o]]);t.ySeries.push(n[0]),n[1].params=i,n[1].indicatorIndex=e,n[1].name="Signal",n[1].labels=this.getLabels(n[1],i);for(o=0;o<s.Signal.length;o++)n[1].points.push([0===s.Signal[o]?null:s.Signal[o]]);t.ySeries.push(n[1]),n[2].params=i,n[2].indicatorIndex=e,n[2].name="Smooth",n[2].labels=this.getLabels(n[2],{p:2});for(o=0;o<s.Smooth.length;o++)n[2].points.push([0===s.Smooth[o]?null:s.Smooth[o]]);t.ySeries.push(n[2]),n[3].params=i,n[3].indicatorIndex=e,n[3].name="EMA",n[3].labels=this.getLabels(n[3],i);for(o=0;o<s.EMA.length;o++)n[3].points.push([0===s.EMA[o]?null:s.EMA[o]]);this.chart.areas[0].ySeries.push(n[3]),this.chart.areas.push(t);for(var h=0;h<this.chart.areas.length;++h)this.chart.areas[h].setMinMax();$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:s}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.ZLEMA=function(t,e,i){if(t){var a="ZLEMA";i=i||this.getDefaultParams(a);var t=this.getData(),r=TA[a].justifyCalculate(0,t.length-1,t,i),s=this.createSeries(a,e);s[0].labels=this.getLabels(s[0],i),s[0].params=i;for(var n=0;n<r.length;n++)s[0].points.push([0===r[n]?null:r[n]]);this.chart.areas[0].ySeries.push(s[0]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:a,params:i,data:r}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)},iChart.Charting.TA.prototype.PCH=function(t,e,i){if(t){i=i||this.getDefaultParams("PCH");var t=this.getData(),a=TA.PCH.justifyCalculate(0,t.length-1,t,i),r=this.createSeries("PCH",e);r[0].labels=this.getLabels(r[0],i," Lower"),r[0].params=i;for(var s=0;s<a.low.length;s++)r[0].points.push([0===a.low[s]?null:a.low[s]]);this.chart.areas[0].ySeries.push(r[0]),r[1].labels=this.getLabels(r[1],i," Upper"),r[1].params=i;for(s=0;s<a.high.length;s++)r[1].points.push([0===a.high[s]?null:a.high[s]]);this.chart.areas[0].ySeries.push(r[1]),$(this.chart.env.container).trigger("iguanaChartEvents",["indicatorDataReady",{name:"PCH",params:i,data:a}]),this.chart.render({forceRecalc:!0,resetViewport:!1,testForIntervalChange:!1})}else this.removeIndicator(e)}}(),iChart.Charting.TA.prototype.analyseResistSupport=function(t,e){t=t||8,e=e||0;var i=(i=this.getData()).slice(0,i.length-e),a=[],r=[],s=[];try{s=TA.RSI.justifyCalculate(0,i.length-1,i,{TimePeriod:t})}catch(t){console.log(t)}$.each(i,function(t,e){a.push(e[TA.LOW]),r.push(e[TA.HIGH])});var n,o=13,h=35,l=65,c={p_1:!1,p_2:!1,p_3:!1,p_4:!1};function d(t,e,i,a,r,s,n,o){for(var h=[],l=[],c=[],d=[],p=i.length-1;0<=p;p--)d.push(i[p]);i=d;for(p=0;p<i.length;p++)c.push(i[p][TA.LOW]),l.push(i[p][TA.HIGH]),h.push(a[a.length-1-p]);var u,g,f,m=-1,v=-1,y=!1,C=!1,x=!1,T=1e8,S=0;switch(3!=s?1==o?(C=!0,0<=n&&(t+=n)):(y=!0,0<=n&&(e-=n)):0==o?(C=!0,0<=n&&(e-=n)):(y=!0,0<=n&&(t+=n)),s){case 2:v=r.p_1;break;case 3:v=r.p_2;break;case 4:v=r.p_3}for(p=v;p<i.length&&(u=h[p],g=l[p],f=c[p],1!=x||!(1==C&&e<=u||1==y&&u<=t));p++)1==C?u<=t&&(0==x&&(x=!0),f<T&&(T=f,m=p)):e<=u&&(0==x&&(x=!0),S<=g&&(S=g,m=p));return m}function u(t,e){for(var i=0,a=e[0].x;a<=Math.min(e[1].x,t.length-1);a++)var r=iChart.getThirdPoint({x:e[0].x,y:e[0].y},{x:e[1].x,y:e[1].y},a),i=Math.max(i,Math.abs(r.y-(t[a][TA.OPEN]+t[a][TA.CLOSE])/2));return i}function p(t,e,i,a,r){for(var s="d"+(a=a||"d"),n={},o={},h=[],l=!1,c=u(t,e),d=t.length-1;d>=e[0].x;d--){o={index:d,time:t[d][TA.FULLTIME],h:t[d][TA.HIGH],l:t[d][TA.LOW],o:t[d][TA.OPEN],c:t[d][TA.CLOSE],av1:(t[d][TA.OPEN]+t[d][TA.CLOSE])/2,av2:(t[d][TA.HIGH]+t[d][TA.LOW])/2};var p=iChart.getThirdPoint({x:e[0].x,y:e[0].y},{x:e[1].x,y:e[1].y},d);o.dh=Math.abs(p.y-o.h),o.dl=Math.abs(p.y-o.l),o.do=Math.abs(p.y-o.o),o.dc=Math.abs(p.y-o.c),o.dav1=Math.abs(p.y-o.av1),o.dav2=Math.abs(p.y-o.av2),d==e[2].x||d==e[3].x?(h.push(o),n=$.extend({},o),l=!0,d--):$.isEmptyObject(n)?(n=$.extend({},o),o[s]/c<r&&(h.push(o),l=!0)):(o[s]>n[s]&&!l&&n[s]/c<r&&(h.push(n),l=!0),"support"==i?o[s]<n[s]&&l&&.15<Math.abs(h[h.length-1][a]-n[a])/c&&(l=!1):"resist"==i&&o[s]>n[s]&&l&&.15<Math.abs(h[h.length-1][a]-n[a])/c&&(l=!1),n=$.extend({},o))}if("support"==i)for(d=0;d<h.length;d++)(void 0!==t[h[d].index-1]&&Math.abs(t[h[d].index-1][TA.HIGH]-h[d].l)/c<.005||void 0!==t[h[d].index+1]&&Math.abs(t[h[d].index+1][TA.HIGH]-h[d].l)/c<.005)&&(h.splice(d,1),--d);else if("resist"==i)for(d=0;d<h.length;d++)(void 0!==t[h[d].index-1]&&Math.abs(t[h[d].index-1][TA.HIGH]-h[d].l)/c<.005||void 0!==t[h[d].index+1]&&Math.abs(t[h[d].index+1][TA.HIGH]-h[d].l)/c<.005)&&(h.splice(d,1),--d);return h}if(function(){if(c.p_1=function(t,e,i,a,r){for(var s=[],n=[],o=[],h=i.length-1;0<=h;h--)o.push(i[h][TA.LOW]),n.push(i[h][TA.HIGH]),s.push(a[h]);for(var l=-1,c=!1,d=!0,p=!0,u=1e8,g=0,h=0;h<i.length;h++){var f=s[h],m=n[h],v=o[h];if(0==c){if(f<=t||e<=f)continue;c=!0}if(f<t){if(1!=p)break;1==d&&(d=!1,0<=r&&(e-=r)),v<u&&(u=v,l=h)}if(e<f){if(1!=d)break;1==p&&(p=!1,0<=r&&(t+=r)),g<m&&(g=m,l=h)}}return l}(h,l,i,s,o),c.p_1<0)console.log("analyseResistSupport: В истории недостаточно баров для анализа 1");else if(0<c.p_1&&(n=function(t,e,i){for(var a=[],r=e.length-1;0<=r;r--)void 0!==e[r]&&a.push(e[r]);return!(a[t.p_1]<=i)}(c,s,h)),c.p_2=d(h,l,i,s,c,2,o,n),c.p_2<0)console.log("analyseResistSupport: В истории недостаточно баров для анализа 2");else if(c.p_3=d(h,l,i,s,c,3,o,n),c.p_3<0)console.log("analyseResistSupport: В истории недостаточно баров для анализа 3");else{if(c.p_4=d(h,l,i,s,c,4,o,n),!(c.p_4<0))return 1;console.log("analyseResistSupport: В истории недостаточно баров для анализа 4")}}()){var g=[];n?(g[0]=[i[i.length-1-c.p_1][TA.FULLTIME],i[i.length-1-c.p_1][TA.HIGH],i.length-1-c.p_1],g[1]=[i[i.length-1-c.p_2][TA.FULLTIME],i[i.length-1-c.p_2][TA.LOW],i.length-1-c.p_2],g[2]=[i[i.length-1-c.p_3][TA.FULLTIME],i[i.length-1-c.p_3][TA.HIGH],i.length-1-c.p_3],g[3]=[i[i.length-1-c.p_4][TA.FULLTIME],i[i.length-1-c.p_4][TA.LOW],i.length-1-c.p_4]):(g[0]=[i[i.length-1-c.p_1][TA.FULLTIME],i[i.length-1-c.p_1][TA.LOW],i.length-1-c.p_1],g[1]=[i[i.length-1-c.p_2][TA.FULLTIME],i[i.length-1-c.p_2][TA.HIGH],i.length-1-c.p_2],g[2]=[i[i.length-1-c.p_3][TA.FULLTIME],i[i.length-1-c.p_3][TA.LOW],i.length-1-c.p_3],g[3]=[i[i.length-1-c.p_4][TA.FULLTIME],i[i.length-1-c.p_4][TA.HIGH],i.length-1-c.p_4]);var f=iChart.getIntersection({x:g[0][2],y:g[0][1]},{x:g[2][2],y:g[2][1]},{x:g[1][2],y:g[1][1]},{x:g[3][2],y:g[3][1]}),m=g[3][2]-(g[0][2]-g[3][2]),m=Math.max(m,0),v=g[0][2]+(g[0][2]-g[3][2]),v=Math.min(v,this.chart.areas[0].xSeries.length-1),y=0,e=this.chart.areas[0].xSeries.length-1;f.x<g[3][2]&&(y=f.x),f.x>g[0][2]&&(e=f.x),m=Math.floor(Math.max(m,y)),v=Math.ceil(Math.min(v,e,this.chart.areas[0].xSeries.length-1,y?i.length+15:i.length+30));var C=!1,x=[],T=!1,S=[];if(n){for(var A=g[3][2];m<=A;A--){var w=iChart.getThirdPoint({x:g[1][2],y:g[1][1]},{x:g[3][2],y:g[3][1]},A);Math.max(i[A][TA.OPEN],i[A][TA.CLOSE])<w.y&&(C=!0),C||(w.time=i[A][TA.FULLTIME],x[0]=w);var P=iChart.getThirdPoint({x:g[0][2],y:g[0][1]},{x:g[2][2],y:g[2][1]},A);T||(P.time=i[A][TA.FULLTIME],S[0]=P),Math.min(i[A][TA.OPEN],i[A][TA.CLOSE])>P.y&&(T=!0)}x[1]=iChart.getThirdPoint({x:g[1][2],y:g[1][1]},{x:g[3][2],y:g[3][1]},v),x[1].time=1e3*this.chart.areas[0].xSeries[v],x[2]={x:g[1][2],y:g[1][1],time:g[1][0]},x[3]={x:g[3][2],y:g[3][1],time:g[3][0]},S[1]=iChart.getThirdPoint({x:g[0][2],y:g[0][1]},{x:g[2][2],y:g[2][1]},v),S[1].time=1e3*this.chart.areas[0].xSeries[v],S[2]={x:g[0][2],y:g[0][1],time:g[0][0]},S[3]={x:g[2][2],y:g[2][1],time:g[2][0]}}else{for(A=g[3][2];m<=A;A--){w=iChart.getThirdPoint({x:g[0][2],y:g[0][1]},{x:g[2][2],y:g[2][1]},A);C||(w.time=i[A][TA.FULLTIME],x[0]=w),(Math.max(i[A][TA.OPEN],i[A][TA.CLOSE])<w.y||w.y<0)&&(C=!0);P=iChart.getThirdPoint({x:g[1][2],y:g[1][1]},{x:g[3][2],y:g[3][1]},A);Math.min(i[A][TA.OPEN],i[A][TA.CLOSE])>P.y&&(T=!0),T||(P.time=i[A][TA.FULLTIME],S[0]=P)}x[1]=iChart.getThirdPoint({x:g[0][2],y:g[0][1]},{x:g[2][2],y:g[2][1]},v),x[1].time=1e3*this.chart.areas[0].xSeries[v],x[2]={x:g[0][2],y:g[0][1],time:g[0][0]},x[3]={x:g[2][2],y:g[2][1],time:g[2][0]},S[1]=iChart.getThirdPoint({x:g[1][2],y:g[1][1]},{x:g[3][2],y:g[3][1]},v),S[1].time=1e3*this.chart.areas[0].xSeries[v],S[2]={x:g[1][2],y:g[1][1],time:g[1][0]},S[3]={x:g[3][2],y:g[3][1],time:g[3][0]}}u(i,x),u(i,S);return{extremeSupports:p(i,x,"support","l",.05),extremeResist:p(i,S,"resist","h",.05),supportPoints:x,resistPoints:S,points:g,lastPoint:{x:i.length-1,y:i[i.length-1][TA.CLOSE],time:i[i.length-1][TA.FULLTIME]}}}return!1},iChart.Charting.TA.prototype.autoResistSupport=function(t,e){t=!!t;var i=this.analyseResistSupport(8,e);if(i){this.clearResistSupport();if((2<i.extremeSupports.length||t)&&((r=this.chart.overlay.createElement("Line")).points=[{x:i.supportPoints[0].time,y:i.supportPoints[0].y},{x:i.supportPoints[1].time,y:i.supportPoints[1].y}],r.drawType="auto",r.storageEnable=!1,r.controlEnable=!1,r.id="SR_analyzer",this.chart.overlay.history.push(r)),(2<i.extremeResist.length||t)&&((r=this.chart.overlay.createElement("Line")).points=[{x:i.resistPoints[0].time,y:i.resistPoints[0].y},{x:i.resistPoints[1].time,y:i.resistPoints[1].y}],r.drawType="auto",r.storageEnable=!1,r.controlEnable=!1,r.id="SR_analyzer",this.chart.overlay.history.push(r)),this.analyser(i),t){t=(t=this.getData()).slice(0,t.length-e);(r=this.chart.overlay.createElement("Event")).hasSettings=!0,r.drawType="auto",r.settings={color:"blue",size:5,shape:"triangle"},r.id="SR_analyzer",r.points=[{x:i.lastPoint.time,y:i.lastPoint.y}],this.chart.overlay.history.push(r),(r=this.chart.overlay.createElement("Polygon")).points=[{x:i.points[2][0],y:i.points[2][1]},{x:i.points[0][0],y:i.points[0][1]},{x:i.points[1][0],y:i.points[1][1]},{x:i.points[3][0],y:i.points[3][1]}],r.storageEnable=!1,r.drawType="auto",r.id="SR_analyzer",this.chart.overlay.history.push(r);for(var a=0;a<i.extremeSupports.length;a++)(r=this.chart.overlay.createElement("Trade")).hasSettings=!0,r.settings={type_id:1,qb:"",mode:1,date_time:"",summ:i.extremeSupports[a].dl/i.extremeSupports[a].l*100},r.points=[{x:i.extremeSupports[a].time,y:i.extremeSupports[a].l}],r.id="SR_analyzer",this.chart.overlay.history.push(r);for(var r,a=0;a<i.extremeResist.length;a++)(r=this.chart.overlay.createElement("Trade")).hasSettings=!0,r.drawType="auto",r.settings={type_id:0,qb:"",mode:1,date_time:"",summ:i.extremeResist[a].dh/i.extremeResist[a].h*100},r.points=[{x:i.extremeResist[a].time,y:i.extremeResist[a].h}],r.id="SR_analyzer",this.chart.overlay.history.push(r)}this.chart.overlay.render()}},iChart.Charting.TA.prototype.clearResistSupport=function(){for(var t=this.chart.overlay.history,e=0;e<t.length;e++)"SR_analyzer"==t[e].id&&(t.splice(e,1),e--);this.chart.overlay.render()},iChart.Charting.TA.prototype.testInPast=function(t){this.clearResistSupport(),this.autoResistSupport(1,t)},iChart.Charting.TA.prototype.analyser=function(t,e){e=e||0;var i=iChart.getLineEquation(t.resistPoints[0],t.resistPoints[1],t.lastPoint.x),a=iChart.getLineEquation(t.supportPoints[0],t.supportPoints[1],t.lastPoint.x),r=Math.abs(i.y-a.y),i=(i.y-t.lastPoint.y)/r*100,r=(t.lastPoint.y-a.y)/r*100;return Math.abs(i)<10?e?2:1:Math.abs(r)<10&&(e?1:2)},iChart.Charting.TA.prototype.analyserSearch=function(t,e){for(var i=0,a=0,r=0,s=0,n=0,o=t=t||this.chart.areas[0].xSeries.length-100;0<o;o--){var h,l,c=this.analyseResistSupport(8,o);c&&((h=this.analyser(c,e))&&(a=a||h,(l=this.chart.overlay.createElement("Event")).hasSettings=!0,l.drawType="auto",l.setSettings({color:1==h?"#f742d0":"#085fff",size:5,shape:"triangle",dataRS:c,pointFormatter:function(){},onHover:function(){var t=this.layer.chart.overlay.createElement("Line");t.points=[{x:this.settings.dataRS.resistPoints[0].time,y:this.settings.dataRS.resistPoints[0].y},{x:this.settings.dataRS.resistPoints[1].time,y:this.settings.dataRS.resistPoints[1].y}],t.drawType="auto",t.storageEnable=!1,t.controlEnable=!1,t.id="SR_view",this.layer.chart.overlay.history.push(t),(t=this.layer.chart.overlay.createElement("Line")).points=[{x:this.settings.dataRS.supportPoints[0].time,y:this.settings.dataRS.supportPoints[0].y},{x:this.settings.dataRS.supportPoints[1].time,y:this.settings.dataRS.supportPoints[1].y}],t.drawType="auto",t.storageEnable=!1,t.controlEnable=!1,t.id="SR_view",this.layer.chart.overlay.history.push(t);for(var e=0;e<this.settings.dataRS.extremeSupports.length;e++)(t=this.layer.chart.overlay.createElement("Trade")).hasSettings=!0,t.settings={type_id:1,qb:"",mode:1,date_time:"",summ:this.settings.dataRS.extremeSupports[e].dl/this.settings.dataRS.extremeSupports[e].l*100},t.points=[{x:this.settings.dataRS.extremeSupports[e].time,y:this.settings.dataRS.extremeSupports[e].l}],t.id="SR_view",this.layer.chart.overlay.history.push(t);for(e=0;e<this.settings.dataRS.extremeResist.length;e++)(t=this.layer.chart.overlay.createElement("Trade")).hasSettings=!0,t.drawType="auto",t.settings={type_id:0,qb:"",mode:1,date_time:"",summ:this.settings.dataRS.extremeResist[e].dh/this.settings.dataRS.extremeResist[e].h*100},t.points=[{x:this.settings.dataRS.extremeResist[e].time,y:this.settings.dataRS.extremeResist[e].h}],t.id="SR_view",this.layer.chart.overlay.history.push(t)},onOut:function(){for(var t=this.layer.chart.overlay.history,e=0;e<t.length;e++)"SR_view"==t[e].id&&(t.splice(e,1),e--);this.layer.chart.overlay.render()}}),l.id="SR_analyserSearch",l.points=[{x:c.lastPoint.time,y:c.lastPoint.y}],this.chart.overlay.history.push(l),i!=h&&(1==h?s+=c.lastPoint.y:s-=c.lastPoint.y,console.log(h,c.lastPoint,s),n=c.lastPoint.y,r=i=h),this.chart.overlay.render()))}a==r&&(1==a?s-=n:s+=n),console.log("Profit: ",s)};